import{aU as I,aV as ce,aW as Uc,aX as Ni,ao as O,ah as X,ac as w,a8 as mt,J as Nc,aa as ln,T as xs,aY as Fi,aZ as Da,a_ as Fc,a$ as Wi,b0 as Wc,b1 as cn,b2 as Hi,b3 as Hc,b4 as Gc,b5 as zc,b6 as jc,b7 as ye,b8 as Qc,ap as ge,aq as b,ab as _e,b9 as qc,ba as Kc,bb as Zc,av as un,ax as Gi,o as Je,a2 as Ea,z as Yc,a7 as Jc,h as _t,bc as Ra,bd as en,be as Va,al as F,bf as B,bg as v,aQ as C,bh as se,at as ze,as as f,bi as nt,aR as L,aS as zi,bj as q,aP as P,bk as _,aI as Vt,aJ as Tt,bl as $e,bm as xe,aL as ne,bn as Xc,bo as eu,bp as ji,bq as Pt,aA as dt,br as bo,bs as Qi,bt as J,bu as H,bv as G,bw as tu,aT as lo,bx as Xe,by as nu,bz as ou,bA as Jo,bB as au,bC as Ta,bD as su,bE as iu,bF as qi,bG as ru,ae,ar as Pa,bH as be,bI as lu,bJ as de,bK as co,au as Ln,ai as kt,bL as Ki,bM as Zi,ad as le,d as Yi,aF as ht,bN as cu,bO as ua,bP as dn,aj as Ji,bQ as Ee,bR as uu,bS as En,ak as du,Q as Xi,bT as Qt,bU as pu,bV as fu,bW as mu,B as gu,aw as Ut,bX as vu,bY as hu,bZ as er,b_ as tr,aD as nr,C as Au,aE as _o,b$ as yu,c0 as wu,c1 as Su,c2 as Cu,c3 as bu,c4 as _u,c5 as Iu,c6 as ku,c7 as Du}from"./vendor-4f1ecac8.js";import{E as Io,N as nn,W as uo,V as or,u as xn,a as te,_ as z,b as qt,c as ko,d as ot,e as Re,f as Un,g as ao,h as Pe,i as Eu,j as K,k as fe,l as Ru,A as ar,m as sr,n as qe,o as Do,p as pt,q as Vu,T as Tu,D as Us,L as Pu,r as sn,s as Mt,t as pe,v as ue,w as da,x as Ns,y as ir,z as Mu,B as Ou,C as Lu,F as St,G as Bu,H as rr,I as Kt,J as Ne,K as Fe,M as We,O as so,P as io,Q as Ke,R as $u,S as Rn,U as Fs,X as It,Y as ke,Z as Be,$ as Ws,a0 as xu,a1 as Eo,a2 as wt,a3 as Uu,a4 as Ye,a5 as Nu,a6 as Fu,a7 as Wu,a8 as pa,a9 as lr,aa as fa,ab as cr,ac as Jn,ad as Hs,ae as Hu,af as Gu,ag as zu,ah as ju}from"./vuetify-cabfe194.js";import{V as Qe,v as De,a as ur,I as rn,b as Ue,c as at,i as Qu,d as dr,m as W,e as pr,f as Ro,g as Vo,h as Ma,j as To,k as Ct,l as qu,n as Ku,o as Zu,p as Yu,q as Ju,C as Xu,r as ed,D as td,R as nd,s as od,t as rt,u as po,w as Oa,x as ad,y as sd,z as id,A as rd,B as ld,E as cd,F as fo,G as fr,H as Nt,J as ud,K as dd,L as mr,M as pd,S as fd,N as md,O as Po,P as gd,Q as vd,T as hd,U as gr,W as mo,X as Ad,Y as yd,Z as At,_ as Nn,$ as Mo,a0 as wd,a1 as go,a2 as Sd,a3 as Cd,a4 as La,a5 as bd,a6 as _d,a7 as vr,a8 as hr,a9 as Ar,aa as Id,ab as kd,ac as Dd,ad as Ba,ae as yr,af as wr,ag as Ed,ah as Sr,ai as Cr,aj as Rd,ak as br,al as _r,am as Ir,an as Vd,ao as Td,ap as Pd,aq as Md,ar as Gs,as as Od,at as Ld,au as Bd,av as $d}from"./vtk.js-460198e0.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))o(a);new MutationObserver(a=>{for(const i of a)if(i.type==="childList")for(const s of i.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&o(s)}).observe(document,{childList:!0,subtree:!0});function n(a){const i={};return a.integrity&&(i.integrity=a.integrity),a.referrerPolicy&&(i.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?i.credentials="include":a.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function o(a){if(a.ep)return;a.ep=!0;const i=n(a);fetch(a.href,i)}})();const Xn=e=>{const t=new URL(document.location),n=t.origin,o=t.pathname.split("/");return o.pop(),n+o.join("/")+e},Ht={pipelineWorkerUrl:Xn("/itk/itk-wasm-pipeline.min.worker.js"),imageIOUrl:Xn("/itk/image-io"),meshIOUrl:Xn("/itk/mesh-io"),pipelinesUrl:Xn("/itk/pipelines")},xd=/^(https?|ftp|file|wss?):$/;class Ud extends URL{constructor(t,n){super(t,n),this._proto=this.protocol}set protocol(t){this._proto=t}get protocol(){return this._proto}replaceProtocol(t){const n=new RegExp(`^${super.protocol}`);return t.replace(n,this._proto)}get origin(){return this.replaceProtocol(super.origin)}get href(){return this.replaceProtocol(super.href)}toString(){return this.replaceProtocol(super.toString())}}function Ot(e,t){let n=new URL(e,t);if(xd.test(n.protocol))return n;const o=n.protocol,a=new RegExp(`^${o}`);return n=new Ud(e.replace(a,"ws:"),t==null?void 0:t.replace(a,"ws:")),n.protocol=o,n}function $a(e){return e}function vo(){let e=null,t=null;const n=i=>{e&&e(i)},o=i=>{t&&t(i)};return{promise:new Promise((i,s)=>{e=i,t=s}),resolve:n,reject:o}}function ft(e,t){const n=e.indexOf(t);n>-1&&e.splice(n,1)}function kr(e,t,n){return Math.min(n,Math.max(t,e))}function Vn(e,...t){return t.reduce((n,o)=>({...n,[o]:e[o]}),{})}function Dr(e,t){const n=[[],[]];return t.forEach(o=>{const a=e(o)?0:1;n[a].push(o)}),n}function Nd(e,t){const n=[[],[]];return t.forEach(o=>e(o)?n[0].push(o):n[1].push(o)),n}const Fd=(e,t,n)=>(e in t||(t[e]=n),t[e]);function Wd(e,t){if(e.length!==t.length)return!1;for(let n=0;n<e.length;n++)if(e[n]!==t[n])return!1;return!0}function Hd(e,t,n){if(e.length!==t.length)return!1;for(let o=0;o<e.length;o++)if(!n(e[o],t[o]))return!1;return!0}function ma(e){return Array.isArray(e)?e:[e]}function Gd(e,t=2){if(!+e)return"0 Bytes";const n=1024,o=t<0?0:t,a=["Bytes","KB","MB","GB","TB","PB","EB","ZB","YB"],i=Math.floor(Math.log(e)/Math.log(n));return`${parseFloat((e/n**i).toFixed(o))} ${a[i]}`}function zd(e,t=Io){const n=Math.round(e);return Math.abs(n-e)<=t?n:e}function jd(e,t){return t in e}function zs(e,t){return Object.fromEntries(Object.entries(e).map(([n,o])=>{if(jd(t,n))return[t[n],o];throw new Error(`Key ${n} not found in keyMap`)}))}const Qd=(e,t)=>Object.fromEntries(Object.entries(e).filter(([n])=>!ma(t).includes(n)));function xa(e){return e instanceof Error?e:new Error(JSON.stringify(e))}function qd(e){return Object.entries(e).reduce((t,[n,o])=>o===void 0?t:{...t,[n]:o},{})}function Er(e){const[t,...n]=Object.keys(e);return I.enum([t,...n])}function Oo(e){return e!=null}const Kd=["Uint8Array","Uint8ClampedArray","Uint16Array","Uint32Array","Int8Array","Int16Array","Int32Array","Float32Array","Float64Array"],Rr=e=>Object.entries(e);function js(e,t){const n=e.map(a=>a[t]),o=e.reduce((a,i)=>({...a,[i[t]]:i}),{});return{order:n,byKey:o}}var He=(e=>(e[e.Error=0]="Error",e[e.Warning=1]="Warning",e[e.Info=2]="Info",e[e.Success=3]="Success",e))(He||{});const Ze=ce("message",{state:()=>({_nextID:1,byID:{},msgList:[]}),getters:{messages(){return this.msgList.map(e=>this.byID[e])},importantMessages(){return this.messages.filter(e=>e.type!==3)}},actions:{addError(e,t){return t instanceof Error?this._addMessage({type:0,title:e},{details:String(t),persist:!1}):this._addMessage({type:0,title:e},t)},addWarning(e,t){return this._addMessage({type:1,title:e},t)},addInfo(e,t){return this._addMessage({type:2,title:e},t)},addSuccess(e,t){return this._addMessage({type:3,title:e},t)},clearOne(e){e in this.byID&&(ft(this.msgList,e),delete this.byID[e])},clearAll(){this.byID={},this.msgList=[]},_addMessage(e,t){const n=String(this._nextID++),o={persist:!1,...typeof t=="string"?{details:t}:t};return this.byID[n]={...e,options:o,id:n},this.msgList.push(n),n}}});function Vr(e){let t=e;for(;t;)t!==e?console.error("The above error was caused by:",t):console.error(t),t instanceof Error?t=t.cause:t=null}const Qs={debug:nn,log:nn,info:nn,warn:nn,error:nn},Zd=Uc({position:"bottom-left",timeout:3e3,hideProgressBar:!0,maxToasts:3,transition:"Vue-Toastification__fade"}),Tr=()=>Zd,eo={Loading:"Loading datasets...",Done:"Datasets loaded!",Error:"Some files failed to load"},qs={type:Ni.INFO,timeout:!1,closeButton:!1,closeOnClick:!1};function Yd(){const e=Ze(),t=O(0),n=O(),o=()=>{t.value+=1},a=()=>{t.value!==0&&(t.value-=1)},i=p=>{n.value=p},s=Tr();let r=null;const l=()=>{r==null?r=s.info(eo.Loading,qs):s.update(r,{content:eo.Loading,options:qs})},c=()=>{if(r==null)return;const p=n.value;n.value=null,p?(Vr(p),s.dismiss(r),e.addError(eo.Error,p)):s.update(r,{content:eo.Done,options:{type:Ni.SUCCESS,timeout:3e3,closeButton:"button",closeOnClick:!0,onClose(){r=null}}})};return X(t,p=>{p?l():c()}),{isLoading:w(()=>t.value>0),startLoading:o,stopLoading:a,setError:i}}const ho=ce("loadData",()=>{const{startLoading:e,stopLoading:t,setError:n,isLoading:o}=Yd();return{segmentGroupExtension:O(""),isLoading:o,startLoading:e,stopLoading:t,setError:n}}),Jd="data:image/jpeg;base64,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",Xd="data:image/jpeg;base64,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",e1="data:image/jpeg;base64,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",t1="data:image/jpeg;base64,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",n1="data:image/jpeg;base64,/9j/4AAQSkZJRgABAQEAYABgAAD/4QAiRXhpZgAATU0AKgAAAAgAAQESAAMAAAABAAEAAAAAAAD/2wBDAAIBAQIBAQICAgICAgICAwUDAwMDAwYEBAMFBwYHBwcGBwcICQsJCAgKCAcHCg0KCgsMDAwMBwkODw0MDgsMDAz/2wBDAQICAgMDAwYDAwYMCAcIDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAz/wAARCACAAIADASIAAhEBAxEB/8QAHwAAAQUBAQEBAQEAAAAAAAAAAAECAwQFBgcICQoL/8QAtRAAAgEDAwIEAwUFBAQAAAF9AQIDAAQRBRIhMUEGE1FhByJxFDKBkaEII0KxwRVS0fAkM2JyggkKFhcYGRolJicoKSo0NTY3ODk6Q0RFRkdISUpTVFVWV1hZWmNkZWZnaGlqc3R1dnd4eXqDhIWGh4iJipKTlJWWl5iZmqKjpKWmp6ipqrKztLW2t7i5usLDxMXGx8jJytLT1NXW19jZ2uHi4+Tl5ufo6erx8vP09fb3+Pn6/8QAHwEAAwEBAQEBAQEBAQAAAAAAAAECAwQFBgcICQoL/8QAtREAAgECBAQDBAcFBAQAAQJ3AAECAxEEBSExBhJBUQdhcRMiMoEIFEKRobHBCSMzUvAVYnLRChYkNOEl8RcYGRomJygpKjU2Nzg5OkNERUZHSElKU1RVVldYWVpjZGVmZ2hpanN0dXZ3eHl6goOEhYaHiImKkpOUlZaXmJmaoqOkpaanqKmqsrO0tba3uLm6wsPExcbHyMnK0tPU1dbX2Nna4uPk5ebn6Onq8vP09fb3+Pn6/9oADAMBAAIRAxEAPwD+f+iiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAopQu6koAKKKKACiiigAooAzQRigAooooAKKKKACiiigAoopyDmgBwGBQRmiigBpSm7cVJRQAwLmlC113wi+EmofFnXWt7W1v5ba3UvNJbQGQr6dBgfU19nfAb/glr4X8c+Eoxqq60NYuPmjPmbUA9MAdaAPgUcU1xkV7l+2t+yvB+zL4zWzhmmWGYfuo5eXOOprK/Y4+BN18a/ilD/ovnafpeLifev7tz/Ch9cnt6ZoA8gor2r9uP9l68/Zp+KEGy3kTw/wCJYWvtLl8srGMNiWAHuY2IGOu14yeteK0AFFFFABRRRQAVteDfh/rnxB1KOy0PSr7VLqVgqR28RdiT9K+hf2Af2I7f9oOSbXfEUi22hwyeVbo52i4YH52z/dB+X3O70r7V8V6Z8OPgFolh4d8M6xptrrxcRrDbICQexLigD458A/8ABGf46eNmt2udBsPD0Nwu8Pqd6sbBfXam4/pXtGi/8G/esC2jXV/iRptrduuWW0017iKM/wC8zoT+Qr6o/Z1/4Kkab+zDFd2fjfwrY+LtSjBEUmoTllT/AIDg5zXt2nf8Fcrb49/DK/s4vAnhnTLeVhHbCC1H2kZP8Mgx/KgD8NP2tP2M/E37I3ieG11aa11bSb0sLPVLPPkT7TypB5Rx/dP4E15HHH50gUFV3cZNfsZ8fPhTa/G6G+8J69ZzwaX4iiL2Erx/8e1x/Cyn1zX5bftHfsveKv2XvHr6D4o024s5W+e2uCn7m7jzw6N0I/Ud6AP0e/YY/Zh1r4e/sy6BrFjrGlHTvESB5Le3YNcXLHqTjsDx1zX0faazf/s1+FX1aS4hs5rGF3WSeIbgpB3cEdewr8iP2XP2z9X/AGeYrdWa41LT7ViI7VrhlWLJzlOoHPtXWftj/wDBSfxd+099ls5J49N02MBnjthtM3++e9AHL/td/E/WP2vf2lLibd5kt1L5MC/wQRg//rJ9TX3X+xj8BNJ+DngbS9PspE3T/wCk3ly6/NM5HI/AcAV8dfsT+FZPFXjKO6t7L7dcXziBGKZZT7V+p3hXQNC+HPgTT7M2Lzal5ZDSTfdD99v0oA8L/wCCj3wyt/2mv2YpNF02FTrXh2dtR0KErtkdkUiVAf8ApqmRjOCwQnpX4+spVsEYI4IPav2w8G6ZcfEb4jXt9qWV8PaUxluXQhGSJD0B/wBo8V+dv/BVP9nnT/g9+0K/iDw7ZfYfCvjhW1O1gUlls5y376HJ7EkSAdAJcDhaAPmGiiigArQ8KeHJ/F3iK0023/1l1IE3YyI16sx9gMk/Ss+u4+Hmo23gvwtf6m//ACErwfZ7UZ+5H/EfxOB+HvQB7B4w/aUuPDeiWPgvwvJ/Zmn2sKWnmBuWUDGSfUnJJ7kmuZ1XwX4n8M6208knm3EMYuIZVfKyAc5Bryi1u21HVWmlydxyQK7nU/H2oS+D47NppmjQbF3nO1fQfSgB2o/FjVde1sT6lI0shPLE5OK+0vgn+1V4X+EngjRvsVj9qvmRZp5HAYqRg4C9Me/Wvz40i4Q3zNIzMqnJHrXoscV9qnhw3mnmSR7ZfmjA+YD6elAH6xfsv/8ABWfwt+0f8TIfDfijwPpcOjRyxxfaI8C4gYcCZeMDHUgds07/AIK8/D6w+KX7MXiLTltYr688Nv8AbtMnMWZAnUsrYzhl6ivyP+DPxF1LwP8AEyG4jjmFzIwXZyM5r9if+Cc3jpP2lbe10nxe0NyzKbCSOfpKABhTnrwcUAfh1feHrq00Jrzy/wBwr7Cf7pqno9j/AGxfQw7lVm45r7I/4LKfsaWv7IHx+vrPQoJrXw7qkhuLeEnKRZ5Kj2Ga+SPCGlNqGuwtCrBU5z70Afb/APwTJ/aM8C/sq+J7m71+EXdx5e2HcoZYmPBOPWvqD4w/tj6H8aooV03zlaQl1dePl9BXxN+yR8Kfh14o8Ywt42+3XmAzrBBOYUkYdmI5x9CK+uJ/DvheEQ2PhTR7CxKxhoSp3uvbBLZNAFvSPiPJrGhro+n27Q2bSpJdA8NcEdAx9B1xmq/7cvwD0r9pD4MTeHrGZbrX4Y1u7AwgeTaXag7Yyf8AaUlD6B89RW54C+D2oXupQ28UzXV1cMVkVBnYT6mu7vP2c9W+Fctva280k95dMNifew5/w96APwpvrGbTL2a2uIZILi3dopYpFKvGynBUg8ggjGKir7h/4LYfsF3X7LXxS0PxpDIk2nfECJpb9UGPsmpLzID7SqRID1LCX0FfD1AE1jaNfXSRL/EefYV0lnJDdDybiNpIUARVQ4aP0rndM1GTS7xJo8Er1B6MPSu08BTWev8Ai6Fol8lpDkoeeaAPT/AvwLsrvTNP1CSOT7NcYydnOfesL44aa+mag1na2+LO1XYJAv3s96+7/h14a8O6F8BYbqSOJ2htTyccsR6eua+XPi3rC3Ph64s5oYtzyeZDII/mwegzQB8v2cK2spkf7oODXonh/wCLEnw/t0vtLby7jYYyxCurAjkYNZnjvwRa6NoK3LbleZfu4xg1xebf+x3VvM87Py88YoA+hf2QPD6/Hr486c2qRwtbyN1C7RwM8V9R/s0+P5fA3xA8RaHaSMJNM1d5IJFOCCrYAz+FfFHwO8S3/hq0sZtF1FrfULNmn2D5W/A96+vP2N7db/4S3XiS7vLGTWTqDySxlv37c9T/AJ70AdJ/wWp+Ly/F/wCFGh3eooP7Sg2oXI5YjA6V8LfAbRIXhurmaNm8mEhBjv617V/wUJ+Jf/C29b0/T4vuwMN+37qmpZvhbY+CvAmniP8AcLJahiW4ZzjqfagDwvwX41uvCPxCt7hd21JCQoPHPqK+2f2e9VuPEurabqmpXS6PpDEeewPzSZ9PSviHxAkekawZ45VlmDE7EBNfTf7PCav8U9PsYX3x2sCguo+7/wDroA/T7w98Q/A3h+xtofBNvKyxoGub+ccM2P4e5PvXZ/D6wt7qca1dGa8+zv5+ZO7HoK8q/ZK+EdnPa2c2sTTGyhcLBZxDMk59XPZa9/8AH97DpOis9vHb2VhDny0LYXPvQB8Vf8FWdIt/2gvD2saTrEiRreQ409m/5dpk+aNwOwDcHHVSw71+KOqaZcaLqdxZ3UTQXVrI0UsbdUZTgg/Qiv0o/wCClv7X1n4C8SXVkZoNR8QXQDwW0Z/494z0Z8fdU9h1b6cj82/EWv3XinXLrUr2TzLq8lMsrYxkn2oAp1JZ3s2n3Uc0EjRTRncrKcEGo6KAPWPBv7T+vWm22uNSnhhk4f5iYX9yvY+4rurjxVceONZsoo1juUuQoBXBA+hr5trc8C/EPVPh3rkF/psyrJA4by5F3xPznBX39sGgD6E/a10WDw34E0u0+yrHcTOHMpGGHH3a+bJCoLKo3eteo/Hj9q+6/aD06xj1TS7bT5rCMRr9kP7t/fB5H0yfrXlG9Wk+VuvrQB6R8GrFpbh5lkaGW3iZkJ4xxWr4I+PN98ONTke3mmkdpSxiDYRieDmo/g1bSalod6oX5vKIEin2rP0/4WX/ANujmuIMxySZB65OaAPSPh94V1P4l+LodQlhIjvZASpOcc819V+Nv2frbx62i2MFvJdOqLHK0bfKB0wazv2WvBKw6PHaXFitvM0YIkYfd/Gv0C/Z8+E3hXwn8HZvEWoSW8hhG9pZnCRoRn1NAHxr8f8A/gnbovw9+A1ncr/YOlzo3mybSJLuTjnc3XArn/2bLWys9KttL09hClrlmfbhpD3PvV79tr9vDwDLqN5Y/wDCSaZfxvlPI09/tRQemUyAcepFfKOpf8FIl8DCaPwP4djEzrtW91Y7tvusKHH0y59x2oA/T7wx8a7f4K+Fm1C81Wx0LQ4EzdahqEyxIhJxjcxAyegA5J4HNfEf7dn/AAWkuPG5k8O/CqS6TTo1Mcmu3kRV5Sepghblf9+QZ64QHDV8P/Fj46eLfjjrP27xVrt/q8iHMUcj7YLftiOJcIg452gZ6nJrk6ALGravd6/qc97fXVxe3l05lmnnkMksznkszNksT6mq9FFABRRRQAUUUUAFFFFAE9nql1p4YW9xPAG6iOQrn8q2dG+KviLQAv2XWL6Pa25dz+ZtPtuziufooA7q+/ab+IWoXImbxn4iidV2DyL54Fx9EIHfrjNc34g8e654tiSPVda1bU0jG1Fu7uSYKMk4AYnHJJ/E1k0UAFFFFABRRRQAUUUUAf/Z";var Ve=(e=>(e.V="V",e.H="H",e))(Ve||{});const re={Coronal:"Coronal",Sagittal:"Sagittal",Axial:"Axial",Three:"3D",ObliqueCoronal:"ObliqueCoronal",ObliqueSagittal:"ObliqueSagittal",ObliqueAxial:"ObliqueAxial",ObliqueThree:"Oblique3D"},Gt={[re.Coronal]:{viewType:"2D",props:{viewDirection:"Posterior",viewUp:"Superior"}},[re.Sagittal]:{viewType:"2D",props:{viewDirection:"Right",viewUp:"Superior"}},[re.Axial]:{viewType:"2D",props:{viewDirection:"Superior",viewUp:"Anterior"}},[re.ObliqueCoronal]:{viewType:"Oblique",props:{viewDirection:"Posterior",viewUp:"Superior"}},[re.ObliqueSagittal]:{viewType:"Oblique",props:{viewDirection:"Right",viewUp:"Superior"}},[re.ObliqueAxial]:{viewType:"Oblique",props:{viewDirection:"Superior",viewUp:"Anterior"}},[re.Three]:{viewType:"3D",props:{viewDirection:"Posterior",viewUp:"Superior"}},[re.ObliqueThree]:{viewType:"Oblique3D",props:{viewDirection:"Posterior",viewUp:"Superior",slices:[{viewID:re.ObliqueSagittal,axis:"Sagittal"},{viewID:re.ObliqueCoronal,axis:"Coronal"},{viewID:re.ObliqueAxial,axis:"Axial"}]}}},o1=Gt[re.Axial],a1="Quad View",Ao=[{name:"Axial Only",direction:Ve.H,items:[re.Axial]},{name:"Axial Primary",direction:Ve.V,items:[re.Axial,{direction:Ve.H,items:[re.Three,re.Coronal,re.Sagittal]}]},{name:"3D Primary",direction:Ve.V,items:[re.Three,{direction:Ve.H,items:[re.Coronal,re.Sagittal,re.Axial]}]},{name:"Quad View",direction:Ve.H,items:[{direction:Ve.V,items:[re.Coronal,re.Three]},{direction:Ve.V,items:[re.Sagittal,re.Axial]}]},{name:"Oblique View",direction:Ve.H,items:[{direction:Ve.V,items:[re.ObliqueCoronal,re.ObliqueThree]},{direction:Ve.V,items:[re.ObliqueSagittal,re.ObliqueAxial]}]},{name:"3D Only",direction:Ve.H,items:[re.Three]}].reduce((e,t)=>({...e,[t.name]:t}),{}),s1=[{name:"CTA Head and Neck",filename:"CTA-Head_and_Neck.zip",description:"CTA head and neck scan of elderly patient with tumor. (80 MB)",url:"https://data.kitware.com/api/v1/item/6347159711dab81428208e24/download",image:t1},{name:"MRA Head and Neck",filename:"MRA-Head_and_Neck.zip",description:'MRA from Patient Contributed Image Repository. Click application help icon "(?)" for more info. (15 MB)',url:"https://data.kitware.com/api/v1/item/6352a2b311dab8142820a33b/download",image:e1},{name:"MRI Cardiac 3D and Cine",filename:"MRI-Cardiac-3D_and_Cine.zip",description:"MRI scan with two series: 3D axial non-gated and 2 chamber cine. (4 MB)",url:"https://data.kitware.com/api/v1/item/6350b28f11dab8142820949d/download",image:Jd},{name:"MRI PROSTATEx",filename:"MRI-PROSTATEx-0004.zip",description:'MRI from the SPIE-AAPM-NCI PROSTATEx challenge. Click application help "(?)" icon for more info. (3 MB)',url:"https://data.kitware.com/api/v1/item/63527c7311dab8142820a338/download",image:Xd},{name:"3D US Fetus",filename:"3DUS-Fetus.mha",description:"3D ultrasound of a baby. Downloaded from tomovision.com.(8 MB)",url:"https://data.kitware.com/api/v1/item/635679c311dab8142820a4f4/download",image:n1,defaults:{colorPreset:"US-Fetal"}}],yo=["#58f24c","#8de4d3","#f0a4b1","#a3c9fe","#c8f251","#fea53b"],Pr=1,i1={red:{color:"red"},green:{color:"#00ff00"},white:{color:"#ffffff"}},r1={artifact:{color:"#888888"},innocuous:{color:"#00ff00"},lesion:{color:"red"}},l1={red:{color:"red"},green:{color:"#00ff00"},white:{color:"#ffffff"}},ga={CT:"CT-AAA",MR:"CT-Coronary-Arteries-2",US:"US-Fetal"},c1="CT-AAA",u1={...ga,PT:"2hot-opaque"},Ks="Blue to Red Rainbow",d1={windowLevel:"l",pan:"n",zoom:"z",ruler:"m",paint:"p",rectangle:"r",crosshairs:"c",crop:"b",polygon:"g",mergeNewPolygon:"Shift",select:"s",nextSlice:"arrowdown",previousSlice:"arrowup",decrementLabel:"q",incrementLabel:"w",deleteCurrentImage:"ctrl+.",clearScene:"ctrl+/",showKeyboardShortcuts:"?"},p1=[{value:1,name:"Tissue",color:[255,0,0,255],visible:!0},{value:2,name:"Liver",color:[0,255,0,255],visible:!0},{value:3,name:"Heart",color:[0,0,255,255],visible:!0}],Zs=[[214,0,0],[59,255,1],[0,0,172],[151,255,0],[126,209,107],[79,255,165],[87,59,0],[86,89,0],[221,0,253],[161,117,105],[182,255,149],[119,191,3],[100,84,116],[0,0,7],[216,253,244],[0,75,0],[121,0,255],[102,237,184],[93,126,102],[228,255,235],[119,165,123],[89,0,163],[198,0,158],[0,156,59],[202,195,0],[130,151,0],[137,130,135],[93,54,59],[0,0,253],[255,189,230],[219,109,1],[184,181,228],[255,47,82],[195,102,144],[98,31,196],[114,3,130],[105,230,128],[38,144,109],[255,77,51],[133,163,1],[3,202,193],[196,196,86],[117,87,61],[103,66,0],[212,218,223],[249,255,0],[103,175,195],[0,225,205],[218,149,255],[3,253,145],[130,160,0],[86,154,84],[140,142,54],[38,151,165],[142,140,94],[70,0,200],[249,174,109],[110,207,167],[255,140,140],[177,119,54],[255,160,121],[0,31,255],[68,94,17],[103,151,147],[94,147,75],[116,82,145],[170,112,49],[207,253,0],[107,96,52],[144,212,47],[212,124,80],[161,77,35],[124,89,0],[205,68,130],[207,77,253],[137,0,61],[82,91,0],[156,170,130],[128,112,142],[100,253,195],[137,205,40],[255,154,181],[93,186,33],[1,0,142],[98,128,35],[135,191,151],[212,205,126],[209,182,91],[0,110,153],[68,175,198],[242,255,209],[235,1,205],[188,68,0],[121,156,126],[112,70,147],[186,0,84],[172,147,235],[163,22,94],[128,0,75],[124,184,211],[42,0,56],[100,184,0],[255,128,61],[209,232,128],[89,33,52],[161,93,110],[181,175,158],[70,51,124],[193,65,0],[232,61,107],[232,117,188],[165,196,168],[84,110,216],[56,251,124],[75,100,73],[195,235,121],[54,75,142],[70,135,255],[0,195,233],[212,255,188],[70,72,0],[198,255,144],[233,79,105],[230,93,177],[144,175,87],[42,175,93],[133,109,225],[110,114,228],[226,184,182],[56,45,0],[126,163,172],[47,168,186],[105,181,130],[209,144,175],[70,7,94],[0,151,137],[15,1,91],[128,47,87],[228,100,59],[63,40,114],[188,75,82],[200,121,221],[49,144,200],[242,5,170],[167,107,154],[175,0,96],[98,242,221],[119,68,1],[36,65,103],[202,121,158],[12,232,161],[247,219,131],[117,142,109],[226,65,47],[73,107,121],[133,255,207],[75,93,198],[179,145,255],[237,214,239],[191,96,38],[163,181,188],[0,135,110],[255,47,161],[232,175,51],[75,184,140],[107,135,82],[147,209,26],[253,161,59],[163,80,168],[0,151,137],[123,89,87],[249,142,138],[214,124,112],[1,24,89],[22,38,255],[216,86,247],[253,121,149],[177,167,212],[207,221,0],[175,121,70],[218,255,230],[5,177,242],[255,163,228],[137,19,35],[103,130,232],[112,216,170],[223,186,212],[82,105,117],[154,151,51],[228,114,126],[89,38,119],[105,47,61]];function zt(e,t,n,o){t in e||(e[t]={}),e[t][n]={...e[t][n],...o}}function hn(e,t){Object.keys(e).forEach(n=>{delete e[n][t]})}function An(e,t,n){var o;return t==null||n==null?null:(o=e[t])==null?void 0:o[n]}const Ys=0,pn=ce("id",()=>{let e=Ys;return{nextId(){return String(++e)},reset(){e=Ys}}}),Ua=["Sagittal","Coronal","Axial"];function an(){return{Sagittal:0,Coronal:0,Axial:0}}function Mr(){return{Sagittal:[0,0],Coronal:[0,0],Axial:[0,0]}}function yt(e,t,n){const o=2*n[t];return e.slice(o,o+2)}function Te(e){switch(e){case"Superior":case"Inferior":return"Axial";case"Left":case"Right":return"Sagittal";case"Posterior":case"Anterior":return"Coronal";default:throw new Error(`Invalid LPS direction: ${e}`)}}function f1(e){switch(e){case"Sagittal":return Qe.YZ_PLANE;case"Coronal":return Qe.XZ_PLANE;case"Axial":return Qe.XY_PLANE;default:throw new Error(`Invalid LPS axis: ${e}`)}}const Or=()=>({Left:mt(1,0,0),Right:mt(-1,0,0),Posterior:mt(0,1,0),Anterior:mt(0,-1,0),Superior:mt(0,0,1),Inferior:mt(0,0,-1),Sagittal:0,Coronal:1,Axial:2});function Na(e){const t=[0,1,2],n=[0,1,2],o=Or();for(let a=0;a<3;a++){let i=0,s=[0,0],r=[0,0];t.forEach((g,A)=>{n.forEach((y,h)=>{const S=e[g*3+y];Math.abs(S)>Math.abs(i)&&(i=S,s=[g,y],r=[A,h])})});const[l,c]=s,u=e.slice(l*3,(l+1)*3),p=Math.sign(i),d=u.map(g=>g*p),m=u.map(g=>g*-p);c===0?(o.Left=d,o.Right=m,o.Sagittal=l):c===1?(o.Posterior=d,o.Anterior=m,o.Coronal=l):c===2&&(o.Superior=d,o.Inferior=m,o.Axial=l),t.splice(r[0],1),n.splice(r[1],1)}return o}var tt=(e=>(e.Rectangle="Rectangle",e.Ruler="Ruler",e.Polygon="Polygon",e))(tt||{}),oe=(e=>(e.WindowLevel="WindowLevel",e.Pan="Pan",e.Zoom="Zoom",e.Crop="Crop",e.Paint="Paint",e.Select="Select",e.Crosshairs="Crosshairs",e.Rectangle="Rectangle",e.Ruler="Ruler",e.Polygon="Polygon",e))(oe||{}),Lo=(e=>(e.DICOM="dicom",e.IMAGE="image",e))(Lo||{});const m1=I.nativeEnum(Lo),g1=I.union([I.literal("Left"),I.literal("Right"),I.literal("Posterior"),I.literal("Anterior"),I.literal("Superior"),I.literal("Inferior")]),v1=I.object({id:I.string(),path:I.string(),type:m1}),h1=I.object({archiveSrc:I.object({path:I.string()}).optional(),uriSrc:I.object({uri:I.string(),name:I.string()}).optional()}),Lr=h1.extend({parent:I.lazy(()=>Lr.optional())}),A1=I.nativeEnum(Ve),Br=I.lazy(()=>I.object({name:I.string().optional(),direction:A1,items:I.array(I.union([Br,I.string()]))})),ut=I.tuple([I.number(),I.number(),I.number()]),y1=I.object({width:I.number(),level:I.number(),min:I.number(),max:I.number(),auto:I.string(),preset:I.object({width:I.number(),level:I.number()})}),w1=I.object({slice:I.number(),min:I.number(),max:I.number(),axisDirection:g1,syncState:I.boolean()}),S1=I.object({parallelScale:I.number().optional(),position:ut.optional(),focalPoint:ut.optional(),directionOfProjection:ut.optional(),viewUp:ut.optional(),syncState:I.boolean().optional()}),Fa=I.object({arrayName:I.string(),location:I.string()}),C1=I.object({position:I.number(),height:I.number(),width:I.number(),xBias:I.number(),yBias:I.number()}),b1=I.object({x:I.number(),y:I.number(),midpoint:I.number(),sharpness:I.number()}),_1=I.object({mode:I.literal(De.Mode.Gaussians),gaussians:C1.array(),mappingRange:I.tuple([I.number(),I.number()])}),I1=I.object({mode:I.literal(De.Mode.Points),preset:I.string(),shift:I.number(),shiftAlpha:I.number(),mappingRange:I.tuple([I.number(),I.number()])}),k1=I.object({mode:I.literal(De.Mode.Nodes),nodes:b1.array(),mappingRange:I.tuple([I.number(),I.number()])}),Wa=I.union([_1,I1,k1]),Ha=I.object({preset:I.string(),mappingRange:I.tuple([I.number(),I.number()])});I.object({colorBy:Fa,transferFunction:Ha,opacityFunction:Wa});const D1=I.object({enabled:I.boolean(),lightFollowsCamera:I.boolean(),volumeQuality:I.number(),useVolumetricScatteringBlending:I.boolean(),volumetricScatteringBlending:I.number(),useLocalAmbientOcclusion:I.boolean(),laoKernelSize:I.number(),laoKernelRadius:I.number(),ambient:I.number(),diffuse:I.number(),specular:I.number()}),E1=I.object({colorBy:Fa,transferFunction:Ha,opacityFunction:Wa,cvr:D1}),R1=I.object({opacity:I.number(),visibility:I.boolean()}),V1=I.object({colorBy:Fa,transferFunction:Ha,opacityFunction:Wa,blendConfig:R1}),T1=I.object({outlineOpacity:I.number(),outlineThickness:I.number()}),P1=I.object({window:y1.optional(),slice:w1.optional(),layers:V1.optional(),segmentGroup:T1.optional(),camera:S1.optional(),volumeColorConfig:E1.optional()}),M1=I.object({id:I.string(),type:I.string(),props:I.record(I.any()),config:I.record(P1)}),O1=I.tuple([I.number(),I.number(),I.number(),I.number()]),L1=I.object({value:I.number(),name:I.string(),color:O1,visible:I.boolean().default(!0)}),B1=I.object({name:I.string(),parentImage:I.string(),segments:I.object({order:I.number().array(),byValue:I.record(I.string(),L1)})}),$1=I.object({id:I.string(),path:I.string(),metadata:B1});I.union([I.literal("Axial"),I.literal("Sagittal"),I.literal("Coronal")]);const x1=I.object({planeOrigin:ut,planeNormal:ut}),$r=I.object({imageID:I.string(),frameOfReference:x1,slice:I.number(),id:I.string(),name:I.string(),color:I.string(),strokeWidth:I.number().optional(),label:I.string().optional(),labelName:I.string().optional()}),Ga=e=>I.object({tools:I.array(e),labels:I.record(e.partial())}),xr=$r.extend({firstPoint:ut,secondPoint:ut}),U1=Ga(xr),N1=xr.extend({fillColor:I.string().optional()}),F1=Ga(N1),W1=$r.extend({id:I.string(),points:I.array(ut)}),H1=Ga(W1),G1=I.object({position:ut}),z1=I.nativeEnum(oe),j1=I.object({activeSegmentGroupID:I.string().nullable(),activeSegment:I.number().nullish(),brushSize:I.number(),labelmapOpacity:I.number().optional()}),Q1=I.object({Sagittal:I.tuple([I.number(),I.number()]),Coronal:I.tuple([I.number(),I.number()]),Axial:I.tuple([I.number(),I.number()])}),q1=I.record(Q1),K1=I.object({rulers:U1.optional(),rectangles:F1.optional(),polygons:H1.optional(),crosshairs:G1,paint:j1,crop:q1,current:z1}),Z1=I.object({selectionKey:I.string(),sourceSelectionKeys:I.string().array()}).array(),Y1=I.object({version:I.string(),datasets:v1.array(),remoteFiles:I.record(Lr.array()),labelMaps:$1.array(),tools:K1,views:M1.array(),primarySelection:I.string().optional(),layout:Br,parentToLayers:Z1}),Bo=e=>({fileSrc:{file:e,fileType:e.type}}),Ur=(e,t)=>({uriSrc:{uri:e,name:t}}),J1=(e,t)=>({...Bo(e),...Ur(t,e.name)});function Nr(e){return!!e.uriSrc||!!e.parent&&Nr(e.parent)}function Bn(e){var t;if(e!=null&&e.fileSrc)return e.fileSrc.file.name;if(e!=null&&e.uriSrc)return e.uriSrc.name;if((t=e==null?void 0:e.dicomSrc)!=null&&t.sources.length){const{sources:n}=e.dicomSrc,[o]=n,a=n.length>1?` (+${n.length-1} more)`:"";return`${Bn(o)}${a}`}return null}function Fr(e){const t={...e};return delete t.fileSrc,t.parent&&(t.parent=Fr(t.parent)),t}const jt=ce("files",{state:()=>({byDataID:{}}),getters:{getDataSources:e=>t=>e.byDataID[t]??[],getFiles:e=>t=>(e.byDataID[t]??[]).map(n=>n.fileSrc.file)},actions:{remove(e){e in this.byDataID&&delete this.byDataID[e]},add(e,t){this.byDataID[e]=t}}});async function Wr(e,t,n){const o=jt(),{zip:a}=e,{manifest:{datasets:i,remoteFiles:s}}=e;t.forEach(r=>{const l=o.getDataSources(r);if(!l.length)throw new Error(`No files for dataID: ${r}`);const[c,u]=Dr(Nr,l);s[r]=c.map(Fr);const p=`data/${r}/`;u.forEach(d=>{const{file:m}=d.fileSrc,g=`${p}/${m.name}`;a.file(g,m)}),i.push({id:r,path:p,type:n})})}const X1=Io*100;function Js(e){const t=e.getExtent(),n=[];for(let o=0;o<2;o++)for(let a=0;a<2;a++)for(let i=0;i<2;i++)n.push(e.indexToWorld([t[o],t[a],t[i]]));return n}function Hr(e,t,n=X1){const o=Js(e),a=Js(t);return o.every(i=>a.some(s=>ur(i,s,n)))}const wo=()=>({name:"(none)",orientation:Nc(),lpsOrientation:Or(),spacing:mt(1,1,1),origin:ln(),dimensions:mt(1,1,1),worldBounds:[0,1,0,1,0,1],worldToIndex:xs(),indexToWorld:xs()}),Ae=ce("images",{state:()=>({idList:[],dataIndex:Object.create(null),metadata:Object.create(null)}),actions:{addVTKImageData(e,t,n){if(n&&n in this.dataIndex)throw new Error("ID already exists");const o=n||pn().nextId();return this.idList.push(o),this.dataIndex[o]=t,this.metadata[o]={...wo(),name:e},this.updateData(o,t),o},updateData(e,t){if(e in this.metadata){const n={name:this.metadata[e].name,dimensions:t.getDimensions(),spacing:t.getSpacing(),origin:t.getOrigin(),orientation:t.getDirection(),lpsOrientation:Na(t.getDirection()),worldBounds:t.getBounds(),worldToIndex:t.getWorldToIndex(),indexToWorld:t.getIndexToWorld()};this.metadata[e]=n,this.dataIndex[e]=t}this.dataIndex[e]=t},deleteData(e){e in this.dataIndex&&(delete this.dataIndex[e],delete this.metadata[e],ft(this.idList,e))},checkAllImagesSameSpace(){if(this.idList.length<2)return!1;const e=this.dataIndex[this.idList[0]];return this.idList.slice(1).every(n=>Hr(this.dataIndex[n],e))},async serialize(e){const t=jt(),n=this.idList.filter(o=>o in t.byDataID);await Wr(e,n,Lo.IMAGE)}}}),ep=4;let va=null,ha=null;async function tp(){ha||(ha=Fc())}function np(){var t;if(va)return;const e=typeof((t=globalThis.navigator)==null?void 0:t.hardwareConcurrency)=="number"?globalThis.navigator.hardwareConcurrency:ep;va=new Wi(e,Wc)}function yn(){return ha}function op(){return va}async function ap(){await Promise.all([tp(),np()]);try{await Fi(new File([],"a.dcm"))}catch{}try{await Da(new File([],"a.dcm"))}catch{}}function Aa(e){return e.replace(/\//g,"_")}function za(e){return new File([e],Aa(e.name))}async function Gr(e,t,n,o){return Hi(e,t,o,n,{webWorker:yn(),pipelineBaseUrl:Ht.pipelinesUrl,pipelineWorkerUrl:Ht.pipelineWorkerUrl})}async function sp(e,t){const n=await Promise.all(e.map(async(l,c)=>{const p=await t(l,c).arrayBuffer();return{type:cn.BinaryFile,data:{path:c.toString(),data:new Uint8Array(p)}}})),o=["--action","categorize","--memory-io","0","--files",...n.map(l=>l.data.path)],a=[{type:cn.TextStream}],i=await Gr("dicom",o,n,a),s=JSON.parse(i.outputs[0].data.data);return Object.fromEntries(Object.entries(s).map(([l,c])=>[l,c.map(u=>e[parseInt(u,10)])]))}async function ip(e,t){const n={tagsToRead:{tags:t.map(({tag:i})=>i)}},o=await Fi(za(e),{...n,webWorker:yn()}),a=new Map(o.tags);return t.reduce((i,s)=>{const{tag:r,name:l}=s;return a.has(r)?{...i,[l]:a.get(r)}:i},{})}async function rp(e,t=!1){const n=await e.arrayBuffer(),o=[{type:cn.BinaryFile,data:{path:Aa(e.name),data:new Uint8Array(n)}}],a=["--action","getSliceImage","--thumbnail",t.toString(),"--file",Aa(e.name),"--memory-io","0"],i=[{type:cn.Image}];return(await Gr("dicom",a,o,i)).outputs[0].data}async function lp(e){const t=za(e),n=await Hc(t,{webWorker:yn(),mergeSegments:!0});return{...n,outputImage:n.segImage}}async function cp(e){const t=e.map(o=>za(o));return await Gc({webWorkerPool:op(),inputImages:t,singleSortedSeries:!1})}const zr="Anonymous",jr="ANONYMOUS";function up(e,t){return`${e}!!${t}`}const dp=async(e,t)=>{const n=[];if(t==="SEG"){const o=e[0],a=await lp(o);return e.length>1&&n.push("Tried to make one volume from 2 SEG modality files. Using only the first file!"),{modality:"SEG",builtImageResults:a,messages:n}}return{builtImageResults:await cp(e),messages:n}},pp=async(e,t)=>{const o=jt().getFiles(e);if(!o)throw new Error("No files for volume key");const a=await dp(o,t.Modality),i=rn.convertItkToVtkImage(a.builtImageResults.outputImage);return{...a,image:i}},fp=e=>ip(e,[{name:"PatientName",tag:"0010|0010",strconv:!0},{name:"PatientID",tag:"0010|0020",strconv:!0},{name:"PatientBirthDate",tag:"0010|0030"},{name:"PatientSex",tag:"0010|0040"},{name:"StudyInstanceUID",tag:"0020|000d"},{name:"StudyDate",tag:"0008|0020"},{name:"StudyTime",tag:"0008|0030"},{name:"StudyID",tag:"0020|0010",strconv:!0},{name:"AccessionNumber",tag:"0008|0050"},{name:"StudyDescription",tag:"0008|1030",strconv:!0},{name:"Modality",tag:"0008|0060"},{name:"SeriesInstanceUID",tag:"0020|000e"},{name:"SeriesNumber",tag:"0020|0011"},{name:"SeriesDescription",tag:"0008|103e",strconv:!0},{name:"WindowLevel",tag:"0028|1050"},{name:"WindowWidth",tag:"0028|1051"}]),mp=e=>e.trim().replace(/\s+/g," "),ja=e=>mp(e.SeriesDescription||e.SeriesNumber)||e.SeriesInstanceUID,Qr=e=>{const{WindowWidth:t,WindowLevel:n}=e;if(t==null||n==null||t===""||n==="")return[];const o=t.split("\\").map(parseFloat),a=n.split("\\").map(parseFloat);return o.some(i=>Number.isNaN(i))||a.some(i=>Number.isNaN(i))?(console.error("Invalid WindowWidth or WindowLevel DICOM tags"),[]):o.length!==a.length?(console.error("Different numbers of WindowWidth and WindowLevel DICOM tags"),[]):o.map((i,s)=>({width:i,level:a[s]}))},Se=ce("dicom",{state:()=>({sliceData:{},volumeBuildResults:{},patientInfo:{},patientStudies:{},studyInfo:{},studyVolumes:{},volumeInfo:{},volumeStudy:{},studyPatient:{},needsRebuild:{}}),actions:{async importFiles(e){if(!e.length)return[];const t=new Map(e.map(i=>[i.fileSrc.file,i])),n=[...t.keys()],o=await sp(n,$a);if(Object.keys(o).length===0)throw new Error("No volumes categorized from DICOM file(s)");const a=jt();return Object.entries(o).forEach(([i,s])=>{const r=s.map(l=>{const c=t.get(l);if(!c)throw new Error("Did not match File with source DataSource");return c});a.add(i,r)}),await Promise.all(Object.entries(o).map(async([i,s])=>{if(!(i in this.volumeInfo)){const r=await fp(s[0]),l=Object.fromEntries(Object.entries(r).map(([d,m])=>[d,m.trim()])),c={PatientID:l.PatientID||jr,PatientName:l.PatientName||zr,PatientBirthDate:l.PatientBirthDate||"",PatientSex:l.PatientSex||""},u=Vn(l,"StudyID","StudyInstanceUID","StudyDate","StudyTime","AccessionNumber","StudyDescription"),p={...Vn(l,"Modality","SeriesInstanceUID","SeriesNumber","SeriesDescription","WindowLevel","WindowWidth"),NumberOfSlices:s.length,VolumeID:i};this._updateDatabase(c,u,p)}i in Ae().dataIndex&&(this.needsRebuild[i]=!0)})),Object.keys(o)},_updateDatabase(e,t,n){const o=e.PatientID,a=t.StudyInstanceUID,i=n.VolumeID;o in this.patientInfo||(this.patientInfo[o]=e,this.patientStudies[o]=[]),a in this.studyInfo||(this.studyInfo[a]=t,this.studyVolumes[a]=[],this.studyPatient[a]=o,this.patientStudies[o].push(a)),i in this.volumeInfo||(this.volumeInfo[i]=n,this.volumeStudy[i]=a,this.sliceData[i]={},this.studyVolumes[a].push(i))},deleteVolume(e){if(e in this.volumeInfo){const t=this.volumeStudy[e];delete this.volumeInfo[e],delete this.sliceData[e],delete this.volumeStudy[e],e in this.volumeBuildResults&&delete this.volumeBuildResults[e],ft(this.studyVolumes[t],e),this.studyVolumes[t].length===0&&this._deleteStudy(t)}},_deleteStudy(e){if(e in this.studyInfo){const t=this.studyPatient[e];delete this.studyInfo[e],delete this.studyPatient[e],[...this.studyVolumes[e]].forEach(n=>this.deleteVolume(n)),delete this.studyVolumes[e],ft(this.patientStudies[t],e),this.patientStudies[t].length===0&&this._deletePatient(t)}},_deletePatient(e){e in this.patientInfo&&(delete this.patientInfo[e],[...this.patientStudies[e]].forEach(t=>this._deleteStudy(t)),delete this.patientStudies[e])},async serialize(e){const t=Object.keys(this.volumeInfo);await Wr(e,t,Lo.DICOM)},async deserialize(e){return this.importFiles(e).then(t=>{if(t.length!==1)throw new Error("Invalid state file.");return t[0]})},async getVolumeSlice(e,t,n=!1){const o=jt(),a=up(t,n);if(e in this.sliceData&&a in this.sliceData[e])return this.sliceData[e][a];if(!(e in this.volumeInfo))throw new Error(`Cannot find given volume key: ${e}`);const s=this.volumeInfo[e].NumberOfSlices;if(t<1||t>s)throw new Error(`Slice ${t} is out of bounds`);const r=o.getFiles(e);if(!r)throw new Error(`No files found for volume key: ${e}`);const l=r[t-1],c=await rp(l,n);return this.sliceData[e][a]=c,c},async getVolumeThumbnail(e){const{NumberOfSlices:t}=this.volumeInfo[e],n=Math.ceil(t/2);return this.getVolumeSlice(e,n,!0)},async buildVolume(e,t=!1){const n=Ae(),o=e in this.volumeBuildResults,a=t||this.needsRebuild[e]||!o;delete this.needsRebuild[e];const i=o?[this.volumeBuildResults[e]]:[],s=a?pp(e,this.volumeInfo[e]):this.volumeBuildResults[e];this.volumeBuildResults[e]=s;const[r]=await Promise.all([s,...i]);if(n.dataIndex[e])n.updateData(e,r.image);else{const u=this.volumeInfo[e],p=ja(u);n.addVTKImageData(p,r.image,e)}const c=Ze();return r.messages.forEach(u=>{console.warn(u),c.addWarning(u)}),r}}});async function $o(e,t){try{return await t()}catch(n){n instanceof Error&&Ze().addError(e,{details:`${n}. More details can be found in the developer's console.`}),console.error(n)}}const Qa=(e,t)=>e===t,Ge=e=>{if(!e)return!1;const t=Se();return e in t.volumeInfo},Ft=e=>e?!Ge(e):!1,qr=async e=>{const t=Ae(),n=Se();return Ge(e)&&await $o("Failed to build volume",()=>n.buildVolume(e)),t.dataIndex[e]},gp=e=>Ae().metadata[e].name,vp=e=>Ge(e)?ja(Se().volumeInfo[e]):gp(e);async function hp(e,t,n,o=[{type:cn.Image}]){const a=navigator.hardwareConcurrency?navigator.hardwareConcurrency:6,i=n[0],s=Math.min(parseInt(a/2,10),Math.max(i.size[i.size.length-1],1),4),r=s.toString(),l=[...Array(s).keys()].map(m=>{const g=[...[...Array(n.length).keys()].map(y=>y.toString()),"0",...t,"--max-total-splits",r,"--split",m.toString(),"--number-of-splits",r,"--memory-io"],A=n.map(y=>({type:cn.Image,data:zc(y)}));return[e,g,o,A,{pipelineBaseUrl:Ht.pipelinesUrl,pipelineWorkerUrl:Ht.pipelineWorkerUrl}]}),c=new Wi(a,Hi),u=await c.runTasks(l).promise;c.terminateWorkers();const d=u.filter(m=>m.returnValue===0).map(({outputs:m})=>m[0].data);return jc(d)}async function Ap(e,t,n=!1){const o=n?["--label"]:[],{size:a,spacing:i,origin:s,direction:r}=e,l=[...o,"--size",a.join(","),"--spacing",i.join(","),"--origin",s.join(","),"--direction",r.join(",")];return hp("resample",l,[t])}async function Kr(e,t,n=!1){if(Hr(e,t))return t;const o=await Ap(rn.convertVtkToItkImage(e),rn.convertVtkToItkImage(t),n);return rn.convertItkToVtkImage(o)}const st=ce("layer",()=>{const e=O({}),t=O({});async function n(u,p){if(!u)throw new Error("Tried to addLayer without parent data selection");const d=`${u}::${p}`;this.parentToLayers[u]=[...this.parentToLayers[u]??[],{selection:p,id:d}];const[m,g]=await Promise.all([u,p].map(qr));if(!g)throw new Error("Failed to load layer image");if(!Ue.intersects(m.getBounds(),g.getBounds()))throw this.deleteLayer(u,p),new Error("Image bounds do not intersect, so no overlap in physical space");const A=await Kr(m,g);this.layerImages[d]=A}async function o(u,p){return $o("Failed to build layer",async()=>{var d;try{await this._addLayer(u,p)}catch(m){throw this.parentToLayers[u]=(d=this.parentToLayers[u])==null?void 0:d.filter(({selection:g})=>g!==p),m}})}function a(u,p){if(!u)throw new Error("Tried to deleteLayer without parent data selection");const d=this.parentToLayers[u]??[],m=d.find(({selection:g})=>g===p);m&&(this.parentToLayers[u]=d.filter(g=>g!==m),delete this.layerImages[m.id])}function i(u){return u?e.value[u]??[]:[]}const s=u=>Object.values(e.value).flat().flat().find(({id:p})=>p===u),r=u=>{const p=st();p.getLayers(u).forEach(({selection:d})=>p.deleteLayer(d,d)),Object.keys(p.parentToLayers).forEach(d=>p.deleteLayer(d,u))};function l(u){u.manifest.parentToLayers=Object.entries(this.parentToLayers).map(([p,d])=>({selectionKey:p,sourceSelectionKeys:d.map(({selection:m})=>m)}))}function c(u,p){const d=g=>p[g],{parentToLayers:m}=u;m.forEach(({selectionKey:g,sourceSelectionKeys:A})=>{const y=d(g);A.forEach(h=>{const S=d(h);this.addLayer(y,S)})})}return{parentToLayers:e,layerImages:t,_addLayer:n,addLayer:o,deleteLayer:a,remove:r,getLayers:i,getLayer:s,serialize:l,deserialize:c}}),Zr=ce("models",{state:()=>({idList:[],dataIndex:{},metadata:{}}),actions:{addVTKPolyData(e,t){const n=pn().nextId();return this.idList.push(n),this.dataIndex[n]=t,n}}}),Oe=ce("dataset",()=>{const e=Ae(),t=Se(),n=jt(),o=st(),a=Zr(),i=O(null),s=i,r=w(()=>{const{dataIndex:m}=e;return s.value&&m[s.value]||null}),l=w(()=>{const m=Object.keys(t.volumeInfo),g=e.idList.filter(A=>Ft(A));return[...m,...g]});function c(m){i.value=m,m&&Ge(m)&&$o("Failed to build volume",()=>t.buildVolume(m))}async function u(m){if(await t.serialize(m),await e.serialize(m),i.value){const{manifest:g}=m;g.primarySelection=i.value}}const p=m=>{m&&(m===i.value&&(i.value=null),Ge(m)&&t.deleteVolume(m),e.deleteData(m),n.remove(m),o.remove(m))};return{primaryImageID:s,primarySelection:i,primaryDataset:r,idsAsSelections:l,setPrimarySelection:c,serialize:u,remove:p,removeAll:()=>{[...e.idList].forEach(A=>{p(A)}),[...a.idList].forEach(A=>{p(A)})}}}),yp=Symbol("CurrentImage");function Yr(e){const t=Ae();if(e&&e in t.metadata){const{lpsOrientation:n}=t.metadata[e],o=t.dataIndex[e];if(o){const a=o.getSpatialExtent();return{Sagittal:yt(a,"Sagittal",n),Coronal:yt(a,"Coronal",n),Axial:yt(a,"Axial",n)}}}return Mr()}function Jr(e){const{metadata:t}=Ae();return e?t[e]??wo():wo()}function wp(e){const{dataIndex:t}=Ae();return e?t[e]??null:null}function Sp(e){return e?!Ae().dataIndex[e]:!1}function Cp(e){if(!e)return[];const t=st();return t.getLayers(e).filter(({id:n})=>n in t.layerImages)}function Ce(e){return{id:w(()=>b(e)),imageData:w(()=>wp(b(e))),metadata:w(()=>Jr(b(e))),extent:w(()=>Yr(b(e))),isLoading:w(()=>Sp(b(e))),layers:w(()=>Cp(b(e)))}}function me(){const{primaryImageID:e}=ye(Oe()),t={imageID:e},{imageID:n}=Qc()?ge(yp,t):t,{id:o,imageData:a,metadata:i,extent:s,isLoading:r,layers:l}=Ce(n);return{currentImageID:o,currentImageMetadata:i,currentImageData:a,currentImageExtent:s,isImageLoading:r,currentLayers:l}}const bp=(e,t,n)=>{const o=e.manifest.datasets.map(i=>i.id),{views:a}=e.manifest;a.forEach(i=>{o.forEach(s=>{var c;const{config:r}=i,l=(c=t[i.id])==null?void 0:c[s];if(l!==void 0){const u=Fd(s,r,{});u[n]=l}})})},wn=(e,t)=>n=>{bp(n,e,t)},ro=()=>({slice:0,min:0,max:1,axisDirection:"Inferior",syncState:!1}),Dt=ce("viewSlice",()=>{const e=Ae(),t=_e({}),n=(d,m)=>An(t,d,m),o=(d,m,g)=>{const A={...ro(),...n(d,m),...g};A.slice=kr(A.slice,A.min,A.max),zt(t,d,m,A)},a=(d,m)=>{const g=n(d,m);g&&o(d,m,{slice:Math.ceil((g.min+g.max)/2)})},i=d=>{delete t[d]},s=(d,m)=>{var g;m?(g=t[m])==null||delete g[d]:hn(t,d)},r=()=>{Object.keys(t).forEach(d=>{e.idList.forEach(m=>{const{syncState:g}={...ro(),...n(d,m)};o(d,m,{syncState:!g})})})},l=()=>Object.keys(t).every(m=>Object.keys(t[m]).every(g=>t[m][g].syncState)),c=()=>{Object.keys(t).forEach(d=>{const{currentImageID:m}=me(),g=n(d,m.value);e.idList.forEach(A=>{const{syncState:y}={...ro(),...n(d,A)};y&&o(d,A,{slice:g==null?void 0:g.slice})})})},u=wn(t,"slice");return{configs:t,getConfig:n,updateConfig:o,resetSlice:a,removeView:i,removeData:s,toggleSyncImages:r,updateSyncConfigs:c,isSync:l,serialize:u,deserialize:(d,m)=>{Object.entries(m).forEach(([g,A])=>{A.slice&&o(d,g,A.slice)})}}}),ya=()=>({width:1,level:.5,min:0,max:1,auto:uo,preset:{width:1,level:.5}}),Fn=ce("windowing",()=>{const e=_e({}),t=O(!0),n=O(),o=d=>{t.value=d},a=(d,m)=>An(e,d,m),i=(d,m)=>{var A;if(!t.value)return;const g=(A=e[d])==null?void 0:A[m];g&&Object.keys(e).filter(y=>y!==d).forEach(y=>{zt(e,y,m,g)})},s=(d,m,g)=>{var A;zt(e,d,m,{...ya(),...(A=e[d])==null?void 0:A[m],...g}),t.value&&i(d,m)},r=(d,m)=>{var S;const g=(S=e[d])==null?void 0:S[m];if(g==null)return;let{width:A,level:y}=g.preset;const h=ya();A===h.width&&y===h.level&&(A=g.max-g.min,y=(g.max+g.min)/2),s(d,m,{width:A,level:y})},l=d=>{delete e[d]},c=(d,m)=>{var g;m?(g=e[m])==null||delete g[d]:hn(e,d)},u=wn(e,"window");return{runtimeConfigWindowLevel:n,configs:e,getConfig:a,setSyncAcrossViews:o,updateConfig:s,resetWindowLevel:r,removeView:l,removeData:c,serialize:u,deserialize:(d,m)=>{Object.entries(m).forEach(([g,A])=>{A.window&&s(d,g,A.window)})}}});function Xr(e,t){var o,a;const n=(a=(o=t.getRenderWindow())==null?void 0:o.getViews())==null?void 0:a[0];if(n){const[i,s,r]=e;return n.worldToDisplay(i,s,r,t)}return null}function _p(e,t){const n=t.getCanvas();if(!n)return null;const o=n.getBoundingClientRect(),a=n.width/o.width,i=n.height/o.height;return[a*(e.clientX-o.left),i*(o.height-e.clientY+o.top)]}function Ip(e,t,n,o){var s;const a=(s=t.getRenderWindow())==null?void 0:s.getViews()[0];if(!a)return null;const i=_p(e,a);return i?Qu(i[0],i[1],n,o,t,a):null}function Et(e,t){var a,i;const n=Xr(e,t),o=(i=(a=t.getRenderWindow())==null?void 0:a.getViews())==null?void 0:i[0];if(n&&o){const[,s]=o.getViewportSize(t);return[n[0]/devicePixelRatio,(s-n[1])/devicePixelRatio]}return null}function qa(e){var a,i,s;const{pokedRenderer:t}=e,n=(i=(a=t==null?void 0:t.getRenderWindow())==null?void 0:a.getViews())==null?void 0:i[0],o=(s=n==null?void 0:n.getContainer())==null?void 0:s.getBoundingClientRect();return!("position"in e)||!o?null:[o.left+e.position.x/devicePixelRatio,o.top+o.height-e.position.y/devicePixelRatio]}function el(e,t,n,o){const a=at.getPresetByName(e);if(a.OpacityPoints){const i=a.OpacityPoints,s=[];for(let u=0;u<i.length;u+=2)s.push([i[u],i[u+1]]);const[r,l]=t,c=l-r;return s.map(([u,p])=>{const d=p&&p-o,m=Math.max(Math.min(d,1),0);return[(u-r)/c+n,m]})}return null}function tl(e){return at.getPresetByName(e).OpacityPoints?{mode:De.Mode.Points,preset:e,shift:0,shiftAlpha:0}:{mode:De.Mode.Gaussians,gaussians:JSON.parse(JSON.stringify(De.Defaults.Gaussians))}}function Wn(e){const t=at.getPresetByName(e);if(!t)return null;const{AbsoluteRange:n,RGBPoints:o}=t;if(n&&o){let a=1/0,i=-1/0;for(let s=0;s<o.length;s+=4)a=Math.min(a,o[s]),i=Math.max(i,o[s]);return[a,i]}return null}function kp(e){const t=at.getPresetByName(e);return t.EffectiveRange?[...t.EffectiveRange]:null}function Dp(e,t,n){const o=n[1]-n[0],a=t.map(([i,s])=>[i*o+n[0],s]);e.removeAllPoints(),a.forEach(([i,s])=>e.addPoint(i,s))}function Ep(e,t,n){const o=n[1]-n[0],a=t.map(i=>({...i,x:i.x*o+n[0]}));e.setNodes(a)}function Rp(e){const n=st().getLayer(e);if(!n)throw new Error(`Layer ${e} not found`);if(Ge(n.selection)){const o=Se(),{Modality:a=void 0}=o.volumeInfo[n.selection];return a&&u1[a]||Ks}return Ks}const Xo=()=>({colorBy:{arrayName:"",location:"pointData"},transferFunction:{preset:"",mappingRange:[0,1]},opacityFunction:{mode:De.Mode.Gaussians,gaussians:[],mappingRange:[0,1]},blendConfig:{opacity:.6,visibility:!0}}),Zt=ce("layerColoring",()=>{const e=_e({}),t=(A,y)=>An(e,A,y),n=(A,y,h)=>{const S={...Xo(),...t(A,y),...h};zt(e,A,y,S)},o=(A,y=$a)=>(h,S,E)=>{const k=t(h,S)??Xo(),R=y({...k[A],...E});n(h,S,{[A]:R})},a=o("colorBy"),i=o("transferFunction"),s=o("opacityFunction"),r=o("blendConfig"),l=(A,y,h)=>{const E=st().layerImages[y];if(!E)return;const k=E.getPointData().getScalars().getRange(),R=Wn(h);i(A,y,{preset:h,mappingRange:R||k});const $=tl(h);$.mappingRange=k,s(A,y,$)},c=(A,y)=>n(A,y,Xo()),u=(A,y)=>{l(A,y,Rp(y))},p=A=>{delete e[A]},d=(A,y)=>{var h;y?(h=e[y])==null||delete h[A]:hn(e,A)},m=wn(e,"layers");return{configs:e,getConfig:t,initConfig:c,updateConfig:n,updateColorBy:a,updateColorTransferFunction:i,updateOpacityFunction:s,updateBlendConfig:r,setColorPreset:l,resetColorPreset:u,removeView:p,removeData:d,serialize:m,deserialize:(A,y)=>{Object.entries(y).forEach(([h,S])=>{S.layers&&n(A,h,S.layers)})}}}),Yt=ce("viewCamera",()=>{const e=Ae(),t=_e({}),n=(m,g)=>An(t,m,g),o=(m,g,A)=>{const y={...n(m,g),...A};zt(t,m,g,y)},a=O(!1),i=()=>{a.value=!a.value},s=m=>{delete t[m]},r=(m,g)=>{var A;g?(A=t[g])==null||delete A[m]:hn(t,m)},l=()=>{Object.keys(t).forEach(m=>{e.idList.forEach(g=>{const{syncState:A}={...n(m,g)};o(m,g,{syncState:!A})})})},c=()=>Object.keys(t).every(g=>Object.keys(t[g]).every(A=>t[g][A].syncState)),u=()=>{Object.keys(t).forEach(m=>{const{currentImageID:g}=me(),A=n(m,g.value);e.idList.forEach(y=>{const{syncState:h}={...n(m,y)};h&&o(m,y,{position:A==null?void 0:A.position,focalPoint:A==null?void 0:A.focalPoint,parallelScale:A==null?void 0:A.parallelScale})})})},p=wn(t,"camera");return{configs:t,getConfig:n,updateConfig:o,disableCameraAutoReset:a,toggleCameraAutoReset:i,removeView:s,removeData:r,toggleSyncCameras:l,updateSyncConfigs:u,isSync:c,serialize:p,deserialize:(m,g)=>{Object.entries(g).forEach(([A,y])=>{y.camera&&o(m,A,y.camera)})}}}),Ka=.2,Za=.7,Ya=.3;function Vp(e){const t=Se();if(Ge(e)){const n=e,{Modality:o}=t.volumeInfo[n];if(o in ga)return ga[o]}return c1}function Tp(e){const t={preset:e},n=Wn(e);n&&(t.mappingRange=n);const o=tl(e);return{colorFunc:t,opacityFunc:o}}const Xs=()=>({colorBy:{arrayName:"",location:"pointData"},transferFunction:{preset:"",mappingRange:[0,1]},opacityFunction:{mode:De.Mode.Gaussians,gaussians:[],mappingRange:[0,1]},cvr:{enabled:!0,lightFollowsCamera:!0,volumeQuality:2,useVolumetricScatteringBlending:!1,volumetricScatteringBlending:.5,useLocalAmbientOcclusion:!0,laoKernelRadius:5,laoKernelSize:15,ambient:Ka,diffuse:Za,specular:Ya}}),Lt=ce("volumeColoring",()=>{const e=_e(Object.create(null)),t=_e(Object.create(null)),n=(y,h)=>An(e,y,h),o=(y,h,S)=>{const E={...Xs(),...n(y,h),...S};zt(e,y,h,E)},a=(y,h=$a)=>(S,E,k)=>{const R=n(S,E)??Xs(),D=h({...R[y],...k});o(S,E,{[y]:D})},i=a("colorBy"),s=a("transferFunction"),r=a("opacityFunction"),l=a("cvr"),c=(y,h,S)=>{const k=Ae().dataIndex[h];if(!k)throw new Error("Invalid imageID");const R=k.getPointData().getScalars().getRange(),{colorFunc:D,opacityFunc:$}=Tp(S);D.mappingRange||(D.mappingRange=R),$.mappingRange=R,s(y,h,D),r(y,h,$)},u=(y,h,S)=>{var R,D,$;const E=t[h],k=S.getPointData().getScalars();i(y,h,{arrayName:((R=E==null?void 0:E.colorBy)==null?void 0:R.arrayName)??k.getName(),location:((D=E==null?void 0:E.colorBy)==null?void 0:D.location)??"pointData"}),c(y,h,(($=E==null?void 0:E.transferFunction)==null?void 0:$.preset)??Vp(h))},p=(y,h)=>{t[y]=h},d=y=>{delete e[y]},m=(y,h)=>{var S;h?(S=e[h])==null||delete S[y]:hn(e,y)},g=wn(e,"volumeColorConfig");return{configs:e,getConfig:n,updateConfig:o,updateColorBy:i,updateColorTransferFunction:s,updateOpacityFunction:r,updateCVRParameters:l,resetToDefaultColoring:u,setDefaults:p,setColorPreset:c,removeView:d,removeData:m,serialize:g,deserialize:(y,h)=>{Object.entries(h).forEach(([S,E])=>{E.volumeColorConfig&&o(y,S,E.volumeColorConfig)})}}}),ei=ce("viewConfig",()=>{const e=Dt(),t=Fn(),n=Zt(),o=Yt(),a=Lt(),i=u=>{e.removeView(u),t.removeView(u),n.removeView(u),o.removeView(u),a.removeView(u)},s=(u,p)=>{e.removeData(u,p),t.removeData(u,p),n.removeData(u,p),o.removeData(u,p),a.removeData(u,p)},r=u=>{e.serialize(u),t.serialize(u),n.serialize(u),o.serialize(u),a.serialize(u)},l=(u,p,d)=>{const m={};Object.entries(p).forEach(([g,A])=>{const y=d[g];m[y]=A}),e.deserialize(u,m),t.deserialize(u,m),n.deserialize(u,m),o.deserialize(u,m),a.deserialize(u,m)};return Ae().$onAction(({name:u,args:p})=>{if(u==="deleteData"){const[d]=p;s(d)}}),{removeView:i,removeData:s,serialize:r,deserialize:l}}),Me=ce("view",{state:()=>({layout:{direction:Ve.V,items:[]},viewSpecs:structuredClone(Gt),activeViewID:""}),getters:{viewIDs(e){return Object.keys(e.viewSpecs)}},actions:{setActiveViewID(e){this.activeViewID=e},addView(e){e in this.viewSpecs||(this.viewSpecs[e]=structuredClone(o1))},removeView(e){e in this.viewSpecs&&delete this.viewSpecs[e]},setLayout(e){this.layout=e;const t=[e];for(;t.length;)t.shift().items.forEach(o=>{typeof o=="string"?this.addView(o):t.push(o)})},serialize(e){const t=ei(),{manifest:n}=e,{views:o}=n;n.layout=this.layout,Object.entries(this.viewSpecs).forEach(([a,i])=>{const s=i.viewType,{props:r}=i,c={id:a,type:s,props:r,config:{}};o.push(c)}),t.serialize(e)},deserialize(e,t){const n=ei();e.forEach(o=>{const a=o.id,i={viewType:o.type,props:o.props};this.viewSpecs[a]=i;const{config:s}=o;n.deserialize(a,s,t)})}}});function Pp(e){const t=e.split(/\/+/g);return t.splice(-1,1),t.join("/")}function nl(e){return e.split(/\/+/g).at(-1)??e}function fn(e){return e.replace(/\/+/g,"/").replace(/\/$/,"")}function ol(...e){return fn(e.join("/"))}function ti(e){const{dataIndex:t}=ye(Ae());return X(t,(n,o)=>{const a=Object.keys(o).filter(i=>!(i in n));a.length&&e(a)})}class al{constructor(t){this.msgID=0,this.worker=t,this.waiting={},this.worker.onmessage=this.handleMessage.bind(this)}postMessage(t,n=[]){const o={id:this.msgID,message:t},a=vo();return this.waiting[o.id]=a,this.worker.postMessage(o,n),this.msgID+=1,a.promise}handleMessage(t){const{id:n,error:o,message:a}=t.data;if(n in this.waiting){const i=this.waiting[n];delete this.waiting[n],o?i.reject(new Error(o)):i.resolve(a)}}}const Ja=e=>async t=>{const n=new Worker(new URL(""+new URL("async.reader.worker-23fc22d3.js",import.meta.url).href,self.location),{type:"module"}),a=await new al(n).postMessage({file:t,readerName:e});if(n.terminate(),a.status==="success")return dr(a.obj);throw a.error},Mp=e=>async t=>{const n=new Worker(new URL(""+new URL("async.writer.worker-33f463b0.js",import.meta.url).href,self.location),{type:"module"}),a=await new al(n).postMessage({obj:t.getState(),writerName:e});if(n.terminate(),a.status==="success")return a.data;throw a.error},Op=Ja("stl"),sl=Ja("vti"),Lp=Ja("vtp"),Bp=Mp("vti"),$p=async e=>{if(e.name.endsWith(".vti"))return await sl(e);const{image:t}=await Da(e,{webWorker:yn()});return rn.convertItkToVtkImage(t)},il=async(e,t)=>{if(e==="vti")return Bp(t);const n=qc(rn.convertVtkToItkImage(t));return(await Kc(n,`image.${e}`,{webWorker:yn()})).serializedImage.data};function xp(e,t){t.classHierarchy.push("vtkImageExtractComponentsFilter"),e.requestData=(n,o)=>{const a=n[0],i=pr.newInstance(),s=t.components;if(!s||!Array.isArray(s)||s.length===0)throw Error("No components specified for extraction.");const r=a.getPointData().getScalars(),l=r.getNumberOfComponents();s.forEach(m=>{if(m<0)throw Error("Component index must be greater than or equal to 0.");if(m>=l)throw Error("Component index must be less than the number of components in the input data.")}),i.shallowCopy(a);const c=r.getData(),u=c.length/l,p=s.length,d=new c.constructor(u*p);for(let m=0;m<u;m++)for(let g=0;g<s.length;g++)d[m*p+g]=c[m*l+s[g]];i.getPointData().setScalars(Ro.newInstance({numberOfComponents:p,values:d})),o[0]=i}}const Up={components:[]};function rl(e,t,n={}){Object.assign(t,Up,n),W.obj(e,t),W.algo(e,t,1,1),W.setGet(e,t,["components"]),xp(e,t)}const Np=W.newInstance(rl,"vtkImageExtractComponentsFilter"),Fp={newInstance:Np,extend:rl};function Wp(e,t){t.classHierarchy.push("vtkLabelMap");const n={...e};e.replaceLabelValue=(o,a)=>{const i=e.getPointData().getScalars().getData(),s=i.length;for(let r=0;r<s;r++)i[r]===o&&(i[r]=a)},e.setSegments=o=>o===t.segments||Zc(o,t.segments)?!1:n.setSegments(o)}const Hp=()=>({segments:[]});function ll(e,t,n={}){Object.assign(t,Hp(),n),pr.extend(e,t,n),W.setGet(e,t,["segments"]),Wp(e,t)}const Gp=W.newInstance(ll,"vtkLabelMap"),cl={newInstance:Gp,extend:ll},ul=Uint8Array,zp=0,wa=e=>`Segment ${e}`,dl=(e,t)=>`Segment Group ${t} for ${e}`,jp=e=>e<=1?"":`${e}`;function Qp(e){const t=new ul(e.getNumberOfPoints()),n=cl.newInstance(e.get("spacing","origin","direction"));return n.getPointData().setScalars(Ro.newInstance({numberOfComponents:1,values:t})),n.setDimensions(e.getDimensions()),n.computeTransforms(),n}function qp(e){const t=new Uint8Array(e.length);for(let n=0;n<e.length;n++){const o=e[n];t[n]=o<0||o>255?0:o}return t}function Kp(e){const t=e.getPointData().getScalars();let n=t.getData();return n instanceof ul||(n=qp(n)),Ro.newInstance({numberOfComponents:t.getNumberOfComponents(),values:n})}function ni(e){const t=cl.newInstance(e.get("spacing","origin","direction","extent","dataDescription"));t.setDimensions(e.getDimensions()),t.computeTransforms();const n=Kp(e);return t.getPointData().setScalars(n),t}function Zp(e){const t=e.getPointData().getScalars().getNumberOfComponents(),n=Fp.newInstance();return n.setInputData(e),Array.from({length:t},(o,a)=>(n.setComponents([a]),n.update(),n.getOutputData()))}const et=ce("segmentGroup",()=>{const e=_e(Object.create(null)),t=_e(Object.create(null)),n=O(Object.create(null));function o(M){if(!(M in t))throw new Error("No such labelmap ID");return t[M]}function a(M,x){const V=o(M);if(!(x in V.segments.byValue))throw new Error("No such segment");return V.segments.byValue[x]}function i(M,x){return x.value!==0&&!(x.value in o(M).segments.byValue)}function s(M,x){var T,U;const V=pn().nextId();return e[V]=M,t[V]=x,(T=n.value)[U=x.parentImage]??(T[U]=[]),n.value[x.parentImage].push(V),V}const r=Object.create(null);ti(M=>{M.forEach(x=>{delete r[x]})});function l(M,x){const V=new Set(Object.values(t).map(U=>U.name));let T="";do{const U=r[x]??1;r[x]=U+1,T=M(U)}while(V.has(T));return T}function c(M){const x=Ae(),V=x.dataIndex[M];if(!V)return null;const{name:T}=x.metadata[M],U=Qp(V),{order:Q,byKey:Z}=js(structuredClone(p1),"value"),ee=l(N=>dl(T,N),M);return s.call(this,U,{name:ee,parentImage:M,segments:{order:Q,byValue:Z}})}function u(M){if(!(M in e))return;const{parentImage:x}=t[M];ft(n.value[x],M),delete e[M],delete t[M]}let p=0;function d(){const M=Zs[p];return p=(p+1)%Zs.length,[...M,255]}async function m(M,x,V=0){if(!Ft(M)){const N=await Se().volumeBuildResults[M];if(N.modality==="SEG")return N.builtImageResults.metaInfo.segmentAttributes[V].map(Y=>({value:Y.labelID,name:Y.SegmentLabel,color:[...Y.recommendedDisplayRGBValue,255],visible:!0}))}const[T,U]=x.getPointData().getScalars().getRange(),Q=Math.max(T,1);return Array.from({length:U-Q+1},(ee,N)=>N+Q).map(ee=>({value:ee,name:wa(ee),color:[...d()],visible:!0}))}async function g(M,x){if(M===x)throw new Error("Cannot convert an image to be a labelmap of itself");const[V,T]=await Promise.all([M,x].map(qr));if(!M||!x)throw new Error("Image and/or parent datasets do not exist");const U=Ae();if(!Ue.intersects(T.getBounds(),V.getBounds()))throw new Error("Segment group and parent image bounds do not intersect. So there is no overlap in physical space.");const Z=U.metadata[M].name;Ft(M)&&U.deleteData(M),(V.getPointData().getScalars().getNumberOfComponents()===1?[V]:Zp(V)).forEach(async(Y,we)=>{const Xt=await Kr(T,Y,!0),Bt=ni(Xt),Zn=await m(M,Bt,we),{order:Yn,byKey:Lc}=js(Zn,"value"),Bc=et(),$c=l(xc=>`${Z} ${jp(xc)}`,x);Bc.addLabelmap(Bt,{name:$c,parentImage:x,segments:{order:Yn,byValue:Lc}})})}function A(M,x){t[M]={...o(M),...x}}function y(M){const{segments:x}=o(M);let V=1;for(;V<=x.order.length&&V in x.byValue;V++);return{name:wa(V),value:V,color:[...d()],visible:!0}}function h(M,x){const V=o(M),T=x??y(M);if(!i(M,T))throw new Error("Invalid segment");V.segments.byValue[T.value]=T,V.segments.order.push(T.value)}function S(M,x,V){const T=o(M),U=a(M,x);T.segments.byValue[x]={...U,...V}}function E(M,x){const{segments:V}=o(M);ft(V.order,x),delete V.byValue[x],e[M].replaceLabelValue(x,zp)}const k=O("vti");async function R(M){const{zip:x}=M,T=Object.keys(n.value).flatMap(U=>n.value[U].map(Z=>{const ee=t[Z];return{id:Z,path:`labels/${Z}.${k.value}`,metadata:{...ee,parentImage:ee.parentImage}}}));M.manifest.labelMaps=T,await Promise.all(T.map(async({id:U,path:Q})=>{const Z=e[U],ee=await il(k.value,Z);x.file(Q,ee)}))}async function D(M,x,V){const{labelMaps:T}=M,U={},Q=await Promise.all(T.map(async Z=>{const[ee]=x.filter(we=>ol(we.archivePath,we.file.name)===fn(Z.path)).map(we=>we.file),N=await $p(ee),j=ni(N),Y=pn().nextId();return e[Y]=j,Y}));return T.forEach((Z,ee)=>{var we;const{metadata:N}=Z,j=V[N.parentImage];N.parentImage=j;const Y=Q[ee];U[Z.id]=Y,t[Y]=N,(we=n.value)[j]??(we[j]=[]),n.value[j].push(Y)}),U}const $=w(()=>Object.entries(t).reduce((M,[x,V])=>{const{segments:{order:T,byValue:U}}=V,Q=T.map(Z=>U[Z]);return{...M,[x]:Q}},{}));return X($,M=>{Object.entries(M).forEach(([x,V])=>{e[x].setSegments(un(V).map(T=>un(T)))})},{immediate:!0}),ti(M=>{M.forEach(x=>{n.value[x].forEach(V=>{u(V)})})}),{dataIndex:e,metadataByID:t,orderByParent:n,segmentByGroupID:$,saveFormat:k,addLabelmap:s,newLabelmapFromImage:c,removeGroup:u,convertImageToLabelmap:g,updateMetadata:A,addSegment:h,getSegment:a,updateSegment:S,deleteSegment:E,serialize:R,deserialize:D}});function ea(e,t){return[Math.max(t[0],Math.min(t[1],e[0])),Math.max(t[0],Math.min(t[1],e[1]))]}function tn(e,t,n,o){const{indexToWorld:a,orientation:i,lpsOrientation:s}=t,r=[0,0,0],l=s[n];r[l]=e[n][o],Je(r,r,a);const c=-(o*2-1),u=[...i.slice(l*3,l*3+3).map(p=>p*c)];return{origin:r,normal:u}}function ta(e,t){const n=e.normal;Ea(n,t.origin,e.origin),Yc(n,n),Jc(t.normal,e.normal)}function Yp(e,t){return Hd(e,t,(n,o)=>_t(n.getOrigin(),o.getOrigin())&&_t(n.getNormal(),o.getNormal()))}const Sn=ce("crop",()=>{const e=Ae(),t=_e({croppingByImageID:{}}),n=p=>w(()=>{const d=b(p);if(d&&d in t.croppingByImageID&&d in e.metadata){const m=t.croppingByImageID[d],g=e.metadata[d],A=[tn(m,g,"Sagittal",0),tn(m,g,"Sagittal",1),tn(m,g,"Coronal",0),tn(m,g,"Coronal",1),tn(m,g,"Axial",0),tn(m,g,"Axial",1)];return ta(A[0],A[1]),ta(A[2],A[3]),ta(A[4],A[5]),A.map(y=>Vo.newInstance(y))}return null}),o=(p,d)=>{const m=Yr(p);return{Sagittal:ea(d.Sagittal,m.Sagittal),Coronal:ea(d.Coronal,m.Coronal),Axial:ea(d.Axial,m.Axial)}},a=(p,d)=>{t.croppingByImageID[p]=o(p,d)},i=(p,d,m)=>{p in t.croppingByImageID&&a(p,{...t.croppingByImageID[p],[d]:m})},s=p=>{const d=e.dataIndex[p];if(!d)return;const{lpsOrientation:m}=e.metadata[p],g=d.getSpatialExtent();a(p,{Sagittal:yt(g,"Sagittal",m),Coronal:yt(g,"Coronal",m),Axial:yt(g,"Axial",m)})};function r(p){const{tools:d}=p.manifest;d.crop=t.croppingByImageID}function l(p,d){const m=p.tools.crop;Object.entries(m).forEach(([g,A])=>{const y=d[g];a(y,A)})}const c=()=>!0,u=nn;return{croppingByImageID:Gi(t.croppingByImageID),getComputedVTKPlanes:n,setCropping:a,setCroppingForAxis:i,resetCropping:s,serialize:r,deserialize:l,activateTool:c,deactivateTool:u}});function Jp(){return Ma.createBuilder().addField({name:"placed",initialValue:!1}).addField({name:"indexToWorld",initialValue:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]}).addField({name:"worldToIndex",initialValue:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]}).addStateFromMixin({labels:["handle"],mixins:["origin","bounds"],name:"handle",initialValues:{origin:null}}).build()}function Xp(e,t){return t.map((n,o)=>Math.max(e[o*2],Math.min(e[o*2+1],n)))}function ef(e,t){t.classHierarchy.push("vtkCrosshairsWidgetProp");let n=!1;W.setGet(e,t,["manipulator"]);function o(a){return a.altKey||a.controlKey||a.shiftKey}e.handleLeftButtonPress=a=>!t.pickable||o(a)?W.VOID:(t.widgetState.setPlaced(!0),n=!0,t._interactor.requestAnimation(e),t._apiSpecificRenderWindow.setCursor("crosshairs"),e.invokeStartInteractionEvent(),e.handleMouseMove(a),W.EVENT_ABORT),e.handleMouseMove=a=>{if((!t.widgetState.getPlaced()||n)&&t.pickable&&t.manipulator&&!o(a)){const{worldCoords:i}=t.manipulator.handleEvent(a,t._apiSpecificRenderWindow),s=t.widgetState.getHandle(),r=t.widgetState.getWorldToIndex(),l=t.widgetState.getIndexToWorld();if(r.length&&l.length){const c=ln(),u=ln(),p=s.getBounds();Je(c,i,r);const d=Xp(p,c);return Je(u,d,l),s.setOrigin(u),e.invokeInteractionEvent(),W.EVENT_ABORT}}return W.VOID},e.handleLeftButtonRelease=()=>{n&&t.pickable&&(t._interactor.cancelAnimation(e),t._apiSpecificRenderWindow.setCursor("default"),e.invokeEndInteractionEvent()),n=!1},e.grabFocus=()=>{},e.loseFocus=()=>{}}function tf(e,t){t.classHierarchy.push("vtkCrosshairsWidget"),t.behavior=ef,t.widgetState=Jp(),e.getRepresentationsForViewType=n=>{switch(n){case Qe.DEFAULT:case Qe.GEOMETRY:case Qe.SLICE:case Qe.VOLUME:default:return[]}},t.widgetState.onBoundsChange(n=>{const o=[(n[0]+n[1])*.5,(n[2]+n[3])*.5,(n[4]+n[5])*.5];t.widgetState.getHandle().setOrigin(o)}),t.manipulator=Ct.newInstance()}const nf={};function pl(e,t,n={}){Object.assign(t,nf,n),To.extend(e,t,n),W.setGet(e,t,["manipulator"]),tf(e,t)}const of=W.newInstance(pl,"vtkCrosshairsWidget"),af={newInstance:of,extend:pl},Xa=ce("crosshairs",()=>{const e=af.newInstance(),t=e.getWidgetState(),n=t.getHandle(),o=O(!1),{currentImageID:a,currentImageMetadata:i}=me(),s=O([0,0,0]),r=w(()=>{const h=ln();return Je(h,s.value,i.value.worldToIndex),h}),l=Dt(),c=Me(),u=w(()=>{const h=b(a);return h?c.viewIDs.filter(S=>!!l.getConfig(S,h)):[]});function p(){return e}function d(h){s.value=h}X(r,h=>{if(o.value){const S=b(a),{lpsOrientation:E}=b(i);if(!S)return;u.value.forEach(k=>{const R=l.getConfig(k,S),D=Te(R.axisDirection),$=E[D],M=Math.round(h[$]);l.updateConfig(k,S,{slice:M})})}}),X(i,h=>{t.setIndexToWorld(h.indexToWorld),t.setWorldToIndex(h.worldToIndex);const[S,E,k]=h.dimensions,R=[0,S-1,0,E-1,0,k-1];n.setBounds(qu(R,.5))},{immediate:!0}),n.onModified(()=>{const h=n.getOrigin();h&&(s.value=h)});function m(){return t.setPlaced(!1),o.value=!0,!0}function g(){o.value=!1}function A(h){const{crosshairs:S}=h.manifest.tools;S.position=s.value}function y(h){const{crosshairs:S}=h.tools;s.value=S.position}return{getWidgetFactory:p,setPosition:d,position:s,imagePosition:r,activateTool:m,deactivateTool:g,serialize:A,deserialize:y}});function sf({stencil:e,location:t,slicingIndex:n,indexToWorld:o}){const[a,i]=e.size,s=Math.floor((a-1)/2),r=Math.floor((i-1)/2),l=a+1,c=i+1,u=[],p=[],d={},m=(A,y)=>{const h=`${A},${y}`;if(h in d)return d[h];const S=[...t].map(R=>Math.round(R));n===0?(S[1]+=A-s-.5,S[2]+=y-r-.5):n===1?(S[0]+=A-s-.5,S[2]+=y-r-.5):n===2&&(S[0]+=A-s-.5,S[1]+=y-r-.5);const E=[];Je(E,S,o),u.push(E);const k=u.length-1;return d[h]=k,k},g=(A,y)=>A<0||A>=a||y<0||y>=i?0:e.pixels[y*a+A]||0;for(let A=0;A<c;A++)for(let y=0;y<l;y++){const h=g(y,A)+g(y-1,A)+g(y,A-1)+g(y-1,A-1);if(h>0&&h<4){const S=m(y,A);if(g(y,A)!==g(y,A-1)){const E=m(y+1,A);p.push([S,E])}if(g(y,A)!==g(y-1,A)){const E=m(y,A+1);p.push([S,E])}}}return{points:new Float32Array(u.flat()),lines:new Uint16Array(p.map(([A,y])=>[2,A,y]).flat())}}function rf(e,t){t.classHierarchy.push("vtkPaintBrushContextRepresentation"),t.internalPolyData=Zu.newInstance({mtime:0}),t.internalArrays={points:t.internalPolyData.getPoints(),lines:t.internalPolyData.getLines()},t.pipelines={brush:{source:e,mapper:Yu.newInstance({transformCoordinate:Ju.newInstance({coordinateSystem:Xu.WORLD})}),actor:ed.newInstance({pickable:!1,parentProp:e})}};const n=t.pipelines.brush.actor.getProperty();n.setLineWidth(2),n.setColor([1,0,0]),n.setDisplayLocation(td.FOREGROUND),n.setRepresentation(nd.SURFACE),od.connectPipeline(t.pipelines.brush),e.addActor(t.pipelines.brush.actor),e.requestData=(o,a)=>{const i=o[0],s=i.getStencil(),r=i.getBrush(),{indexToWorld:l,worldToIndex:c}=t;if(s&&r.getOrigin()){const u=[];Je(u,r.getOrigin(),c);const p=sf({stencil:s,location:u,slicingIndex:t.slicingIndex,indexToWorld:l}),{points:d,lines:m}=t.internalArrays;d.setData(p.points),m.setData(p.lines),t.internalPolyData.modified()}a[0]=t.internalPolyData}}const lf={defaultScale:1,drawBorder:!1,drawFace:!0,worldToIndex:null,indexToWorld:null,slicingIndex:0};function fl(e,t,n={}){Object.assign(t,lf,n),Ku.extend(e,t,n),W.setGet(e,t,["slicingIndex","indexToWorld","worldToIndex"]),W.get(e,t,["mapper","actor"]),rf(e,t)}const cf=W.newInstance(fl,"vtkPaintBrushContextRepresentation"),uf={newInstance:cf,extend:fl};function df(e,t,n,o){let a=n();const i=t.$subscribe(()=>{const r=n();(o?o(a,r):a!==r)&&(a=r,e.modified())}),s=e.delete;e.delete=()=>{i(),s()}}function Sa(e,t,n){let o=t.onModified(n);const a=e.delete;e.delete=()=>{o.unsubscribe(),o=null,a()}}const es=e=>t=>{var a,i;const n=((i=(a=e.activeState)==null?void 0:a.getManipulator)==null?void 0:i.call(a))??e.manipulator;if(!n){console.error("No manipulator");return}const{worldCoords:o}=n.handleEvent(t,e._apiSpecificRenderWindow);return o||console.warn("Event cannot be converted to world coordinates"),o};function na(e){return e.altKey||e.controlKey||e.shiftKey}function pf(e,t){t.classHierarchy.push("vtkPaintWidgetProp");const n=es(t);W.setGet(e,t,["manipulator"]);let o=!1;e.handleLeftButtonPress=a=>{if(!t.manipulator||na(a))return W.VOID;const i=n(a);return i?(t.widgetState.getBrush().setOrigin(...i),o=!0,e.invokeStartInteractionEvent(),W.EVENT_ABORT):W.VOID},e.handleMouseMove=a=>{if(na(a))return W.VOID;const i=n(a);return i?(t.widgetState.getBrush().setOrigin(...i),o?(e.invokeInteractionEvent(),W.EVENT_ABORT):W.VOID):W.VOID},e.handleLeftButtonRelease=a=>!o||na(a)?W.VOID:(o=!1,e.invokeEndInteractionEvent(),W.EVENT_ABORT),e.handleMouseWheel=()=>o?W.EVENT_ABORT:W.VOID,e.grabFocus=()=>{t.hasFocus||(t.hasFocus=!0,t._interactor.requestAnimation(e))},e.loseFocus=()=>{t.hasFocus&&t._interactor.cancelAnimation(e),t.hasFocus=!1}}function ff(){return Ma.createBuilder().addStateFromMixin({labels:["brush"],name:"brush",mixins:["origin","scale1","visible","color"],initialValues:{scale1:1,origin:null,visible:!0}}).addField({name:"stencil",initialValue:null}).build()}function mf(e,t){t.classHierarchy.push("vtkPaintWidget"),t.methodsToLink=["slicingIndex","indexToWorld","worldToIndex"],e.getRepresentationsForViewType=()=>[{builder:uf,labels:["brush"]}],t.manipulator=Ct.newInstance()}const gf={};function ml(e,t,n={}){Object.assign(t,gf,n),To.extend(e,t,{...n,behavior:pf,widgetState:ff()}),W.get(e,t,["manipulator"]),mf(e,t)}const vf=W.newInstance(ml,"vtkPaintWidget"),hf={newInstance:vf,extend:ml};function Af(e,t){const n=new Uint8Array(e*t),o=(y,h)=>{n[y+h*e]=1},a=(y,h,S)=>{const E=S*e+y,k=E+(h-y+1);n.fill(1,E,k)};let i=0,s=0,r=e-1,l=t-1,c=r,u=l;const p=u&1;let d=4*(1-c)*u*u,m=4*(p+1)*c*c,g=d+m+p*c*c,A=0;s+=Math.floor((u+1)/2),l=s-p,c*=8*c,u*=8*u;do a(i,r,s),a(i,r,l),A=2*g,A<=m&&(s++,l--,m+=c,g+=m),(A>=d||2*g>m)&&(i++,r--,d+=u,g+=d);while(i<=r);for(;s-l<t;)o(i-1,s),o(r+1,s++),o(i-1,l),o(r+1,l--);return n}class yf{constructor(){this.size=1,this.scale=[1,1],this.recomputeStencil()}setSize(t){this.size=Math.max(0,t),this.recomputeStencil()}setScale(t){this.scale=t,this.recomputeStencil()}recomputeStencil(){const t=[Math.ceil(this.size*this.scale[0]),Math.ceil(this.size*this.scale[1])];this.cachedStencil={size:t,pixels:Af(t[0],t[1])}}getStencil(){return this.cachedStencil}}const wf=0;var ts=(e=>(e[e.CirclePaint=0]="CirclePaint",e[e.Erase=1]="Erase",e))(ts||{});let Sf=class{constructor(){this.factory=hf.newInstance(),this.brush=new yf,this.brushValue=1,this.mode=0}updateWidgetStencil(){const t=this.brush.getStencil();this.factory.getWidgetState().setStencil(t)}setBrushSize(t){this.brush.setSize(t),this.updateWidgetStencil()}setBrushScale(t){this.brush.setScale(t),this.updateWidgetStencil()}setMode(t){this.mode=t}setBrushValue(t){this.brushValue=t}paintLabelmap(t,n,o,a){if(this.brushValue==null)return;const i=this.mode===1?wf:this.brushValue,s=this.brush.getStencil(),r=[...o.map($=>Math.round($))],l=r[n];r.splice(n,1);let c=[...r];a&&(c=[...a.map($=>Math.round($))],c.splice(n,1));const u=t.getPointData().getScalars().getData(),p=t.getDimensions(),d=p[0],m=p[0]*p[1],g=$=>$[0]>=0&&$[1]>=0&&$[2]>=0&&$[0]<p[0]&&$[1]<p[1]&&$[2]<p[2],{pixels:A,size:y}=s,h=Math.floor((y[0]-1)/2),S=Math.floor((y[1]-1)/2),E=[...r],k=[...c],R=[0,0,0],D=[0,0];for(let $=0;$<y[1];$++){const M=$-S,x=$*y[0];for(let V=0;V<y[0];V++){const T=V-h,U=x+V;if(A[U]){E[0]=r[0]+T,E[1]=r[1]+M,k[0]=c[0]+T,k[1]=c[1]+M;const Q=k[0]-E[0],Z=k[1]-E[1];let ee=Math.abs(Math.abs(Q)>Math.abs(Z)?Q:Z);const N=Q/ee,j=Z/ee;for([D[0],D[1]]=E;ee-->=0;){if(D.splice(n,0,l),R[0]=Math.round(D[0]),R[1]=Math.round(D[1]),R[2]=Math.round(D[2]),g(R)){const Y=R[0]+R[1]*d+R[2]*m;u[Y]=i}D.splice(n,1),D[0]+=N,D[1]+=j}}}}t.modified()}};const Cf=4,Rt=ce("paint",()=>{const e=O(ts.CirclePaint),t=O(null),n=O(null),o=O(Cf),a=O([]),i=O(!1),{currentImageID:s}=me();function r(){return this.$paint.factory}const l=et(),c=w(()=>t.value?l.dataIndex[t.value]??null:null);function u(V){e.value=V,this.$paint.setMode(V)}function p(V){t.value=V}function d(V){var U;if(!V)return null;if(t.value&&((U=l.metadataByID[t.value])==null?void 0:U.parentImage)===V)return t.value;const T=l.orderByParent[V];return T&&T.length>0?T[0]:null}function m(V){if(!V){p(null);return}const T=d(V)??l.newLabelmapFromImage(V);p(T)}function g(V){if(V){if(!t.value)throw new Error("Cannot set active segment without a labelmap");const{segments:T}=l.metadataByID[t.value];if(!(V in T.byValue))throw new Error("Segment is not available for the active labelmap")}n.value=V,this.$paint.setBrushValue(V)}function A(V){o.value=Math.round(V),this.$paint.setBrushSize(V)}function y(V){if(!c.value)return;const T=a.value.length-1;if(T>=0){const U=a.value[T],Q=T>=1?a.value[T-1]:void 0;this.$paint.paintLabelmap(c.value,V,U,Q)}}function h(V){if(!c.value)return;const T=c.value.getSpacing();T.splice(V,1);const U=[1/T[0],1/T[1]];this.$paint.setBrushScale(U)}function S(){var T;const V=s.value;if(V&&!(t.value&&((T=l.metadataByID[t.value])==null?void 0:T.parentImage)===V))if(i.value)m(V);else{const U=d(V);U&&p(U)}}function E(V,T){S(),a.value=[Ra(V)],y.call(this,T)}function k(V,T){a.value.push(V),y.call(this,T)}function R(V,T){a.value.push(V),y.call(this,T)}function D(){const V=s.value;return V?(m(V),this.$paint.setBrushSize(this.brushSize),i.value=!0,!0):!1}function $(){t.value=null,i.value=!1}function M(V){const{paint:T}=V.manifest.tools;T.activeSegmentGroupID=t.value??null,T.brushSize=o.value,T.activeSegment=n.value}function x(V,T){const{paint:U}=V.tools;A.call(this,U.brushSize),i.value=V.tools.current===oe.Paint,U.activeSegmentGroupID!==null&&(t.value=T[U.activeSegmentGroupID],p(t.value),g.call(this,U.activeSegment))}return{activeMode:e,activeSegmentGroupID:t,activeSegment:n,brushSize:o,strokePoints:a,isActive:i,getWidgetFactory:r,activateTool:D,deactivateTool:$,setMode:u,setActiveSegmentGroup:p,ensureActiveSegmentGroupForImage:m,setActiveSegment:g,setBrushSize:A,setSliceAxis:h,startStroke:E,placeStrokePoint:k,endStroke:R,serialize:M,deserialize:x}});function ns(e,t){return ce(e,t)}const oi=ln();function xo(e,t,n){const o=(n==null?void 0:n.epsilon)??Io,a=(n==null?void 0:n.allowNonIntegralSlice)??!1,i=(n==null?void 0:n.allowOutOfBoundsSlice)??!1,{planeNormal:s,planeOrigin:r}=e,{dimensions:l,lpsOrientation:c,worldToIndex:u}=t;let p=null;const{Left:d,Right:m,Posterior:g,Anterior:A,Superior:y,Inferior:h}=c;if(_t(d,s)||_t(m,s)?p="Sagittal":_t(g,s)||_t(A,s)?p="Coronal":(_t(y,s)||_t(h,s))&&(p="Axial"),!p)return null;Je(oi,r,u);const S=c[p],E=zd(oi[S],o);return!a&&!Number.isInteger(E)||!i&&(E<0||E>=l[S])?null:{axis:p,slice:E}}function bf(e,t){const n=xo(e,t);if(!n)return Math.min(...t.spacing);const o=t.lpsOrientation[n.axis],a=[...t.spacing];return a.splice(o,1),Math.min(...a)}function ai({planeOrigin:e,planeNormal:t}){const n=[0,0,0],o=[0,0,0],a=[0,0,0],i=[0,0,0];Math.abs(t[0])>1e-6?(a[0]=-t[1],a[1]=t[0],a[2]=0):Math.abs(t[1])>1e-6?(a[0]=0,a[1]=-t[2],a[2]=t[1]):(a[0]=t[2],a[1]=0,a[2]=-t[0]),rt.cross(t,a,i),rt.normalize(a),rt.normalize(i);const s=Vo.newInstance();return s.setOrigin(e),s.setNormal(t),{to2D:c=>{s.projectPoint(c,n);const u=rt.subtract(n,e,o),p=rt.dot(u,a),d=rt.dot(u,i);return[p,d]},to3D:c=>{const[u,p]=c,d=[0,0,0];return n[0]=a[0],n[1]=a[1],n[2]=a[2],o[0]=i[0],o[1]=i[1],o[2]=i[2],rt.multiplyScalar(n,u),rt.multiplyScalar(o,p),rt.add(e,n,d),rt.add(d,o,d),d}}}const Cn=ce("tool-selection",()=>{const e=O(Object.create(null));function t(l,c){l in e.value||(e.value[l]=c)}function n(){e.value=Object.create(null)}function o(l){l in e.value&&delete e.value[l]}function a(l,c){l in e.value?o(l):t(l,c)}function i(l){return l in e.value}const s=w(()=>Object.entries(e.value).map(([l,c])=>({id:l,type:c}))),{primarySelection:r}=ye(Oe());return X(r,()=>{n()}),{addSelection:t,clearSelection:n,removeSelection:o,toggleSelection:a,isSelected:i,selection:s}}),_f=Object.freeze({labelName:"New Label",color:yo[0]}),If=e=>{const t=O({}),n=O(),o=m=>{n.value=m};let a=0;const i=(m={})=>{const g=pn().nextId();return t.value[g]={..._f,...e,color:yo[a],...m},a=(a+1)%yo.length,o(g),g},s=m=>{if(!(m in t.value))throw new Error("Label does not exist");if(delete t.value[m],t.value={...t.value},m===n.value){const g=Object.keys(t.value);g.length!==0?o(g[0]):o("")}},r=(m,g)=>{if(!(m in t.value))throw new Error("Label does not exist");t.value={...t.value,[m]:{...t.value[m],...g}}},l=O(!0),c=()=>{l.value&&(t.value={}),l.value=!1},u=m=>Object.entries(t.value).find(([,{labelName:g}])=>m===g),p=m=>{const{labelName:g}=m,A=u(g);if(A){const[y]=A;return r(y,m),y}return i(m)};return{labels:t,activeLabel:n,setActiveLabel:o,addLabel:i,deleteLabel:s,updateLabel:r,mergeLabels:m=>{Object.entries(m??{}).forEach(([g,A])=>p({...A,labelName:g}))},findLabel:u,clearDefaultLabels:c}},kf=Object.freeze({strokeWidth:Pr}),Df=()=>({frameOfReference:{planeOrigin:[0,0,0],planeNormal:[1,0,0]},slice:-1,imageID:"",placing:!1,color:yo[0],strokeWidth:Pr,name:"baseAnnotationTool"}),os=({toolDefaults:e,initialLabels:t,newLabelDefault:n})=>{const o=O([]),a=O(Object.create(null)),i=w(()=>{const h=a.value;return o.value.map(S=>h[S])}),s=w(()=>i.value.filter(h=>!h.placing)),r=If({...kf,...n});r.mergeLabels(t);function l(h){if(!h)return{labelName:""};const S=r.labels.value[h];return S||{labelName:""}}function c(h){const S=pn().nextId();if(S in a.value)throw new Error("Cannot add tool with conflicting ID");return a.value[S]={...Df(),...e(),label:r.activeLabel.value,...h,...l(h.label),id:S},o.value.push(S),S}function u(h){if(!(h in a.value))return;ft(o.value,h),delete a.value[h],Cn().removeSelection(h)}function p(h,S){h in a.value&&(a.value[h]={...a.value[h],...S,id:h})}X(r.labels,()=>{o.value.forEach(h=>{const S=a.value[h],E=l(S.label);p(h,{...S,...E})})});const{currentImageID:d,currentImageMetadata:m}=me();function g(h){const S=a.value[h],E=d.value;if(!E||S.imageID!==E)return;const k=xo(S.frameOfReference,m.value);if(!k)return;const R=Me(),D=R.viewIDs.filter(M=>{const V=R.viewSpecs[M].props.viewDirection;return V&&Te(V)===k.axis}),$=Dt();D.forEach(M=>{$.updateConfig(M,E,{slice:S.slice})})}const A=()=>({tools:o.value.map(S=>a.value[S]).filter(S=>!S.placing).map(({imageID:S,...E})=>({imageID:S,...E})),labels:r.labels.value});function y(h,S){h!=null&&h.labels&&r.clearDefaultLabels();const E=Object.fromEntries(Object.entries((h==null?void 0:h.labels)??{}).map(([k,R])=>{const D=r.addLabel(R);return[k,D]}));h==null||h.tools.map(({imageID:k,label:R,...D})=>({...D,imageID:S[k],label:R&&E[R]||""})).forEach(k=>c(k))}return{...r,toolIDs:o,toolByID:a,tools:i,finishedTools:s,addTool:c,removeTool:u,updateTool:p,jumpToTool:g,serializeTools:A,deserializeTools:y}},Ef=()=>({firstPoint:[0,0,0],secondPoint:[0,0,0],id:"",name:"Ruler"}),Jt=ns("ruler",()=>{const e=os({toolDefaults:Ef,initialLabels:i1}),{toolIDs:t,toolByID:n,tools:o,addTool:a,updateTool:i,removeTool:s,jumpToTool:r,serializeTools:l,deserializeTools:c}=e,u=w(()=>{const g=n.value;return t.value.reduce((A,y)=>{const{firstPoint:h,secondPoint:S}=g[y];return Object.assign(A,{[y]:Math.sqrt(po(h,S))})},{})});function p(g){const A=e.toolByID.value[g];return[A.firstPoint,A.secondPoint]}function d(g){g.manifest.tools.rulers=l()}function m(g,A){c(g.tools.rulers,A)}return{...e,rulerIDs:t,rulerByID:n,rulers:o,lengthByID:u,addRuler:a,updateRuler:i,removeRuler:s,jumpToRuler:r,getPoints:p,serialize:d,deserialize:m}}),Rf=()=>({firstPoint:[0,0,0],secondPoint:[0,0,0],id:"",name:"Rectangle",fillColor:"transparent"}),Vf={fillColor:"transparent"},bn=ns("rectangles",()=>{const e=os({toolDefaults:Rf,initialLabels:r1,newLabelDefault:Vf});function t(a){const i=e.toolByID.value[a];return[i.firstPoint,i.secondPoint]}function n(a){a.manifest.tools.rectangles=e.serializeTools()}function o(a,i){e.deserializeTools(a.tools.rectangles,i)}return{...e,getPoints:t,serialize:n,deserialize:o}}),Tf=()=>({points:[],id:"",name:"Polygon"}),Pf=e=>e.length>0&&e[0].length>0&&e[0][0].length===6?e.map(n=>n.map(o=>[o[4],o[5]])):e,_n=ns("polygon",()=>{const e=os({toolDefaults:Tf,initialLabels:l1});function t(h){return e.toolByID.value[h].points}const n=h=>{const{to2D:S}=ai(h.frameOfReference);if(h.points.length!==0)return{regions:[h.points.map(S)],inverted:!1}},o=(h,S)=>{const[E,k]=[h,S].map(n);return!E||!k?!1:en.intersect(E,k).regions.length>0},a=(h,S)=>h[0]===S[0]&&h[1]===S[1],i=h=>{const[S,...E]=h;for(;E.length>0;){let k=0,R=0,D=0;for(let V=0;V<E.length;V++){const T=E[V];let U=0;const Q=S.findIndex(Z=>T.some((ee,N)=>(U=N,a(Z,ee))));if(Q!==-1){k=V,R=Q,D=U;break}}const[$]=E.splice(k,1),M=$.splice(0,D),x=[...$,...M];S.splice(R,0,...x)}return S},s=h=>{const S=h.map(n);if(S.some(U=>U===void 0))throw new Error("Trying to merge invalid polygons");let E=en.segments(S[0]);for(let U=1;U<S.length;U++){const Q=en.segments(S[U]),Z=en.combine(E,Q);E=en.selectUnion(Z)}const k=en.polygon(E).regions,R=i(Pf(k)),D=h[0],{to3D:$}=ai(D.frameOfReference),M=R.map($),{id:x,...V}=h[0];return{...V,points:M}},r=(h,S)=>h.label===S.label&&h.slice===S.slice&&h.frameOfReference===S.frameOfReference,l=(h,S)=>r(h,S)?o(h,S):!1,c=Cn(),u=h=>h.type===tt.Polygon,p=w(()=>{const h=c.selection.filter(u).map(R=>e.toolByID.value[R.id]);if(h.length<2)return[];const[S,...E]=h,k=[S];for(;E.length>0;){const R=E.findIndex(D=>k.some($=>l(D,$)));if(R<0)return[];k.push(...E.splice(R,1))}return k});function d(h){const S=s(h);e.addTool(S),h.map(({id:E})=>E).forEach(e.removeTool)}function m(){d(p.value)}function g(h){const S=e.toolByID.value[h],E=e.tools.value.filter(R=>R!==S&&!R.placing);if(!S||E.length===0)return;const k=E.filter(R=>l(R,S));k.length!==0&&d([S,...k])}function A(h){h.manifest.tools.polygons=e.serializeTools()}function y(h,S){e.deserializeTools(h.tools.polygons,S)}return{...e,getPoints:t,mergeableTools:p,mergeSelectedTools:m,mergeWithOtherTools:g,serialize:A,deserialize:y}}),gl={[tt.Polygon]:_n,[tt.Rectangle]:bn,[tt.Ruler]:Jt},So={[oe.Pan]:null,[oe.WindowLevel]:null,[oe.Zoom]:null,[oe.Select]:null,[oe.Crop]:Sn,[oe.Crosshairs]:Xa,[oe.Paint]:Rt,...gl};function Tn(e){const t=gl[e];return t()}function Mf(e){var o;const t=So[e],n=t==null?void 0:t();return n!=null&&n.activateTool?(o=n.activateTool)==null?void 0:o.call(n):!0}function Of(e){var o;const t=So[e],n=t==null?void 0:t();n&&((o=n.deactivateTool)==null||o.call(n))}const Le=ce("tool",{state:()=>({currentTool:oe.WindowLevel}),actions:{setCurrentTool(e){Mf(e)&&(Of(this.currentTool),this.currentTool=e)},serialize(e){const{tools:t}=e.manifest;Object.values(So).map(n=>n==null?void 0:n()).filter(n=>!!n).forEach(n=>{var o;(o=n.serialize)==null||o.call(n,e)}),t.current=this.currentTool},deserialize(e,t,n){const{tools:o}=e;Rt().deserialize(e,t),Object.values(So).filter(a=>a!==Rt).map(a=>a==null?void 0:a()).filter(a=>!!a).forEach(a=>{var i;(i=a.deserialize)==null||i.call(a,e,n)}),this.currentTool=o.current}}}),mn={vti:"application/vnd.unknown.vti",vtp:"application/vnd.unknown.vtp",stl:"model/stl",dcm:"application/dicom",zip:"application/zip",json:"application/json",gipl:"application/vnd.unknown.gipl","gipl.gz":"application/vnd.unknown.gipl",hdf5:"application/x-hdf5",jpg:"image/jpeg",jpeg:"image/jpeg",lsm:"application/vnd.unknown.lsm",mnc:"application/vnd.unknown.minc","mnc.gz":"application/vnd.unknown.minc",mnc2:"application/vnd.unknown.minc",mgh:"application/vnd.unknown.mgh",mgz:"application/vnd.unknown.mgh","mgh.gz":"application/vnd.unknown.mgh",mha:"application/vnd.unknown.metaimage",mhd:"application/vnd.unknown.metaimage",mrc:"application/vnd.unknown.mrc",nia:"application/vnd.unknown.nifti-1",nii:"application/vnd.unknown.nifti-1","nii.gz":"application/vnd.unknown.nifti-1",hdr:"application/vnd.unknown.nifti-1",nrrd:"application/vnd.unknown.nrrd",nhdr:"application/vnd.unknown.nrrd",png:"image/png",pic:"application/vnd.unknown.biorad",tif:"image/tiff",tiff:"image/tiff",vtk:"application/vnd.unknown.vtk",isq:"application/vnd.unknown.scanco",fdf:"application/vnd.unknown.fdf"},si=new Set(Object.keys(mn)),ii=new Set(Object.values(mn)),vl=new Set([mn.zip,"application/x-zip-compressed"]),ri=[{mime:"application/dicom",skip:128,header:Array.from("DICM").map(e=>e.charCodeAt(0))}],Lf=512;function Bf(e,t){if(t.length>e.length)return!1;for(let n=0;n<t.length;n+=1)if(t[n]!==e[n])return!1;return!0}async function $f(e){return new Promise(t=>{const n=e.slice(0,Lf),o=new FileReader;o.onload=()=>{const a=new Uint8Array(o.result);for(let i=0;i<ri.length;i+=1){const{mime:s,header:r,skip:l=0}=ri[i];if(Bf(a.slice(l),r)){t(s);return}}t(null)},o.readAsArrayBuffer(n)})}async function hl(e){const t=e.type.toLowerCase();if(ii.has(t))return t;if(si.has(t))return mn[t];const n=[...si].find(a=>e.name.toLowerCase().endsWith(`.${a}`));if(n)return mn[n];const o=await $f(e);return o&&ii.has(o)?o:null}async function xf(e){const t=await hl(e)??"";return new File([e],e.name,{type:t.toLowerCase()})}const as="manifest.json",Uf="4.0.0";async function Al(){const e=Oe(),t=Me(),n=et(),o=Le(),a=st(),i=new Va,s={version:Uf,datasets:[],remoteFiles:{},labelMaps:[],tools:{crosshairs:{position:[0,0,0]},paint:{activeSegmentGroupID:null,activeSegment:null,brushSize:8},crop:{},current:oe.WindowLevel},layout:{direction:Ve.H,items:[]},views:[],parentToLayers:[]},r={zip:i,manifest:s};return await e.serialize(r),t.serialize(r),await n.serialize(r),o.serialize(r),await a.serialize(r),i.file(as,JSON.stringify(s)),i.generateAsync({type:"blob"})}async function Nf(e){const t=await xf(e);return vl.has(t.type)?(await Va.loadAsync(t)).file(as)!==null:!1}const ss=new Headers;function li(e,t){ss.set(e,t)}function Ff(e,t){const n=new Headers(e);return new Headers(t).forEach((a,i)=>{n.set(i,a)}),n}const yl=(e,t)=>fetch(e,{...t,headers:Ff(ss,t==null?void 0:t.headers)}),Wf={testURL:e=>{const{protocol:t}=Ot(e,window.location.href);return t==="http:"||t==="https:"},fetchURL:async(e,t={})=>{var c;const{progress:n}=t,o=await yl(e);if(o.status!==200)throw new Error(`Fetching resource failed (HTTP code ${o.status})`);if(!n)return o.blob();const a=Number(o.headers.get("content-length"))??-1;if(a<0)return n(1/0),o.blob();const i=(c=o.body)==null?void 0:c.getReader();if(!i)return null;const s=new Uint8Array(a);let r=0,l=!1;do{const u=await i.read();l=u.done,u.value&&!l&&(s.set(u.value,r),r+=u.value.length,n(r/a))}while(!l);return new Blob([s])}},is=[Wf];function Hf(e){return!!is.find(t=>t.testURL(e))}async function wl(e,t,n){const o=is.find(s=>s.testURL(e));if(!o)throw new Error(`Cannot find a handler for URL: ${e}`);const a=n==null?void 0:n.cache;if(a!=null&&a.has(e))return a.get(e);const i=o.fetchURL(e,n).then(s=>{if(!s)throw new Error(`Failed to download ${e}`);return new File([s],t)});return i.catch(()=>{a==null||a.delete(e)}),a==null||a.set(e,i),i}async function Gf(e,t){const n=is.find(s=>s.testURL(e));if(!n)throw new Error(`Cannot find a handler for URL: ${e}`);const o=await n.fetchURL(e,t);if(!o)throw new Error(`Failed to download ${e}`);const a=await o.arrayBuffer(),i=new TextDecoder;return JSON.parse(i.decode(new Uint8Array(a)))}const rs=ce("remoteSaveState",()=>{const e=O(""),t=O(!1),n=Ze();return{saveUrl:e,setSaveUrl:i=>{e.value=i},isSaving:t,saveState:async()=>{if(!(!e.value||t.value))try{t.value=!0;const i=await Al();(await yl(e.value,{method:"POST",headers:{"Content-Type":"application/zip","Content-Length":i.size.toString()},body:i})).ok?n.addSuccess("Save Successful"):n.addError("Save Failed","Network response not OK")}catch(i){n.addError("Save Failed with error",`Failed from: ${i}`)}finally{t.value=!1}}}}),ls=F({__name:"IsolatedDialog",setup(e){const t=n=>{n.key!=="Escape"&&n.stopPropagation()};return(n,o)=>(C(),B(or,{onKeydown:t},{default:v(()=>[se(n.$slots,"default")]),_:3}))}}),zf=F({inheritAttrs:!1,__name:"CloseableDialog",props:{modelValue:Boolean,width:{type:String,required:!1},maxWidth:{type:String,default:"960px"},closeOffsetX:{type:Number,default:()=>8},closeOffsetY:{type:Number,default:()=>8}},emits:["update:model-value"],setup(e,{emit:t}){const n=e,o=()=>{t("update:model-value",!1)},a=xn(),i=w(()=>n.width?n.width:a.mobile.value?"100%":"75%"),s=w(()=>a.mobile.value?"100%":n.maxWidth);return(r,l)=>(C(),B(ls,ze(r.$attrs,{"content-class":["closeable-dialog",r.$attrs["content-class"]],width:i.value,"max-width":s.value,"model-value":n.modelValue,"onUpdate:modelValue":l[0]||(l[0]=c=>t("update:model-value",c))}),{default:v(()=>[f(te,{variant:"flat",class:"close-button",style:nt({top:`${n.closeOffsetY}px`,right:`${n.closeOffsetX}px`}),icon:"mdi-close",onClick:o},null,8,["style"]),se(r.$slots,"default",{close:o},void 0,!0)]),_:3},16,["content-class","width","max-width","model-value"]))}});const Wt=z(zf,[["__scopeId","data-v-92f92aea"]]),jf={name:"volview-full-logo"},Qf={width:"362",height:"46",viewBox:"0 0 362 46",fill:"none",xmlns:"http://www.w3.org/2000/svg"},qf=zi('<g clip-path="url(#clip0_137_135)"><path d="M217.55 26.6132C217.498 26.6912 217.447 26.7951 217.37 26.8731C216.06 28.64 213.364 29.3676 210 28.8999C209.846 28.8739 209.692 28.8479 209.537 28.8219C207.509 28.4841 205.3 27.7306 203.092 26.6132C201.782 25.9377 200.472 25.1062 199.214 24.1447C197.853 23.1054 196.621 21.988 195.568 20.7928C193.898 18.9479 192.666 16.9991 191.87 15.1282C190.56 12.0361 190.56 9.28175 191.844 7.48883C193.154 5.7219 195.722 5.04631 198.932 5.54001C200.524 5.77387 202.27 6.31954 204.068 7.12505C205.84 7.93057 207.663 8.99592 209.435 10.3471C212.979 13.0235 215.649 16.2715 217.087 19.3377C218.474 22.2479 218.654 24.8463 217.55 26.6132Z" fill="#3EAE2B"></path><path d="M217.55 26.6132C217.498 26.6912 217.447 26.7951 217.37 26.8731C216.06 28.64 213.364 29.3676 210 28.8998C209.846 28.8739 209.692 28.8479 209.537 28.8219C207.663 28.4321 205.506 27.7306 203.092 26.6132C201.782 25.9376 200.473 25.1061 199.214 24.1447C197.853 23.1054 196.621 21.988 195.568 20.7928C193 16.5054 193.539 11.1786 195.08 9.48961C196.954 7.41087 201.243 6.94315 207.945 11.4904C213.852 15.492 218.089 23.2613 217.55 26.6132Z" fill="black" fill-opacity="0.15"></path><path d="M214.442 22.2479C214.442 22.7416 214.34 23.1833 214.16 23.5731C214.108 23.703 214.031 23.8329 213.929 23.9628C213.518 24.5345 212.85 24.8983 211.951 25.0801C211.053 25.262 209.974 25.2101 208.767 24.9762C206.353 24.5085 203.58 23.2353 201.14 21.4164C201.115 21.3904 201.063 21.3644 201.037 21.3384C198.675 19.5195 196.877 17.3109 195.876 15.2581C194.849 13.1534 194.772 11.3085 195.619 10.1652C196.441 9.02188 198.213 8.68409 200.498 9.1518C202.784 9.61952 205.429 10.8927 207.843 12.7376C210.257 14.5825 212.26 16.8172 213.415 18.9219C214.108 20.1431 214.442 21.2864 214.442 22.2479Z" fill="#3EAE2B"></path><path d="M214.16 23.5731C214.108 23.7031 214.031 23.833 213.929 23.9629C213.518 24.5346 212.85 24.8983 211.951 25.0802C211.053 25.2621 209.974 25.2102 208.767 24.9763C206.353 24.5086 203.58 23.2353 201.14 21.4165C201.114 21.3905 201.063 21.3645 201.037 21.3385C198.187 18.4542 198.059 13.855 199.214 12.5558C200.524 11.3865 202.835 11.4125 207.072 14.2708C210.616 16.6873 213.877 21.1826 214.16 23.5731Z" fill="black" fill-opacity="0.15"></path><path d="M210.616 21.4944C210.436 21.7282 210.128 21.8841 209.666 21.9621C209.204 22.0141 208.613 21.9881 207.92 21.8062C206.559 21.4684 204.915 20.6889 203.374 19.5196C201.834 18.3503 200.652 17.0251 199.985 15.8038C199.651 15.2062 199.471 14.6605 199.394 14.1928C199.343 13.7251 199.42 13.4133 199.599 13.1794C199.779 12.9456 200.062 12.7637 200.524 12.7117C200.96 12.6597 201.525 12.6857 202.193 12.8416C202.835 12.9975 203.58 13.2834 204.324 13.6731C205.069 14.0629 205.865 14.5566 206.61 15.1542C208.151 16.3235 209.383 17.6487 210.102 18.844C210.462 19.4416 210.667 19.9873 210.744 20.455C210.847 20.9487 210.77 21.2865 210.616 21.4944Z" fill="#3EAE2B"></path><path d="M211.309 21.8061C211.078 22.4038 210.847 22.8455 210.462 23.3912C208.151 26.5093 203.323 26.951 199.933 24.3786C196.543 21.8061 195.67 16.999 197.956 13.8809C198.418 13.3093 198.752 12.9195 199.291 12.4778C199.188 12.5557 199.111 12.6337 199.034 12.7376C198.701 13.1794 198.624 13.725 198.701 14.2967C198.778 14.8683 199.009 15.5179 199.368 16.1675C200.087 17.4668 201.346 18.8959 202.963 20.1172C204.581 21.3384 206.302 22.1699 207.791 22.5077C208.536 22.6896 209.229 22.7416 209.794 22.6636C210.385 22.5857 210.898 22.3518 211.232 21.9101C211.258 21.9101 211.284 21.8581 211.309 21.8061Z" fill="#0068C7"></path><path d="M214.879 24.0148C214.571 24.9502 213.441 26.6652 212.747 27.4447C209.101 32.3558 201.448 33.2132 195.953 29.0558C190.483 24.9762 189.482 16.6873 193.128 11.7502C193.693 10.9967 194.643 9.80143 195.465 9.09985C195.285 9.25576 195.105 9.43765 194.951 9.64552C193.821 11.1786 194.078 13.4132 195.131 15.6219C196.21 17.8565 198.136 20.1951 200.627 22.092C201.885 23.0534 203.22 23.8589 204.581 24.4825C205.942 25.1062 207.303 25.5739 208.562 25.8077C209.846 26.0676 211.027 26.1195 212.054 25.9117C213.081 25.7038 213.954 25.2621 214.545 24.4825C214.699 24.3266 214.802 24.1707 214.879 24.0148Z" fill="#0068C7"></path><path d="M218.577 26.4054C218.012 27.9385 216.959 29.8353 215.495 31.5503C209.589 38.3582 199.368 39.6314 192.024 34.0448C184.705 28.5101 182.985 18.3503 187.787 10.633C188.865 8.89203 190.945 6.83928 192.178 5.95581C192.152 5.98179 191.459 6.6314 191.176 7.02116C189.61 9.15187 189.738 12.296 191.099 15.466C192.46 18.6881 195.08 22.066 198.701 24.8204C200.524 26.1975 202.424 27.2889 204.324 28.1204C206.225 28.9519 208.125 29.4716 209.871 29.7314C213.364 30.1991 216.445 29.5235 218.012 27.3928C218.243 27.081 218.448 26.7432 218.577 26.4054Z" fill="#0068C7"></path><path d="M217.832 18.9739C216.317 15.7779 213.544 12.4259 209.923 9.67158C206.328 6.91725 202.424 5.22828 199.06 4.70859C197.853 4.5267 196.672 4.50072 195.619 4.63064C195.568 4.63064 195.516 4.63064 195.491 4.65662C195.337 4.68261 195.157 4.70859 195.003 4.73458C194.977 4.73458 194.951 4.73458 194.9 4.76056C194.797 4.78654 194.695 4.81253 194.618 4.83851C194.515 4.8645 194.438 4.89048 194.361 4.91647C194.284 4.94245 194.207 4.96843 194.13 4.99442C193.385 5.22828 192.717 5.59206 192.127 6.05977C191.767 6.31962 191.459 6.63143 191.176 7.02119C189.61 9.1519 189.738 12.296 191.099 15.4661C192.46 18.6881 195.08 22.0661 198.701 24.8204C200.524 26.1976 202.424 27.2889 204.324 28.1204C206.225 28.9519 208.125 29.4716 209.871 29.7314C213.364 30.1991 216.445 29.5236 218.012 27.3928C218.243 27.107 218.423 26.7692 218.577 26.4314C219.527 24.3527 219.116 21.6763 217.832 18.9739ZM217.55 26.6133C217.498 26.6913 217.447 26.7952 217.37 26.8732C216.06 28.6401 213.364 29.3676 210 28.8999C209.846 28.8739 209.692 28.848 209.537 28.822C207.509 28.4842 205.3 27.7306 203.092 26.6133C201.782 25.9377 200.473 25.1062 199.214 24.1448C197.853 23.1054 196.621 21.9881 195.568 20.7928C193.899 18.948 192.666 16.9991 191.87 15.1283C190.56 12.0362 190.56 9.28182 191.844 7.48891C193.154 5.72198 195.722 5.04639 198.932 5.54009C200.524 5.77395 202.27 6.31962 204.068 7.12513C205.84 7.93064 207.663 8.99599 209.435 10.3472C212.979 13.0236 215.649 16.2716 217.087 19.3377C218.474 22.248 218.654 24.8464 217.55 26.6133Z" fill="white"></path><path d="M214.16 18.5061C212.953 16.2975 210.873 13.9589 208.382 12.062C205.891 10.1652 203.143 8.84 200.704 8.3463C198.88 7.95654 197.16 8.03449 195.927 8.78803C195.901 8.78803 195.876 8.81402 195.876 8.81402C195.876 8.81402 195.85 8.81402 195.85 8.84C195.799 8.86599 195.747 8.89197 195.722 8.94394C195.645 8.99591 195.568 9.07386 195.491 9.12583C195.311 9.28173 195.131 9.46362 194.977 9.6715C193.847 11.2046 194.104 13.4392 195.157 15.6479C196.235 17.8825 198.161 20.2211 200.652 22.118C201.911 23.0794 203.246 23.8849 204.607 24.5085C205.968 25.1321 207.329 25.5998 208.587 25.8337C209.871 26.0935 211.053 26.1455 212.08 25.9376C213.107 25.7298 213.98 25.288 214.571 24.5085C214.673 24.3786 214.776 24.2227 214.853 24.0668C215.675 22.5077 215.238 20.4809 214.16 18.5061ZM213.929 23.9628C213.518 24.5345 212.85 24.8983 211.951 25.0802C211.053 25.262 209.974 25.2101 208.767 24.9762C206.353 24.5085 203.58 23.2353 201.14 21.4164C198.726 19.5975 196.877 17.3369 195.876 15.2581C194.849 13.1534 194.772 11.3085 195.619 10.1652C196.441 9.02189 198.213 8.6841 200.498 9.15181C202.784 9.61953 205.429 10.8928 207.843 12.7376C210.256 14.5825 212.259 16.8172 213.415 18.9219C214.108 20.1691 214.442 21.3124 214.442 22.2739C214.442 22.9235 214.288 23.4951 213.929 23.9628Z" fill="white"></path><path fill-rule="evenodd" clip-rule="evenodd" d="M211.515 20.351C211.412 19.7793 211.155 19.1297 210.77 18.4801C210 17.1809 208.716 15.7778 207.098 14.5565C205.506 13.3352 203.837 12.4778 202.398 12.14C201.679 11.9581 201.012 11.9061 200.447 11.9841C200.01 12.036 199.599 12.2179 199.291 12.4778C199.189 12.5557 199.111 12.6337 199.034 12.7376C198.701 13.1793 198.624 13.725 198.701 14.2967C198.778 14.8683 199.009 15.5179 199.368 16.1675C200.087 17.4667 201.346 18.8959 202.963 20.1171C204.581 21.3384 206.302 22.1699 207.791 22.5077C208.536 22.6896 209.229 22.7415 209.794 22.6636C210.385 22.5856 210.899 22.3518 211.232 21.91C211.258 21.8581 211.284 21.8321 211.309 21.7801C211.54 21.3904 211.592 20.8707 211.515 20.351ZM210.616 21.4943C210.436 21.7281 210.128 21.8841 209.666 21.962C209.204 22.014 208.613 21.988 207.92 21.8061C206.559 21.4683 204.915 20.6888 203.374 19.5195C201.834 18.3502 200.652 17.025 199.985 15.8037C199.651 15.2061 199.471 14.6604 199.394 14.1927C199.343 13.725 199.42 13.4132 199.599 13.1793C199.779 12.9455 200.062 12.7636 200.524 12.7116C200.96 12.6596 201.525 12.6856 202.193 12.8415C202.835 12.9974 203.58 13.2833 204.324 13.673C205.069 14.0628 205.865 14.5565 206.61 15.1541C208.151 16.3234 209.383 17.6486 210.102 18.8439C210.462 19.4415 210.667 19.9872 210.744 20.4549C210.847 20.9486 210.77 21.2864 210.616 21.4943Z" fill="white"></path></g><path d="M246.292 9.76333H243.172L235.252 31.1633L227.372 9.76333H224.252L233.692 35.0433H236.852L246.292 9.76333ZM261.251 25.4033C261.251 29.8033 260.131 32.6033 255.691 32.6033C251.251 32.6033 250.091 29.8033 250.091 25.4033C250.091 21.0033 251.251 18.2033 255.691 18.2033C260.131 18.2033 261.251 21.0033 261.251 25.4033ZM255.691 35.3633C261.771 35.3633 264.171 31.2833 264.171 25.4033C264.171 19.4033 261.891 15.4433 255.691 15.4433C249.571 15.4433 247.171 19.5233 247.171 25.4033C247.171 31.4033 249.451 35.3633 255.691 35.3633ZM268.747 29.6833C268.747 33.8433 270.827 35.2833 273.587 35.2833C274.627 35.2833 275.427 35.1233 275.947 34.8833L275.547 32.2433C275.107 32.4433 274.507 32.5233 273.827 32.5233C272.467 32.5233 271.667 31.8833 271.667 29.2433V7.76333H268.747V29.6833Z" fill="#3EAE2B"></path><path d="M299.261 9.76333H296.141L288.221 31.1633L280.341 9.76333H277.221L286.661 35.0433H289.821L299.261 9.76333ZM302.505 35.0433H305.425V15.7633H302.505V35.0433ZM302.065 9.16333C302.065 10.2033 302.905 11.0433 303.985 11.0433C305.025 11.0433 305.865 10.2033 305.865 9.16333C305.865 8.12333 305.025 7.24333 303.985 7.24333C302.905 7.24333 302.065 8.08333 302.065 9.16333ZM326.615 23.8833C326.615 18.2833 323.615 15.4433 318.535 15.4433C312.215 15.4433 310.175 19.8833 310.175 25.4433C310.175 32.2833 313.295 35.3633 319.455 35.3633C321.815 35.3633 324.095 34.8833 325.975 34.0433L325.535 31.2833C324.095 32.0433 321.735 32.6033 319.495 32.6033C315.495 32.6033 313.135 30.8033 313.135 26.7233V26.5633H326.295C326.535 25.7233 326.615 24.6833 326.615 23.8833ZM313.135 23.8433C313.135 19.6833 315.215 18.0433 318.455 18.0433C321.735 18.0433 323.815 19.7233 323.815 23.8433V24.0833H313.135V23.8433ZM332.648 15.7633H329.648L336.368 35.0433H339.368L344.608 20.2833L349.848 35.0433H352.848L359.568 15.7633H356.568L351.328 31.0833L346.088 15.7633H343.128L337.888 31.0833L332.648 15.7633Z" fill="#0068C7"></path><path d="M8.87229 5.59206L0.781128 14.7137L2.74742 16.9885L13.3699 5.00647H10.1831C9.68593 5.00647 9.2113 5.20917 8.87229 5.59206Z" fill="#3EAE2B"></path><path d="M15.0876 5.59206L3.85486 18.2497L5.82115 20.5245L19.5852 5.00647H16.3984C15.9012 5.00647 15.404 5.20917 15.0876 5.59206Z" fill="#3EAE2B"></path><path d="M25.7778 5.00647H22.6137C22.1165 5.00647 21.6193 5.23169 21.2802 5.59206L6.90601 21.8083L19.879 36.8308C20.218 37.2137 20.6926 37.4389 21.2124 37.4389H24.3314L10.8386 21.8308L25.7778 5.00647Z" fill="#3EAE2B"></path><path d="M12.059 37.4389L0.781128 24.3983V28.9479L7.60663 36.8307C7.94565 37.2136 8.42027 37.4389 8.94009 37.4389H12.059Z" fill="#0068C7"></path><path d="M18.2065 37.4389L0.781128 17.2812V21.8308L13.7541 36.8308C14.0931 37.2137 14.5677 37.4389 15.0876 37.4389H18.2065Z" fill="#0068C7"></path><path d="M31.2925 7.37134H34.2532V35.029H31.2925V7.37134ZM43.2936 15.4794H47.068L38.9316 24.7137L47.8816 35.0065H44.1073L35.1573 24.7137L43.2936 15.4794Z" fill="#0068C7"></path><path d="M51.6786 6.85327C52.7408 6.85327 53.5996 7.75417 53.5996 8.79021C53.5996 9.84877 52.7408 10.7046 51.6786 10.7046C50.5711 10.7046 49.7349 9.84877 49.7349 8.79021C49.7349 7.70913 50.5937 6.85327 51.6786 6.85327ZM50.1869 15.4794H53.1476V35.0289H50.1869V15.4794Z" fill="#0068C7"></path><path d="M57.6453 10.2091H60.606V15.4794H68.4486V18.2722H60.606V28.1596C60.606 31.5154 62.1203 32.5289 64.3804 32.5289C66.0077 32.5289 67.7253 32.1235 68.8554 31.6055L69.3074 34.3983C67.9965 34.9614 66.2111 35.3217 64.3804 35.3217C60.4252 35.3217 57.6227 33.4974 57.6227 28.137V10.2091H57.6453Z" fill="#0068C7"></path><path d="M79.0032 31.0199L84.337 15.4794H87.343L92.6768 30.9974L97.988 15.4794H101.039L94.2137 35.0289H91.1625L85.8287 20.074L80.4949 35.0289H77.4437L70.6182 15.4794H73.6694L79.0032 31.0199Z" fill="#0068C7"></path><path d="M117.109 34.2182C115.278 34.8713 112.385 35.3443 109.673 35.3443C104.949 35.3443 101.83 33.7677 101.83 29.3533C101.83 24.9839 104.972 23.3173 110.283 23.3173H114.148V21.4029C114.148 18.7227 112.272 17.8668 109.176 17.8668C106.893 17.8668 105.017 18.2722 103.797 18.7227L103.345 15.9975C104.927 15.547 106.915 15.1416 109.289 15.1416C113.764 15.1416 117.109 16.7632 117.109 21.6281V34.2182ZM114.148 25.6596H110.328C106.712 25.6596 104.791 26.5605 104.791 29.3083C104.791 32.056 106.712 32.7993 109.582 32.7993C111.006 32.7993 112.882 32.6416 114.148 32.2362V25.6596Z" fill="#0068C7"></path><path d="M121.651 16.2902C122.962 15.6821 125.403 15.1866 127.799 15.1866C129.336 15.1866 130.647 15.3443 131.709 15.6821L131.144 18.4299C130.534 18.1821 129.313 17.9794 127.889 17.9794C126.217 17.9794 125.335 18.1821 124.635 18.4975V35.0065H121.674V16.2902H121.651Z" fill="#0068C7"></path><path d="M148.931 26.4253H135.528V26.583C135.528 30.7271 137.924 32.5515 141.992 32.5515C144.275 32.5515 146.671 31.9884 148.14 31.2226L148.592 34.0154C146.671 34.8713 144.365 35.3442 141.97 35.3442C135.709 35.3442 132.522 32.2136 132.522 25.2992C132.522 19.6686 134.602 15.1641 141.02 15.1641C146.196 15.1641 149.247 18.0469 149.247 23.7226C149.247 24.5334 149.157 25.5695 148.931 26.4253ZM135.528 23.9253H146.399V23.6776C146.399 19.5109 144.275 17.7992 140.953 17.7992C137.653 17.7992 135.551 19.4659 135.551 23.6776V23.9253H135.528Z" fill="#0068C7"></path><line x1="170.559" y1="0.935669" x2="170.559" y2="42.4279" stroke="#CACACA"></line><defs><clipPath id="clip0_137_135"><rect width="34" height="33" fill="white" transform="translate(185.09 4.55261)"></rect></clipPath></defs>',17),Kf=[qf];function Zf(e,t,n,o,a,i){return C(),L("svg",Qf,Kf)}const Sl=z(jf,[["render",Zf]]),Uo=ce("keyboardShortcuts",()=>({settingsOpen:O(!1)})),Yf=""+new URL("KitwareHeadAndNeck-6fe4377e.jpg",import.meta.url).href;const Jf=F({name:"AboutBox",components:{VolViewFullLogo:Sl},setup(){const e=xn(),t=Uo();return{openKeyboardShortcuts:()=>{t.settingsOpen=!0},mobile:e.xs,versions:{volview:"4.3.0","vtk.js":"32.9.1","itk-wasm":"1.0.0-b.178"}}}}),Ie=e=>($e("data-v-58943ed3"),e=e(),xe(),e),Xf=Ie(()=>_("h2",{class:"mt-2"},"About VolView",-1)),em={class:"float-right"},tm=Ie(()=>_("br",null,null,-1)),nm=Ie(()=>_("p",null,[_("a",{rel:"noopener noreferrer",target:"_blank",href:"https://volview.kitware.com/"},[_("span",null,"VolView")]),P(" is an open-source web application developed at "),_("a",{rel:"noopener noreferrer",target:"_blank",href:"https://kitware.com/"},[_("span",null,"Kitware")]),P(" for visualizing and annotating medical images. It key features include: ")],-1)),om=Ie(()=>_("ul",null,[_("li",null,"Fast: Drag-and-drop DICOM files for quick viewing"),_("li",null," Flexible: Designed to be easily integrated into existing systems "),_("li",null," Beautiful: Cinematic volume rendering to generate high-quality 3D visualizations "),_("li",null," Friendly: Familiar radiological image visualization and annotation tools "),_("li",null," Secure: Your data stays on your machine. No cloud services or data servers are used. ")],-1)),am=Ie(()=>_("br",null,null,-1)),sm=Ie(()=>_("a",{rel:"noopener noreferrer",target:"_blank",href:"https://github.com/InsightSoftwareConsortium/itk-wasm/"},[_("span",null,"itk-wasm")],-1)),im=Ie(()=>_("a",{rel:"noopener noreferrer",target:"_blank",href:"https://github.com/Kitware/vtk-js"},[_("span",null,"vtk.js")],-1)),rm=Ie(()=>_("br",null,null,-1)),lm=Ie(()=>_("br",null,null,-1)),cm=Ie(()=>_("a",{"rel-":"noopener noreferrer",target:"_blank",href:"https://www.kitware.com/contact/project/"},"Contact Kitware!",-1)),um=Ie(()=>_("h2",{class:"mt-2"},"Useful Links",-1)),dm=Ie(()=>_("ul",null,[_("li",null,[_("span",null,"VolView source code repo: "),_("a",{rel:"noopener noreferrer",target:"_blank",href:"https://github.com/Kitware/VolView"}," https://github.com/Kitware/VolView ")]),_("li",null,[_("span",null,"Community support forum: "),_("a",{rel:"noopener noreferrer",target:"_blank",href:"https://discourse.vtk.org/c/web/volview/14"}," https://discourse.vtk.org/c/web/volview/14 ")]),_("li",null,[_("span",null,"File an bug report or feature request: "),_("a",{rel:"noopener noreferrer",target:"_blank",href:"https://github.com/Kitware/VolView/issues"}," https://github.com/Kitware/VolView/issues ")])],-1)),pm=Ie(()=>_("h2",null,"Version Info",-1)),fm={class:"d-flex flex-flow align-center text-no-wrap"},mm=Ie(()=>_("span",null,"VolView: ",-1)),gm={class:"d-flex flex-flow align-center text-no-wrap"},vm=Ie(()=>_("span",null,"vtk.js: ",-1)),hm={class:"d-flex flex-flow align-center text-no-wrap"},Am=Ie(()=>_("span",null,"itk-wasm: ",-1)),ym=Ie(()=>_("h2",{class:"mt-2"},"Acknowledgments",-1)),wm=Ie(()=>_("br",null,null,-1)),Sm=Ie(()=>_("br",null,null,-1)),Cm=Ie(()=>_("ul",null,[_("li",null,[P(' PROSTATEx Challenge Data: Geert Litjens, Oscar Debats, Jelle Barentsz, Nico Karssemeijer, and Henkjan Huisman. "ProstateX Challenge data", The Cancer Imaging Archive (2017). DOI: 10.7937/K9TCIA.2017.MURS5CL ('),_("a",{rel:"noopener noreferrer",target:"_blank",href:"https://wiki.cancerimagingarchive.net/pages/viewpage.action?pageId=23691656"},"TCIA"),P(") ")]),_("li",null,[P(' MRA Head and Neck: Test case 98890234 from the "Patient Contributed Image Repository" ('),_("a",{rel:"noopener noreferrer",target:"_blank",href:"http://www.pcir.org/researchers/98890234_20030505_MR.html"},"PCIR.org"),P(") ")]),_("li",null,[P(" 3D ultrasound of a fetus: Sample data from "),_("a",{rel:"noopener noreferrer",target:"_blank",href:"http://tomovision.com"},"tomovision.com")])],-1));function bm(e,t,n,o,a,i){const s=q("vol-view-full-logo");return C(),B(Pe,null,{default:v(()=>[f(qt,{class:"d-flex flex-row justify-center"},{default:v(()=>[f(s)]),_:1}),f(ko,{color:"secondary",variant:"tonal",class:"notice"},{default:v(()=>[P(" For investigational use only ")]),_:1}),f(ot,null,{default:v(()=>[f(te,{class:"my-2",onClick:e.openKeyboardShortcuts,"prepend-icon":"mdi-keyboard",color:"secondary"},{default:v(()=>[P(" Keyboard Shortcuts and View Controls ")]),_:1},8,["onClick"]),Xf,f(Re,{class:"mb-2"}),_("p",em,[Vt(f(Un,{src:Yf,alt:"Head and neck CT rendering",width:"200px",class:"ma-1",align:"center"},null,512),[[Tt,!e.mobile]]),tm]),nm,om,am,P(" VolView is freely available for research, educational, and commercial applications. It is built on a variety of open-source toolkits created by Kitware, such as "),sm,P(" for DICOM I/O and image processing, and "),im,P(" for in-browser scientific visualization. "),rm,lm,P(" Want help customizing VolView or creating a new web-based visualization application? "),cm,um,f(Re,{class:"mb-2"}),dm,pm,f(Re,{class:"mb-2"}),_("ul",null,[_("li",null,[_("div",fm,[mm,f(ao,{inline:"",content:e.versions.volview},null,8,["content"])])]),_("li",null,[_("div",gm,[vm,f(ao,{inline:"",content:e.versions["vtk.js"]},null,8,["content"])])]),_("li",null,[_("div",hm,[Am,f(ao,{inline:"",content:e.versions["itk-wasm"]},null,8,["content"])])])]),ym,f(Re,{class:"mb-2"}),P(" This work was funded, in part, by the NIH via NIBIB and NIGMS R01EB021396, NIBIB R01EB014955, NCI R01CA220681, and NINDS R42NS086295 "),wm,Sm,P(" Sample data provided by the following sources: "),Cm]),_:1})]),_:1})}const _m=z(Jf,[["render",bm],["__scopeId","data-v-58943ed3"]]),Im={},km={width:"178",height:"41",viewBox:"0 0 178 41",fill:"none",xmlns:"http://www.w3.org/2000/svg"},Dm=zi('<g clip-path="url(#clip0_137_151)"><path d="M33.2403 22.3722C33.189 22.4501 33.1376 22.554 33.0606 22.632C31.7509 24.3989 29.0545 25.1265 25.6905 24.6588C25.5364 24.6328 25.3823 24.6068 25.2282 24.5808C23.1995 24.243 20.9911 23.4895 18.7826 22.3722C17.4729 21.6966 16.1633 20.8651 14.905 19.9037C13.5439 18.8643 12.3113 17.747 11.2584 16.5517C9.58926 14.7068 8.35663 12.758 7.56056 10.8871C6.25089 7.79499 6.25089 5.04066 7.53488 3.24774C8.84455 1.48082 11.4125 0.805225 14.6225 1.29893C16.2146 1.53278 17.9609 2.07845 19.7584 2.88396C21.5303 3.68948 23.3536 4.75483 25.1255 6.10601C28.6693 8.78239 31.34 12.0304 32.7781 15.0966C34.1648 18.0068 34.3445 20.6052 33.2403 22.3722Z" fill="#3EAE2B"></path><path d="M33.2404 22.3721C33.189 22.4501 33.1377 22.554 33.0606 22.632C31.7509 24.3989 29.0546 25.1265 25.6905 24.6588C25.5364 24.6328 25.3824 24.6068 25.2283 24.5808C23.3537 24.191 21.1966 23.4895 18.7827 22.3721C17.473 21.6966 16.1633 20.8651 14.905 19.9036C13.544 18.8643 12.3114 17.7469 11.2585 16.5517C8.69052 12.2643 9.2298 6.9375 10.7706 5.24852C12.6452 3.16978 16.9337 2.70206 23.6361 7.24931C29.5425 11.2509 33.7796 19.0202 33.2404 22.3721Z" fill="black" fill-opacity="0.15"></path><path d="M30.1331 18.0068C30.1331 18.5005 30.0304 18.9422 29.8506 19.332C29.7993 19.4619 29.7222 19.5918 29.6195 19.7217C29.2086 20.2934 28.541 20.6572 27.6422 20.8391C26.7434 21.021 25.6648 20.969 24.4579 20.7351C22.044 20.2674 19.2706 18.9942 16.831 17.1753C16.8053 17.1493 16.7539 17.1233 16.7283 17.0973C14.3657 15.2784 12.5681 13.0698 11.5666 11.017C10.5394 8.91229 10.4624 7.06741 11.3098 5.9241C12.1316 4.78079 13.9035 4.443 16.189 4.91071C18.4745 5.37843 21.1195 6.65166 23.5334 8.49654C25.9473 10.3414 27.9503 12.5761 29.1059 14.6808C29.7993 15.9021 30.1331 17.0454 30.1331 18.0068Z" fill="#3EAE2B"></path><path d="M29.8506 19.3321C29.7992 19.462 29.7222 19.5919 29.6195 19.7218C29.2086 20.2935 28.5409 20.6573 27.6421 20.8391C26.7433 21.021 25.6648 20.9691 24.4578 20.7352C22.0439 20.2675 19.2705 18.9943 16.831 17.1754C16.8053 17.1494 16.7539 17.1234 16.7282 17.0974C13.8778 14.2132 13.7494 9.61394 14.905 8.31473C16.2146 7.14544 18.5258 7.17142 22.763 10.0297C26.3068 12.4462 29.5681 16.9415 29.8506 19.3321Z" fill="black" fill-opacity="0.15"></path><path d="M26.3068 17.2533C26.1271 17.4871 25.8189 17.6431 25.3567 17.721C24.8944 17.773 24.3038 17.747 23.6105 17.5651C22.2494 17.2273 20.6059 16.4478 19.0651 15.2785C17.5243 14.1092 16.3431 12.784 15.6754 11.5627C15.3416 10.9651 15.1618 10.4194 15.0848 9.95171C15.0334 9.484 15.1105 9.17219 15.2902 8.93833C15.47 8.70447 15.7524 8.52258 16.2147 8.47061C16.6512 8.41864 17.2162 8.44463 17.8839 8.60053C18.5259 8.75644 19.2706 9.04227 20.0153 9.43203C20.76 9.82179 21.5561 10.3155 22.3008 10.9131C23.8416 12.0824 25.0742 13.4076 25.7932 14.6029C26.1528 15.2005 26.3582 15.7462 26.4352 16.2139C26.5379 16.7076 26.4609 17.0454 26.3068 17.2533Z" fill="#3EAE2B"></path><path d="M27.0001 17.565C26.769 18.1627 26.5379 18.6044 26.1527 19.1501C23.8415 22.2682 19.0137 22.7099 15.624 20.1375C12.2343 17.565 11.3612 12.758 13.6467 9.63984C14.1089 9.06819 14.4427 8.67843 14.982 8.23669C14.8793 8.31465 14.8022 8.3926 14.7252 8.49654C14.3914 8.93827 14.3143 9.48394 14.3914 10.0556C14.4684 10.6272 14.6995 11.2769 15.059 11.9265C15.7781 13.2257 17.0364 14.6548 18.6542 15.8761C20.272 17.0973 21.9926 17.9288 23.482 18.2666C24.2267 18.4485 24.9201 18.5005 25.485 18.4225C26.0757 18.3446 26.5893 18.1107 26.9231 17.669C26.9488 17.669 26.9745 17.617 27.0001 17.565Z" fill="#0068C7"></path><path d="M30.5696 19.7737C30.2615 20.7092 29.1316 22.4241 28.4382 23.2036C24.7917 28.1147 17.1391 28.9722 11.6436 24.8147C6.17386 20.7351 5.17235 12.4462 8.81888 7.50916C9.38383 6.75562 10.334 5.56034 11.1557 4.85876C10.976 5.01467 10.7962 5.19656 10.6421 5.40443C9.51223 6.93751 9.76903 9.17215 10.8219 11.3808C11.9004 13.6155 13.8264 15.954 16.3174 17.8509C17.5757 18.8123 18.911 19.6178 20.272 20.2414C21.6331 20.8651 22.9941 21.3328 24.2524 21.5666C25.5364 21.8265 26.7177 21.8784 27.7449 21.6706C28.7721 21.4627 29.6452 21.021 30.2358 20.2414C30.3899 20.0855 30.4926 19.9296 30.5696 19.7737Z" fill="#0068C7"></path><path d="M34.2675 22.1643C33.7025 23.6974 32.6497 25.5942 31.1859 27.3092C25.2796 34.1171 15.059 35.3903 7.71463 29.8037C0.395901 24.2691 -1.32464 14.1092 3.47747 6.39189C4.55602 4.65094 6.63608 2.59819 7.86871 1.71472C7.84303 1.74071 7.14968 2.39031 6.8672 2.78008C5.30074 4.91078 5.42913 8.05488 6.79016 11.225C8.15119 14.447 10.7705 17.825 14.3914 20.5793C16.2146 21.9565 18.1149 23.0478 20.0152 23.8793C21.9155 24.7108 23.8158 25.2305 25.5621 25.4903C29.0545 25.958 32.1361 25.2824 33.7026 23.1517C33.9337 22.8399 34.1391 22.5021 34.2675 22.1643Z" fill="#0068C7"></path><path d="M33.5228 14.7329C32.0077 11.5368 29.2343 8.18483 25.6135 5.4305C22.0183 2.67616 18.115 0.987188 14.7509 0.467503C13.544 0.285613 12.3627 0.259629 11.3098 0.38955C11.2585 0.38955 11.2071 0.38955 11.1814 0.415535C11.0274 0.441519 10.8476 0.467503 10.6935 0.493487C10.6679 0.493487 10.6422 0.493487 10.5908 0.519472C10.4881 0.545456 10.3854 0.57144 10.3083 0.597424C10.2056 0.623409 10.1286 0.649393 10.0515 0.675377C9.9745 0.701361 9.89746 0.727346 9.82042 0.75333C9.07571 0.987188 8.40803 1.35097 7.8174 1.81868C7.45788 2.07853 7.14973 2.39034 6.86725 2.7801C5.30078 4.91081 5.42918 8.0549 6.79021 11.225C8.15124 14.447 10.7706 17.825 14.3914 20.5793C16.2147 21.9565 18.115 23.0478 20.0153 23.8793C21.9156 24.7108 23.8159 25.2305 25.5621 25.4903C29.0546 25.9581 32.1361 25.2825 33.7026 23.1518C33.9337 22.8659 34.1135 22.5281 34.2675 22.1903C35.2177 20.1116 34.8068 17.4352 33.5228 14.7329ZM33.2404 22.3722C33.189 22.4502 33.1376 22.5541 33.0606 22.6321C31.7509 24.399 29.0546 25.1266 25.6905 24.6588C25.5364 24.6329 25.3824 24.6069 25.2283 24.5809C23.1996 24.2431 20.9911 23.4895 18.7827 22.3722C17.473 21.6966 16.1633 20.8651 14.905 19.9037C13.544 18.8644 12.3114 17.747 11.2585 16.5518C9.5893 14.7069 8.35667 12.7581 7.5606 10.8872C6.25093 7.79506 6.25093 5.04073 7.53492 3.24782C8.84459 1.48089 11.4126 0.805298 14.6225 1.299C16.2147 1.53286 17.9609 2.07853 19.7585 2.88404C21.5304 3.68955 23.3537 4.7549 25.1256 6.10609C28.6694 8.78246 31.3401 12.0305 32.7781 15.0966C34.1648 18.0069 34.3446 20.6053 33.2404 22.3722Z" fill="white"></path><path d="M29.8506 14.2651C28.6436 12.0564 26.5636 9.71781 24.0726 7.82096C21.5817 5.92411 18.834 4.59891 16.3944 4.10521C14.5711 3.71545 12.8506 3.7934 11.618 4.54694C11.5923 4.54694 11.5666 4.57293 11.5666 4.57293C11.5666 4.57293 11.5409 4.57293 11.5409 4.59891C11.4896 4.6249 11.4382 4.65088 11.4125 4.70285C11.3355 4.75482 11.2584 4.83277 11.1814 4.88474C11.0016 5.04065 10.8219 5.22254 10.6678 5.43041C9.5379 6.96348 9.79469 9.19813 10.8476 11.4068C11.9261 13.6414 13.8521 15.98 16.343 17.8769C17.6013 18.8383 18.9367 19.6438 20.2977 20.2674C21.6587 20.891 23.0198 21.3588 24.2781 21.5926C25.5621 21.8525 26.7433 21.9044 27.7705 21.6966C28.7977 21.4887 29.6708 21.0469 30.2615 20.2674C30.3642 20.1375 30.4669 19.9816 30.5439 19.8257C31.3657 18.2666 30.9291 16.2399 29.8506 14.2651ZM29.6195 19.7217C29.2086 20.2934 28.5409 20.6572 27.6421 20.8391C26.7433 21.021 25.6648 20.969 24.4578 20.7351C22.0439 20.2674 19.2705 18.9942 16.8309 17.1753C14.4171 15.3564 12.5681 13.0958 11.5666 11.017C10.5394 8.9123 10.4624 7.06742 11.3098 5.92411C12.1316 4.7808 13.9035 4.44301 16.189 4.91072C18.4745 5.37844 21.1195 6.65167 23.5334 8.49655C25.9473 10.3414 27.9503 12.5761 29.1059 14.6808C29.7992 15.928 30.1331 17.0714 30.1331 18.0328C30.1331 18.6824 29.979 19.254 29.6195 19.7217Z" fill="white"></path><path fill-rule="evenodd" clip-rule="evenodd" d="M27.2056 16.1099C27.1029 15.5382 26.8461 14.8886 26.4609 14.239C25.6905 12.9398 24.4065 11.5367 22.7887 10.3154C21.1965 9.09415 19.5274 8.23667 18.0893 7.89887C17.3703 7.71698 16.7026 7.66501 16.1376 7.74296C15.7011 7.79493 15.2902 7.97682 14.982 8.23667C14.8793 8.31462 14.8023 8.39257 14.7252 8.49651C14.3914 8.93824 14.3144 9.48391 14.3914 10.0556C14.4684 10.6272 14.6996 11.2768 15.0591 11.9264C15.7781 13.2256 17.0364 14.6548 18.6542 15.876C20.2721 17.0973 21.9926 17.9288 23.482 18.2666C24.2268 18.4485 24.9201 18.5004 25.4851 18.4225C26.0757 18.3445 26.5893 18.1107 26.9231 17.6689C26.9488 17.617 26.9745 17.591 27.0002 17.539C27.2313 17.1493 27.2826 16.6296 27.2056 16.1099ZM26.3068 17.2532C26.1271 17.4871 25.8189 17.643 25.3567 17.7209C24.8944 17.7729 24.3038 17.7469 23.6104 17.565C22.2494 17.2272 20.6059 16.4477 19.0651 15.2784C17.5243 14.1091 16.3431 12.7839 15.6754 11.5626C15.3416 10.965 15.1618 10.4193 15.0848 9.95163C15.0334 9.48391 15.1104 9.1721 15.2902 8.93824C15.47 8.70438 15.7524 8.52249 16.2147 8.47052C16.6512 8.41855 17.2162 8.44454 17.8839 8.60044C18.5259 8.75635 19.2706 9.04218 20.0153 9.43194C20.76 9.8217 21.5561 10.3154 22.3008 10.913C23.8416 12.0823 25.0742 13.4075 25.7932 14.6028C26.1527 15.2004 26.3582 15.7461 26.4352 16.2138C26.5379 16.7075 26.4609 17.0453 26.3068 17.2532Z" fill="white"></path></g><path d="M61.9829 5.52224H58.8629L50.9429 26.9222L43.0629 5.52224H39.9429L49.3829 30.8022H52.5429L61.9829 5.52224ZM76.9417 21.1622C76.9417 25.5622 75.8217 28.3622 71.3817 28.3622C66.9417 28.3622 65.7817 25.5622 65.7817 21.1622C65.7817 16.7622 66.9417 13.9622 71.3817 13.9622C75.8217 13.9622 76.9417 16.7622 76.9417 21.1622ZM71.3817 31.1222C77.4617 31.1222 79.8617 27.0422 79.8617 21.1622C79.8617 15.1622 77.5817 11.2022 71.3817 11.2022C65.2617 11.2022 62.8617 15.2822 62.8617 21.1622C62.8617 27.1622 65.1417 31.1222 71.3817 31.1222ZM84.4373 25.4422C84.4373 29.6022 86.5173 31.0422 89.2773 31.0422C90.3173 31.0422 91.1173 30.8822 91.6373 30.6422L91.2373 28.0022C90.7973 28.2022 90.1973 28.2822 89.5173 28.2822C88.1573 28.2822 87.3573 27.6422 87.3573 25.0022V3.52224H84.4373V25.4422Z" fill="#3EAE2B"></path><path d="M114.952 5.52224H111.832L103.912 26.9222L96.0317 5.52224H92.9117L102.352 30.8022H105.512L114.952 5.52224ZM118.196 30.8022H121.116V11.5222H118.196V30.8022ZM117.756 4.92225C117.756 5.96224 118.596 6.80225 119.676 6.80225C120.716 6.80225 121.556 5.96224 121.556 4.92225C121.556 3.88224 120.716 3.00224 119.676 3.00224C118.596 3.00224 117.756 3.84225 117.756 4.92225ZM142.306 19.6422C142.306 14.0422 139.306 11.2022 134.226 11.2022C127.906 11.2022 125.866 15.6422 125.866 21.2022C125.866 28.0422 128.986 31.1222 135.146 31.1222C137.506 31.1222 139.786 30.6422 141.666 29.8022L141.226 27.0422C139.786 27.8022 137.426 28.3622 135.186 28.3622C131.186 28.3622 128.826 26.5622 128.826 22.4822V22.3222H141.986C142.226 21.4822 142.306 20.4422 142.306 19.6422ZM128.826 19.6022C128.826 15.4422 130.906 13.8022 134.146 13.8022C137.426 13.8022 139.506 15.4822 139.506 19.6022V19.8422H128.826V19.6022ZM148.339 11.5222H145.339L152.059 30.8022H155.059L160.299 16.0422L165.539 30.8022H168.539L175.259 11.5222H172.259L167.019 26.8422L161.779 11.5222H158.819L153.579 26.8422L148.339 11.5222Z" fill="#0068C7"></path><defs><clipPath id="clip0_137_151"><rect width="34" height="33" fill="white" transform="translate(0.781128 0.311523)"></rect></clipPath></defs>',4),Em=[Dm];function Rm(e,t){return C(),L("svg",km,Em)}const Vm=z(Im,[["render",Rm]]);const Tm={__name:"AppBar",emits:["click:left-menu"],setup(e,{emit:t}){const{mobile:n}=xn(),o=O(!1);return(a,i)=>(C(),L(ne,null,[f(Ru,{app:"","clipped-left":"",height:48},{default:v(()=>[f(te,{icon:"mdi-menu",onClick:i[0]||(i[0]=s=>t("click:left-menu"))}),f(Eu,{class:"d-flex flex-row align-center mt-3"},{default:v(()=>[b(n)?(C(),B(Vm,{key:0})):(C(),B(Sl,{key:1}))]),_:1}),f(te,{variant:"text",icon:"",rounded:0,class:"toolbar-button",href:"https://volview.kitware.com/feedback/",target:"_blank"},{default:v(()=>[f(K,{icon:"mdi-comment-question-outline"}),f(fe,{activator:"parent",location:"bottom"},{default:v(()=>[P(" Ask Question/Submit Feedback ")]),_:1})]),_:1}),f(te,{variant:"text",icon:"",rounded:0,class:"toolbar-button",onClick:i[1]||(i[1]=s=>o.value=!o.value)},{default:v(()=>[f(K,{icon:"mdi-information-outline"}),f(fe,{activator:"parent",location:"bottom"},{default:v(()=>[P("About")]),_:1})]),_:1})]),_:1}),f(Wt,{modelValue:o.value,"onUpdate:modelValue":i[2]||(i[2]=s=>o.value=s)},{default:v(()=>[f(_m)]),_:1},8,["modelValue"])],64))}},Pm=z(Tm,[["__scopeId","data-v-c0c6ae33"]]),Cl=e=>Nd(t=>t.ok,e);function Mm(e,t,n){return{message:e,inputDataStackTrace:[t],cause:n}}const oa=Symbol("DoneSentinel");class No{constructor(t){this.handlers=Array.from(t??[])}async execute(t,n){return this.startExecutionContext(t,n)}async startExecutionContext(t,n){const o=[...this.handlers],a=[],i=vo(),s=(d,m)=>{m?i.reject(m):i.resolve(d)},r=async(d,m)=>{let g=!1,A;const y=m>=o.length,h={done:E=>{if(g)throw new Error("done() called twice!");return g=!0,A=E,oa},execute:async(E,k)=>{const R=this.execute(E,k??n);return a.push(R),R},extra:n};let S;y&&(S=oa);try{if(y)S=oa;else{const E=o[m];S=await E(d,h)}}catch(E){const k=E instanceof Error?E:new Error(E?String(E):"Unknown error occurred");s(void 0,k);return}if(g||y){s(A);return}r(S,m+1)},l=await(async()=>{try{await r(t,0);const d=await i.promise;return d!=null?{ok:!0,data:[d]}:{ok:!0,data:[]}}catch(d){const m=d instanceof Error?d.message:String(d);return{ok:!1,errors:[Mm(m,t,d)]}}})(),c=await Promise.all(a),[u,p]=Cl(c);return p.length>0?{ok:!1,errors:p.flatMap(m=>{const{errors:g}=m;return g.forEach(A=>{A.inputDataStackTrace.push(t)}),g})}:(l.ok&&u.forEach(d=>{l.data.push(...d.data)}),l)}}function bl(e){return!!e.fileSrc&&vl.has(e.fileSrc.fileType)}function Fo(e){return"dataID"in e&&"dataType"in e}function _l(e){return Fo(e)&&(e.dataType==="image"||e.dataType==="dicom")}function Om(e){return"config"in e}const Lm=(e,{extra:t,done:n})=>{const{fileSrc:o}=e;return t!=null&&t.dicomDataSources&&(o==null?void 0:o.fileType)==="application/dicom"?(t.dicomDataSources.push(e),n()):e},Il=async(e,{execute:t,done:n,extra:o})=>{const{fileSrc:a,uriSrc:i}=e;if(!a&&i&&Hf(i.uri))try{const s=await wl(i.uri,i.name,{cache:o==null?void 0:o.fetchFileCache});return t({...e,fileSrc:{file:s,fileType:""}}),n()}catch(s){throw new Error(`Could not download URL ${i.uri}`,{cause:s instanceof Error?s:void 0})}return e};async function cs(e){const t=await Va.loadAsync(e),n=[],o=[];return t.forEach((a,i)=>{if(!i.dir){const s=nl(i.name),r=Pp(i.name),l=t.file(i.name);l&&(n.push(l.async("blob").then(c=>new File([c],s))),o.push(r))}}),Promise.all(n).then(a=>a.map((i,s)=>({file:i,archivePath:o[s]})))}const Bm=async(e,{execute:t,done:n})=>bl(e)?((await cs(e.fileSrc.file)).forEach(a=>{t({fileSrc:{file:a.file,fileType:""},archiveSrc:{path:`${a.archivePath}/${a.file.name}`},parent:e})}),n()):e;async function $m(e,t){let n=t==null?void 0:t.get(e);return n||(n=cs(e).then(o=>o.reduce((a,i)=>{const s=ol(i.archivePath,i.file.name);return Object.assign(a,{[s]:i.file})},{})),t&&t.set(e,n),n)}const kl=async(e,{extra:t,execute:n,done:o})=>{const{fileSrc:a,archiveSrc:i,parent:s}=e,{archiveCache:r}=t??{};if(!a&&i&&s){if(!(s!=null&&s.fileSrc))throw new Error("Cannot extract an archive target with an unresolved parent");if(!bl(s))throw new Error("Parent is not a supported archive file");const l=await $m(s.fileSrc.file,r),c=fn(i.path),u=l[c];if(!u)throw new Error(`Failed to find archive member ${c}`);return n({...e,fileSrc:{file:u,fileType:""}}),o()}return e},xm=e=>Ot(e,window.location.origin).protocol==="s3:";function Um(e,t){return`https://${e}.s3.amazonaws.com/${t}`}async function Nm(e,t,n=()=>{}){const o=new Xc({region:"us-east-1",signer:{sign:async i=>i}}),a=async i=>{const s=new eu({Bucket:e,Prefix:t,ContinuationToken:i,MaxKeys:1e3});let r;try{r=await o.send(s)}catch(l){throw console.error(l),l}if(!r.Contents)throw new Error("S3 returned no objects");r.Contents.forEach(l=>{if(!l.Key)return;const c=l.Key,u=Um(e,l.Key);n(c,u)}),r.IsTruncated&&r.NextContinuationToken&&await a(r.NextContinuationToken)};await a()}const Fm=e=>{const{hostname:t,pathname:n}=Ot(e),o=n.replace(/^\//,"");return[t,o]},Wm=async(e,t=()=>{})=>{const[n,o]=Fm(e);await Nm(n,o,t)},Hm=async(e,{execute:t,done:n})=>{const{uriSrc:o}=e;if(o&&xm(o.uri))try{return await Wm(o.uri,(a,i)=>{t({uriSrc:{uri:i,name:a},parent:e})}),n()}catch(a){throw new Error(`Could not download S3 URI ${o.uri}`,{cause:a instanceof Error?a:void 0})}return e},Gm=e=>Ot(e,window.location.origin).protocol==="gs:",zm=e=>{const{hostname:t,pathname:n}=Ot(e),o=n.replace(/^\//,"");return[t,o]},jm=e=>`https://storage.googleapis.com/storage/v1/b/${e}/o`;async function Qm(e,t,n=()=>{}){const o=[],a=async i=>{const s=Ot(jm(e));s.searchParams.append("prefix",t),s.searchParams.append("maxResults","1000"),i&&s.searchParams.append("pageToken",i);const r=await Gf(s.toString());if(r.kind!=="storage#objects")throw new Error("GCS did not return a list of objects!");o.push(...r.items),r.items.forEach(l=>n(l)),r.nextPageToken&&await a(r.nextPageToken)};return await a(),o}const qm=async(e,t=()=>{})=>{const[n,o]=zm(e);return Qm(n,o,t)},Km=async(e,{execute:t,done:n})=>{const{uriSrc:o}=e;if(o&&Gm(o.uri))try{return await qm(o.uri,a=>{t({uriSrc:{uri:a.mediaLink,name:a.name},parent:e})}),n()}catch(a){throw new Error(`Could not download GCS URI ${o.uri}`,{cause:a instanceof Error?a:void 0})}return e},Ca=new Map,Zm=async(e,{done:t})=>{if(!e.fileSrc)return e;const{fileSrc:n}=e;if(!Ca.has(n.fileType))return e;const a=await Ca.get(n.fileType)(n.file),i=jt();if(a.isA("vtkImageData")){const s=Ae().addVTKImageData(n.file.name,a);return i.add(s,[e]),Me().viewIDs.forEach(r=>{const{lpsOrientation:l,dimensions:c}=Ae().metadata[s],u=Gt[r].props.viewDirection,p=Te(u),d=l[p],m=c[d];Dt().updateConfig(r,s,{axisDirection:u,max:m-1}),Dt().resetSlice(r,s)}),t({dataID:s,dataSource:e,dataType:"image"})}if(a.isA("vtkPolyData")){Oe().primarySelection||Ze().addWarning("Load an image to see the mesh. Initializing viewports from mesh files is not implemented.");const s=Zr().addVTKPolyData(n.file.name,a);return i.add(s,[e]),t({dataID:s,dataSource:e,dataType:"model"})}throw new Error("Data reader did not produce a valid dataset")},Ym=I.object({url:I.string(),name:I.optional(I.string())}),Jm=I.object({resources:I.array(Ym)});async function Xm(e){const t=new TextDecoder,n=await e.arrayBuffer(),o=t.decode(new Uint8Array(n));return Jm.parse(JSON.parse(o))}const eg=async(e,{done:t,execute:n})=>{const{fileSrc:o}=e;if((o==null?void 0:o.fileType)==="application/json"){const a=[];try{(await Xm(o.file)).resources.forEach(s=>{a.push({uriSrc:{uri:s.url,name:s.name??new URL(s.url,window.location.origin).pathname},parent:e})})}catch{return e}return a.forEach(i=>{n(i)}),t()}return e};function ci(...e){return t=>e.reduce((n,o)=>o(n),t)}function tg(e,...t){return t.slice(1).reduce((n,o)=>o(n),t[0](e))}const us=(e,{done:t})=>t({dataSource:e}),Wo=async e=>{let t=e;const{fileSrc:n}=t;if(n){const o=await hl(n.file);o&&(t={...t,fileSrc:{...n,fileType:o}})}return t},ui={1:{value:1,name:"Segment 1",color:[153,153,0,255]},2:{value:2,name:"Segment 2",color:[76,76,0,255]},3:{value:3,name:"Segment 3",color:[255,255,0,255]},4:{value:4,name:"Segment 4",color:[0,76,0,255]},5:{value:5,name:"Segment 5",color:[0,153,0,255]},6:{value:6,name:"Segment 6",color:[0,255,0,255]},7:{value:7,name:"Segment 7",color:[76,0,0,255]},8:{value:8,name:"Segment 8",color:[153,0,0,255]},9:{value:9,name:"Segment 9",color:[255,0,0,255]},10:{value:10,name:"Segment 10",color:[0,76,76,255]},11:{value:11,name:"Segment 11",color:[0,153,153,255]},12:{value:12,name:"Segment 12",color:[0,255,255,255]},13:{value:13,name:"Segment 13",color:[0,0,76,255]},14:{value:14,name:"Segment 14",color:[0,0,153,255]}},di=(e,t)=>n=>e.includes(n.version)?t(n):n,ng=e=>{const t=JSON.parse(JSON.stringify(e));return t.version="2.1.0",t},og=e=>{const t=JSON.parse(JSON.stringify(e));t.tools.paint.activeSegmentGroupID=e.tools.paint.activeLabelmapID,delete t.tools.paint.activeLabelmapID;const n=Object.keys(ui).map(o=>Number(o));return t.labelMaps=e.labelMaps.map((o,a)=>({id:o.id,path:o.path,metadata:{parentImage:o.parent,name:dl("My Image",a),segments:{order:n,byValue:ui}}})),t.version="3.0.0",t},ag=e=>{const t=JSON.parse(e);return tg(t,di(["1.1.0","1.0.0","0.5.0"],ng),di(["2.1.0"],og))},sg=async(e,{extra:t,done:n})=>{const{uriSrc:o}=e;if(o){const a=await new No([Il,Wo,us]).execute(e,t);if(!a.ok)throw a.errors[0].cause;return n({dataSource:a.data[0].dataSource})}return e},ig=async(e,{execute:t})=>{const{fileSrc:n,parent:o}=e;if(!n&&o){const a=await t(o);if(!a.ok)throw new Error("Could not process parent",{cause:xa(a.errors[0].cause)});return{...e,parent:a.data[0].dataSource}}return e},rg=async(e,{extra:t,done:n})=>{if(e.archiveSrc){const a=await new No([kl,Wo,us]).execute(e,t);if(!a.ok)throw a.errors[0].cause;return n({dataSource:a.data[0].dataSource})}return e};function lg(e,t,n){const o=n.filter(i=>fn(i.archivePath)===fn(e.path)).map(i=>Bo(i.file)),a=t.remoteFiles[e.id]??[];return[...o,...a]}async function cg(e,t,{extra:n,execute:o}){const a=new Map,i=t.map(c=>({...c,archivePath:fn(c.archivePath)})),{datasets:s}=e,r={},l=new No([Wo,sg,ig,rg,us]);return await Promise.all(s.map(async c=>{let u=lg(c,e,i);u=await Promise.all(u.map(async m=>{const g=await l.execute(m,{...n,archiveCache:a});if(!g.ok)throw g.errors[0].cause;return g.data[0].dataSource}));const p=[],d=await Promise.all(u.map(m=>o(m,{...n,archiveCache:a,dicomDataSources:p})));if(p.length){const m=Se(),g=await m.importFiles(p);if(g.length!==1)throw new Error("Obtained more than one volume from DICOM import");const[A]=g;await m.buildVolume(A),r[c.id]=A}else if(d.length===1){if(!d[0].ok)throw d[0].errors[0].cause;const[m]=d;if(m.data.length!==1)throw new Error("Import encountered multiple volumes for a single dataset");const g=m.data[0];if(!Fo(g))throw new Error("Failed to import dataset");r[c.id]=g.dataID}else throw new Error("Could not load any data from the session")})),r}const ug=async(e,t)=>{const{fileSrc:n}=e;if(n&&await Nf(n.file)){const o=await cs(n.file),[a,i]=Dr(p=>p.file.name===as,o);if(a.length!==1)throw new Error("State file does not have exactly 1 manifest");const s=await a[0].file.text(),r=ag(s),l=Y1.parse(r);Me().setLayout(l.layout);const c=await cg(l,i,t);if(l.primarySelection!==void 0){const p=c[l.primarySelection];Oe().setPrimarySelection(p)}Me().deserialize(l.views,c);const u=await et().deserialize(l,i,c);return Le().deserialize(l,u,c),st().deserialize(l,c),t.done()}return e},Dl=ce("data-browser",()=>({hideSampleData:O(!1)}));function bt(e,t){const n=Dt(),o=ro(),a=w(()=>n.getConfig(b(e),b(t))),i=w({get:()=>{var r;return((r=a.value)==null?void 0:r.slice)??o.slice},set:r=>{var c;const l=b(t);!l||r==null||(n.updateConfig(b(e),l,{slice:r}),(c=a.value)!=null&&c.syncState&&n.updateSyncConfigs())}}),s=w(()=>{const{min:r,max:l}=a.value??{};return r==null||l==null?[o.min,o.max]:[r,l]});return{config:a,slice:i,range:s}}const pi=e=>()=>{const t={[oe.Rectangle]:bn(),[oe.Ruler]:Jt(),[oe.Polygon]:_n()},n=Le(),o=t[n.currentTool];if(!o)return;const a=Object.entries(o.labels),i=a.findIndex(([r])=>r===o.activeLabel),[s]=a.at((i+e)%a.length);o.setActiveLabel(s)},lt=e=>()=>{Le().setCurrentTool(e)},dg=()=>{const e=Uo();e.settingsOpen=!e.settingsOpen},fi=e=>()=>{const{currentImageID:t}=me(),{activeViewID:n}=Me(),{slice:o}=bt(n,t);o.value+=e},pg=()=>()=>{Oe().removeAll()},fg=()=>()=>{const e=Oe();e.remove(e.primaryImageID),e.setPrimarySelection(e.idsAsSelections[0])},mg={windowLevel:lt(oe.WindowLevel),pan:lt(oe.Pan),zoom:lt(oe.Zoom),ruler:lt(oe.Ruler),paint:lt(oe.Paint),rectangle:lt(oe.Rectangle),crosshairs:lt(oe.Crosshairs),crop:lt(oe.Crop),polygon:lt(oe.Polygon),select:lt(oe.Select),nextSlice:fi(1),previousSlice:fi(-1),decrementLabel:pi(-1),incrementLabel:pi(1),deleteCurrentImage:fg(),clearScene:pg(),mergeNewPolygon:()=>{},showKeyboardShortcuts:dg},gn=O(d1);function gg(){const e=ji();let t=[];X(gn,n=>{t.forEach(o=>o()),t=Rr(n).map(([o,a])=>{const i=a.split("+"),s=i[i.length-1];return Pt(e[a],()=>{const r=e.current.has("shift"),l=Array.from(e.current).pop(),c=r?(l==null?void 0:l.toUpperCase())??l:l,u=e.current.size===i.length,p=s===c,d=r&&e.current.size-1===i.length&&p;(u&&p||d)&&mg[o]()})})},{immediate:!0,deep:!0})}const vg=I.object({activeLayout:Er(Ao).optional()}).optional(),hg=I.object({hideSampleData:I.boolean().optional()}).optional(),Ag=I.record(Er(ar),I.string()).optional(),El=I.string(),Ho=I.object({color:El,strokeWidth:I.number().optional()}),yg=Ho,wg=Ho,Sg=I.intersection(Ho,I.object({fillColor:El})),Cg=I.object({defaultLabels:I.record(Ho).or(I.null()).optional(),rulerLabels:I.record(yg).or(I.null()).optional(),rectangleLabels:I.record(Sg).or(I.null()).optional(),polygonLabels:I.record(wg).or(I.null()).optional()}).optional(),bg=I.object({segmentGroupSaveFormat:I.string().optional(),segmentGroupExtension:I.string().default("")}).optional(),_g=I.object({level:I.number(),width:I.number()}).optional(),Ig=I.object({layout:vg,dataBrowser:hg,labels:Cg,shortcuts:Ag,io:bg,windowing:_g}),kg=async e=>{const t=new TextDecoder,n=await e.arrayBuffer(),o=t.decode(new Uint8Array(n));return Ig.parse(JSON.parse(o))},Dg=e=>{if(!e.labels)return;const t=s=>{var r;return s===void 0?(r=e.labels)==null?void 0:r.defaultLabels:s},n=(s,r)=>{const l=t(r);l&&(s.clearDefaultLabels(),s.mergeLabels(l))},{rulerLabels:o,rectangleLabels:a,polygonLabels:i}=e.labels;n(Jt(),o),n(bn(),a),n(_n(),i)},Eg=e=>{var t;Dl().hideSampleData=!!((t=e.dataBrowser)!=null&&t.hideSampleData)},Rg=e=>{var t;if((t=e.layout)!=null&&t.activeLayout){const n=Ao[e.layout.activeLayout];Me().setLayout(n)}},Vg=e=>{e.shortcuts&&(gn.value={...gn.value,...e.shortcuts})},Tg=e=>{e.io&&(e.io.segmentGroupSaveFormat&&(et().saveFormat=e.io.segmentGroupSaveFormat),ho().segmentGroupExtension=e.io.segmentGroupExtension)},Pg=e=>{e.windowing&&(Fn().runtimeConfigWindowLevel=e.windowing)},Mg=e=>{Rg(e),Dg(e),Eg(e),Vg(e),Tg(e),Pg(e)},Og=async(e,{done:t})=>{const{fileSrc:n}=e;if((n==null?void 0:n.fileType)==="application/json")try{const o=await kg(n.file);return Object.keys(o).length===0?e:t({dataSource:e,config:o})}catch(o){throw new Error("Failed to parse config file",{cause:xa(o)})}return e};function Rl(e){const t=String(e);return!t||t==="[object Object]"?"Unknown error. More details in the dev console.":t}const Lg=()=>{throw new Error("Failed to handle resource")};function Vl(e){if(!e.ok||e.data.length===0)return!1;const t=e.data[0];return!(!Fo(t)||t.dataType==="model")}const Bg=async e=>{try{return e.flatMap(t=>t.ok?t.data:[]).filter(Om).map(({config:t})=>t).forEach(Mg),{ok:!0,data:[]}}catch(t){return{ok:!1,errors:[{message:Rl(t),cause:t,inputDataStackTrace:[]}]}}},$g=async e=>{const t={dicomSrc:{sources:e}};try{return e.length?{ok:!0,data:(await Se().importFiles(e)).map(o=>({dataID:o,dataType:"dicom",dataSource:t}))}:{ok:!0,data:[]}}catch(n){return{ok:!1,errors:[{message:Rl(n),cause:n,inputDataStackTrace:[t]}]}}};async function ds(e){const t={fetchFileCache:new Map,dicomDataSources:[]},n=[Wo,ug,eg,Km,Hm,Il,kl,Bm,Og,Lm,Zm,Lg],o=new No(n),a=await Promise.all(e.map(r=>o.execute(r,t))),i=await Bg(a),s=await $g(t.dicomDataSources);return[...a,s,i].filter(r=>!r.ok||Vl(r))}function vn(e){const{dataID:t}=e;return t}function Tl(e){if(!Vl(e))return null;const t=e.data[0];return vn(t)}const mi={CT:{priority:3},MR:{priority:3},US:{priority:2},DX:{priority:1}};function xg(e){const t=e.filter(({dataType:a})=>a==="dicom"),n=Se(),o=t.map(a=>{var r;const i=n.volumeInfo[a.dataID],s=i==null?void 0:i.Modality;if(s in mi)return{dicomSource:a,priority:(r=mi[s])==null?void 0:r.priority,volumeInfo:i}}).filter(Oo).sort(({priority:a,volumeInfo:i},{priority:s,volumeInfo:r})=>{const l=a-s;return l!==0?l:i.NumberOfSlices?r.NumberOfSlices?r.NumberOfSlices-i.NumberOfSlices:-1:1});if(o.length)return o[0].dicomSource}function Pl(e,t){return e?t.split(".").slice(1).includes(e):!1}function Ug(e,t){const n=e.filter(({dataType:o})=>o==="image").filter(o=>{const a=Bn(o.dataSource);return a?!Pl(t,a):!1});if(n.length)return n[0]}function ps(e){return e.flatMap(t=>t.data.filter(Fo))}function Ng(e,t,n){const o=Se(),a=e.dataType==="dicom"?o.volumeInfo[e.dataID].SeriesNumber:Bn(e.dataSource);if(!a)return[];const i=a.split(".").slice(0,1).join();return ps(t).filter(s=>s!==e).map(s=>({importResult:s,name:Bn(s.dataSource)})).filter(({name:s})=>{if(!s)return!1;const r=Pl(n,s),l=s.startsWith(i);return r&&l}).map(({importResult:s})=>s)}function gi(e){var o;const t=Se(),n=t.volumeStudy[e];return(o=t.studyInfo[n])==null?void 0:o.StudyInstanceUID}function Fg(e,t){const n=ps(e),o=xg(n);if(o)return o;const a=Ug(n,t);return a||n[0]}function Ml(e,t){const n=gi(e);return ps(t).filter(({dataType:a})=>a==="dicom").filter(a=>gi(a.dataID)===n&&a.dataID!==e)}function Wg(e,t){if(e.dataType!=="dicom")return;const n=Ml(e.dataID,t),o=Se();if(o.volumeInfo[e.dataID].Modality!=="CT")return;const i=n.find(c=>o.volumeInfo[c.dataID].Modality==="PT");if(!i)return;const s=vn(e),r=st(),l=vn(i);r.addLayer(s,l)}function Hg(e,t,n){const o=Ng(e,t,n).filter(_l),a=Se(),i=Ml(e.dataID,t).filter(r=>{const l=a.volumeInfo[r.dataID].Modality;return l?l.trim()==="SEG":!1}),s=et();[...i,...o].forEach(r=>{const l=vn(r);s.convertImageToLabelmap(l,vn(e))})}function Ol(e){return(o=>{const{startLoading:a,stopLoading:i}=ho();return async function(...r){try{a(),await o(...r)}finally{i()}}})(async()=>{const o=ho(),a=Oe();let i;try{i=await ds(e)}catch(l){o.setError(l);return}const[s,r]=Cl(i);if(!a.primarySelection&&s.length){const l=Fg(s,o.segmentGroupExtension);if(_l(l)){const c=vn(l);a.setPrimarySelection(c),Wg(l,s),Hg(l,s,o.segmentGroupExtension)}}if(r.length){const l=r.map(u=>{const[p]=u.errors,d=Bn(p.inputDataStackTrace[0]);return Vr(p.cause),`- ${d}: ${p.message}`}),c=new Error(`These files failed to load:
${l.join(`
`)}`);o.setError(c)}})()}function Gg(){return new Promise(e=>{const t=document.createElement("input");t.setAttribute("type","file"),t.setAttribute("multiple","multiple"),t.setAttribute("accept","*"),t.addEventListener("change",()=>{const n=[...t.files??[]];e(n)}),t.click()})}async function Ll(e){const t=e.map(Bo);return Ol(t)}async function Bl(){const e=await Gg();return Ll(e)}async function zg(e){const t=ma(e.urls),n=ma(e.names??[]),o=t.map((a,i)=>Ur(a,n[i]||nl(Ot(a,window.location.href).pathname)||a));return Ol(o)}const jg="session.volview.zip",Qg=F({props:{close:{type:Function,required:!0}},setup(e){const t=O(""),n=O(!0),o=O(!1);async function a(){if(t.value.trim().length>=0){o.value=!0;try{const s=await Al();Qi.saveAs(s,t.value),e.close()}finally{o.value=!1}}}dt(()=>{t.value=jg}),bo("Enter",()=>{a()});function i(s){return s.trim().length>0||"Required"}return{saving:o,saveSession:a,fileName:t,validFileName:i,valid:n}}}),qg=_("span",{"data-testid":"save-session-confirm-button"},"Save",-1);function Kg(e,t,n,o,a,i){return C(),B(Pe,null,{default:v(()=>[f(qt,{class:"d-flex flex-row align-center"},{default:v(()=>[P(" Saving Session State ")]),_:1}),f(ot,null,{default:v(()=>[f(sr,{modelValue:e.valid,"onUpdate:modelValue":t[1]||(t[1]=s=>e.valid=s),onSubmit:J(e.saveSession,["prevent"])},{default:v(()=>[f(qe,{modelValue:e.fileName,"onUpdate:modelValue":t[0]||(t[0]=s=>e.fileName=s),hint:"The filename to use for the session state file.",label:"Session State Filename",rules:[e.validFileName],required:"",id:"session-state-filename"},null,8,["modelValue","rules"])]),_:1},8,["modelValue","onSubmit"])]),_:1}),f(Do,null,{default:v(()=>[f(pt),f(te,{loading:e.saving,color:"secondary",onClick:e.saveSession,disabled:!e.valid},{default:v(()=>[f(K,{class:"mr-2"},{default:v(()=>[P("mdi-content-save-all")]),_:1}),qg]),_:1},8,["loading","onClick","disabled"])]),_:1})]),_:1})}const Zg=z(Qg,[["render",Kg]]),Yg={name:"ControlButton",props:{icon:{type:String,required:!0},name:{type:String,required:!0},size:{type:[Number,String],default:40},buttonClass:[String,Array,Object],tooltipLocation:{type:String,default:"right"}},computed:{sizeV(){return Number(this.size)},iconSize(){return Math.floor(.6*this.sizeV)},classV(){const e=this.buttonClass;return typeof e=="string"?e:Array.isArray(e)?e.join(" "):e&&Object.keys(e).length?Object.keys(this.buttonClass).filter(t=>this.buttonClass[t]).join(" "):""}}};function Jg(e,t,n,o,a,i){return C(),B(te,ze({variant:"text",rounded:0,dark:"",height:i.sizeV,width:i.sizeV,"min-width":i.sizeV,"max-width":i.sizeV,class:i.classV},e.$attrs),{default:v(()=>[f(K,{size:i.iconSize},{default:v(()=>[P(H(n.icon),1)]),_:1},8,["size"]),f(fe,{location:n.tooltipLocation,activator:"parent",transition:"slide-x-transition"},{default:v(()=>[_("span",null,H(n.name),1)]),_:1},8,["location"]),se(e.$slots,"default")]),_:3},16,["height","width","min-width","max-width","class"])}const ct=z(Yg,[["render",Jg]]),Xg=F({props:{message:String,detailsButton:Boolean}});const e2={key:0,class:"button"};function t2(e,t,n,o,a,i){return C(),L("div",null,[_("span",null,H(e.message),1),P("   "),e.detailsButton?(C(),L("button",e2,"details")):G("",!0)])}const n2=z(Xg,[["render",t2],["__scopeId","data-v-fb318769"]]),o2=5e3,a2=F({setup(e,{emit:t}){const n=Ze(),{byID:o}=ye(n),a={},i=Tr(),s=r=>({timeout:o.value[r].options.persist?!1:o2,closeOnClick:!o.value[r].options.persist,onClick:()=>t("open-notifications"),onClose:()=>{delete a[r]}});return X(o,r=>{Object.keys(a).forEach(l=>{l in r||(i.dismiss(a[l]),delete a[l])})}),n.$onAction(({name:r,args:l,after:c})=>{if(r==="_addMessage"){const u=l[0];c(p=>{if(!p)return;let d=i.info,m=!1;u.type===He.Error?(d=i.error,m=!0):u.type===He.Warning?(d=i.warning,m=!0):u.type===He.Info?d=i.info:u.type===He.Success&&(d=i.success),a[p]=d({component:n2,props:{message:u.title,detailsButton:m}},s(p))})}}),()=>null}}),gt=ce("dicom-meta",{state:()=>({patientInfo:{},patientStudies:{},studyInfo:{},studyVolumes:{},volumeInfo:{},volumeInstances:{},instanceInfo:{},instanceVolume:{},volumeStudy:{},studyPatient:{},needsRebuild:{}}),actions:{async importMeta(e){const t={PatientID:e.PatientID||jr,PatientName:e.PatientName||zr,PatientBirthDate:e.PatientBirthDate||"",PatientSex:e.PatientSex||""},n=Vn(e,"StudyID","StudyInstanceUID","StudyDate","StudyTime","AccessionNumber","StudyDescription"),o={...Vn(e,"Modality","SeriesInstanceUID","SeriesNumber","SeriesDescription","WindowLevel","WindowWidth"),NumberOfSlices:0,VolumeID:e.SeriesInstanceUID},a={...Vn(e,"SopInstanceUID","InstanceNumber"),Rows:Number.parseInt(e.Rows,10),Columns:Number.parseInt(e.Columns,10)};this._updateDatabase(t,n,o,a)},deleteVolume(e){if(e in this.volumeInfo){const t=this.volumeStudy[e];delete this.volumeInfo[e],delete this.volumeStudy[e],ft(this.studyVolumes[t],e),this.studyVolumes[t].length===0&&this.deleteStudy(t)}},deleteStudy(e){if(e in this.studyInfo){const t=this.studyPatient[e];delete this.studyInfo[e],delete this.studyPatient[e],delete this.studyVolumes[e],ft(this.patientStudies[t],e),this.patientStudies[t].length===0&&this.deletePatient(t)}},deletePatient(e){e in this.patientInfo&&(delete this.patientInfo[e],[...this.patientStudies[e]].forEach(t=>this.deleteStudy(t)),delete this.patientStudies[e])},_updateDatabase(e,t,n,o){const a=e.PatientID;a&&!(a in this.patientInfo)&&(this.patientInfo[a]=e,this.patientStudies[a]=[]);const i=t.StudyInstanceUID;i&&!(i in this.studyInfo)&&(this.studyInfo[i]=t,this.studyVolumes[i]=[],this.studyPatient[i]=a,this.patientStudies[a].push(i));const s=n.VolumeID;s&&!(s in this.volumeInfo)&&(this.volumeInfo[s]=n,this.volumeInstances[s]=[],this.volumeStudy[s]=i,this.studyVolumes[i].push(s));const r=o.SopInstanceUID;r&&!(r in this.instanceInfo)&&(this.instanceInfo[r]=o,this.instanceVolume[r]=s,this.volumeInstances[s].push(r),this.volumeInfo[s].NumberOfSlices+=1),Object.entries(this.patientStudies).forEach(([l,c])=>{c.length===0&&this.deletePatient(l)})}}}),s2={PatientID:"00100020",PatientName:"00100010",PatientBirthDate:"00100030",PatientSex:"00100040",StudyID:"00200010",StudyInstanceUID:"0020000D",StudyName:"00100010",StudyDate:"00080020",StudyTime:"00080030",AccessionNumber:"00080050",StudyDescription:"00081030",SeriesInstanceUID:"0020000E",SeriesNumber:"00200011",SeriesDescription:"0008103E",Modality:"00080060",WindowLevel:"00281050",WindowWidth:"00281051",SopInstanceUID:"00080018",InstanceNumber:"00200013",Rows:"00280010",Columns:"00280011"};function i2(e){var o;const t=(o=e==null?void 0:e.Value)==null?void 0:o[0],n=t==null?void 0:t.Alphabetic;return n||t}function fs(e){const t=Object.entries(s2).reduce((n,[o,a])=>({...n,[o]:i2(e[a])}),{});return qd(t)}let vi=0;function r2(e){return vi++,new File([new Blob([e])],`dicom-web.${vi}.dcm`)}function Hn(e){const t=Object.fromEntries(ss.entries());return new tu.DICOMwebClient({url:e,headers:t})}async function l2(e){return(await Hn(e).searchForStudies()).map(fs)}async function $l(e,t){return(await Hn(e).searchForSeries(t)).map(fs)}async function xl(e,t){return(await Hn(e).retrieveSeriesMetadata(t)).map(fs)}async function c2(e,t,n){return(await Hn(e).retrieveSeries({...t,progressCallback:n})).map(r2)}async function u2(e,t){const o=await Hn(e).retrieveInstanceRendered({...t,mediaTypes:[{mediaType:"image/jpeg"}]}),a=new Uint8Array(o),i=new Blob([a],{type:"image/jpeg"});return URL.createObjectURL(i)}const d2=["series","studies"];function p2(e){const t=e.replace(/\/$/,"");let n=t.split("/");const o=d2.reduce((r,l)=>{const[c,u]=n.slice(-2);return c===l?(n=n.slice(0,-2),{[l]:u,...r}):r},{}),a=Object.keys(o).length*2,i=t.split("/");return{host:i.slice(0,i.length-a).join("/"),...o}}const f2="dicomweb",Ul=e=>!e||["Pending","Done"].every(t=>t!==e.state),m2={host:l2,studies:$l,series:xl},g2={studies:"studyInstanceUID",series:"seriesInstanceUID"},v2={studies:"StudyInstanceUID",series:"SeriesInstanceUID"},Gn=ce("dicom-web",()=>{const{VITE_DICOM_WEB_NAME:e,VITE_DICOM_WEB_URL:t}={BASE_URL:"./",MODE:"production",DEV:!1,PROD:!0,SSR:!1},n=e?O(e):lo("dicomWebHostName",""),i=Oa.extractURLParameters()[f2]??t,s=lo("dicomWebHost",""),r=O(i??s.value);X(s,()=>{r.value=s.value});const l=w(()=>p2(r.value??"")),c=w(()=>l.value.host),u=w(()=>!!c.value),p=async M=>{const x=gt(),V=x.volumeInfo[M],T=Math.floor(V.NumberOfSlices/2),U=x.volumeInstances[M].map(N=>x.instanceInfo[N]).sort(({InstanceNumber:N},{InstanceNumber:j})=>Number(N)-Number(j))[T],Q=x.volumeStudy[M],ee={studyInstanceUID:x.studyInfo[Q].StudyInstanceUID,seriesInstanceUID:V.SeriesInstanceUID,sopInstanceUID:U.SopInstanceUID};return u2(c.value,ee)},d=async M=>{const x=gt();(await Promise.all(x.patientStudies[M].map(T=>x.studyInfo[T]).map(async T=>(await $l(c.value,{studyInstanceUID:T.StudyInstanceUID})).map(Q=>({...T,...Q}))))).flat().forEach(T=>x.importMeta(T))},m=async M=>{const x=gt();(await Promise.all(M.map(async T=>{const U=x.volumeInfo[T],Q=x.studyInfo[x.volumeStudy[T]];return(await xl(c.value,{studyInstanceUID:Q.StudyInstanceUID,seriesInstanceUID:U.SeriesInstanceUID})).map(ee=>({...Q,...U,...ee}))}))).flat().forEach(T=>x.importMeta(T))},g=O({}),A=async M=>{const x=Oe(),V=gt();if(!Ul(g.value[M]))return;g.value[M]={...g.value[M],state:"Pending",loaded:0,total:0};const{SeriesInstanceUID:T}=V.volumeInfo[M],U=V.volumeStudy[M],{StudyInstanceUID:Q}=V.studyInfo[U],Z={studyInstanceUID:Q,seriesInstanceUID:T},ee=({loaded:N,total:j})=>{g.value[M]={...g.value[M],loaded:N,total:j}};try{const N=await c2(c.value,Z,ee);if(!N)throw new Error("Could not fetch series");const[j]=await ds(N.map(Bo));if(!j)throw new Error("Did not receive a load result");if(!j.ok)throw j.errors[0].cause;const Y=Tl(j);x.setPrimarySelection(Y),g.value[M]={...g.value[M],state:"Done"}}catch(N){console.error(N),Ze().addError("Failed to load DICOM",N),g.value[M]={...g.value[M],state:"Error",loaded:0}}},y=O("Idle"),h=O(void 0),S=O(!1),E=async()=>{y.value="Pending",h.value=void 0,S.value=!1;const M=gt();if(M.$reset(),!c.value)return;const x=Object.keys(l.value).pop();S.value=x==="studies"||x==="series";const V=m2[x],T=Qd(l.value,"host"),U=zs(T,g2);try{const Q=await V(c.value,U),Z=zs(T,v2);Q.map(N=>({...Z,...N})).forEach(N=>M.importMeta(N))}catch(Q){h.value=Q,console.error(Q)}if(x==="series"){const Q=Object.values(l.value).pop();A(Q)}y.value="Done"},k=w(()=>{if(h.value)return`Error fetching DICOMWeb data: ${h.value}`;const M=gt();return y.value==="Done"&&Object.values(M.patientInfo).length===0?"Found zero dicoms.":""});let R="";const D=()=>{(R!==r.value||k.value)&&(R=r.value,E())};return Se().$onAction(({name:M,args:x,after:V})=>{M==="deleteVolume"&&V(()=>{const[T]=x,U=Object.keys(g.value).find(Q=>T.startsWith(Q));U&&(g.value[U]={...g.value[U],state:"Remote",loaded:0})})}),{host:r,savedHost:s,isConfigured:u,hostName:n,message:k,volumes:g,linkedToStudyOrSeries:S,fetchDicomsOnce:D,fetchPatientMeta:d,fetchVolumesMeta:m,fetchVolumeThumbnail:p,downloadVolume:A}}),h2=F({setup(){const e=Gn();return Xe(()=>{e.fetchDicomsOnce()}),{dicomWeb:e}}}),A2=_("h3",{class:"mb-4"},"DICOMWeb",-1);function y2(e,t,n,o,a,i){return C(),L("div",null,[A2,f(qe,{modelValue:e.dicomWeb.hostName,"onUpdate:modelValue":t[0]||(t[0]=s=>e.dicomWeb.hostName=s),class:"server-param",label:"Host Display Name",clearable:""},null,8,["modelValue"]),f(qe,{modelValue:e.dicomWeb.savedHost,"onUpdate:modelValue":t[1]||(t[1]=s=>e.dicomWeb.savedHost=s),class:"server-param",label:"Host Address",clearable:""},null,8,["modelValue"])])}const w2=z(h2,[["render",y2]]),S2=new Set(Kd);function C2(e){return S2.has(e)}function b2(e){var t;return(t=e==null?void 0:e.isA)==null?void 0:t.call(e,"vtkImageData")}function Nl(e){const{arrays:t}=e.pointData;return t.forEach(n=>{const{data:o}=n;C2(o.dataType)&&(o.values=new globalThis[o.dataType](o.values))}),e}function _2(e){if(!b2(e))return e;const t=e.toJSON();return Nl(t)}function I2(e){if((e==null?void 0:e.vtkClass)!=="vtkImageData")return e;try{return dr(Nl(e))}catch{return e}}const hi=[_2],Ai=[I2];function Pn(e,t){const n=t(e);return!n||typeof n!="object"?n:Array.isArray(n)?n.map(o=>Pn(o,t)):Object.entries(n).reduce((o,[a,i])=>({...o,[a]:i}),{})}function aa(e,t){return e.map(n=>Pn(n,t))}const Dn=1*1024*1024,ms="C";function k2(e){return e instanceof ArrayBuffer||ArrayBuffer.isView(e)||e instanceof Blob||e instanceof File}function D2(e){if(Number.isInteger(e==null?void 0:e.byteLength))return e.byteLength;if(Number.isInteger(e==null?void 0:e.length))return e.length;throw new Error("Cannot get obj length")}function E2(e){return e.every(t=>typeof t=="string")}function R2(e){return e.every(t=>t instanceof ArrayBuffer)}class V2 extends nu{encode(t){const n=super.encode(t);if(n.every(i=>D2(i)<=Dn))return n;const o=[],a=[];for(let i=0;i<n.length;i++){const s=n[i],r=this.chunkMessage(s);a.push(r.length),o.push(...r)}return[`${ms}${JSON.stringify(a)}`,...o]}chunkMessage(t){if(typeof t=="string")return this.chunkString(t);if(k2(t))return this.chunkBinary(t);throw new TypeError("Cannot handle invalid message type")}chunkString(t){const n=[];let o=0;for(;o<t.length;){const a=Math.min(o+Dn,t.length);n.push(t.substring(o,a)),o=a}return n}chunkBinary(t){if(ArrayBuffer.isView(t)||t instanceof ArrayBuffer){const a=t instanceof ArrayBuffer?new Uint8Array(t):t,i=[],{buffer:s}=a,r=a.byteOffset+a.byteLength;let l=a.byteOffset;for(;l<r;){const c=Math.min(l+Dn,r);i.push(new Uint8Array(s,l,c-l)),l=c}return i}const n=[];let o=0;for(;o<t.size;){const a=Math.min(o+Dn,t.size);n.push(t.slice(o,a)),o+=a}return n}}class T2 extends ou{constructor(){super(...arguments),this.chunks=[]}add(t){var n;if((n=this.chunkingInfo)!=null&&n.length)this.chunks.push(t),this.chunks.length===this.chunkingInfo[0]&&(super.add(this.reconstructChunks(this.chunks)),this.chunks.length=0,this.chunkingInfo.shift()),this.chunkingInfo.length===0&&(this.chunkingInfo=null);else if(typeof t=="string"&&t.charAt(0)===ms){if(t.charAt(1)!=="[")throw new Error("Failed to parse start of chunking info.");this.chunkingInfo=this.parseChunkingInfo(t.substring(1)),this.chunks=[]}else super.add(t)}parseChunkingInfo(t){try{const n=JSON.parse(t);if(!Array.isArray(n))throw new TypeError("Chunking info is not an array");if(!n.every(o=>Number.isInteger(o)))throw new TypeError("Chunking info is invalid");return n}catch(n){throw new Error("Failed to parse chunking info",{cause:xa(n)})}}reconstructChunks(t){if(!t.length)throw new Error("Cannot reconstruct an empty chunk");if(E2(t))return this.reconstructString(t);if(R2(t))return this.reconstructBinary(t);throw new TypeError("Received a set of unknown chunks")}reconstructString(t){return t.join("")}reconstructBinary(t){const n=t.reduce((i,s)=>i+s.byteLength,0),o=new Uint8Array(n);let a=0;return t.forEach(i=>{o.set(new Uint8Array(i),a),a+=i.byteLength}),o.buffer}}const P2=V2,M2=T2,O2=Object.freeze(Object.defineProperty({__proto__:null,CHUNKED_PACKET_TYPE:ms,CHUNK_SIZE:Dn,Decoder:M2,Encoder:P2},Symbol.toStringTag,{value:"Module"})),L2=24,yi=24,wi="rpc:call",Si="rpc:result",B2="stream:call",$2="stream:result",Fl=I.object({rpcId:I.string(),ok:I.literal(!0),data:I.unknown()});function x2(e){return{rpcId:"",ok:!0,data:e}}const Wl=I.object({rpcId:I.string(),ok:I.literal(!1),error:I.string()});function Ci(e){return{rpcId:"",ok:!1,error:e}}const U2=I.union([Fl,Wl]);function N2(e){return U2.safeParse(e).success}const F2=Fl.extend({done:I.boolean()}),W2=I.union([F2,Wl]);function H2(e){return W2.safeParse(e).success}const G2=I.object({rpcId:I.string(),name:I.string(),args:I.array(I.unknown()).optional()});function z2(e){return G2.safeParse(e).success}function j2(e){const t=Ot(e);return t.pathname="",String(t)}function Q2(e){const t=new URL(e);return t.pathname.replace(/^\/+$/,"").length===0?"/socket.io/":t.pathname}class q2{constructor(t,n){this.serializers=hi,this.deserializers=Ai,this.serialize=ci(...this.serializers),this.deserialize=ci(...this.deserializers),this.onRpcResultEvent=o=>{if(!N2(o))return;const a=this.pendingRpcs.get(o.rpcId);if(!a){Qs.warn("Received unknown RPC ID:",o.rpcId);return}this.pendingRpcs.delete(o.rpcId),o.ok?a.resolve(Pn(o.data,this.deserialize)):a.reject(new Error(o.error))},this.onStreamResultEvent=o=>{if(!H2(o))throw new Error("Failed to validate RPC stream result");const a=this.pendingRpcs.get(o.rpcId),i=this.activeStreams.get(o.rpcId);if(!a||!i){Qs.warn("Received unknown RPC ID:",o.rpcId);return}const s=()=>{this.pendingRpcs.delete(o.rpcId),this.activeStreams.delete(o.rpcId)};o.ok?o.done?(s(),a.resolve()):i(Pn(o.data,this.deserialize)):(s(),a.reject(new Error(o.error)))},this.onRpcCallEvent=async o=>{if(!z2(o))return;const{rpcId:a,name:i,args:s}=o,r=await this.tryRpcCall(i,s??[]);r.rpcId=a,this.socket.emit(Si,r)},this.clientId=`cid_${Jo(L2)}`,this.api=t,this.serializers=(n==null?void 0:n.serializers)??hi,this.deserializers=(n==null?void 0:n.deserializers)??Ai,this.waiting=new Map,this.pendingRpcs=new Map,this.activeStreams=new Map,this.socket=au("",{query:{clientId:this.clientId},autoConnect:!1,parser:O2}),this.socket.on(wi,this.onRpcCallEvent),this.socket.on(Si,this.onRpcResultEvent),this.socket.on($2,this.onStreamResultEvent)}async connect(t){await this.disconnect(),this.socket.io.uri=j2(t),this.socket.io.opts.path=Q2(t);let n=this.waiting.get("connect");return n||(n=this.connectHelper(),this.waiting.set("connect",n),n.finally(()=>{this.waiting.delete("connect")})),n}connectHelper(){let t,n;const o=()=>{this.socket.off("connect",t),this.socket.off("connect_error",n)},a=new Promise((i,s)=>{t=i,n=s,this.socket.once("connect",t),this.socket.once("connect_error",n),this.socket.connect()});return a.finally(o),a}async disconnect(){if(!this.socket.connected)return Promise.resolve();let t=this.waiting.get("disconnect");return t||(t=new Promise(n=>{this.socket.once("disconnect",n),this.socket.disconnect()}),this.waiting.set("disconnect",t),t.finally(()=>{this.waiting.delete("disconnect")})),t}async call(t,n){if(!this.socket.connected)throw new Error("Not connected to server");const o=`rpcid_${Jo(yi)}`,a=vo();return this.pendingRpcs.set(o,a),this.sendRpcCall(wi,{rpcId:o,name:t,args:aa(n??[],this.serialize)}),a.promise}async stream(t,n,o){if(!this.socket.connected)throw new Error("Not connected to server");const a=Array.isArray(n)?n:[],i=Array.isArray(n)?o:n,s=`rpcid_${Jo(yi)}`,r=vo();return this.pendingRpcs.set(s,r),this.activeStreams.set(s,i),this.sendRpcCall(B2,{rpcId:s,name:t,args:aa(a??[],this.serialize)}),r.promise}sendRpcCall(t,n){this.socket.emit(t,n)}async tryRpcCall(t,n){if(!(t in this.api))return Ci(`${t} is not a registered client RPC endpoint`);try{const o=aa(n,this.deserialize),a=await this.api[t](...o);return x2(Pn(a,this.serialize))}catch(o){return Ci(String(o))}}}const Hl=new Map;function K2(e){return Hl.get(e)}function Z2(e){const{store:t}=e;Hl.set(t.$id,t)}const Y2=e=>e==="server",J2=(e,t)=>t.includes("_p"),X2=[Y2,J2];function Gl(e,t){if(X2.some(a=>a(e,t)))throw new Error("Cannot access the requested store and property");const n=K2(e);if(!n)throw new Error(`${e} does not exist or is not initialized`);let o=n;for(;t.length;){const a=t.shift();o=o[a]}return o}async function e0(e,t,n){return Gl(e,t)(...n)}const t0={getStoreProperty:Gl,callStoreMethod:e0},{VITE_REMOTE_SERVER_URL:n0}={BASE_URL:"./",MODE:"production",DEV:!1,PROD:!0,SSR:!1};var je=(e=>(e[e.Disconnected=0]="Disconnected",e[e.Pending=1]="Pending",e[e.Connected=2]="Connected",e))(je||{});const zn=ce("server",()=>{const e=O(n0??""),t=O(0),n=new q2(t0);n.socket.on("disconnect",()=>{t.value=0});async function o(){if(e.value){t.value=1;try{await n.connect(e.value),t.value=2}catch{t.value=0}}}async function a(){await n.disconnect()}function i(s){e.value=s,a()}return{url:e,client:Ta(n),connState:t,connect:o,disconnect:a,setUrl:i}}),o0={class:"ma-2"},a0=_("span",null,"Remote Server",-1),s0={class:"mt-4"},i0={class:"mt-4"},r0={class:"ml-5"},l0=F({__name:"ServerSettings",setup(e){const t=zn(),{connState:n}=ye(t),o=w({get(){return t.url},set(l){t.setUrl(l)}}),a={[je.Connected]:"Connected",[je.Disconnected]:"Disconnected",[je.Pending]:"Connecting..."},i=w(()=>a[n.value]);function s(){n.value===je.Connected?t.disconnect():n.value===je.Disconnected&&t.connect()}const r=w(()=>n.value===je.Connected?"Disconnect":"Connect");return(l,c)=>(C(),L("div",o0,[_("h3",null,[a0,f(te,{icon:"mdi-help-circle",variant:"flat",size:"x-small",href:"https://kitware.github.io/VolView/doc/server.html",target:"_blank",class:"ml-1",style:{color:"#777"},title:"Server Documentation"})]),_("div",s0,[f(qe,{modelValue:o.value,"onUpdate:modelValue":c[0]||(c[0]=u=>o.value=u),label:"Server URL",clearable:"","persistent-hint":"",hint:"Make sure you trust the remote server!"},null,8,["modelValue"])]),_("div",i0,[f(te,{color:"secondary",onClick:s,loading:b(n)===b(je).Pending},{default:v(()=>[P(H(r.value),1)]),_:1},8,["loading"]),_("span",r0,"Status: "+H(i.value),1)])]))}});function c0(){return typeof OffscreenCanvas>"u"?null:new OffscreenCanvas(1,1).getContext("webgl2")}function u0(){return typeof document>"u"?null:document.createElement("canvas").getContext("webgl2")}function d0(){const e=c0()??u0();if(!e)throw new Error("Cannot get a webgl2 context");const t={renderer:"",vendor:""},n=e.getExtension("WEBGL_debug_renderer_info");return n?(t.renderer=e.getParameter(n.UNMASKED_RENDERER_WEBGL),t.vendor=e.getParameter(n.UNMASKED_VENDOR_WEBGL)):(t.renderer=e.getParameter(e.RENDERER),t.vendor=e.getParameter(e.VENDOR)),t}const{VITE_SENTRY_DSN:zl}={BASE_URL:"./",MODE:"production",DEV:!1,PROD:!0,SSR:!1},jl="error-reporting-off",gs=!!zl,p0=e=>{localStorage.getItem(jl)!=="true"&&gs&&su({app:e,dsn:zl});try{iu("gpu",d0())}catch(n){qi(n)}},f0=e=>{var n;const t=(n=ru().getClient())==null?void 0:n.getOptions();t&&(t.enabled=e)},Ql=ce("error-reporting",()=>{const e=lo(jl,"false"),t=O(e.value==="true");return X(t,()=>{e.value=String(t.value),f0(!t.value)}),{disableReporting:t}}),m0=F({setup(){const e=Vu(),t=lo(Tu,e.global.name.value),n=O(e.global.name.value===Us);X(n,l=>{e.global.name.value=l?Us:Pu,t.value=e.global.name.value});const o=Ql(),a=O(!o.disableReporting);X(a,l=>{o.disableReporting=!l});const{disableCameraAutoReset:i}=ye(Yt()),s=Uo();return{dark:n,reportingEnabled:a,errorReportingConfigured:gs,openKeyboardShortcuts:()=>{s.settingsOpen=!0},disableCameraAutoReset:i}},components:{DicomWebSettings:w2,ServerSettings:l0}});function g0(e,t,n,o,a,i){const s=q("dicom-web-settings"),r=q("server-settings");return C(),B(Pe,null,{default:v(()=>[f(qt,{class:"d-flex flex-row align-center"},{default:v(()=>[P("Settings")]),_:1}),f(ot,null,{default:v(()=>[f(te,{class:"my-2",onClick:e.openKeyboardShortcuts,"prepend-icon":"mdi-keyboard",color:"secondary"},{default:v(()=>[P(" Keyboard Shortcuts and View Controls ")]),_:1},8,["onClick"]),f(sn,{label:`Dark Theme (${e.dark?"On":"Off"})`,modelValue:e.dark,"onUpdate:modelValue":t[0]||(t[0]=l=>e.dark=l),color:"secondary",density:"compact","hide-details":""},null,8,["label","modelValue"]),f(sn,{label:`Camera Auto Reset (${e.disableCameraAutoReset?"On":"Off"})`,modelValue:e.disableCameraAutoReset,"onUpdate:modelValue":t[1]||(t[1]=l=>e.disableCameraAutoReset=l),color:"secondary",density:"compact","hide-details":""},null,8,["label","modelValue"]),e.errorReportingConfigured?(C(),B(sn,{key:0,label:`Error Reporting (${e.reportingEnabled?"On":"Off"})`,modelValue:e.reportingEnabled,"onUpdate:modelValue":t[2]||(t[2]=l=>e.reportingEnabled=l),color:"secondary",density:"compact","hide-details":""},null,8,["label","modelValue"])):G("",!0),f(Re,{class:"mt-2 mb-6"}),f(s),f(Re,{class:"mt-2 mb-6"}),f(r)]),_:1})]),_:1})}const v0=z(m0,[["render",g0]]),ql=Symbol("ItemGroup"),Go=F({props:{modelValue:null,mandatory:Boolean,equalsTest:Function},setup(e,{emit:t,slots:n}){const{modelValue:o,mandatory:a,equalsTest:i}=ae(e),s=O();return X(o,c=>{c!==s.value&&(s.value=c)}),dt(()=>{s.value=o.value}),Pa(ql,{selectItem:c=>{a.value&&!c||(s.value=c,t("update:modelValue",s.value))},isSelected:c=>s.value==null?!1:i.value?i.value(c,s.value):c===s.value}),()=>{var c;return(c=n.default)==null?void 0:c.call(n)}}}),zo=F({props:{value:{type:null,required:!0}},setup(e,{slots:t}){const{value:n}=ae(e),o=ge(ql);if(!o)throw new Error("GroupableItem needs ItemGroup!");const a=()=>{o.selectItem(n.value)},i=()=>{o&&o.selectItem(o.isSelected(n.value)?void 0:n.value)};return()=>{var s;return(s=t.default)==null?void 0:s.call(t,{active:o.isSelected(n.value),select:a,toggle:i})}}}),h0=F({name:"MenuControlButton",props:{icon:{type:String,required:!0},name:{type:String,required:!0},size:{type:[Number,String],default:40},active:Boolean,disabled:Boolean,mobileOnlyMenu:Boolean},components:{ControlButton:ct},setup(e){const t=xn(),n=w(()=>!t.mobile.value),o=O(!1),a=w(()=>!e.mobileOnlyMenu||t.mobile.value);X(o,s=>{o.value=s&&a.value});const i=w(()=>e.active);return X(i,s=>{s||(o.value=!1)}),{showLeft:n,menuOn:o,enableMenu:a}}});const A0={class:"menu-content elevation-24"};function y0(e,t,n,o,a,i){const s=q("control-button");return C(),B(Mt,{"no-click-animation":"","close-on-content-click":!1,modelValue:e.menuOn,"onUpdate:modelValue":t[1]||(t[1]=r=>e.menuOn=r),location:e.showLeft?"left":"right",class:"overflow-auto"},{activator:v(({props:r})=>[f(s,ze({icon:e.icon,name:e.name,buttonClass:["tool-btn",e.active?"tool-btn-selected":""],disabled:e.disabled,size:e.size,onClick:t[0]||(t[0]=l=>e.$emit("click"))},r),{default:v(()=>[e.active&&e.enableMenu?(C(),B(K,{key:0,class:be([e.showLeft?"menu-more-left":"menu-more-right"]),size:"18"},{default:v(()=>[P(H(e.showLeft?"mdi-menu-left":"mdi-menu-right"),1)]),_:1},8,["class"])):G("",!0)]),_:2},1040,["icon","name","buttonClass","disabled","size"])]),default:v(()=>[_("div",A0,[se(e.$slots,"default",{},void 0,!0)])]),_:3},8,["modelValue","location"])}const w0=z(h0,[["render",y0],["__scopeId","data-v-a4658b95"]]),S0=F({components:{ControlButton:ct},setup(){const{currentImageID:e}=me(),t=Sn();return{resetCrop:()=>{const o=e.value;o&&t.resetCropping(o)}}}});function C0(e,t,n,o,a,i){const s=q("control-button");return C(),B(Pe,{dark:""},{default:v(()=>[f(s,{size:"40",icon:"mdi-restore",name:"Reset Crop",onClick:e.resetCrop},null,8,["onClick"])]),_:1})}const b0=z(S0,[["render",C0]]),Kl=lu();function In(){return{onClick:Kl.on}}const _0=F({components:{ControlButton:ct},methods:{onClick(){Kl.trigger()}}});function I0(e,t,n,o,a,i){const s=q("control-button");return C(),B(s,{size:"40",icon:"mdi-camera-flip-outline",name:"Reset Views",onClick:e.onClick},null,8,["onClick"])}const k0=z(_0,[["render",I0]]),D0=F({__name:"EditableChipList",props:{items:{},itemKey:{},itemTitle:{},createLabelText:{default:"Create Label"},modelValue:{}},emits:["select","edit","create","update:model-value"],setup(e){const t=e,n=w(()=>t.items.map(o=>({key:o[t.itemKey],title:o[t.itemTitle]})));return(o,a)=>(C(),B(ir,{"model-value":o.modelValue,"onUpdate:modelValue":a[1]||(a[1]=i=>o.$emit("update:model-value",i)),"selected-class":"selected",mandatory:""},{default:v(()=>[f(pe,{dense:""},{default:v(()=>[(C(!0),L(ne,null,de(n.value,({key:i,title:s},r)=>(C(),B(ue,{cols:"6",key:i},{default:v(()=>[f(da,{value:i},{default:v(({selectedClass:l,toggle:c})=>[f(Ns,{variant:"tonal",class:be(["w-100 d-flex",l]),onClick:c},{default:v(()=>[se(o.$slots,"item-prepend",{key:i,item:o.items[r]},void 0,!0),f(fe,{text:s,location:"end"},{activator:v(({props:u})=>[_("span",ze(u,{class:"text-truncate"}),H(s),17)]),_:2},1032,["text"]),f(pt),se(o.$slots,"item-append",{key:i,item:o.items[r]},void 0,!0)]),_:2},1032,["class","onClick"])]),_:2},1032,["value"])]),_:2},1024))),128)),f(ue,{cols:"6"},{default:v(()=>[f(Ns,{variant:"outlined",class:"w-100",onClick:a[0]||(a[0]=i=>o.$emit("create"))},{default:v(()=>[f(K,{class:"mr-2"},{default:v(()=>[P("mdi-plus")]),_:1}),P(" "+H(o.createLabelText),1)]),_:1})]),_:1})]),_:3})]),_:3},8,["model-value"]))}});const Zl=z(D0,[["__scopeId","data-v-07743f98"]]),E0={class:"d-flex flex-row"},R0={class:"flex-grow-1 d-flex flex-column justify-space-between mr-4"},Yl=F({__name:"LabelEditor",props:{color:{},valid:{type:Boolean}},emits:["done","cancel","delete","update:color"],setup(e,{emit:t}){const n=e,{color:o,valid:a}=ae(n),i=w(()=>!a.value),s=()=>{t("done")},r=()=>{t("cancel")},l=()=>{t("delete"),t("done")};return(c,u)=>(C(),B(Pe,null,{default:v(()=>[se(c.$slots,"title"),f(Mu,null,{default:v(()=>[_("div",E0,[_("div",R0,[se(c.$slots,"fields",{done:s}),f(Do,{class:"mb-2 px-0"},{default:v(()=>[f(te,{color:"error",variant:"elevated",onClick:l},{default:v(()=>[P(" Delete ")]),_:1}),f(pt),f(te,{color:"cancel",variant:"tonal",onClick:r},{default:v(()=>[P(" Cancel ")]),_:1}),f(te,{color:"secondary",variant:"elevated",onClick:s,disabled:i.value,"data-testid":"edit-label-done-button"},{default:v(()=>[P(" Done ")]),_:1},8,["disabled"])]),_:1})]),f(Ou,{"model-value":b(o),"onUpdate:modelValue":u[0]||(u[0]=p=>c.$emit("update:color",p)),mode:"rgb",label:"Color"},null,8,["model-value"])])]),_:3})]),_:3}))}}),V0=F({__name:"ToolLabelEditor",props:{name:{},strokeWidth:{},color:{},invalidNames:{}},emits:["done","cancel","delete","update:name","update:strokeWidth","update:color"],setup(e){const t=e;function n(i){return!t.invalidNames.has(i.trim())}function o(i){return n(i)||"Name is not unique"}const a=w(()=>n(t.name));return(i,s)=>(C(),B(Yl,{color:i.color,valid:a.value,"onUpdate:color":s[2]||(s[2]=r=>i.$emit("update:color",r)),onCancel:s[3]||(s[3]=r=>i.$emit("cancel")),onDone:s[4]||(s[4]=r=>i.$emit("done")),onDelete:s[5]||(s[5]=r=>i.$emit("delete"))},{title:v(()=>[f(qt,{class:"d-flex flex-row align-center"},{default:v(()=>[P(" Edit Label ")]),_:1})]),fields:v(({done:r})=>[f(qe,{label:"Name",class:"flex-grow-0","model-value":t.name,"onUpdate:modelValue":s[0]||(s[0]=l=>i.$emit("update:name",l)),onKeydown:co(J(r,["stop"]),["enter"]),rules:[o]},null,8,["model-value","onKeydown","rules"]),f(qe,{label:"Stroke Width",type:"number",class:"flex-grow-0 label-stroke-width-input","model-value":i.strokeWidth,"onUpdate:modelValue":s[1]||(s[1]=l=>i.$emit("update:strokeWidth",+l)),onKeydown:co(J(r,["stop"]),["enter"])},null,8,["model-value","onKeydown"])]),_:1},8,["color","valid"]))}}),T0={class:"dot-container mr-3"},P0=F({__name:"LabelControls",props:{labelsStore:{}},setup(e){const t=e,n=w(()=>Object.entries(t.labelsStore.labels).map(([g,A])=>({id:g,name:A.labelName??"(no name)",color:A.color}))),o=w({get:()=>t.labelsStore.activeLabel,set:g=>{g!=null&&t.labelsStore.setActiveLabel(g)}}),a=O(void 0),i=O(!1),s=_e({labelName:"",strokeWidth:1,color:""}),r=w(()=>a.value?t.labelsStore.labels[a.value]:null),l=w(()=>{var y;const g=new Set(Object.values(t.labelsStore.labels).map(({labelName:h})=>h).filter(Oo)),A=(y=r.value)==null?void 0:y.labelName;return A&&g.delete(A),g}),c=g=>{const A=new Set(Object.values(t.labelsStore.labels).map(S=>S.labelName));let y=g,h=1;for(;A.has(y);)y=`${g} (${h})`,h++;return y},u=()=>{const g=c("New Label");a.value=t.labelsStore.addLabel({labelName:g})};function p(g){i.value=!0,a.value=g,r.value&&(s.labelName=r.value.labelName??"",s.strokeWidth=r.value.strokeWidth??0,s.color=r.value.color??"")}function d(g){a.value&&g&&t.labelsStore.updateLabel(a.value,s),i.value=!1,a.value=null}function m(){a.value&&t.labelsStore.deleteLabel(a.value),d(!1)}return(g,A)=>(C(),L(ne,null,[f(Pe,{class:"pt-2"},{default:v(()=>[f(Lu,null,{default:v(()=>[P("Labels")]),_:1}),f(St,null,{default:v(()=>[f(Zl,{modelValue:o.value,"onUpdate:modelValue":A[0]||(A[0]=y=>o.value=y),items:n.value,"item-key":"id","item-title":"name","create-label-text":"New label",onCreate:u},{"item-prepend":v(({item:y})=>[_("div",T0,[_("div",{class:"color-dot",style:nt({background:y.color})},null,4)])]),"item-append":v(({key:y})=>[f(te,{icon:"mdi-pencil",size:"small",density:"compact",class:"ml-auto mr-1",variant:"plain",onClick:J(h=>p(y),["stop"]),"data-testid":"edit-label-button"},null,8,["onClick"])]),_:1},8,["modelValue","items"])]),_:1})]),_:1}),f(ls,{modelValue:i.value,"onUpdate:modelValue":A[6]||(A[6]=y=>i.value=y),"max-width":"800px"},{default:v(()=>[a.value?(C(),B(V0,{key:0,name:s.labelName,"onUpdate:name":A[1]||(A[1]=y=>s.labelName=y),"stroke-width":s.strokeWidth,"onUpdate:strokeWidth":A[2]||(A[2]=y=>s.strokeWidth=y),color:s.color,"onUpdate:color":A[3]||(A[3]=y=>s.color=y),onDelete:m,onCancel:A[4]||(A[4]=y=>d(!1)),onDone:A[5]||(A[5]=y=>d(!0)),invalidNames:l.value},null,8,["name","stroke-width","color","invalidNames"])):G("",!0)]),_:1},8,["modelValue"])],64))}});const vs=z(P0,[["__scopeId","data-v-7ede37f5"]]),Jl=F({__name:"RulerControls",setup(e){const t=Jt();return(n,o)=>(C(),B(vs,{"labels-store":b(t)},null,8,["labels-store"]))}}),Xl=F({__name:"RectangleControls",setup(e){const t=bn();return(n,o)=>(C(),B(vs,{"labels-store":b(t)},null,8,["labels-store"]))}}),ec=F({__name:"PolygonControls",setup(e){const t=_n();return(n,o)=>(C(),B(vs,{"labels-store":b(t)},null,8,["labels-store"]))}}),M0=F({setup(){const{currentImageID:e}=me(),t=Fn(),n=Me(),o=Se(),a=O(["tags","presets","auto"]),i=ya(),s=w(()=>n.viewIDs.filter(h=>!!t.getConfig(h,e.value)));function r(h){return h.replace(/([A-Z])/g," $1").trim()}const l=w(()=>{if(e.value&&Ge(e.value)){const h=e.value,{Modality:S}=o.volumeInfo[h];return S}return""}),c=["ct","ctprotocol"],u=w(()=>e.value&&!Ge(e.value)?!0:l.value&&c.includes(l.value.toLowerCase())),p=w(()=>({width:i.width,level:i.level})),d=w(()=>{const h=s.value[0],S=e.value;return!S||!h?i:t.getConfig(h,S)}),m=w(()=>{var h;return((h=d.value)==null?void 0:h.width)??p.value.width}),g=w(()=>{var h;return((h=d.value)==null?void 0:h.level)??p.value.level}),A=w({get(){const h=d.value,{width:S,level:E}=(h==null?void 0:h.preset)||p.value,{width:k,level:R}=p.value;return S!==k&&E!==R?{width:m.value,level:g.value}:(h==null?void 0:h.auto)||uo},set(h){const S=e.value,E=s.value[0];if(S&&E){const k=typeof h!="object",R={preset:k?p.value:h,auto:k?h:uo};t.updateConfig(E,S,R),t.resetWindowLevel(E,S)}}}),y=w(()=>{if(e.value&&Ge(e.value)){const h=e.value;return Qr(o.volumeInfo[h])}return[]});return{parseLabel:r,wlOptions:A,WLPresetsCT:Bu,showCtPresets:u,tags:y,panel:a,WLAutoRanges:rr}}});function O0(e,t,n,o,a,i){return C(),B(Pe,{dark:""},{default:v(()=>[f(ot,null,{default:v(()=>[f(Kt,{modelValue:e.panel,"onUpdate:modelValue":t[3]||(t[3]=s=>e.panel=s),multiple:""},{default:v(()=>[e.tags.length?(C(),B(Ne,{key:0,value:"tags"},{default:v(()=>[f(Fe,null,{default:v(()=>[P(" File Specific Presets ")]),_:1}),f(We,null,{default:v(()=>[f(so,{modelValue:e.wlOptions,"onUpdate:modelValue":t[0]||(t[0]=s=>e.wlOptions=s),"hide-details":""},{default:v(()=>[(C(!0),L(ne,null,de(e.tags,(s,r)=>(C(),B(io,{key:r,label:`Tag ${r+1} [W:${s.width},L:${s.level}]`,value:s,density:"compact"},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1})):G("",!0),e.showCtPresets?(C(),B(Ne,{key:1,value:"presets"},{default:v(()=>[f(Fe,null,{default:v(()=>[P("CT Presets")]),_:1}),f(We,null,{default:v(()=>[f(so,{modelValue:e.wlOptions,"onUpdate:modelValue":t[1]||(t[1]=s=>e.wlOptions=s),"hide-details":""},{default:v(()=>[(C(!0),L(ne,null,de(e.WLPresetsCT,(s,r)=>(C(),L("div",{key:r},[(C(),B(io,{key:r,label:e.parseLabel(r),value:s,density:"compact",class:"ml-3"},null,8,["label","value"]))]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1})):G("",!0),f(Ne,{value:"auto"},{default:v(()=>[f(Fe,null,{default:v(()=>[P("Auto Window/Level")]),_:1}),f(We,null,{default:v(()=>[f(so,{modelValue:e.wlOptions,"onUpdate:modelValue":t[2]||(t[2]=s=>e.wlOptions=s),"hide-details":""},{default:v(()=>[(C(!0),L(ne,null,de(e.WLAutoRanges,(s,r)=>(C(),B(io,{key:r,label:e.parseLabel(r),value:r,density:"compact"},{default:v(()=>[f(fe,{activator:"parent",location:"bottom"},{default:v(()=>[P(H(s?`Remove the top and bottom ${s} percent of data`:"Use the full data range"),1)]),_:2},1024)]),_:2},1032,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1})}const L0=z(M0,[["render",O0],["__scopeId","data-v-11476fc3"]]),B0=F({components:{ControlButton:ct,MenuControlButton:w0,ItemGroup:Go,GroupableItem:zo,CropControls:b0,ResetViews:k0,RulerControls:Jl,RectangleControls:Xl,PolygonControls:ec,WindowLevelControls:L0},setup(){const e=Oe(),t=Le(),n=Me(),o=w(()=>!e.primaryDataset),a=w(()=>t.currentTool),{layout:i}=ye(n),s=w(()=>{var p;return((p=i.value)==null?void 0:p.name)==="Oblique View"}),r=O(!1),l=O(!1),c=O(!1);bo("Escape",()=>{r.value=!1,l.value=!1,c.value=!1});const u=w(()=>{const p=gn.value;return{"Window & Level":p.windowLevel,Pan:p.pan,Zoom:p.zoom,Crosshairs:p.crosshairs,Select:p.select,Paint:p.paint,Rectangle:p.rectangle,Polygon:p.polygon,Ruler:p.ruler,Crop:p.crop}});return{currentTool:a,setCurrentTool:t.setCurrentTool,noCurrentImage:o,isObliqueLayout:s,Tools:oe,paintMenu:r,cropMenu:l,windowingMenu:c,nameToShortcut:u}}});const jo=e=>($e("data-v-24a6e628"),e=e(),xe(),e),$0=jo(()=>_("div",{class:"my-1 tool-separator"},null,-1)),x0=jo(()=>_("div",{class:"my-1 tool-separator"},null,-1)),U0=jo(()=>_("div",{class:"my-1 tool-separator"},null,-1)),N0=jo(()=>_("div",{class:"my-1 tool-separator"},null,-1));function F0(e,t,n,o,a,i){const s=q("window-level-controls"),r=q("menu-control-button"),l=q("groupable-item"),c=q("control-button"),u=q("rectangle-controls"),p=q("polygon-controls"),d=q("ruler-controls"),m=q("crop-controls"),g=q("reset-views"),A=q("item-group");return C(),B(A,{mandatory:"","model-value":e.currentTool,"onUpdate:modelValue":t[0]||(t[0]=y=>e.setCurrentTool(y))},{default:v(()=>[$0,f(l,{value:e.Tools.WindowLevel},{default:v(({active:y,toggle:h})=>[f(r,{icon:"mdi-circle-half-full",name:`Window & Level [${e.nameToShortcut["Window & Level"]}]`,active:y,disabled:e.noCurrentImage,onClick:h},{default:v(()=>[f(s)]),_:2},1032,["name","active","disabled","onClick"])]),_:1},8,["value"]),f(l,{value:e.Tools.Pan},{default:v(({active:y,toggle:h})=>[f(c,{icon:"mdi-cursor-move",name:`Pan [${e.nameToShortcut.Pan}]`,buttonClass:["tool-btn",y?"tool-btn-selected":""],disabled:e.noCurrentImage,onClick:h},null,8,["name","buttonClass","disabled","onClick"])]),_:1},8,["value"]),f(l,{value:e.Tools.Zoom},{default:v(({active:y,toggle:h})=>[f(c,{icon:"mdi-magnify-plus-outline",name:`Zoom [${e.nameToShortcut.Zoom}]`,buttonClass:["tool-btn",y?"tool-btn-selected":""],disabled:e.noCurrentImage,onClick:h},null,8,["name","buttonClass","disabled","onClick"])]),_:1},8,["value"]),f(l,{value:e.Tools.Crosshairs},{default:v(({active:y,toggle:h})=>[f(c,{icon:"mdi-crosshairs",name:`Crosshairs [${e.nameToShortcut.Crosshairs}]`,buttonClass:["tool-btn",y?"tool-btn-selected":""],disabled:e.noCurrentImage||e.isObliqueLayout,onClick:h},null,8,["name","buttonClass","disabled","onClick"])]),_:1},8,["value"]),x0,f(l,{value:e.Tools.Select},{default:v(({active:y,toggle:h})=>[f(c,{icon:"mdi-cursor-default",name:`Select [${e.nameToShortcut.Select}]`,buttonClass:["tool-btn",y?"tool-btn-selected":""],disabled:e.noCurrentImage,onClick:h},null,8,["name","buttonClass","disabled","onClick"])]),_:1},8,["value"]),f(l,{value:e.Tools.Paint},{default:v(({active:y,toggle:h})=>[f(c,{icon:"mdi-brush",name:`Paint [${e.nameToShortcut.Paint}]`,buttonClass:["tool-btn",y?"tool-btn-selected":""],disabled:e.noCurrentImage||e.isObliqueLayout,onClick:h},null,8,["name","buttonClass","disabled","onClick"])]),_:1},8,["value"]),f(l,{value:e.Tools.Rectangle},{default:v(({active:y,toggle:h})=>[f(r,{icon:"mdi-vector-square",name:`Rectangle [${e.nameToShortcut.Rectangle}]`,mobileOnlyMenu:!0,active:y,disabled:e.noCurrentImage||e.isObliqueLayout,onClick:h},{default:v(()=>[f(u)]),_:2},1032,["name","active","disabled","onClick"])]),_:1},8,["value"]),f(l,{value:e.Tools.Polygon},{default:v(({active:y,toggle:h})=>[f(r,{icon:"mdi-pentagon-outline",name:`Polygon [${e.nameToShortcut.Polygon}]`,mobileOnlyMenu:!0,active:y,disabled:e.noCurrentImage||e.isObliqueLayout,onClick:h},{default:v(()=>[f(p)]),_:2},1032,["name","active","disabled","onClick"])]),_:1},8,["value"]),f(l,{value:e.Tools.Ruler},{default:v(({active:y,toggle:h})=>[f(r,{icon:"mdi-ruler",name:`Ruler [${e.nameToShortcut.Ruler}]`,mobileOnlyMenu:!0,active:y,disabled:e.noCurrentImage||e.isObliqueLayout,onClick:h},{default:v(()=>[f(d)]),_:2},1032,["name","active","disabled","onClick"])]),_:1},8,["value"]),U0,f(l,{value:e.Tools.Crop},{default:v(({active:y,toggle:h})=>[f(r,{icon:"mdi-crop",name:`Crop [${e.nameToShortcut.Crop}]`,active:y,disabled:e.noCurrentImage||e.isObliqueLayout,onClick:h},{default:v(()=>[f(m)]),_:2},1032,["name","active","disabled","onClick"])]),_:1},8,["value"]),N0,f(g)]),_:1},8,["model-value"])}const W0=z(B0,[["render",F0],["__scopeId","data-v-24a6e628"]]),H0={[He.Error]:"error",[He.Warning]:"warn",[He.Info]:"info",[He.Success]:""},G0=F({props:{message:{type:Object,required:!0}},setup(e){const{message:t}=ae(e);return{headerClass:w(()=>{const o=H0[t.value.type];return o!=null&&o.length?`${o}-message`:""})}}});const z0={class:"header"},j0={class:"mt-4"},Q0={class:"details"};function q0(e,t,n,o,a,i){return C(),B(Ne,null,{default:v(()=>[f(Fe,{class:be(e.headerClass)},{default:v(()=>[_("div",z0,[_("span",null,H(e.message.title),1),f(te,{icon:"mdi-delete",variant:"text",size:"small",class:"mr-3",onClick:t[0]||(t[0]=J(s=>e.$emit("delete"),["stop"]))})])]),_:1},8,["class"]),e.message.options.details?(C(),B(We,{key:0},{default:v(()=>[_("div",j0,[_("pre",Q0,H(e.message.options.details),1)])]),_:1})):G("",!0)]),_:1})}const K0=z(G0,[["render",q0],["__scopeId","data-v-9c5e91a3"]]),Z0=F({components:{MessageItem:K0},setup(){const e=Ze(),{messages:t}=ye(e),n=O(!0),o=O(!0),a=O(!0),i=w(()=>{const r={errors:n.value,warnings:o.value,info:a.value};return t.value.filter(l=>l.type===He.Error&&r.errors||l.type===He.Warning&&r.warnings||l.type===He.Info&&r.info)});function s(r){e.clearOne(r)}return{deleteItem:s,clearAll:()=>{e.clearAll()},showErrors:n,showWarnings:o,showInfo:a,filteredMessages:i}}});const tc=e=>($e("data-v-22995088"),e=e(),xe(),e),Y0=tc(()=>_("span",null,"Notifications",-1)),J0={class:"action-bar ma-2"},X0={class:"filter-bar"},ev=tc(()=>_("span",null,"Clear All",-1)),tv={class:"message-list ma-2"},nv={key:0,class:"empty"};function ov(e,t,n,o,a,i){const s=q("message-item");return C(),B(Pe,{class:"fill-height message-center"},{default:v(()=>[f(qt,{class:"d-flex flex-row align-center"},{default:v(()=>[Y0]),_:1}),f(ot,{class:"content-container pt-4"},{default:v(()=>[_("div",J0,[_("div",X0,[f(Ke,{modelValue:e.showErrors,"onUpdate:modelValue":t[0]||(t[0]=r=>e.showErrors=r),class:"px-2","hide-details":"",label:"Error"},null,8,["modelValue"]),f(Ke,{modelValue:e.showWarnings,"onUpdate:modelValue":t[1]||(t[1]=r=>e.showWarnings=r),class:"px-2","hide-details":"",label:"Warning"},null,8,["modelValue"]),f(Ke,{modelValue:e.showInfo,"onUpdate:modelValue":t[2]||(t[2]=r=>e.showInfo=r),class:"px-2","hide-details":"",label:"Info"},null,8,["modelValue"])]),f(te,{color:"secondary",onClick:e.clearAll},{default:v(()=>[f(K,{class:"mr-2"},{default:v(()=>[P("mdi-delete")]),_:1}),ev]),_:1},8,["onClick"])]),_("div",tv,[f(Kt,{variant:"accordion",multiple:""},{default:v(()=>[(C(!0),L(ne,null,de(e.filteredMessages,r=>(C(),B(s,{key:r.id,message:r,onDelete:l=>e.deleteItem(r.id)},null,8,["message","onDelete"]))),128))]),_:1}),e.filteredMessages.length===0?(C(),L("div",nv,"No notifications to display")):G("",!0)])]),_:1})]),_:1})}const av=z(Z0,[["render",ov],["__scopeId","data-v-22995088"]]),sv=e=>($e("data-v-e7f0b4f3"),e=e(),xe(),e),iv={id:"tools-strip",class:"bg-grey-darken-4 d-flex flex-column align-center"},rv=sv(()=>_("div",{class:"my-1 tool-separator"},null,-1)),lv=F({__name:"ControlsStrip",props:{hasData:{type:Boolean}},setup(e){function t(){const A=Me(),y=O(a1),{layout:h}=ye(A);return X(y,()=>{const S=Ao[y.value]||[];A.setLayout(S)},{immediate:!0}),X(h,()=>{var S;(S=h.value)!=null&&S.name&&h.value.name!==y.value&&(y.value=h.value.name)}),y}function n(){const A=rs(),{isSaving:y,saveUrl:h}=ye(A),S=O(!1);return{handleSave:()=>{h.value!==""?A.saveState():S.value=!0},isSaving:y,saveDialog:S}}function o(){const A=Ze(),y=w(()=>A.importantMessages.length),h=w(()=>A.importantMessages.find(S=>S.type===He.Error)?"error":A.importantMessages.find(S=>S.type===He.Warning)?"warning":"primary");return{count:y,badgeColor:h}}function a(){const A=zn(),y=w(()=>{switch(A.connState){case je.Connected:return"mdi-lan-check";case je.Disconnected:return"mdi-lan-disconnect";case je.Pending:return"mdi-lan-pending";default:throw new Error("Invalid connection state")}}),{url:h}=ye(A);return{icon:y,url:h}}const i=O(!1),s=O(!1),{icon:r,url:l}=a(),c=t(),{handleSave:u,saveDialog:p,isSaving:d}=n(),{count:m,badgeColor:g}=o();return(A,y)=>(C(),L(ne,null,[_("div",iv,[f(ct,{size:"40",icon:"mdi-folder-open",name:"Open files",onClick:b(Bl)},null,8,["onClick"]),f(ct,{size:"40",icon:"mdi-content-save-all",name:"Save session",loading:b(d),onClick:b(u)},null,8,["loading","onClick"]),rv,f(Mt,{location:"right","close-on-content-click":!0},{activator:v(({props:h})=>[_("div",null,[f(ct,ze(h,{size:"40",icon:"mdi-view-dashboard",name:"Layouts"}),null,16)])]),default:v(()=>[f(Pe,null,{default:v(()=>[f(ot,null,{default:v(()=>[f(so,{modelValue:b(c),"onUpdate:modelValue":y[0]||(y[0]=h=>Ln(c)?c.value=h:null),class:"mt-0","hide-details":""},{default:v(()=>[(C(!0),L(ne,null,de(b(Ao),(h,S)=>(C(),B(io,{key:S,label:h.name,value:S},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1}),A.hasData?(C(),B(W0,{key:0})):G("",!0),f(pt),b(l)?(C(),B(ct,{key:1,size:"40",icon:b(r),name:"Open Server Settings",onClick:y[1]||(y[1]=h=>i.value=!0)},null,8,["icon"])):G("",!0),f(ao,{"offset-x":"10","offset-y":"10",content:b(m),color:b(g),"model-value":b(m)>0,id:"notifications"},{default:v(()=>[f(ct,{size:"40",icon:"mdi-bell-outline",name:"Notifications",onClick:y[2]||(y[2]=h=>s.value=!0)})]),_:1},8,["content","color","model-value"]),f(ct,{size:"40",icon:"mdi-cog",name:"Settings",onClick:y[3]||(y[3]=h=>i.value=!0)})]),f(Wt,{modelValue:b(p),"onUpdate:modelValue":y[4]||(y[4]=h=>Ln(p)?p.value=h:null),"max-width":"30%"},{default:v(({close:h})=>[f(Zg,{close:h},null,8,["close"])]),_:1},8,["modelValue"]),f(Wt,{modelValue:s.value,"onUpdate:modelValue":y[5]||(y[5]=h=>s.value=h),"content-class":"fill-height"},{default:v(()=>[f(av)]),_:1},8,["modelValue"]),f(a2,{onOpenNotifications:y[6]||(y[6]=h=>s.value=!0)}),f(Wt,{modelValue:i.value,"onUpdate:modelValue":y[7]||(y[7]=h=>i.value=h)},{default:v(()=>[f(v0)]),_:1},8,["modelValue"])],64))}});const cv=z(lv,[["__scopeId","data-v-e7f0b4f3"]]),Qo=e=>($e("data-v-57dbc13d"),e=e(),xe(),e),uv=Qo(()=>_("p",{class:"mb-4"}," VolView takes data privacy and security seriously. Here is how we keep your data safe. ",-1)),dv=Qo(()=>_("ul",{class:"bullet-points"},[_("li",null,[_("span",{class:"font-weight-bold"},"Data Loading"),P(": Your image data never leaves your computer. Images are loaded into your browser and are never sent to any remote server or cloud service. ")]),_("li",null,[_("span",{class:"font-weight-bold"},"Error Reporting"),P(": We collect error reports in the event that VolView encounters issues. These reports help us improve VolView's stability and only consist of code stack traces where applicable. We do not collect your data, nor any other identifiable information. ")])],-1)),pv=Qo(()=>_("p",null," If you would like to opt-out of error reporting, you may turn it off using the following setting. Your choice will be respected for future VolView sessions on this machine. ",-1)),fv={class:"mt-4 ml-4"},mv=Qo(()=>_("span",null,"Error reporting has been turned off at build time.",-1)),gv=F({__name:"DataSecurityBox",setup(e){const t=Ql(),n=w({get:()=>!t.disableReporting,set:o=>{t.disableReporting=!o}});return(o,a)=>(C(),B(Pe,{class:"text-grey-lighten-1"},{default:v(()=>[f(qt,null,{default:v(()=>[P("Data Privacy and Security Notice")]),_:1}),f(ot,null,{default:v(()=>[uv,dv,pv,_("p",fv,[b(gs)?(C(),B(sn,{key:0,modelValue:n.value,"onUpdate:modelValue":a[0]||(a[0]=i=>n.value=i),label:`Error Reporting: ${n.value?"On":"Off"}`,color:"secondary","hide-details":""},null,8,["modelValue","label"])):(C(),B(ko,{key:1,type:"info",variant:"text"},{default:v(()=>[mv]),_:1}))])]),_:1})]),_:1}))}});const vv=z(gv,[["__scopeId","data-v-57dbc13d"]]),hs=e=>($e("data-v-eef2b270"),e=e(),xe(),e),hv=hs(()=>_("div",null,"Click to open local files.",-1)),Av={class:"mt-8"},yv=hs(()=>_("div",null,"Drag & drop your DICOM files.",-1)),wv={class:"vertical-offset-margin"},Sv={key:0,class:"vertical-offset-margin"},Cv={key:1},bv=hs(()=>_("div",{class:"text-h6 my-4"},"Loading data...",-1)),_v=F({__name:"WelcomePage",props:{loading:{type:Boolean,default:!1}},setup(e){const t=w(()=>rs().saveUrl===""),n=O(!1);return(o,a)=>(C(),L(ne,null,[f(St,ze({class:"page-container bg-grey-darken-3"},o.$attrs),{default:v(()=>[f(ue,null,{default:v(()=>[f(pe,{justify:"center"},{default:v(()=>[f(Pe,{flat:"",dark:"",rounded:"0",color:"transparent",class:"text-center headline"},{default:v(()=>[o.loading?(C(),L(ne,{key:1},[bv,f($u,{indeterminate:""})],64)):(C(),L(ne,{key:0},[_("div",null,[f(K,{size:"64"},{default:v(()=>[P("mdi-folder-open")]),_:1})]),hv,_("div",Av,[f(K,{size:"64"},{default:v(()=>[P("mdi-arrow-down-bold")]),_:1})]),yv,_("div",wv,[t.value?(C(),L("div",Sv,[f(K,{size:"64"},{default:v(()=>[P("mdi-cloud-off-outline")]),_:1})])):G("",!0),t.value?(C(),L("div",Cv," Secure: Image data never leaves your machine. ")):G("",!0),f(te,{class:"mt-2",variant:"tonal",color:"secondary",onClick:a[0]||(a[0]=J(i=>n.value=!0,["stop"]))},{default:v(()=>[P(" Learn More ")]),_:1})])],64))]),_:1})]),_:1})]),_:1})]),_:1},16),f(Wt,{modelValue:n.value,"onUpdate:modelValue":a[1]||(a[1]=i=>n.value=i)},{default:v(()=>[f(vv)]),_:1},8,["modelValue"])],64))}});const Iv=z(_v,[["__scopeId","data-v-eef2b270"]]);function ie(e,t,n,o){const a=w(()=>{const l=b(e);return l?l[t]:null});let i=null;const s=()=>{i==null||i.unsubscribe(),i=null},r=X(a,l=>{s(),l&&(i=l(n,(o==null?void 0:o.priority)??0))},{immediate:!0});return kt(()=>{s()}),{stop:()=>{s(),r()}}}function As(e){let t=null;return(...o)=>{t==null&&(t=setTimeout(()=>{t=null,e(...o)},0))}}function kv(e){const t=rd.newInstance();return Ki(n=>{const o=b(e);o&&(t.setContainer(o),n(()=>{t.setContainer(null)}))}),kt(()=>{t.delete()}),t}function Dv(e){const t=ld.newInstance();t.setRenderer(e);const n=()=>{const o=t.getPickingEnabled(),a=t.getWidgets().length;!o&&a?t.enablePicking():o&&!a&&t.disablePicking()};return ie(t,"onModified",n),n(),t}function nc(e){const t=ad.newInstance(),n=sd.newInstance();n.addRenderer(t);const o=kv(e);n.addView(o),kt(()=>{n.removeView(o)});const a=id.newInstance();n.setInteractor(a),a.setView(o),Ki(d=>{const m=b(e);m&&(a.initialize(),a.bindEvents(m),d(()=>{a.getContainer()&&a.unbindEvents()}))});const i=Dv(t),s=As(()=>{a.isAnimating()||(i.renderWidgets(),n.render())}),r=()=>{a.isAnimating()||n.render()},l=({immediate:d}={immediate:!1})=>{d&&r(),s()};ie(t,"onModified",()=>{l()});const c=(d,m)=>{const g=Math.max(1,d*globalThis.devicePixelRatio),A=Math.max(1,m*globalThis.devicePixelRatio);o.setSize(g,A),l({immediate:!0})},{width:u,height:p}=Zi(e);return le(()=>{c(u.value,p.value)}),kt(()=>{n.removeRenderer(t),t.delete(),n.delete(),a.delete()}),{renderer:t,renderWindow:n,interactor:a,renderWindowView:o,widgetManager:i,requestRender:l}}function oc(e,t){const n=e.newInstance();return t.interactor.getInteractorStyle()&&cd("Overwriting an already set interactor style"),t.interactor.setInteractorStyle(n),kt(()=>{t.interactor.getInteractorStyle()===n&&t.interactor.setInteractorStyle(null),n.delete()}),{interactorStyle:n}}function ac(e,t,n){return X(e,(o,a,i)=>{let s=null;const r=c=>{s=c},l=n==null?void 0:n.compare(o,a);i(()=>{l&&(s==null||s())}),!l&&t(o,a,r)},n)}function Ev(e){const t=O(e.value);return ac(e,n=>{t.value=n},{compare:Yi}),w({get:()=>t.value,set:n=>{e.value=n}})}function Rv(e,t){t.isA("vtkCompositeMouseManipulator")?e.addMouseManipulator(t):t.isA("vtkCompositeGestureManipulator")?e.addGestureManipulator(t):t.isA("vtkCompositeKeyboardManipulator")&&e.addKeyboardManipulator(t)}function Vv(e,t){t.isA("vtkCompositeMouseManipulator")?e.removeMouseManipulator(t):t.isA("vtkCompositeGestureManipulator")?e.removeGestureManipulator(t):t.isA("vtkCompositeKeyboardManipulator")&&e.removeKeyboardManipulator(t)}function xt(e,t,n){const o=Ev(ht(n)),a=w(()=>b(t).newInstance(o.value)),i=O(!0);return X(a,(s,r)=>{r==null||r.delete()}),le(s=>{if(!i.value)return;const r=a.value;Rv(e,r),s(()=>{e.isDeleted()||Vv(e,r)})}),{instance:a,enabled:i}}function Tv(e,t){if(e===0&&t===1)return[2,1];if(e===0&&t===2)return[1,2];if(e===1&&t===0)return[2,0];if(e===1&&t===2)return[0,2];if(e===2&&t===0)return[1,0];if(e===2&&t===1)return[0,1];throw new Error(`Invalid lookAxis and eyeUpAxis: ${e}, ${t}`)}function Pv(e,t,n,o){const[a,i]=Tv(e,t),s=n[a],r=n[i],l=s/r,[c,u]=o,p=c/u;let d=r/2;return p<l&&(d=s/2/p),d}function Mv(e,t,n,o){e.renderer.getActiveCamera().setParallelScale(Pv(t,n,o,e.renderWindowView.getSize()))}function Ov(e,t,n,o){const a=Ra(o);Ea(a,a,t),e.setFocalPoint(...o),e.setPosition(...a),e.setDirectionOfProjection(...t),e.setViewUp(...n)}function sc(e,t,n,o){const{worldBounds:a,orientation:i}=t,s=Na(i),r=Ue.getCenter(a),l=e.renderer.getActiveCamera(),c=s[n],u=s[o];Ov(l,c,u,r),e.renderer.resetCamera(a),e.requestRender()}function Lv(e,t,n,o){const{lpsOrientation:a,dimensions:i,spacing:s}=t,r=Te(n),l=Te(o),c=a[r],u=a[l],p=[i[0]*s[0],i[1]*s[1],i[2]*s[2]];Mv(e,c,u,p),e.requestRender()}function ic(e,t,n,o){let a=!1;const i=()=>{a=!0},s=()=>{a=!1},r=c=>{i();try{c()}finally{s()}},{stop:l}=ie(e,t,c=>{a||n(c)},o);return{stop:l,pause:i,resume:s,withPaused:r}}function he(e,t){let n,o;if(typeof t=="string"){const l=`get${fo(t)}`,c=`set${fo(t)}`,u=w(()=>{var g;return(g=b(e))==null?void 0:g[l]}),p=w(()=>{var g;return(g=b(e))==null?void 0:g[c]}),d=w(()=>!!b(e)),m=w(()=>{const g=b(e);return g?c in g:!1});n=()=>{var g;return(g=u.value)==null?void 0:g.call(u)},o=g=>{const A=p.value;if(!d.value)return!1;if(!m.value||!A)throw new Error(`No setter for field '${t}'`);return Array.isArray(g)&&A.length===g.length?A(...g):A(g)}}else n=t.get,o=t.set;let a,i;const s=cu((l,c)=>({get:()=>(l(),n()),set:u=>{let p=!1;a();try{const d=o(u);p=d===void 0?!0:d}finally{i()}p&&c()}})),r=As(()=>{var l;(l=b(e))!=null&&l.isDeleted()||ua(s)});return{pause:a,resume:i}=ic(e,"onModified",r),s}function Bv(e,t){return w({get:()=>e.value,set:n=>{t(n,e.value)&&(e.value=n)}})}function rc(e,t,n){const o=Yt(),a=["position","focalPoint","viewUp","parallelScale","directionOfProjection"],i=a.reduce((l,c)=>({...l,[c]:Bv(he(n,c),u=>!!u)}),{}),s=w(()=>o.getConfig(b(e),b(t))),r=a.reduce((l,c)=>({...l,[c]:w({get:()=>{var u;return(u=s.value)==null?void 0:u[c]},set:u=>{const p=b(e),d=b(t);!p||!d||(o.updateConfig(p,d,{[c]:u}),o.isSync()&&o.updateSyncConfigs())}})}),{});a.forEach(l=>{dn(r[l],i[l])})}const ve=Symbol("VtkView"),lc=F({__name:"VtkVolumeView",props:{viewId:{},imageId:{},viewDirection:{},viewUp:{}},setup(e,{expose:t}){const n=e,{viewId:o,imageId:a,viewDirection:i,viewUp:s}=ae(n),r=O(),{disableCameraAutoReset:l}=ye(Yt()),{metadata:c}=Ce(a),u=Ji(!0),p=u.run(()=>nc(r));Xe(()=>{u.stop()}),p.renderer.setBackground(0,0,0);const{interactorStyle:d}=oc(fr,p);xt(d,Nt,{button:1,shift:!0}),xt(d,Nt,{button:2}),xt(d,ud,{button:3,scrollEnabled:!0}),xt(d,dd,{button:1}),le(()=>{const A=Ue.getCenter(c.value.worldBounds);d.setCenterOfRotation(...A)});function m(){sc(p,c.value,i.value,s.value)}Ee([l,o,a],([A])=>{A||m()}),rc(o,a,p.renderer.getActiveCamera());const g=Ta({...p,interactorStyle:d,resetCamera:m});return t(g),Pa(ve,g),(A,y)=>(C(),L("div",{ref_key:"vtkContainerRef",ref:r},[se(A.$slots,"default")],512))}});function qo({view:e,data:t,vtkActorClass:n,vtkMapperClass:o}){const a=n.newInstance(),i=o.newInstance(),s=a.getProperty();return a.setMapper(i),le(r=>{const l=b(t);if(!l)return;const{renderer:c}=e;i.setInputData(l,0),c.addActor(a),e.requestRender(),r(()=>{c.removeActor(a)})}),[a,i,s].forEach(r=>{ie(r,"onModified",()=>{e.requestRender()})}),kt(()=>{a.delete(),i.delete()}),{actor:a,mapper:i,property:s}}function $v(e,t){const n=qo({view:e,data:t,vtkActorClass:mr,vtkMapperClass:pd}),o=he(n.mapper,"slicePlane");return ie(o,"onModified",()=>{e.requestRender()}),n}function jn(e,t){const n=Fn(),o=w(()=>n.getConfig(b(e),b(t))),a=s=>w({get:()=>{var r;return((r=o.value)==null?void 0:r[s])??0},set:r=>{const l=b(t);!l||r==null||n.updateConfig(b(e),l,{[s]:r})}}),i=w(()=>{const{min:s,max:r}=o.value??{};return s==null||r==null?[0,1]:[s,r]});return{config:o,width:a("width"),level:a("level"),range:i}}const cc=F({__name:"VtkBaseObliqueSliceRepresentation",props:{viewId:{},imageId:{},planeNormal:{},planeOrigin:{}},setup(e,{expose:t}){const n=e,{viewId:o,imageId:a,planeNormal:i,planeOrigin:s}=ae(n),r=ge(ve);if(!r)throw new Error("No VtkView");const{imageData:l}=Ce(a),c=jn(o,a),u=$v(r,l);u.mapper.setResolveCoincidentTopologyToPolygonOffset(),u.mapper.setResolveCoincidentTopologyPolygonOffsetParameters(1,1);const p=Vo.newInstance();return u.mapper.setSlicePlane(p),u.mapper.setSlabType(fd.MAX),u.mapper.setSlabThickness(1),Ee([i,s],([d,m])=>{const g=u.mapper.getSlicePlane();g&&(g.setNormal(d),g.setOrigin(m))}),le(()=>{u.property.setColorLevel(c.level.value),u.property.setColorWindow(c.width.value)}),t(u),(d,m)=>se(d.$slots,"default")}});function bi(e,...t){const n=e.newInstance(),o=he(n,"mTime");le(()=>{t.map(s=>b(s)).forEach((s,r)=>{s&&n.setInputData(b(s),r)})});let a={};const i=(s=0)=>(s in a||(a[s]=uu(o,()=>n.getInputData(s)?n.getOutputData(s):null)),a[s]);return kt(()=>{a={},n.delete()}),{filter:n,getOutputData:i}}const uc=F({__name:"VtkImageOutlineRepresentation",props:{viewId:{},imageId:{},planeNormal:{},planeOrigin:{},color:{default:()=>[1,1,1]},thickness:{default:1}},setup(e,{expose:t}){const n=e,{imageId:o,planeNormal:a,planeOrigin:i,color:s,thickness:r}=ae(n),l=ge(ve);if(!l)throw new Error("No VtkView");const{imageData:c}=Ce(o),p=bi(gd,c).getOutputData(0),d=Vo.newInstance(),m=bi(vd,p);m.filter.setCutFunction(d);const g=qo({view:l,data:m.getOutputData(0),vtkActorClass:md,vtkMapperClass:Po});le(()=>{g.property.setLineWidth(r.value),g.property.setColor(s.value)});const A=he(d,"normal"),y=he(d,"origin");return En(a,A),En(i,y),Ee([A,y],()=>{m.filter.modified()}),t(g),(h,S)=>se(h.$slots,"default")}});function xv(e,t,n){if(!n)return!0;const{byViewType:o,byViewIds:a}=n;return!(o&&!o.includes(t)||a&&!a.includes(e))}function _i(e,t){if(!(!e||!t))return Array.from(new Set(e.concat(t)))}function Uv(e){if(e.length!==0)return e.reduce((t,n)=>{if(t===void 0)return;const o=_i(t==null?void 0:t.byViewIds,n==null?void 0:n.byViewIds),a=_i(t==null?void 0:t.byViewType,n==null?void 0:n.byViewType);return{byViewIds:o,byViewType:a}},e[0])}const ys=ce("viewAnimation",()=>{const e=O(!1),t=du(new Map),n=w(()=>Uv(Array.from(t.value.values())));return{animating:e,viewFilter:n,requestAnimation:(i,s)=>{t.value.has(i)||(t.value.set(i,s),e.value=!0,ua(t))},cancelAnimation:i=>{t.value.delete(i),t.value.size===0&&(e.value=!1),ua(t)}}});function Ko(e,t,n){const o=ys(),{animating:a,viewFilter:i}=ye(o),s=w(()=>xv(b(t),b(n),i.value));let r=!1;le(()=>{const l=b(e);l&&(a.value?!r&&s.value&&(l.interactor.requestAnimation(o),r=!0):(l.interactor.cancelAnimation(o),r=!1))})}function dc(e){switch(e){case"Coronal":return Qe.XZ_PLANE;case"Sagittal":return Qe.YZ_PLANE;case"Axial":return Qe.XY_PLANE;default:throw new Error(`Invalid view axis: ${e}`)}}function pc(e,t){const{Inferior:n,Anterior:o,Superior:a,Left:i}=un(t.lpsOrientation),s={[Qe.YZ_PLANE]:{normal:i,viewUp:a},[Qe.XZ_PLANE]:{normal:o,viewUp:a},[Qe.XY_PLANE]:{normal:n,viewUp:o}};e.setPlanes(s)}function Nv(e,t){const{currentImageData:n,currentImageMetadata:o}=me();le(()=>{const a=n.value;a&&(e.setImage(a),pc(t,o.value))})}const ws=ce("resliceCursor",()=>{const e=hd.newInstance({scaleInPixels:!0,rotationHandlePosition:.75}),t=e.getWidgetState();return Nv(e,t),{resliceCursor:e,resliceCursorState:t,resetReslicePlanes:n=>{pc(t,n)}}}),Fv=e=>($e("data-v-ea74155a"),e=e(),xe(),e),Wv={class:"vtk-container-wrapper",tabindex:"0"},Hv=Fv(()=>_("div",{class:"vtk-gutter"},null,-1)),Gv={class:"vtk-container"},zv={class:"vtk-sub-container"},jv=F({__name:"MultiObliqueSliceViewer",props:{viewDirection:{},viewUp:{},slices:{},id:{},type:{}},setup(e){const t=e,n=O(),{id:o,type:a,viewDirection:i,viewUp:s,slices:r}=ae(t);Ko(n,o,a);const{currentImageID:l}=me(),c=ws(),{resliceCursor:u,resliceCursorState:p}=c,d=he(p,"center"),m=w(()=>r.value.map(A=>{const y=u.getPlaneNormalFromViewType(dc(A.axis)),h=Xi([0,0,0],Rn[A.viewID],1/255);return{viewId:A.viewID,planeNormal:y,planeOrigin:d.value,outlineColor:h}}));function g(){n.value&&(n.value.resetCamera(),n.value.requestRender())}return In().onClick(g),(A,y)=>(C(),L("div",Wv,[Hv,_("div",Gv,[_("div",zv,[f(lc,{class:"vtk-view",ref_key:"vtkView",ref:n,"data-testid":"vtk-view","view-id":A.id,"image-id":b(l),"view-direction":b(i),"view-up":b(s)},{default:v(()=>[(C(!0),L(ne,null,de(m.value,(h,S)=>(C(),L(ne,{key:S},[f(cc,{"view-id":h.viewId,"image-id":b(l),"plane-normal":h.planeNormal,"plane-origin":h.planeOrigin},null,8,["view-id","image-id","plane-normal","plane-origin"]),f(uc,{"view-id":h.viewId,"image-id":b(l),"plane-normal":h.planeNormal,"plane-origin":h.planeOrigin,thickness:4,color:h.outlineColor},null,8,["view-id","image-id","plane-normal","plane-origin","color"])],64))),128)),se(A.$slots,"default",{},void 0,!0)]),_:3},8,["view-id","image-id","view-direction","view-up"])])])]))}});const Qv=z(jv,[["__scopeId","data-v-ea74155a"]]);function fc(e){const t=he(e,"container");return w(()=>!!t.value)}function qv(e,t){const n=fc(e);Pt(n,()=>{t()})}function Kv(e,t){const n=fc(e);Pt(w(()=>!n.value),()=>{t()}),Xe(()=>{t()})}const Zv=F({__name:"ResliceCursorTool",props:{viewId:{},viewDirection:{}},setup(e){const t=e,{viewDirection:n}=ae(t),o=w(()=>Te(n.value)),a=ge(ve);if(!a)throw new Error("No vtk view");const i=ws(),{resliceCursor:s,resliceCursorState:r}=i,l=O(),c=w(()=>f1(o.value));return qv(a.renderWindowView,()=>{l.value=a.widgetManager.addWidget(s,c.value),l.value.setKeepOrthogonality(!0),l.value.setCursorStyles({translateCenter:"default",rotateLine:"default",translateAxis:"default"}),r.getStatesWithLabel("sphere").forEach(m=>{const g=m;g.setScale1(10),g.setOpacity(128)}),r.getStatesWithLabel("line").forEach(m=>{const g=m;g.setScale3(1,1,1),g.setOpacity(100)}),[...r.getStatesWithLabel("XinZ"),...r.getStatesWithLabel("XinY")].forEach(m=>{m.setColor3(Rn[re.ObliqueSagittal])}),[...r.getStatesWithLabel("YinZ"),...r.getStatesWithLabel("YinX")].forEach(m=>{m.setColor3(Rn[re.ObliqueCoronal])}),[...r.getStatesWithLabel("ZinX"),...r.getStatesWithLabel("ZinY")].forEach(m=>{m.setColor3(Rn[re.ObliqueAxial])}),l.value.getRepresentations().forEach(m=>{m.getActors().forEach(g=>{g.getProperty().setAmbient(1)})}),a.requestRender()}),Kv(a.renderWindowView,()=>{l.value=void 0,a.widgetManager.removeWidget(s)}),(u,p)=>(C(),L("div"))}});function Yv(e){const t=O(!0),{withPaused:n}=ic(e,"onModified",()=>{t.value=!1});return{autoFit:t,withoutAutoFitEffect:n}}const mc=F({__name:"VtkSliceView",props:{viewId:{},imageId:{},viewDirection:{},viewUp:{},disableAutoResetCamera:{type:Boolean}},setup(e,{expose:t}){const n=e,{viewId:o,imageId:a,viewDirection:i,viewUp:s}=ae(n),r=O(),{disableCameraAutoReset:l}=ye(Yt()),{metadata:c}=Ce(a),u=Ji(!0),p=u.run(()=>nc(r));Xe(()=>{u.stop()}),p.renderer.setBackground(0,0,0),p.renderer.getActiveCamera().setParallelProjection(!0);const{interactorStyle:d}=oc(fr,p),{autoFit:m,withoutAutoFitEffect:g}=Yv(p.renderer.getActiveCamera());function A(){m.value&&g(()=>{Lv(p,c.value,i.value,s.value)})}Qt(r,()=>{l.value||A()});function y(){m.value=!0,g(()=>{sc(p,c.value,i.value,s.value),A()})}Ee([l,o,a],([S])=>{S||y()}),rc(o,a,p.renderer.getActiveCamera());const h=Ta({...p,interactorStyle:d,resetCamera:y});return t(h),Pa(ve,h),(S,E)=>(C(),L("div",{ref_key:"vtkContainerRef",ref:r},[se(S.$slots,"default")],512))}}),Jv=250;function Xv(e){const n=e.renderer.getVolumes()[0];if(!n)return null;const o=n.getMapper();return o?o.get("computeNormalFromOpacity","autoAdjustSampleDistances","maximumSamplesPerRay","sampleDistance","volumetricScatteringBlending"):null}function Ss(e){const t=pu(()=>{Ze().addError(Fs.WebGLLost.title,Fs.WebGLLost.details);const i={},s=b(e);s&&(i.vtk=Xv(s)),mu("WebGL2 context was lost",{contexts:i})},Jv),n=w(()=>{var a;return(a=b(e))==null?void 0:a.renderWindowView}),o=he(n,"canvas");fu(o,"webglcontextlost",t)}const eh="_gridRoot_102tk_2",th="_row_102tk_9",nh="_cell_102tk_16",oh="_top_102tk_20",ah="_left_102tk_21",sh="_center_102tk_25",ih="_middle_102tk_26",rh="_bottom_102tk_30",lh="_right_102tk_31",ch={gridRoot:eh,row:th,cell:nh,top:oh,left:ah,center:sh,middle:ih,bottom:rh,right:lh},uh={};function dh(e,t){return C(),L("div",{class:be(e.$style.gridRoot)},[_("div",{class:be([e.$style.top,e.$style.row])},[_("div",{class:be([e.$style.left,e.$style.cell])},[se(e.$slots,"top-left")],2),_("div",{class:be([e.$style.center,e.$style.cell])},[se(e.$slots,"top-center")],2),_("div",{class:be([e.$style.right,e.$style.cell])},[se(e.$slots,"top-right")],2)],2),_("div",{class:be([e.$style.middle,e.$style.row])},[_("div",{class:be([e.$style.left,e.$style.cell])},[se(e.$slots,"middle-left")],2),_("div",{class:be([e.$style.center,e.$style.cell])},[se(e.$slots,"middle-center")],2),_("div",{class:be([e.$style.right,e.$style.cell])},[se(e.$slots,"middle-right")],2)],2),_("div",{class:be([e.$style.bottom,e.$style.row])},[_("div",{class:be([e.$style.left,e.$style.cell])},[se(e.$slots,"bottom-left")],2),_("div",{class:be([e.$style.center,e.$style.cell])},[se(e.$slots,"bottom-center")],2),_("div",{class:be([e.$style.right,e.$style.cell])},[se(e.$slots,"bottom-right")],2)],2)],2)}const ph={$style:ch},gc=z(uh,[["render",dh],["__cssModules",ph]]);function to(e){return e.map((t,n)=>({value:t,axis:n})).filter(({value:t})=>Math.abs(t)>Io).sort((t,n)=>Math.abs(n.value)-Math.abs(t.value)).map(({value:t,axis:n})=>(Math.sign(t)===1?"LPS":"RAI")[n]).join("")}function fh(e){const t=w(()=>b(e).renderer),n=he(t,"activeCamera"),o=O(""),a=O(""),i=O(""),s=O("");function r(){const l=n.value.getViewUp(),c=n.value.getDirectionOfProjection(),u=[0,0,0];gu(u,c,l);const p=l.map(m=>m*-1),d=u.map(m=>m*-1);o.value=to(l),s.value=to(u),i.value=to(p),a.value=to(d)}return ie(n,"onModified",r),r(),{top:o,right:s,bottom:i,left:a}}const mh=F({__name:"DicomQuickInfoButton",props:{imageId:{}},setup(e){const n=ht(e,"imageId"),o=Se(),a=w(()=>{const i=n.value;if(i&&Ge(i)){const s=o.volumeInfo[i],r=o.volumeStudy[i],l=o.studyInfo[r],c=o.studyPatient[r],p=o.patientInfo[c].PatientID,d=l.StudyID,m=l.StudyDescription,g=s.SeriesNumber,A=s.SeriesDescription;return{patientID:p,studyID:d,studyDescription:m,seriesNumber:g,seriesDescription:A}}return null});return(i,s)=>a.value!==null?(C(),B(Mt,{key:0,"open-on-hover":"",location:"bottom left",left:"","nudge-left":"10",dark:"","max-width":"300px"},{activator:v(({props:r})=>[f(K,ze(r,{dark:"",size:"x-large",class:"pointer-events-all hover-info"}),{default:v(()=>[P(" mdi-information ")]),_:2},1040)]),default:v(()=>[f(It,{class:"bg-grey-darken-3"},{default:v(()=>[f(ke,null,{default:v(()=>[f(Be,{class:"font-weight-bold"},{default:v(()=>[P(" PATIENT / CASE ")]),_:1}),f(Re),f(Be,null,{default:v(()=>[P(" ID: "+H(a.value.patientID),1)]),_:1})]),_:1}),f(ke,null,{default:v(()=>[f(Be,{class:"font-weight-bold"},{default:v(()=>[P(" STUDY ")]),_:1}),f(Re),f(Be,null,{default:v(()=>[P(" ID: "+H(a.value.studyID),1)]),_:1}),f(Be,null,{default:v(()=>[P(H(a.value.studyDescription),1)]),_:1})]),_:1}),f(ke,null,{default:v(()=>[f(Be,{class:"font-weight-bold"},{default:v(()=>[P(" SERIES ")]),_:1}),f(Re),f(Be,null,{default:v(()=>[P(" Series #: "+H(a.value.seriesNumber),1)]),_:1}),f(Be,null,{default:v(()=>[P(H(a.value.seriesDescription),1)]),_:1})]),_:1})]),_:1})]),_:1})):G("",!0)}});const gh=z(mh,[["__scopeId","data-v-74522c0c"]]),vh={class:"annotation-cell"},hh={class:"annotation-cell"},Ah={class:"annotation-cell"},yh={key:0},wh={key:1},Sh={class:"annotation-cell"},Ch=F({__name:"SliceViewerOverlay",props:{viewId:{},imageId:{}},setup(e){const t=e,{viewId:n,imageId:o}=ae(t),a=ge(ve);if(!a)throw new Error("No VtkView");const{top:i,left:s}=fh(a),{config:r,slice:l,range:c}=bt(n,o),{config:u,width:p,level:d}=jn(n,o);return(m,g)=>(C(),B(gc,{class:"overlay-no-events view-annotations"},{"top-center":v(()=>[_("div",vh,[_("span",null,H(b(i)),1)])]),"middle-left":v(()=>[_("div",hh,[_("span",null,H(b(s)),1)])]),"bottom-left":v(()=>[_("div",Ah,[b(r)?(C(),L("div",yh," Slice: "+H(b(l)+1)+"/"+H(b(c)[1]+1),1)):G("",!0),b(u)?(C(),L("div",wh," W/L: "+H(b(p).toFixed(2))+" / "+H(b(d).toFixed(2)),1)):G("",!0)])]),"top-right":v(()=>[_("div",Sh,[f(gh,{"image-id":b(o)},null,8,["image-id"])])]),_:1}))}});const vc=z(Ch,[["__scopeId","data-v-a2dcd710"]]);function bh(e){const{imageData:t}=Ce(e),n=(a,i,s)=>{const[r,l]=i,c=(l-r+1)/s,u=new Array(s).fill(0);return a.forEach(p=>u[Math.floor((p-r)/c)]++),u};return{autoRangeValues:w(()=>{if(!t.value)return{};const a=t.value.getPointData().getScalars(),{min:i,max:s}=Ro.fastComputeRange(a.getData(),0,1),l=n(a.getData(),[i,s],Ws).reduce((u,p,d)=>{const m=d!==0?u[d-1]:0;return u.push(p+m),u},[]),c=(s-i+1)/Ws;return Object.fromEntries(Object.entries(rr).map(([u,p])=>{const d=l.findIndex(y=>y>=p*.01*a.getData().length),m=l.findIndex(y=>y>=(1-p*.01)*a.getData().length),g=Math.max(i,i+c*d),A=Math.min(s,i+c*m+c);return[u,[g,A]]}))})}}function _h(e,t){const{imageData:n}=Ce(t),o=Se(),a=Fn(),{config:i}=jn(e,t),{autoRangeValues:s}=bh(t),r=w(()=>{var c;return((c=i.value)==null?void 0:c.auto)||uo}),l=w(()=>{const c=b(t);if(c&&Ge(c)){const u=c,p=Qr(o.volumeInfo[u]);if(p.length)return p[0]}});Ee(i,c=>{const u=n.value,p=b(t),d=b(e);if(c||!u||!p)return;const[m,g]=u.getPointData().getScalars().getRange();a.updateConfig(d,p,{min:m,max:g}),a.resetWindowLevel(d,p)}),Ee(n,c=>{const u=b(t),p=b(i),d=b(e);if(u==null||p!=null||!c)return;const[m,g]=s.value[r.value];a.updateConfig(d,u,{min:m,max:g});const A=b(l);A!=null&&A.width&&a.updateConfig(d,u,{preset:{width:A.width,level:A.level}});const y=a.runtimeConfigWindowLevel;y&&a.updateConfig(d,u,{preset:{...y}}),a.resetWindowLevel(d,u)}),X(r,c=>{const u=n.value,p=b(t),d=b(e);if(p==null||i.value==null||!u)return;const m=s.value[c];a.updateConfig(d,p,{min:m[0],max:m[1]}),a.resetWindowLevel(d,p)}),In().onClick(()=>{const c=b(t),u=b(e);c==null||i.value==null||a.resetWindowLevel(u,c)})}const Ih=1;function ba(e,t,n,o,a){const i=O(a??0);return ac([ht(n),ht(o),ht(e)],([s,,r],l,c)=>{if(!s||!r)return;const u=`set${fo(t)}Listener`,p=`remove${fo(t)}Listener`;r[u](s[0],s[1],b(o)??Ih,()=>i.value,d=>{i.value=d}),c(()=>{r[p]()})},{immediate:!0,compare:Yi}),i}const hc=F({__name:"VtkSliceViewWindowManipulator",props:{viewId:{},imageId:{},manipulatorConfig:{}},setup(e){const t=e,{viewId:n,imageId:o,manipulatorConfig:a}=ae(t),i=ge(ve);if(!i)throw new Error("No VtkView");const s=i.interactorStyle;if(!(s!=null&&s.isA("vtkInteractorStyleManipulator")))throw new Error("No vtkInteractorStyleManipulator");const r=w(()=>({button:1,dragEnabled:!0,scrollEnabled:!1,...a==null?void 0:a.value})),{instance:l}=xt(s,gr,r),c=jn(n,o);_h(n,o);const u=g=>Math.min(g[1]-g[0],1)/256,p=w(()=>u(c.range.value)),d=ba(l,"horizontal",c.range,p,c.level.value),m=ba(l,"vertical",w(()=>[1e-12,c.range.value[1]-c.range.value[0]]),p,c.width.value);return dn(d,c.level,{immediate:!0}),dn(m,c.width,{immediate:!0}),(g,A)=>se(g.$slots,"default")}}),vt=F({__name:"VtkMouseInteractionManipulator",props:{manipulatorConstructor:{},manipulatorProps:{}},setup(e,{expose:t}){const n=e,{manipulatorConstructor:o,manipulatorProps:a}=ae(n),i=ge(ve);if(!i)throw new Error("No VtkView");const s=i.interactorStyle;if(!(s!=null&&s.isA("vtkInteractorStyleManipulator")))throw new Error("No vtkInteractorStyleManipulator");const r=w(()=>({dragEnabled:!0,...a==null?void 0:a.value})),{instance:l}=xt(s,o,r);return t({manipulator:l}),(c,u)=>se(c.$slots,"default")}}),kh=e=>($e("data-v-5f5207f4"),e=e(),xe(),e),Dh={class:"vtk-container-wrapper",tabindex:"0"},Eh=kh(()=>_("div",{class:"vtk-gutter"},null,-1)),Rh={class:"vtk-container"},Vh={class:"vtk-sub-container"},Th=F({__name:"ObliqueSliceViewer",props:{viewDirection:{},viewUp:{},id:{},type:{}},setup(e){const t=e,n=O(),{id:o,type:a,viewDirection:i,viewUp:s}=ae(t),r=w(()=>Te(i.value));Ss(n),Ko(n,o,a);const{currentTool:l}=ye(Le()),c=w(()=>l.value===oe.WindowLevel?{button:1}:{button:-1}),{currentImageID:u,currentImageData:p,currentImageMetadata:d}=me(),m=ws(),{resliceCursor:g,resliceCursorState:A}=m,y=w(()=>dc(r.value));le(()=>{p.value&&g.setImage(p.value)});const h=he(A,{get:()=>A.getCenter(),set:V=>g.setCenter(V)}),S=he(A,"planes"),E=w(()=>S.value[y.value].normal);function k(V,T){if(!V||!T)return[0,1];const U=Ad.buildFromDegree().identity().rotateFromDirections(T,[1,0,0]),Q=V.map(N=>N.slice());Q.forEach(N=>U.apply(N));let Z=1/0,ee=-1/0;for(let N=0;N<8;N++){const j=Q[N][0];j>ee&&(ee=j),j<Z&&(Z=j)}return[Z,ee]}const R=w(()=>{const V=p.value,[T,U,Q,Z,ee,N]=(V==null?void 0:V.getExtent())??[0,1,0,1,0,1],j=[[T,Q,ee],[U,Q,ee],[T,Z,ee],[U,Z,ee],[T,Q,N],[U,Q,N],[T,Z,N],[U,Z,N]];return j.forEach(Y=>V==null?void 0:V.indexToWorld(Y,Y)),j}),D=w(()=>{const[...V]=E.value,T=k(R==null?void 0:R.value,V);return{min:T[0],max:T[1]}}),$=V=>{!n.value||!A.getImage()||g.updateCameraPoints(n.value.renderer,y.value,V,!1,!0)};function M(){if(!n.value)return;const V=d.value;m.resetReslicePlanes(V);const{worldBounds:T}=V;h.value=Ue.getCenter(T),A.placeWidget(T),n.value.resetCamera(),$(!1),n.value.requestRender()}In().onClick(M),ie(A,"onModified",As(()=>{$(!1)})),Ee(u,()=>{$(!0)});const x=w(()=>Xi([0,0,0],Rn[o.value],1/255));return(V,T)=>(C(),L("div",Dh,[Eh,_("div",Rh,[_("div",Vh,[f(mc,{class:"vtk-view",ref_key:"vtkView",ref:n,"data-testid":"vtk-view","view-id":V.id,"image-id":b(u),"view-direction":b(i),"view-up":b(s),"slice-range":D.value},{default:v(()=>[b(l)===b(oe).Pan?(C(),B(vt,{key:0,"manipulator-constructor":b(Nt),"manipulator-props":{button:1}},null,8,["manipulator-constructor"])):G("",!0),f(vt,{"manipulator-constructor":b(Nt),"manipulator-props":{button:1,shift:!0}},null,8,["manipulator-constructor"]),b(l)===b(oe).Zoom?(C(),B(vt,{key:1,"manipulator-constructor":b(mo),"manipulator-props":{button:1}},null,8,["manipulator-constructor"])):G("",!0),f(vt,{"manipulator-constructor":b(mo),"manipulator-props":{button:3}},null,8,["manipulator-constructor"]),f(hc,{"view-id":V.id,"image-id":b(u),"manipulator-config":c.value},null,8,["view-id","image-id","manipulator-config"]),f(vc,{"view-id":V.id,"image-id":b(u)},null,8,["view-id","image-id"]),f(cc,{"view-id":V.id,"image-id":b(u),"plane-normal":E.value,"plane-origin":b(h)},null,8,["view-id","image-id","plane-normal","plane-origin"]),f(uc,{"view-id":V.id,"image-id":b(u),"plane-normal":E.value,"plane-origin":b(h),thickness:4,color:x.value},null,8,["view-id","image-id","plane-normal","plane-origin","color"]),f(Zv,{"view-id":V.id,"view-direction":b(i)},null,8,["view-id","view-direction"]),se(V.$slots,"default",{},void 0,!0)]),_:3},8,["view-id","image-id","view-direction","view-up","slice-range"])])])]))}});const Ph=z(Th,[["__scopeId","data-v-5f5207f4"]]);function Cs(e,t){return qo({view:e,data:t,vtkActorClass:mr,vtkMapperClass:yd})}const Mh=F({__name:"VtkBaseSliceRepresentation",props:{viewId:{},imageId:{},axis:{}},setup(e,{expose:t}){const n=e,{viewId:o,imageId:a,axis:i}=ae(n),s=ge(ve);if(!s)throw new Error("No VtkView");const{metadata:r,imageData:l}=Ce(a),c=bt(o,a),u=jn(o,a),p=Cs(s,l);p.mapper.setResolveCoincidentTopologyToPolygonOffset(),p.mapper.setResolveCoincidentTopologyPolygonOffsetParameters(1,1),le(()=>{const{lpsOrientation:A}=r.value,y=A[i.value],h=[At.I,At.J,At.K][y];p.mapper.setSlicingMode(h)});const d=he(p.mapper,"slice");En(c.slice,d,{immediate:!0});const m=he(p.property,"colorLevel"),g=he(p.property,"colorWindow");return En(u.level,m,{immediate:!0}),En(u.width,g,{immediate:!0}),t(p),(A,y)=>se(A.$slots,"default")}}),Ii="segmentGroup",ki=()=>({outlineOpacity:1,outlineThickness:2}),bs=ce(`${Ii}Config`,()=>{const e=_e({}),t=(u,p)=>An(e,u,p),n=(u,p,d)=>{const m={...ki(),...t(u,p),...d};zt(e,u,p,m)},o=(u,p)=>n(u,p,ki()),a=u=>{delete e[u]},i=(u,p)=>{var d;p?(d=e[p])==null||delete d[u]:hn(e,u)},s=wn(e,Ii),r=(u,p)=>{Object.entries(p).forEach(([d,m])=>{m.segmentGroup&&n(u,d,m.segmentGroup)})},l=w(()=>{const u=Object.keys(e);if(u.length===0)return null;const p=u[0],d=Object.keys(e[p]);if(d.length===0)return null;const m=d[0];return e[p][m]});return{configs:e,getConfig:t,initConfig:o,updateConfig:n,removeView:a,removeData:i,serialize:s,deserialize:r,aConfig:l,updateAllConfigs:(u,p)=>{Object.keys(e).forEach(d=>{n(d,u,p)})}}}),Di=e=>{const t=bs(),n=w(()=>Object.keys(t.configs)),o=w(()=>n.value.map(s=>({config:t.getConfig(s,b(e)),viewID:s})));return{config:w(()=>o.value.find(({config:s})=>s)),updateConfig:s=>{o.value.forEach(({viewID:r})=>t.updateConfig(r,b(e),s))}}};function Oh(e,t){const n=Zt(),o=w(()=>n.getConfig(b(e),b(t)));Ee(o,a=>{if(a)return;const i=b(e),s=b(t);n.initConfig(i,s),n.updateBlendConfig(i,s,{opacity:.3})})}function Ac(e,t){Oh(e,t);const n=bs(),o=w(()=>n.getConfig(b(e),b(t)));Ee(o,a=>{if(a)return;const i=b(e),s=b(t);n.initConfig(i,s)})}const Lh=F({__name:"VtkSegmentationSliceRepresentation",props:{viewId:{},segmentationId:{},axis:{}},setup(e,{expose:t}){const n=e,{viewId:o,segmentationId:a,axis:i}=ae(n),s=ge(ve);if(!s)throw new Error("No VtkView");const r=et(),l=w(()=>r.metadataByID[a.value]),c=w(()=>r.dataIndex[a.value]);ie(c,"onModified",()=>{s.requestRender()});const u=Cs(s,c);u.property.setRGBTransferFunction(0,Nn.newInstance()),u.property.setScalarOpacity(0,Mo.newInstance()),u.property.setInterpolationType(wd.NEAREST),u.property.setUseLookupTableScalarRange(!0),u.mapper.setResolveCoincidentTopologyToPolygonOffset(),u.mapper.setResolveCoincidentTopologyPolygonOffsetParameters(-2,-2),Ac(o.value,a.value);const p=Zt(),d=w(()=>p.getConfig(o.value,a.value).blendConfig.visibility);le(()=>{u.actor.setVisibility(d.value)});const m=w(()=>p.getConfig(o.value,a.value).blendConfig.opacity);le(()=>{u.property.setOpacity(m.value)});const g=w(()=>{var D;return(D=l.value)==null?void 0:D.parentImage}),{metadata:A}=Ce(g);le(()=>{const{lpsOrientation:D}=A.value,$=D[i.value],M=[At.I,At.J,At.K][$];u.mapper.setSlicingMode(M)});const y=he(u.mapper,"slice"),{slice:h}=bt(o,g);dn(h,y,{immediate:!0}),le(()=>{const D=u.property.getRGBTransferFunction(0),$=u.property.getPiecewiseFunction(0);if(!D||!$)throw new Error("Missing transfer functions");D.removeAllPoints(),$.removeAllPoints();let M=0;if(!l.value)return;const{segments:x}=l.value;x.order.forEach(V=>{const T=x.byValue[V],U=T.color[0]||0,Q=T.color[1]||0,Z=T.color[2]||0,ee=T.visible&&T.color[3]||0;D.addRGBPoint(T.value,U/255,Q/255,Z/255),$.addPoint(T.value,ee/255),M=Math.max(M,T.value)}),D.addRGBPoint(0,0,0,0),$.addPoint(0,0),D.addRGBPoint(M+1,0,0,0),$.addPoint(M+1,0),u.property.modified()});const E=bs(),k=w(()=>E.getConfig(b(o),b(a))),R=w(()=>{var D;return((D=k.value)==null?void 0:D.outlineThickness)??2});return u.property.setUseLabelOutline(!0),u.property.setUseLookupTableScalarRange(!0),le(()=>{var D;u.property.setLabelOutlineOpacity(((D=k.value)==null?void 0:D.outlineOpacity)??1)}),le(()=>{if(!l.value)return;const D=R.value,{segments:$}=l.value,M=Math.max(...$.order),x=Array.from({length:M},(V,T)=>{const U=$.byValue[T+1];return(!U||U.visible)&&D||0});u.property.setLabelOutlineThickness(x)}),t(u),(D,$)=>se(D.$slots,"default")}});function Bh(e,t){const n=Zt(),o=w(()=>n.getConfig(b(e),b(t)));Ee(o,a=>{if(a)return;const i=b(e),s=b(t);n.resetColorPreset(i,s)})}function yc({props:{colorFunction:e,opacityFunction:t},cfun:n,ofun:o,componentIndex:a=-1}){a===-1?n.setVectorModeToMagnitude():(n.setVectorModeToComponent(),n.setVectorComponent(a));const i=at.getPresetByName(e.preset);i&&n.applyColorMap(i),n.setMappingRange(...e.mappingRange);const{mappingRange:s}=t;switch(o.setRange(...t.mappingRange),t.mode){case De.Mode.Gaussians:go.applyGaussianToPiecewiseFunction(t.gaussians,256,t.mappingRange,o);break;case De.Mode.Points:{const r=el(t.preset,t.mappingRange,t.shift,t.shiftAlpha);r&&Dp(o,r,s);break}case De.Mode.Nodes:{Ep(o,t.nodes,s);break}default:throw new Error("Invalid opacity function mode encountered")}}function $h(e,t,n){const o=w(()=>{var i;return(i=b(e))==null?void 0:i.transferFunction}),a=w(()=>{var i;return(i=b(e))==null?void 0:i.opacityFunction});le(()=>{const i=o.value,s=a.value;!i||!s||yc({props:{colorFunction:i,opacityFunction:s},cfun:b(t),ofun:b(n)})})}const xh=F({__name:"VtkLayerSliceRepresentation",props:{viewId:{},layerId:{},parentId:{},axis:{}},setup(e,{expose:t}){const n=e,{viewId:o,layerId:a,parentId:i,axis:s}=ae(n),r=ge(ve);if(!r)throw new Error("No VtkView");const l=Zt(),c=w(()=>l.getConfig(o.value,a.value)),u=st(),p=w(()=>u.layerImages[a.value]),d=Cs(r,p);d.property.setRGBTransferFunction(0,Nn.newInstance()),d.property.setScalarOpacity(0,Mo.newInstance()),d.property.setUseLookupTableScalarRange(!1),d.mapper.setResolveCoincidentTopologyToPolygonOffset(),d.mapper.setResolveCoincidentTopologyPolygonOffsetParameters(-4,-4);const{metadata:m}=Ce(i);le(()=>{const{lpsOrientation:h}=m.value,S=h[s.value],E=[At.I,At.J,At.K][S];d.mapper.setSlicingMode(E)});const g=he(d.mapper,"slice"),{slice:A}=bt(o,i);return dn(A,g,{immediate:!0}),Bh(o,a),le(()=>{const h=c.value;if(!h)return;const S=d.property.getRGBTransferFunction(0),E=d.property.getPiecewiseFunction(0);if(!S||!E)throw new Error("Missing transfer functions");yc({props:{colorFunction:h.transferFunction,opacityFunction:h.opacityFunction},cfun:S,ofun:E});const{opacityFunction:k}=h,{mappingRange:R}=k,D=R[1]-R[0],$=(R[1]+R[0])/2;d.property.setColorWindow(D),d.property.setColorLevel($),d.property.setOpacity(h.blendConfig.opacity)}),t(d),(h,S)=>se(h.$slots,"default")}});function Uh(e,t){const n=Ae(),o=w(()=>{const a=e.value;return a?!!n.dataIndex[a]:!1});return Pt(o,(a,i,s)=>{t({id:e.value,imageData:n.dataIndex[e.value]},void 0,s)})}function it(e,t){const{metadata:n}=Ce(t),{slice:o,config:a}=bt(e,t);return w(()=>{if(!a.value)return null;const{lpsOrientation:i}=n.value,{axisDirection:s}=a.value,r=Te(s),l=[0,0,0];return l[i[r]]=o.value,{axisName:r,axisIndex:i[r],slice:o.value,planeNormal:i[s],planeOrigin:l}})}function Nh(e){const t=O(null),n=()=>{var o;t.value=((o=b(e))==null?void 0:o.getContainer())??null};return ie(e,"onModified",n),n(),t}function Fh(e,t){const n=O([]),o=w(()=>{var r,l,c;return(c=(l=(r=b(t))==null?void 0:r.getRenderWindow())==null?void 0:l.getViews())==null?void 0:c[0]}),a=Nh(o),i=()=>{const r=b(e),l=b(t);r==null||!l||(n.value=r.map(c=>{const u=Xr(c,l);return[u[0]/devicePixelRatio,u[1]/devicePixelRatio]}))},s=w(()=>{var r;return(r=b(t))==null?void 0:r.getActiveCamera()});return Qt(a,i),le(i),ie(s,"onModified",i),i(),n}function Wh(e,t){const n=Fh(e,t);return w(()=>{var r,l;const a=n.value,i=b(t),s=(l=(r=i==null?void 0:i.getRenderWindow())==null?void 0:r.getViews())==null?void 0:l[0];if(i&&s){const[,c]=s.getViewportSize(i);return a.map(u=>[u[0],c/devicePixelRatio-u[1]])}return null})}const Hh=F({props:{line:{required:!0,type:Object},clickWidth:{default:20,type:Number},outOfBounds:{default:!1,type:Boolean}},setup(){const e=O("grab"),t=O(null),n=O(0);return{onPointer:(i,s)=>{var r,l;i?(r=t.value)==null||r.setPointerCapture(s.pointerId):(l=t.value)==null||l.releasePointerCapture(s.pointerId),e.value=i?"grabbing":"grab"},onHover:i=>{n.value=i?2:0},cursor:e,grabLineEl:t,focusWidth:n}}});const Gh=["x1","y1","x2","y2","stroke-width"],zh=["x1","y1","x2","y2","stroke-width","stroke-dasharray"],jh=["x1","y1","x2","y2","stroke-width"],Qh=["x1","y1","x2","y2","stroke-width"];function qh(e,t,n,o,a,i){return C(),L("g",null,[_("line",{x1:e.line.startEdge[0],y1:e.line.startEdge[1],x2:e.line.startCrop[0],y2:e.line.startCrop[1],"stroke-width":2+e.focusWidth,"stroke-dasharray":"6","stroke-linecap":"square",stroke:"rgba(200, 255, 0, 0.5)"},null,8,Gh),_("line",{x1:e.line.startCrop[0],y1:e.line.startCrop[1],x2:e.line.endCrop[0],y2:e.line.endCrop[1],"stroke-width":2+e.focusWidth,"stroke-dasharray":e.outOfBounds?6:"none","stroke-linecap":"butt",stroke:"rgb(200, 255, 0)"},null,8,zh),_("line",{x1:e.line.endCrop[0],y1:e.line.endCrop[1],x2:e.line.endEdge[0],y2:e.line.endEdge[1],"stroke-width":2+e.focusWidth,"stroke-dasharray":"6","stroke-linecap":"square",stroke:"rgba(200, 255, 0, 0.5)"},null,8,jh),_("line",ze({ref:"grabLineEl",class:"pointer-events-all",style:{cursor:e.cursor},onPointerenter:t[0]||(t[0]=s=>e.onHover(!0)),onPointerleave:t[1]||(t[1]=s=>e.onHover(!1)),onPointerdown:t[2]||(t[2]=s=>e.onPointer(!0,s)),onPointerup:t[3]||(t[3]=s=>e.onPointer(!1,s)),x1:e.line.startEdge[0],y1:e.line.startEdge[1],x2:e.line.endEdge[0],y2:e.line.endEdge[1],fill:"none","stroke-opacity":"0","stroke-dasharray":"none","stroke-width":Number(e.$attrs["stroke-width"]||0)+e.clickWidth||0},e.$attrs),null,16,Qh)])}const Kh=z(Hh,[["render",qh],["__scopeId","data-v-926e0a5c"]]);function Ei(e,t,n,o,a){const i=it(e,t);return w(()=>{const s=b(e),r=n.value,l=o.value,c=a.value,u=i.value;if(!s||!r||!u)return null;const p=u.axisName,[d]=Ua.filter(k=>k!==r&&k!==p),m=l[r],g=l[d],A=c[d],y=l[p],h=u.slice,S=h<y[0]||y[1]<h,E=k=>{const R=an(),D=an(),$=an(),M=an();return R[r]=m[k],D[r]=m[k],$[r]=m[k],M[r]=m[k],[R[d],M[d]]=A,[D[d],$[d]]=g,{startEdge:R,startCrop:D,endCrop:$,endEdge:M}};return{lowerLine:E(0),upperLine:E(1),outOfBounds:S}})}function Ri(e,t,n){const o=w(()=>{const i=e.value,{lpsOrientation:s,indexToWorld:r}=t.value;return i?[i.lowerLine.startEdge,i.lowerLine.startCrop,i.lowerLine.endCrop,i.lowerLine.endEdge,i.upperLine.startEdge,i.upperLine.startCrop,i.upperLine.endCrop,i.upperLine.endEdge].map(l=>{const c=[0,0,0];c[s.Sagittal]=l.Sagittal,c[s.Coronal]=l.Coronal,c[s.Axial]=l.Axial;const u=[0,0,0];return Je(u,c,r),u}):null}),a=Wh(o,n);return w(()=>{const i=e.value,s=a.value;return!i||!(s!=null&&s.length)?null:{lowerLine:{startEdge:s[0],startCrop:s[1],endCrop:s[2],endEdge:s[3]},upperLine:{startEdge:s[4],startCrop:s[5],endCrop:s[6],endEdge:s[7]},outOfBounds:i.outOfBounds}})}function Zh({mouseEventToLPSPoint:e,getCropEdgePos:t,setCropEdgePos:n}){const o=O(),a=O(),i=O(an()),s=O(0),r=ys(),l=Symbol("Crop2DRequestor");return{onPointerDown:(d,m,g)=>{const A=e(g);A&&(i.value=A,s.value=t(d,m),o.value=d,a.value=m,r.requestAnimation(l,{byViewType:["3D"]}))},onPointerMove:d=>{if(o.value==null||a.value==null)return;const m=o.value,g=e(d);if(!g)return;const A=g[m]-i.value[m];n(m,a.value,s.value+A)},onPointerUp:()=>{o.value=null,a.value=null,r.cancelAnimation(l)}}}const Yh=F({props:{viewId:{required:!0,type:String},imageId:String},components:{Crop2DLineHandle:Kh},setup(e){const{viewId:t,imageId:n}=ae(e),o=ge(ve);if(!o)throw new Error("No VtkView");const{extent:a,metadata:i}=Ce(n),s=it(t,n),r=w(()=>{var k;return((k=s.value)==null?void 0:k.axisName)??null}),l=Sn(),c=w(()=>{const k=n.value;return k&&k in l.croppingByImageID?l.croppingByImageID[k]:Mr()}),u=w(()=>Ua.filter(k=>r.value&&k!==r.value)),p=w(()=>u.value[0]??null),d=w(()=>u.value[1]??null),m=Ei(t,n,p,c,a),g=Ei(t,n,d,c,a),A=Ri(m,i,o.renderer),y=Ri(g,i,o.renderer),{onPointerDown:h,onPointerMove:S,onPointerUp:E}=Zh({mouseEventToLPSPoint(k){const R=s.value;if(!R)return null;const{lpsOrientation:D,worldToIndex:$}=i.value,M=Ip(k,o.renderer,R.planeOrigin,R.planeNormal);if(!M)return null;Je(M,M,$);const x=an();return x.Sagittal=M[D.Sagittal],x.Coronal=M[D.Coronal],x.Axial=M[D.Axial],x},getCropEdgePos(k,R){return c.value[k][R]},setCropEdgePos(k,R,D){if(!n.value)return;const $=c.value,[M,x]=$[k],[V,T]=a.value[k],U=[M,x];R===0?U[0]=Math.max(V,Math.min(D,x)):R===1&&(U[1]=Math.max(M,Math.min(D,T))),l.setCroppingForAxis(n.value,k,U)}});return{ax1:w(()=>({name:p.value,lines:A.value})),ax2:w(()=>({name:d.value,lines:y.value})),onPointerDown:h,onPointerMove:S,onPointerUp:E}}});function Jh(e,t,n,o,a,i){const s=q("crop-2D-line-handle");return C(),L("g",null,[e.ax1.lines!=null?(C(),L(ne,{key:0},[f(s,{line:e.ax1.lines.lowerLine,"out-of-bounds":e.ax1.lines.outOfBounds,onPointerdown:t[0]||(t[0]=J(r=>e.onPointerDown(e.ax1.name,0,r),["stop"])),onPointermove:J(e.onPointerMove,["stop"]),onPointerup:J(e.onPointerUp,["stop"])},null,8,["line","out-of-bounds","onPointermove","onPointerup"]),f(s,{line:e.ax1.lines.upperLine,"out-of-bounds":e.ax1.lines.outOfBounds,onPointerdown:t[1]||(t[1]=J(r=>e.onPointerDown(e.ax1.name,1,r),["stop"])),onPointermove:J(e.onPointerMove,["stop"]),onPointerup:J(e.onPointerUp,["stop"])},null,8,["line","out-of-bounds","onPointermove","onPointerup"])],64)):G("",!0),e.ax2.lines!=null?(C(),L(ne,{key:1},[f(s,{line:e.ax2.lines.lowerLine,"out-of-bounds":e.ax2.lines.outOfBounds,onPointerdown:t[2]||(t[2]=J(r=>e.onPointerDown(e.ax2.name,0,r),["stop"])),onPointermove:J(e.onPointerMove,["stop"]),onPointerup:J(e.onPointerUp,["stop"])},null,8,["line","out-of-bounds","onPointermove","onPointerup"]),f(s,{line:e.ax2.lines.upperLine,"out-of-bounds":e.ax2.lines.outOfBounds,onPointerdown:t[3]||(t[3]=J(r=>e.onPointerDown(e.ax2.name,1,r),["stop"])),onPointermove:J(e.onPointerMove,["stop"]),onPointerup:J(e.onPointerUp,["stop"])},null,8,["line","out-of-bounds","onPointermove","onPointerup"])],64)):G("",!0)])}const Xh=z(Yh,[["render",Jh],["__scopeId","data-v-3dc0596f"]]);function eA(e){return e.Sagittal[0]<=e.Sagittal[1]&&e.Coronal[0]<=e.Coronal[1]&&e.Axial[0]<=e.Axial[1]}function tA(e,t){return e.Axial[0]===t.Axial[0]&&e.Axial[1]===t.Axial[1]&&e.Sagittal[0]===t.Sagittal[0]&&e.Sagittal[1]===t.Sagittal[1]&&e.Coronal[0]===t.Coronal[0]&&e.Coronal[1]===t.Coronal[1]}const nA=F({props:{imageId:String},setup(e){const t=ge(ve);if(!t)throw new Error("No VtkView");const{widgetManager:n}=t,{imageId:o}=ae(e),a=Sn(),i=w(()=>{const p=o.value;return p&&p in a.croppingByImageID?a.croppingByImageID[p]:null}),s=Sd.newInstance(),r=s.getWidgetState();s.setEdgeHandlesEnabled(!1),s.setFaceHandlesEnabled(!0),s.setCornerHandlesEnabled(!0),n.addWidget(s).getRepresentations().forEach(p=>{p.getActors().forEach(d=>{d.getProperty().setAmbient(1)})}),Ut(()=>{n.removeWidget(s)});const{metadata:c}=Ce(o);Ee(c,p=>{r.setWorldToIndexT(p.worldToIndex),r.setIndexToWorldT(p.indexToWorld),r.placeWidget(p.worldBounds)});const u=p=>{const{lpsOrientation:d}=c.value,m=[0,0,0,0,0,0];Ua.forEach(g=>{[m[d[g]*2],m[d[g]*2+1]]=p[g]}),Wd(m,r.getCroppingPlanes().getPlanes())||(r.getCroppingPlanes().setPlanes(m),t.requestRender())};return Ee(i,p=>{p&&u(p)}),ie(r.getCroppingPlanes(),"onModified",()=>{const p=o.value;if(!p)return;const d=r.getCroppingPlanes().getPlanes(),{lpsOrientation:m}=c.value,g={Sagittal:yt(d,"Sagittal",m),Coronal:yt(d,"Coronal",m),Axial:yt(d,"Axial",m)},A=i.value;A&&tA(g,A)||(eA(g)?a.setCropping(p,g):A&&u(A))}),()=>null}}),oA=F({props:{viewId:{type:String,required:!0},imageId:String},components:{Crop2D:Xh,Crop3D:nA},setup(e){const{viewId:t,imageId:n}=ae(e),o=Sn(),a=Le(),i=w(()=>a.currentTool===oe.Crop);Uh(n,({id:r})=>{r&&!(r in o.croppingByImageID)&&o.resetCropping(r)});const s=w(()=>Me().viewSpecs[t.value].viewType);return{active:i,viewType:s}}});const aA={class:"overlay-no-events"};function sA(e,t,n,o,a,i){const s=q("crop-2D"),r=q("crop-3D");return C(),L("svg",aA,[e.active&&e.viewType==="2D"?(C(),B(s,{key:0,"view-id":e.viewId,"image-id":e.imageId},null,8,["view-id","image-id"])):G("",!0),e.active&&e.viewType==="3D"?(C(),B(r,{key:1,"view-id":e.viewId,"image-id":e.imageId},null,8,["view-id","image-id"])):G("",!0)])}const wc=z(oA,[["render",sA],["__scopeId","data-v-3a4f6e08"]]);function Qn(e,t,n,o){const{lpsOrientation:a}=o,i=a[Te(t)],s=a[t],r=[0,0,0];r[i]=n,Je(r,r,o.indexToWorld),e.setUserNormal(s),e.setUserOrigin(r)}const iA=F({name:"CrosshairsWidget2D",props:{viewId:{type:String,required:!0},viewDirection:{type:String,required:!0},imageId:String},setup(e){const{viewDirection:t,imageId:n,viewId:o}=ae(e),a=ge(ve);if(!a)throw new Error("No VtkView");const i=it(o,n),s=w(()=>{var d;return(d=i.value)==null?void 0:d.slice}),l=Xa().getWidgetFactory(),c=a.widgetManager.addWidget(l);Xe(()=>{a.widgetManager.removeWidget(l)});const u=Ct.newInstance();c.setManipulator(u);const{metadata:p}=Ce(n);return le(()=>{s.value!=null&&Qn(u,t.value,s.value,p.value)}),c.setVisibility(!0),dt(()=>{a.widgetManager.renderWidgets()}),()=>null}}),rA=F({props:{position:Array},setup(e){const{position:t}=ae(e),n=O(),o=ge(ve);if(!o)throw new Error("No VtkView");const a=()=>{const r=o.renderer,l=b(t);if(l){const c=Et(l,r);c&&(n.value={x:c[0],y:c[1]})}},i=he(o.renderer,"activeCamera");ie(i,"onModified",a),le(a);const s=he(o.renderWindowView,"container");return Qt(s,()=>{a()}),{x:w(()=>{var r;return(r=n.value)==null?void 0:r.x}),y:w(()=>{var r;return(r=n.value)==null?void 0:r.y})}}});const lA=["x1","x2","y2"],cA=["x1","y1","x2"],uA=["y1","x2","y2"],dA=["x1","y1","y2"];function pA(e,t,n,o,a,i){return C(),L("g",null,[e.x!=null&&e.y!=null?(C(),L("line",{key:0,x1:e.x,y1:"0%",x2:e.x,y2:e.y-8,stroke:"yellow","stroke-width":"1"},null,8,lA)):G("",!0),e.x!=null&&e.y!=null?(C(),L("line",{key:1,x1:e.x,y1:e.y+8,x2:e.x,y2:"100%",stroke:"yellow","stroke-width":"1"},null,8,cA)):G("",!0),e.x!=null&&e.y!=null?(C(),L("line",{key:2,x1:"0%",y1:e.y,x2:e.x-8,y2:e.y,stroke:"yellow","stroke-width":"1"},null,8,uA)):G("",!0),e.x!=null&&e.y!=null?(C(),L("line",{key:3,x1:e.x+8,y1:e.y,x2:"100%",y2:e.y,stroke:"yellow","stroke-width":"1"},null,8,dA)):G("",!0)])}const fA=z(rA,[["render",pA],["__scopeId","data-v-582a6418"]]),mA=F({name:"CrosshairsTool",props:{viewId:{type:String,required:!0},viewDirection:{type:String,required:!0},imageId:String},components:{CrosshairsWidget2D:iA,CrosshairSVG2D:fA},setup(e){const{viewId:t,imageId:n,viewDirection:o}=ae(e),a=Le(),{position:i,imagePosition:s}=ye(Xa()),r=it(t,n),{currentImageMetadata:l}=me(),c=w(()=>a.currentTool===oe.Crosshairs),u=w(()=>{if(!r.value)return!1;const{lpsOrientation:p,dimensions:d}=l.value,m=Te(o.value),g=p[m],A=kr(s.value[g],0,d[g]-1);return Math.round(A)===r.value.slice});return{active:c,position:i,isVisible:u}}});const gA={key:0,class:"overlay-no-events"},vA={class:"overlay-no-events"};function hA(e,t,n,o,a,i){const s=q("CrosshairSVG2D"),r=q("CrosshairsWidget2D");return e.active?(C(),L("div",gA,[(C(),L("svg",vA,[Vt(f(s,{position:e.position},null,8,["position"]),[[Tt,e.isVisible]])])),f(r,{"image-id":e.imageId,"view-id":e.viewId,"view-direction":e.viewDirection},null,8,["image-id","view-id","view-direction"])])):G("",!0)}const AA=z(mA,[["render",hA],["__scopeId","data-v-4bb77cc1"]]),yA=F({name:"PaintWidget2D",props:{viewId:{type:String,required:!0},viewDirection:{type:String,required:!0},imageId:String},setup(e){const{viewDirection:t,viewId:n,imageId:o}=ae(e),a=ge(ve);if(!a)throw new Error("No VtkView");const i=it(n,o),s=w(()=>{var h;return(h=i.value)==null?void 0:h.slice}),r=Rt(),l=r.getWidgetFactory(),c=l.getWidgetState(),{metadata:u}=Ce(o),p=w(()=>Te(t.value)),d=w(()=>u.value.lpsOrientation[p.value]),m=h=>{const{worldToIndex:S}=u.value,E=ln();return Je(E,h,S),E},g=a.widgetManager.addWidget(l);dt(()=>{a.widgetManager.renderWidgets(),a.widgetManager.grabFocus(g)}),Xe(()=>{a.widgetManager.removeWidget(l)}),le(()=>{const h=u.value,S=h.lpsOrientation[p.value];g&&(g.setSlicingIndex(S),g.setIndexToWorld(h.indexToWorld),g.setWorldToIndex(h.worldToIndex))}),ie(g,"onStartInteractionEvent",()=>{const h=m(c.getBrush().getOrigin());r.startStroke(h,d.value)}),ie(g,"onInteractionEvent",()=>{const h=m(c.getBrush().getOrigin());r.placeStrokePoint(h,d.value)}),ie(g,"onEndInteractionEvent",()=>{const h=m(c.getBrush().getOrigin());r.endStroke(h,d.value)});const A=Ct.newInstance();g.setManipulator(A),le(()=>{s.value!=null&&Qn(A,t.value,s.value,u.value)});let y=!1;return dt(()=>{g.setVisibility(!1),y=!0}),ie(a.interactor,"onMouseMove",()=>{y&&(y=!1,g.setVisibility(!0),r.setSliceAxis(d.value))}),ie(a.interactor,"onMouseEnter",()=>{r.setSliceAxis(d.value),g.setVisibility(!0)}),ie(a.interactor,"onMouseLeave",()=>{g.setVisibility(!1)}),()=>null}}),wA=F({name:"PaintTool",props:{viewId:{type:String,required:!0},viewDirection:{type:String,required:!0},imageId:String},components:{PaintWidget2D:yA},setup(){const e=Rt();return{active:w(()=>e.isActive)}}});const SA={class:"overlay-no-events"};function CA(e,t,n,o,a,i){const s=q("PaintWidget2D");return C(),L("div",SA,[e.active?(C(),B(s,{key:0,"view-id":e.viewId,"image-id":e.imageId,"view-direction":e.viewDirection},null,8,["view-id","image-id","view-direction"])):G("",!0)])}const bA=z(wA,[["render",CA],["__scopeId","data-v-3dfb5ef4"]]),_A=e=>{const t=O(!0),n=vu(()=>{t.value=!0},e);return{isSet:t,reset:()=>{t.value=!1,n()}}},IA=250,Sc=(e,t,n)=>{if(!t.frameOfReference)return!1;const o=xo(t.frameOfReference,b(n),{allowOutOfBoundsSlice:!0});return!!o&&o.axis===b(e)},_s=(e,t)=>{const{currentImageID:n,currentImageMetadata:o}=me();return w(()=>{const a=n.value;return e.tools.filter(i=>i.imageID===a&&Sc(t,i,o)&&!i.hidden)})},Is=()=>{const e=O(null);return{contextMenu:e,openContextMenu:(n,o)=>{if(!e.value)throw new Error("contextMenu component does not exist");e.value.open(n,o)}}},ks=(e,t)=>{ie(t,"onRightClickEvent",n=>{const o=qa(n);o&&e("contextmenu",{displayXY:o,widgetActions:n.widgetActions})})},Cc=(e,t)=>{ie(t,"onHoverEvent",n=>{const o=qa(n);o&&e("widgetHover",{displayXY:o,hovering:n.hovering})})},Ds=(e,t)=>{const n=O({}),o=w(()=>e.value.filter(p=>p.slice===t.value));X(o,()=>{n.value=o.value.reduce((p,{id:d})=>{const m=n.value[d]??{visible:!1};return Object.assign(p,{[d]:m})},{})});const a=(p,d)=>{n.value[p]=d.hovering?{visible:!0,toolID:p,displayXY:d.displayXY}:{visible:!1}},i=w(()=>{const p=Object.keys(n.value).find(d=>n.value[d].visible);return p?n.value[p]:{visible:!1}}),{isSet:s,reset:r}=_A(IA);X(i,r);const l=w(()=>s.value?i.value:{visible:!1}),c=Le();return{overlayInfo:w(()=>c.currentTool!==oe.Select?{visible:!1}:l.value),onHover:a}},Es=(e,t)=>{const n=O(null),o=()=>{const s=n.value;s&&(e.updateTool(s,{placing:!1}),n.value=null)},a=()=>{if(n.value)throw new Error("Placing tool already exists.");n.value=e.addTool({...t.value,placing:!0})},i=()=>{const s=n.value;s&&(e.removeTool(s),n.value=null)};return X(t,()=>{n.value&&e.updateTool(n.value,t.value)}),{id:Gi(n),commit:o,add:a,remove:i}},Rs=(e,t,n)=>{Ee(()=>t.value,o=>{e.setVisibility(o)}),dt(()=>{e.setHandleVisibility(!1),n.widgetManager.renderWidgets(),n.requestRender()})},kA=F({__name:"AnnotationContextMenu",props:{toolStore:{}},setup(e,{expose:t}){const n=e,o=hu({show:!1,x:0,y:0,forToolID:"",widgetActions:[]});t({open:(l,c)=>{const{displayXY:u}=c;[o.x,o.y]=u,o.forToolID=l,o.show=!0,o.widgetActions=c.widgetActions}});const i=w(()=>n.toolStore.toolByID[o.forToolID]),s=()=>{n.toolStore.removeTool(o.forToolID)},r=()=>{n.toolStore.updateTool(o.forToolID,{hidden:!0})};return(l,c)=>i.value?(C(),B(Mt,{key:0,modelValue:b(o).show,"onUpdate:modelValue":c[0]||(c[0]=u=>b(o).show=u),class:"position-absolute",style:nt({top:`${b(o).y}px`,left:`${b(o).x}px`}),"close-on-click":"","close-on-content-click":""},{default:v(()=>[f(It,{density:"compact"},{default:v(()=>[f(ke,null,{prepend:v(()=>[_("div",{class:"color-dot v-icon",style:nt({backgroundColor:i.value.color})},null,4)]),default:v(()=>[f(Be,{class:"v-list-item--disabled"},{default:v(()=>[P(H(i.value.labelName),1)]),_:1})]),_:1}),f(Re),f(ke,{onClick:r},{prepend:v(()=>[f(K,null,{default:v(()=>[P("mdi-eye")]),_:1})]),default:v(()=>[f(Be,null,{default:v(()=>[P("Hide")]),_:1})]),_:1}),f(ke,{onClick:s},{prepend:v(()=>[f(K,null,{default:v(()=>[P("mdi-delete")]),_:1})]),default:v(()=>[f(Be,null,{default:v(()=>[P("Delete Annotation")]),_:1})]),_:1}),se(l.$slots,"default",{},void 0,!0),(C(!0),L(ne,null,de(b(o).widgetActions,u=>(C(),B(ke,{onClick:u.func,key:u.name},{prepend:v(()=>[f(K)]),default:v(()=>[f(Be,null,{default:v(()=>[P(H(u.name),1)]),_:2},1024)]),_:2},1032,["onClick"]))),128))]),_:3})]),_:3},8,["modelValue","style"])):G("",!0)}});const Vs=z(kA,[["__scopeId","data-v-649873bf"]]),DA=30,EA=20,RA=F({__name:"AnnotationInfo",props:{info:{},toolStore:{}},setup(e){const t=e,n=w(()=>t.info.visible),o=w(()=>t.info.visible?t.toolStore.toolByID[t.info.toolID].labelName:""),a=O(),i=w(()=>{var c;return(c=a.value)==null?void 0:c.contentEl}),{width:s,height:r}=Zi(i),l=w(()=>({x:(s.value+DA)/2,y:r.value+EA}));return(c,u)=>c.info.visible?(C(),B(fe,{key:0,ref_key:"tooltip",ref:a,modelValue:n.value,"onUpdate:modelValue":u[0]||(u[0]=p=>n.value=p),style:nt({left:`${c.info.displayXY[0]-l.value.x}px`,top:`${c.info.displayXY[1]-l.value.y}px`,zIndex:500}),class:"better-contrast"},{default:v(()=>[P(H(o.value),1)]),_:1},8,["modelValue","style"])):G("",!0)}});const Ts=z(RA,[["__scopeId","data-v-9b14ee00"]]);function Ps(e,t,n){const o=w(()=>Te(b(e)));return w(()=>{const{lpsOrientation:a,indexToWorld:i}=b(n),s=a[b(e)],r=a[o.value],l=[0,0,0];return l[r]=b(t),Je(l,l,i),{planeNormal:s,planeOrigin:l}})}function VA(e,t){t.classHierarchy.push("vtkLineGlyphRepresentation"),e.setGlyphResolution=W.chain(e.setGlyphResolution,t._pipeline.glyph.setResolution)}function Vi(e,t){return(n,o)=>{var s;t._pipeline.mapper.setScaleArray("scale"),t._pipeline.mapper.setScaleFactor(1),t._pipeline.mapper.setScaling(!0),t._pipeline.mapper.setScaleMode(_d.ScaleModes.SCALE_BY_COMPONENTS);const a=vr(n,"scale",o.length,"Float32Array",3).getData();let i=0;for(let r=0;r<o.length;++r){const l=o[r],c=l.getOrigin(),u=o[r===o.length-1?0:r+1].getOrigin(),p=hr(u,c,[]),d=Ar(p);let m=l.getActive()?t.activeScaleFactor:1;e.getScaleInPixels()&&(m*=Id(l.getOrigin(),t.displayScaleParams)),t.forceLineThickness||(m*=((s=l.getScale1)==null?void 0:s.call(l))??1);const g=[1,t.lineThickness,t.lineThickness];a[i++]=d*g[0],a[i++]=m*g[1],a[i++]=m*g[2]}}}function TA(e,t){return(n,o)=>{t._pipeline.mapper.setOrientationArray("orientation"),t._pipeline.mapper.setOrientationMode(kd.MATRIX);const a=vr(n,"orientation",o.length,"Float32Array",9).getData();for(let i=0;i<o.length;++i){const r=o[i].getOrigin(),l=o[i===o.length-1?0:i+1].getOrigin(),c=hr(l,r,[]);Ar(c);const u=[1,0,0],p=[0,1,0];Dd(c,p,u,0),a.set(c,9*i),a.set(p,9*i+3),a.set(u,9*i+6)}}}function PA(e,t,n){var o;return{behavior:La.CONTEXT,glyphResolution:32,lineThickness:.5,forceLineThickness:!1,...n,_pipeline:{glyph:((o=n==null?void 0:n.pipeline)==null?void 0:o.glyph)??bd.newInstance({direction:[1,0,0],center:[.5,0,0],capping:!1}),...n==null?void 0:n.pipeline},applyMixin:{noScale:Vi(e,t),scale1:Vi(e,t),noOrientation:TA(e,t)}}}function bc(e,t,n={}){Cd.extend(e,t,PA(e,t,n)),W.setGet(e,t,["glyphResolution","lineThickness","forceLineThickness"]),W.get(e,t._pipeline,["glyph","mapper","actor"]),VA(e,t)}const MA=W.newInstance(bc,"vtkLineGlyphRepresentation"),Ms={newInstance:MA,extend:bc},OA=10,LA=OA**2,BA=300,$A=10,xA=$A**2;function UA(e,t){t.classHierarchy.push("vtkPolygonWidgetBehavior");const n=h=>{t._dragging=h,e.invokeDraggingEvent({dragging:h})};let o=!1,a=!1;const i=()=>{var E;const h=t._widgetManager.getSelections();return((E=h==null?void 0:h[0])==null?void 0:E.getProperties().prop)===t.representations[1].getActors()[0]&&!o};W.setGet(e,t,["manipulator"]),W.event(e,t,"RightClickEvent"),W.event(e,t,"PlacedEvent"),W.event(e,t,"HoverEvent"),W.event(e,t,"DraggingEvent"),e.resetInteractions=()=>{t._interactor.cancelAnimation(e,!0)};const s=()=>{e.loseFocus(),t.widgetState.clearHandles()},r=()=>{const h=t.widgetState.getHandles();h.length>0&&(t.widgetState.removeHandle(h.length-1),h.length===0&&s())},l=()=>{t.widgetState.setPlacing(!1),e.loseFocus(),e.invokePlacedEvent()};function c(){const h=t.widgetState.getHandles(),S=t.widgetState.getMoveHandle();if(t.activeState===S&&h.length>=3){const E=t._apiSpecificRenderWindow.worldToDisplay(...S.getOrigin(),t._renderer),k=t._apiSpecificRenderWindow.worldToDisplay(...h[0].getOrigin(),t._renderer);if(!E||!k)return!1;const R=LA*t._apiSpecificRenderWindow.getComputedDevicePixelRatio();return po(k,E)<R}return!1}const u=es(t);function p(h){const S=u(h);return S!=null&&S.length&&(t.activeState===t.widgetState.getMoveHandle()||t._dragging)?(t.activeState.setOrigin(S),t.widgetState.setFinishable(c()),t.widgetState.getFinishable()&&t.activeState.setOrigin(t.widgetState.getHandles()[0].getOrigin()),e.invokeInteractionEvent(),W.EVENT_ABORT):W.VOID}function d(){const h=t.widgetState.getMoveHandle();t.widgetState.addHandle().setOrigin(h.getOrigin())}e.handleLeftButtonPress=h=>{var k,R,D;const S=t._widgetManager.getActiveWidget();if(!t.manipulator||S&&S!==e)return W.VOID;if(i())return W.VOID;const E=((R=(k=t.activeState)==null?void 0:k.getManipulator)==null?void 0:R.call(k))??t.manipulator;return t.widgetState.getPlacing()&&E?(t.widgetState.getHandles().length===0&&(t.activeState=t.widgetState.getMoveHandle(),t._widgetManager.grabFocus(e)),p(h),t.widgetState.getFinishable()?(l(),W.EVENT_ABORT):(d(),e.invokeStartInteractionEvent(),a=!0,W.EVENT_ABORT)):(D=t.activeState)!=null&&D.getActive()&&t.pickable&&t.dragable?(n(!0),t._apiSpecificRenderWindow.setCursor("grabbing"),t._interactor.requestAnimation(e),e.invokeStartInteractionEvent(),W.EVENT_ABORT):W.VOID},e.handleMouseMove=h=>t.pickable&&t.dragable&&t.activeState&&p(h)===W.EVENT_ABORT?(a&&d(),W.EVENT_ABORT):(o=!1,t.hasFocus&&t._widgetManager.disablePicking(),e.invokeHoverEvent({...h,hovering:!!t.activeState}),W.VOID);let m=0,g;function A(h){const S=Date.now(),E=[h.position.x,h.position.y,h.position.z],k=S-m,R=g?po([h.position.x,h.position.y,h.position.z],g):Number.POSITIVE_INFINITY,D=k<BA&&R<xA;return m=S,g=E,D}e.handleLeftButtonRelease=h=>!t.activeState||!t.activeState.getActive()||!t.pickable?W.VOID:(a=!1,t._dragging?(t._apiSpecificRenderWindow.setCursor("pointer"),t._interactor.cancelAnimation(e),n(!1),t._widgetManager.enablePicking(),e.invokeEndInteractionEvent(),W.EVENT_ABORT):t.widgetState.getPlacing()?(t.widgetState.getFinishable()?l():A(h)&&t.widgetState.getHandles().length>=4&&(r(),l()),(t.hasFocus&&!t.activeState||t.activeState&&!t.activeState.getActive())&&(t._widgetManager.enablePicking(),t._interactor.render()),e.invokeEndInteractionEvent(),W.EVENT_ABORT):W.VOID),e.handleKeyDown=({key:h})=>t.widgetState.getPlacing()&&h==="Escape"?(s(),W.EVENT_ABORT):t.widgetState.getPlacing()&&h==="Enter"?(t.widgetState.getHandles().length>=3&&l(),W.EVENT_ABORT):W.VOID,e.deactivateAllHandles=()=>{t.widgetState.deactivate(),t.activeState=null};const y=h=>{const S=[],{activeState:E}=t,k=i();return k?S.push({name:"Add Point",func:()=>{const R=E.getIndex()+1,D=t.widgetState.addHandle({insertIndex:R}),$=u(h);if(!$)throw new Error("No world coords");D.setOrigin($),e.activateHandle({selectedState:D,representation:t.representations[0].getActors()[0]})}}):!k&&t.widgetState.getHandles().length>2&&S.push({name:"Delete Point",func:()=>{t.widgetState.removeHandle(E.getIndex())}}),S};e.handleRightButtonPress=h=>{if(!t.activeState)return W.VOID;if(t.widgetState.getPlacing())return r(),W.EVENT_ABORT;const S={...h,widgetActions:y(h)};return e.invokeRightClickEvent(S),W.EVENT_ABORT},e.grabFocus=()=>{t.hasFocus||(t.activeState=t.widgetState.getMoveHandle(),t.activeState.activate(),t.activeState.setVisible(!0),t._interactor.requestAnimation(e),e.invokeStartInteractionEvent()),t.hasFocus=!0},e.loseFocus=()=>{t.hasFocus&&(t._interactor.cancelAnimation(e),e.invokeEndInteractionEvent()),t.widgetState.deactivate(),t.widgetState.getMoveHandle().deactivate(),t.widgetState.getMoveHandle().setVisible(!1),t.widgetState.getMoveHandle().setOrigin(null),t.activeState=null,t.hasFocus=!1,t._widgetManager.enablePicking()},e.delete=W.chain(()=>{e.resetInteractions()},e.delete)}function NA(e,t,n){Ba.extend(e,t,n),W.get(e,t,["id","toolType"]),e.getStore=()=>Tn(t.toolType)}const _c={extend:NA},FA=xu*2;function WA(e,t,{id:n,store:o,key:a,visible:i=!0}){Object.assign(t,{id:n,_store:o,key:a}),Ba.extend(e,t,{}),yr.extend(e,t,{visible:i}),wr.extend(e,t,{scale1:FA});const s=()=>t._store.toolByID[t.id],r=l=>t._store.updateTool(t.id,l);e.getOrigin=()=>{var l;return un((l=s())==null?void 0:l[t.key])},e.setOrigin=l=>{r({[t.key]:l}),e.modified()},df(e,t._store,()=>{var l;return(l=s())==null?void 0:l[t.key]})}const _a=W.newInstance(WA,"vtkPointWidgetState"),HA=.1;function GA(e,t=HA){const n=e.length;if(n<3)return e;const o=t*t,a=[[0,n-1]],i=new Array(n).fill(!1);let s=2;for(i[0]=!0,i[n-1]=!0;a.length;){const[l,c]=a.pop();if(c-l===1)continue;const u=e[l],p=e[c];let d=-1/0,m=-1;for(let g=l+1;g<c;g++){const A=e[g],{distance:y}=Ed.distanceToLine(A,u,p);y>d&&(d=y,m=g)}d<o||(i[m]=!0,s++,a.push([m,c]),a.push([l,m]))}const r=new Array(s);for(let l=0,c=0;l<n;l++)i[l]&&(r[c++]=e[l]);return r}const Ic="moveHandle",Mn="handles",zA=20,jA=.2;function QA(e,t){t.classHierarchy.push("vtkPolygonWidgetState"),t.moveHandle=_a({id:t.id,store:e.getStore(),key:"movePoint",visible:!0}),Sa(e,t.moveHandle,()=>e.modified());const n=()=>e.getStore().toolByID[t.id];t.handles=[],t.labels={[Ic]:[t.moveHandle],[Mn]:[]},t.finishable=!1,e.addHandle=({insertIndex:a=-1,addPoint:i=!0}={})=>{const s=a===-1?t.handles.length:a;i&&n().points.splice(s,0,[0,0,0]);const r={index:s},l={getOrigin:()=>{var u;return(u=n())==null?void 0:u.points[r.index]},setOrigin:u=>{n().points[r.index]=u,e.modified()},getIndex:()=>r.index,setIndex:u=>{r.index=u}};Ba.extend(l,r,{}),yr.extend(l,r,{visible:!0}),wr.extend(l,r,{scale1:zA}),r.classHierarchy.push("vtkPolygonHandleState"),t.handles.splice(s,0,l);for(let u=s+1;u<t.handles.length;u++)t.handles[u].setIndex(u);return e.bindState(l,[Mn]),t.labels[Mn]=[...t.handles],e.modified(),l},e.removeHandle=a=>{const i=t.handles[a];e.unbindState(i),t.handles.splice(a,1);for(let r=a;r<t.handles.length;r++)t.handles[r].setIndex(r);const s=n();s&&s.points.splice(a,1),e.modified()},e.clearHandles=()=>{for(;t.handles.length;)e.removeHandle(t.handles.length-1)};const o=()=>{n().points.forEach(a=>{e.addHandle({addPoint:!1}).setOrigin(a)})};e.getPlacing=()=>n().placing,e.setPlacing=a=>{const i=n();if(i.placing=a,a)return;const s=Jr(i.imageID),r=bf(i.frameOfReference,s),l=GA(i.points,r*jA);e.clearHandles(),i.points=l,o()},o()}const qA=e=>({toolType:tt.Polygon,...e});function KA(e,t,n){Object.assign(t,qA(n)),_c.extend(e,t,n),Sr.extend(e,t),W.get(e,t,["handles","moveHandle","finishable"]),W.setGet(e,t,["finishable"]),QA(e,t)}const ZA=W.newInstance(KA,"vtkPolygonWidgetState");function YA(e,t){t.classHierarchy.push("vtkPolygonWidget"),e.getRepresentationsForViewType=()=>[{builder:Cr,labels:[Mn,Ic],initialValues:{scaleInPixels:!0}},{builder:Ms,labels:[Mn],initialValues:{scaleInPixels:!0,lineThickness:.25,behavior:La.HANDLE}}],t.manipulator=Ct.newInstance()}const JA={};function kc(e,t,n={}){Object.assign(t,JA,n),To.extend(e,t,{...n,behavior:UA,widgetState:ZA(n)}),W.get(e,t,["manipulator"]),YA(e,t)}const XA=W.newInstance(kc,"vtkPolygonWidget"),e3={newInstance:XA,extend:kc},Ia=Eo,t3=Ia,n3=F({props:{points:{type:Array,required:!0},color:String,strokeWidth:Number,movePoint:{type:Array},placing:{type:Boolean,default:!1},finishable:{type:Boolean,default:!1},showHandles:{type:Boolean,default:!1}},setup(e){const{points:t,movePoint:n,placing:o,finishable:a,showHandles:i}=ae(e),s=ge(ve);if(!s)throw new Error("No VtkView");const r=w(()=>t.value.length>0&&o.value&&a.value),l=w(()=>i.value?"visible":"hidden"),c=w(()=>r.value?"visible":l.value),u=O([]),p=O(""),d=()=>{const A=s.renderer,y=t.value.map(S=>({point:Et(S,A)??[0,0],radius:Ia}));if(r.value&&(y[0].radius=t3),y.length>0&&o.value&&n.value){const S=Et(n.value,A)??[0,0];y.push({point:S,radius:Ia})}u.value=y;const h=u.value.map(({point:S})=>S==null?void 0:S.join(","));o.value||h.push(h[0]),p.value=h.join(" ")},m=he(s.renderer,"activeCamera");ie(m,"onModified",d),X([t,n,o],d,{deep:!0,immediate:!0});const g=he(s.renderWindowView,"container");return Qt(g,()=>{d()}),{devicePixelRatio,handlePoints:u,linePoints:p,firstHandleVisibility:c,handleVisibility:l}}}),o3=["cx","cy","stroke","stroke-width","r","visibility"],a3=["points","stroke","stroke-width"];function s3(e,t,n,o,a,i){return C(),L("g",null,[(C(!0),L(ne,null,de(e.handlePoints,({point:[s,r],radius:l},c)=>(C(),L("circle",{key:c,cx:s,cy:r,stroke:e.color,"stroke-width":e.strokeWidth,fill:"transparent",r:l,visibility:c===0?e.firstHandleVisibility:e.handleVisibility},null,8,o3))),128)),_("polyline",{points:e.linePoints,stroke:e.color,"stroke-width":e.strokeWidth,fill:"none"},null,8,a3)])}const i3=z(n3,[["render",s3]]),r3=F({name:"PolygonWidget2D",emits:["placed","contextmenu","widgetHover"],props:{toolId:{type:String,required:!0},viewId:{type:String,required:!0},viewDirection:{type:String,required:!0},isPlacing:{type:Boolean,default:!1},imageId:String},components:{SVG2DComponent:i3},setup(e,{emit:t}){const{toolId:n,viewId:o,viewDirection:a,imageId:i,isPlacing:s}=ae(e),r=ge(ve);if(!r)throw new Error("No VtkView");const l=it(o,i),c=w(()=>{var D;return(D=l.value)==null?void 0:D.slice}),u=_n(),p=w(()=>u.toolByID[n.value]),{metadata:d}=Ce(i),m=e3.newInstance({id:n.value}),g=r.widgetManager.addWidget(m);Xe(()=>{r.widgetManager.removeWidget(g),m.delete()}),X([c,i],()=>{s.value&&(g.resetInteractions(),g.getWidgetState().clearHandles())}),ie(g,"onPlacedEvent",()=>{t("placed")});const A=O(null);ie(g,"onHoverEvent",D=>{A.value=D});const y=O(!1);ie(g,"onDraggingEvent",D=>{y.value=D.dragging});const h=w(()=>{var D;return((D=A.value)==null?void 0:D.hovering)&&!y.value});le(()=>{var $;if(!A.value)return;const D=qa(A.value);D&&t("widgetHover",{displayXY:D,hovering:(($=A.value)==null?void 0:$.hovering)&&!y.value})}),ks(t,g);const S=Ct.newInstance();g.setManipulator(S),le(()=>{var D;Qn(S,a.value,((D=p.value)==null?void 0:D.slice)??c.value??0,d.value)});const E=w(()=>{var D;return((D=p.value)==null?void 0:D.slice)===c.value});Rs(g,E,r);const k=_e({movePoint:null,finishable:!1}),R=m.getWidgetState();return ie(R,"onModified",()=>{k.movePoint=R.getMoveHandle().getOrigin(),k.finishable=R.getFinishable()}),{slice:c,tool:p,editState:k,showHandles:h}}});function l3(e,t,n,o,a,i){const s=q("SVG2DComponent");return Vt((C(),B(s,{points:e.tool.points,color:e.tool.color,"stroke-width":e.tool.strokeWidth,"move-point":e.editState.movePoint,placing:e.tool.placing,finishable:e.editState.finishable,"show-handles":e.showHandles},null,8,["points","color","stroke-width","move-point","placing","finishable","show-handles"])),[[Tt,e.slice===e.tool.slice]])}const c3=z(r3,[["render",l3]]),u3=_n,d3=oe.Polygon,p3=F({name:"PolygonTool",props:{viewId:{type:String,required:!0},viewDirection:{type:String,required:!0},imageId:String},components:{PolygonWidget2D:c3,AnnotationContextMenu:Vs,AnnotationInfo:Ts},setup(e){const{viewDirection:t,imageId:n,viewId:o}=ae(e),a=Le(),i=u3(),{activeLabel:s}=ye(i),r=it(o,n),l=w(()=>{var $;return(($=r.value)==null?void 0:$.slice)??0}),{metadata:c}=Ce(n),u=w(()=>a.currentTool===d3),p=w(()=>Te(t.value)),d=Ps(t,l,c),m=Es(i,w(()=>n.value?{imageID:n.value,frameOfReference:d.value,slice:l.value,label:s.value,...s.value&&i.labels[s.value]}:{}));Ee([u,n],([$,M])=>{m.remove(),$&&M&&m.add()}),Xe(()=>{m.remove()});const g=ji(),A=w(()=>g[gn.value.mergeNewPolygon].value),y=()=>{if(n.value){const $=m.id.value;m.commit(),m.add(),A.value&&$&&i.mergeWithOtherTools($)}},{contextMenu:h,openContextMenu:S}=Is(),E=_s(i,p),{onHover:k,overlayInfo:R}=Ds(E,l),D=w(()=>i.mergeableTools.length>=1);return{tools:E,placingToolID:m.id,onToolPlaced:y,contextMenu:h,openContextMenu:S,mergeTools:i.mergeSelectedTools,mergePossible:D,activeToolStore:i,onHover:k,overlayInfo:R}}});const f3={class:"overlay-no-events"},m3={class:"overlay-no-events"};function g3(e,t,n,o,a,i){const s=q("polygon-widget-2D"),r=q("annotation-context-menu"),l=q("annotation-info");return C(),L("div",f3,[(C(),L("svg",m3,[(C(!0),L(ne,null,de(e.tools,c=>(C(),B(s,{key:c.id,"tool-id":c.id,"is-placing":c.id===e.placingToolID,"image-id":e.imageId,"view-id":e.viewId,"view-direction":e.viewDirection,onContextmenu:u=>e.openContextMenu(c.id,u),onPlaced:e.onToolPlaced,onWidgetHover:u=>e.onHover(c.id,u)},null,8,["tool-id","is-placing","image-id","view-id","view-direction","onContextmenu","onPlaced","onWidgetHover"]))),128))])),f(r,{ref:"contextMenu","tool-store":e.activeToolStore},{default:v(()=>[f(fe,{disabled:e.mergePossible,text:"Shift select multiple polygons that overlap and have the same label."},{activator:v(({props:c})=>[_("div",er(tr(c)),[f(ke,{onClick:e.mergeTools,disabled:!e.mergePossible},{prepend:v(()=>[f(K,null,{default:v(()=>[P("mdi-vector-union")]),_:1})]),default:v(()=>[f(Be,null,{default:v(()=>[P("Merge Polygons")]),_:1})]),_:1},8,["onClick","disabled"])],16)]),_:1},8,["disabled"])]),_:1},8,["tool-store"]),f(l,{info:e.overlayInfo,"tool-store":e.activeToolStore},null,8,["info","tool-store"])])}const v3=z(p3,[["render",g3],["__scopeId","data-v-684570b0"]]);var $n=(e=>(e.PlacingFirst="PlacingFirst",e.PlacingSecond="PlacingSecond",e.Select="Select",e.Dragging="Dragging",e))($n||{});function Ti(e){return e.altKey||e.controlKey||e.shiftKey}function h3(e,t){t.classHierarchy.push("vtkRulerWidgetProp"),t.interactionState="Select";let n=null;W.setGet(e,t,["interactionState"]),W.setGet(e,t,["manipulator"]),W.event(e,t,"RightClickEvent"),W.event(e,t,"PlacedEvent"),W.event(e,t,"HoverEvent"),e.deactivateAllHandles=()=>{t.widgetState.deactivate(),t.activeState=null},e.setFirstPoint=s=>{t.widgetState.getFirstPoint().setOrigin(s)},e.setSecondPoint=s=>{t.widgetState.getSecondPoint().setOrigin(s)};const o=e.setInteractionState;e.setInteractionState=s=>{const r=o(s);return r&&s==="PlacingFirst"&&(t.widgetState.setIsPlaced(!1),t.widgetState.getFirstPoint().setVisible(!1),t.widgetState.getSecondPoint().setVisible(!1)),r},e.resetInteractions=()=>{t._interactor.cancelAnimation(e,!0)};const a=()=>{var l;return((l=t._widgetManager.getSelections()[0])==null?void 0:l.getProperties().prop)===t.representations[1].getActors()[0]},i=es(t);e.handleLeftButtonPress=s=>{var u;if(!t.manipulator||Ti(s))return W.VOID;e.invokeHoverEvent({...s,hovering:!1});const r=t._widgetManager.getActiveWidget();if(r&&r!==e)return W.VOID;const l=i(s);if(!(l!=null&&l.length))return W.VOID;const c=e.getInteractionState();return c==="PlacingFirst"?(e.setFirstPoint(l),e.setSecondPoint(l),t.widgetState.getFirstPoint().setVisible(!0),t.widgetState.getSecondPoint().setVisible(!0),t._interactor.requestAnimation(e),e.invokeStartInteractionEvent(),e.setInteractionState("PlacingSecond"),W.EVENT_ABORT):c==="PlacingSecond"?(e.setSecondPoint(l),t.widgetState.setIsPlaced(!0),e.setInteractionState("Select"),e.invokeEndInteractionEvent(),e.invokePlacedEvent(),t._interactor.cancelAnimation(e),W.EVENT_ABORT):(u=t.activeState)!=null&&u.getActive()&&t.pickable&&!a()?(n=t.activeState,e.setInteractionState("Dragging"),t._apiSpecificRenderWindow.setCursor("grabbing"),t._interactor.requestAnimation(e),e.invokeStartInteractionEvent(),W.EVENT_ABORT):W.VOID},e.handleMouseMove=s=>{const r=i(s);return r!=null&&r.length?e.getInteractionState()==="PlacingSecond"?(t.widgetState.getSecondPoint().setOrigin(r),t.widgetState.getSecondPoint().setVisible(!0),e.invokeInteractionEvent(),W.EVENT_ABORT):e.getInteractionState()==="Dragging"&&n?(n.setOrigin(r),e.invokeInteractionEvent(),W.EVENT_ABORT):(e.invokeHoverEvent({...s,hovering:!!t.activeState}),W.VOID):W.VOID},e.handleLeftButtonRelease=s=>{if(n){const r=i(s);r!=null&&r.length&&n.setOrigin(r),n=null,e.setInteractionState("Select"),t._apiSpecificRenderWindow.setCursor("pointer"),t.widgetState.deactivate(),t._interactor.cancelAnimation(e),e.invokeEndInteractionEvent(),t._widgetManager.enablePicking()}},e.handleRightButtonPress=s=>Ti(s)||e.getInteractionState()!=="Select"||!t.activeState?W.VOID:(e.invokeRightClickEvent(s),W.EVENT_ABORT),e.grabFocus=()=>{throw new Error("grabFocus is not implemented")},e.loseFocus=()=>{throw new Error("loseFocus is not implemented")},e.delete=W.chain(()=>{e.resetInteractions()},e.delete)}const ka="points";function A3(e,t){const n=_a({id:t.id,store:e.getStore(),key:"firstPoint",visible:!0}),o=_a({id:t.id,store:e.getStore(),key:"secondPoint",visible:!0});Sa(e,n,()=>e.modified()),Sa(e,o,()=>e.modified()),t.labels={[ka]:[n,o]},e.getFirstPoint=()=>n,e.getSecondPoint=()=>o}const y3=e=>({toolType:tt.Ruler,isPlaced:!1,...e});function w3(e,t,n){Object.assign(t,y3(n)),_c.extend(e,t,n),Sr.extend(e,t),W.setGet(e,t,["isPlaced"]),A3(e,t)}const S3=W.newInstance(w3,"vtkRulerWidgetState");function C3(e,t){t.classHierarchy.push("vtkRulerWidget"),e.getRepresentationsForViewType=()=>[{builder:Cr,labels:[ka],initialValues:{scaleInPixels:!0}},{builder:Ms,labels:[ka],initialValues:{scaleInPixels:!0,lineThickness:.25,behavior:La.HANDLE}}],e.getLength=()=>{const n=t.widgetState.getFirstPoint().getOrigin(),o=t.widgetState.getSecondPoint().getOrigin();return!n||!o?0:Math.sqrt(po(n,o))},t.manipulator=Ct.newInstance()}const b3={};function Dc(e,t,n={}){Object.assign(t,b3,n),To.extend(e,t,{...n,behavior:h3,widgetState:S3(n)}),W.get(e,t,["manipulator"]),C3(e,t)}const _3=W.newInstance(Dc,"vtkRulerWidget"),Ec={newInstance:_3,extend:Dc},I3=F({props:{point1:Array,point2:Array,color:String,strokeWidth:Number,length:Number,textOffset:{type:Number,default:8},textSize:{type:Number,default:14}},setup(e){const{point1:t,point2:n,textOffset:o,length:a}=ae(e),i=O(),s=O(),r=ge(ve);if(!r)throw new Error("No VtkView");const l=()=>{const d=r.renderer,m=b(t),g=b(n);if(m){const A=Et(m,d);A&&(i.value={x:A[0],y:A[1]})}else i.value=null;if(g){const A=Et(g,d);A&&(s.value={x:A[0],y:A[1]})}else s.value=null},c=he(r.renderer,"activeCamera");ie(c,"onModified",l),X([t,n],l,{deep:!0,immediate:!0});const u=w(()=>{const d=b(i),m=b(s),g=o.value;return!d||!m?null:m.x>d.x?{dx:g,dy:-g,anchor:"start"}:{dx:-g,dy:-g,anchor:"end"}}),p=he(r.renderWindowView,"container");return Qt(p,()=>{l()}),{textdx:w(()=>{var d;return((d=u.value)==null?void 0:d.dx)??0}),textdy:w(()=>{var d;return((d=u.value)==null?void 0:d.dy)??0}),anchor:w(()=>{var d;return((d=u.value)==null?void 0:d.anchor)??"start"}),first:i,second:s,rulerLength:w(()=>{var d;return((d=a==null?void 0:a.value)==null?void 0:d.toFixed(2))??""}),ANNOTATION_TOOL_HANDLE_RADIUS:Eo}}});const k3=["x1","y1","x2","y2","stroke","stroke-width"],D3=["cx","cy","stroke","stroke-width","r"],E3=["cx","cy","stroke","stroke-width","r"],R3=["x","y","dx","dy","text-anchor","font-size"];function V3(e,t,n,o,a,i){return C(),L("g",null,[e.first&&e.second?(C(),L("line",{key:0,x1:e.first.x,y1:e.first.y,x2:e.second.x,y2:e.second.y,stroke:e.color,"stroke-width":e.strokeWidth},null,8,k3)):G("",!0),e.first?(C(),L("circle",{key:1,cx:e.first.x,cy:e.first.y,stroke:e.color,"stroke-width":e.strokeWidth,fill:"transparent",r:e.ANNOTATION_TOOL_HANDLE_RADIUS},null,8,D3)):G("",!0),e.second?(C(),L("circle",{key:2,cx:e.second.x,cy:e.second.y,stroke:e.color,"stroke-width":e.strokeWidth,fill:"transparent",r:e.ANNOTATION_TOOL_HANDLE_RADIUS,class:"handle"},null,8,E3)):G("",!0),e.second?(C(),L("text",{key:3,x:e.second.x,y:e.second.y,dx:e.textdx,dy:e.textdy,"text-anchor":e.anchor,"stroke-width":"0.75",stroke:"black",fill:"white","font-size":`${e.textSize}px`,"font-weight":"bold"},H(e.rulerLength),9,R3)):G("",!0)])}const T3=z(I3,[["render",V3],["__scopeId","data-v-50f670d6"]]),P3=F({name:"RulerWidget2D",emits:["placed","contextmenu","widgetHover"],props:{toolId:{type:String,required:!0},viewId:{type:String,required:!0},viewDirection:{type:String,required:!0},isPlacing:{type:Boolean,default:!1},imageId:String},components:{RulerSVG2D:T3},setup(e,{emit:t}){const{toolId:n,viewId:o,viewDirection:a,imageId:i,isPlacing:s}=ae(e),r=ge(ve);if(!r)throw new Error("No VtkView");const l=it(o,i),c=w(()=>{var k;return((k=l.value)==null?void 0:k.slice)??0}),u=Jt(),p=w(()=>u.rulerByID[n.value]),{metadata:d}=Ce(i),m=Ec.newInstance({id:n.value,isPlaced:!s.value}),g=r.widgetManager.addWidget(m);Xe(()=>{r.widgetManager.removeWidget(g),m.delete()}),Pt(s,()=>{g.setInteractionState($n.PlacingFirst)},{immediate:!0}),X([c,i],()=>{g.getWidgetState().getIsPlaced()||(g.resetInteractions(),g.setInteractionState($n.PlacingFirst))}),ie(g,"onPlacedEvent",()=>{t("placed")}),Cc(t,g),ks(t,g);const A=Ct.newInstance();g.setManipulator(A),le(()=>{var k;Qn(A,a.value,((k=p.value)==null?void 0:k.slice)??c.value,d.value)});const y=w(()=>{var k;return((k=p.value)==null?void 0:k.slice)===c.value});Rs(g,y,r);const h=_e({firstPoint:!1,secondPoint:!1}),S=k=>{h.firstPoint=k.getFirstPoint().getVisible(),h.secondPoint=k.getSecondPoint().getVisible()},E=m.getWidgetState();return ie(m.getWidgetState(),"onModified",()=>S(E)),S(E),{ruler:p,slice:c,firstPoint:w(()=>{var k;return h.firstPoint?(k=p.value)==null?void 0:k.firstPoint:void 0}),secondPoint:w(()=>{var k;return h.secondPoint?(k=p.value)==null?void 0:k.secondPoint:void 0}),length:w(()=>u.lengthByID[p.value.id])}}});function M3(e,t,n,o,a,i){const s=q("RulerSVG2D");return Vt((C(),B(s,{point1:e.firstPoint,point2:e.secondPoint,color:e.ruler.color,strokeWidth:e.ruler.strokeWidth,length:e.length},null,8,["point1","point2","color","strokeWidth","length"])),[[Tt,e.slice===e.ruler.slice]])}const O3=z(P3,[["render",M3]]),L3=F({name:"RulerTool",props:{viewId:{type:String,required:!0},viewDirection:{type:String,required:!0},imageId:String},components:{RulerWidget2D:O3,AnnotationContextMenu:Vs,AnnotationInfo:Ts},setup(e){const{viewDirection:t,imageId:n,viewId:o}=ae(e),a=Le(),i=Jt(),{activeLabel:s}=ye(i),r=it(o,n),l=w(()=>{var R;return((R=r.value)==null?void 0:R.slice)??0}),{metadata:c}=Ce(n),u=w(()=>a.currentTool===oe.Ruler),p=w(()=>Te(t.value)),d=Ps(t,l,c),m=Es(i,w(()=>n.value?{imageID:n.value,frameOfReference:d.value,slice:l.value,label:s.value,...s.value&&i.labels[s.value]}:{}));Ee([u,n],([R,D])=>{m.remove(),R&&D&&m.add()}),Xe(()=>{m.remove()});const g=()=>{n.value&&(m.commit(),m.add())},{contextMenu:A,openContextMenu:y}=Is(),h=_s(i,p),S=w(()=>{const{lengthByID:R}=i;return h.value.map(D=>({...D,length:R[D.id]}))}),{onHover:E,overlayInfo:k}=Ds(h,l);return{rulers:S,placingRulerID:m.id,onRulerPlaced:g,contextMenu:A,openContextMenu:y,rulerStore:i,onHover:E,overlayInfo:k}}});const B3={class:"overlay-no-events"},$3={class:"overlay-no-events"};function x3(e,t,n,o,a,i){const s=q("ruler-widget-2D"),r=q("annotation-info"),l=q("annotation-context-menu");return C(),L("div",B3,[(C(),L("svg",$3,[(C(!0),L(ne,null,de(e.rulers,c=>(C(),B(s,{key:c.id,"tool-id":c.id,"is-placing":c.id===e.placingRulerID,"image-id":e.imageId,"view-id":e.viewId,"view-direction":e.viewDirection,onContextmenu:u=>e.openContextMenu(c.id,u),onPlaced:e.onRulerPlaced,onWidgetHover:u=>e.onHover(c.id,u)},null,8,["tool-id","is-placing","image-id","view-id","view-direction","onContextmenu","onPlaced","onWidgetHover"]))),128))])),f(r,{info:e.overlayInfo,"tool-store":e.rulerStore},null,8,["info","tool-store"]),f(l,{ref:"contextMenu","tool-store":e.rulerStore},null,8,["tool-store"])])}const U3=z(L3,[["render",x3],["__scopeId","data-v-a7deb0f8"]]);function N3(e,t){t.classHierarchy.push("vtkRectangleLineRepresentation");const n=e.getRepresentationStates,o=Ma.createBuilder().addDynamicMixinState({labels:["handles"],mixins:["origin","scale1"],name:"handle"}).build(),a=Array.from({length:4},()=>o.addHandle()),i=t.widgetAPI.behavior;let s;t.widgetAPI.behavior=(r,l)=>(s=l,i(r,l)),e.getRepresentationStates=(r=t.inputData[0])=>{const l=n(r);if(l.length===0)return l;const c=[...Ue.INIT_BOUNDS];l.forEach(g=>{const A=s._apiSpecificRenderWindow.worldToDisplay(...g.getOrigin(),s._renderer);Ue.addPoint(c,...A)});const p=Ue.getCorners(c,[]).reduce((g,A)=>(g.some(h=>ur(h,A))||g.push(A),g),[]),d=l[0].getScale1();return[0,2,3,1].map(g=>Math.min(g,p.length-1)).map((g,A)=>{const y=s._apiSpecificRenderWindow.displayToWorld(...p[g],s._renderer),h=a[A];return h.setOrigin(y),h.setScale1(d),h})}}function Rc(e,t,n={}){Ms.extend(e,t,n),N3(e,t)}const F3=W.newInstance(Rc,"vtkRectangleLineRepresentation"),W3={newInstance:F3,extend:Rc};function H3(e,t){t.classHierarchy.push("vtkRectangleWidget");const n=e.getRepresentationsForViewType;e.getRepresentationsForViewType=()=>{const o=n();return o[1].builder=W3,o[1].initialValues={...o[1].initialValues,widgetAPI:t},o}}const G3={};function Vc(e,t,n={}){Object.assign(t,G3,n),Ec.extend(e,t,{...n,toolType:tt.Rectangle}),H3(e,t)}const z3=W.newInstance(Vc,"vtkRectangleWidget"),j3={newInstance:z3,extend:Vc},Q3=F({props:{point1:Array,point2:Array,color:String,fillColor:String,strokeWidth:Number},setup(e){const{point1:t,point2:n}=ae(e),o=O(),a=O(),i=ge(ve);if(!i)throw new Error("No VtkView");const s=()=>{const u=i.renderer,p=b(t),d=b(n);if(p){const m=Et(p,u);m&&(o.value={x:m[0],y:m[1]})}else o.value=null;if(d){const m=Et(d,u);m&&(a.value={x:m[0],y:m[1]})}else a.value=null},r=w(()=>{var g,A,y,h;const[u,p]=[((g=o.value)==null?void 0:g.x)??0,((A=o.value)==null?void 0:A.y)??0],[d,m]=[((y=a.value)==null?void 0:y.x)??u,((h=a.value)==null?void 0:h.y)??p];return{x:Math.min(u,d),y:Math.min(p,m),width:Math.abs(u-d),height:Math.abs(p-m)}}),l=he(i.renderer,"activeCamera");ie(l,"onModified",s),X([t,n],s,{deep:!0,immediate:!0});const c=he(i.renderWindowView,"container");return Qt(c,()=>{s()}),{first:o,second:a,rectangle:r,ANNOTATION_TOOL_HANDLE_RADIUS:Eo}}}),q3=["x","y","width","height","stroke","stroke-width","fill"],K3=["cx","cy","stroke","stroke-width","r"],Z3=["cx","cy","stroke","stroke-width","r"];function Y3(e,t,n,o,a,i){return C(),L("g",null,[_("rect",{x:e.rectangle.x,y:e.rectangle.y,width:e.rectangle.width,height:e.rectangle.height,stroke:e.color,"stroke-width":e.strokeWidth,fill:e.fillColor},null,8,q3),e.first?(C(),L("circle",{key:0,cx:e.first.x,cy:e.first.y,stroke:e.color,"stroke-width":e.strokeWidth,fill:"transparent",r:e.ANNOTATION_TOOL_HANDLE_RADIUS},null,8,K3)):G("",!0),e.second?(C(),L("circle",{key:1,cx:e.second.x,cy:e.second.y,stroke:e.color,"stroke-width":e.strokeWidth,fill:"transparent",r:e.ANNOTATION_TOOL_HANDLE_RADIUS},null,8,Z3)):G("",!0)])}const J3=z(Q3,[["render",Y3]]),X3=bn,ey=j3,ty=J3,ny=F({name:"RectangleWidget2D",emits:["placed","contextmenu","widgetHover"],props:{toolId:{type:String,required:!0},viewId:{type:String,required:!0},viewDirection:{type:String,required:!0},isPlacing:{type:Boolean,default:!1},imageId:String},components:{SVG2DComponent:ty},setup(e,{emit:t}){const{toolId:n,viewId:o,viewDirection:a,imageId:i,isPlacing:s}=ae(e),r=ge(ve);if(!r)throw new Error("No VtkView");const l=it(o,i),c=w(()=>{var k;return(k=l.value)==null?void 0:k.slice}),u=X3(),p=w(()=>u.toolByID[n.value]),{metadata:d}=Ce(i),m=ey.newInstance({id:n.value,isPlaced:!s.value}),g=r.widgetManager.addWidget(m);Xe(()=>{r.widgetManager.removeWidget(g),m.delete()}),Pt(s,()=>{g.setInteractionState($n.PlacingFirst)},{immediate:!0}),X([c,i],()=>{g.getWidgetState().getIsPlaced()||(g.resetInteractions(),g.setInteractionState($n.PlacingFirst))}),ie(g,"onPlacedEvent",()=>{t("placed")}),Cc(t,g),ks(t,g);const A=Ct.newInstance();g.setManipulator(A),le(()=>{var k;Qn(A,a.value,((k=p.value)==null?void 0:k.slice)??c.value,d.value)});const y=w(()=>{var k;return((k=p.value)==null?void 0:k.slice)===c.value});Rs(g,y,r);const h=_e({firstPoint:!1,secondPoint:!1}),S=k=>{h.firstPoint=k.getFirstPoint().getVisible(),h.secondPoint=k.getSecondPoint().getVisible()},E=m.getWidgetState();return ie(m.getWidgetState(),"onModified",()=>S(E)),S(E),{tool:p,slice:c,firstPoint:w(()=>{var k;return h.firstPoint?(k=p.value)==null?void 0:k.firstPoint:void 0}),secondPoint:w(()=>{var k;return h.secondPoint?(k=p.value)==null?void 0:k.secondPoint:void 0})}}});function oy(e,t,n,o,a,i){const s=q("SVG2DComponent");return Vt((C(),B(s,{"view-id":e.viewId,point1:e.firstPoint,point2:e.secondPoint,color:e.tool.color,"stroke-width":e.tool.strokeWidth,"fill-color":e.tool.fillColor},null,8,["view-id","point1","point2","color","stroke-width","fill-color"])),[[Tt,e.slice===e.tool.slice]])}const ay=z(ny,[["render",oy]]),sy=bn,iy=oe.Rectangle,ry=F({name:"RectangleTool",props:{viewId:{type:String,required:!0},viewDirection:{type:String,required:!0},imageId:String},components:{RectangleWidget2D:ay,AnnotationContextMenu:Vs,AnnotationInfo:Ts},setup(e){const{viewDirection:t,imageId:n,viewId:o}=ae(e),a=Le(),i=sy(),{activeLabel:s}=ye(i),r=it(o,n),l=w(()=>{var R;return((R=r.value)==null?void 0:R.slice)??0}),{currentImageID:c,currentImageMetadata:u}=me(),p=w(()=>a.currentTool===iy),d=w(()=>Te(t.value)),m=Ps(t,l,u),g=Es(i,w(()=>c.value?{imageID:c.value,frameOfReference:m.value,slice:l.value,label:s.value,...s.value&&i.labels[s.value]}:{}));Ee([p,c],([R,D])=>{g.remove(),R&&D&&g.add()}),Xe(()=>{g.remove()});const A=()=>{c.value&&(g.commit(),g.add())},{contextMenu:y,openContextMenu:h}=Is(),S=_s(i,d),{onHover:E,overlayInfo:k}=Ds(S,l);return{tools:S,placingToolID:g.id,onToolPlaced:A,contextMenu:y,openContextMenu:h,activeToolStore:i,onHover:E,overlayInfo:k}}});const ly={class:"overlay-no-events"},cy={class:"overlay-no-events","data-testid":"rectangle-tool-container"};function uy(e,t,n,o,a,i){const s=q("rectangle-widget-2D"),r=q("annotation-info"),l=q("annotation-context-menu");return C(),L("div",ly,[(C(),L("svg",cy,[(C(!0),L(ne,null,de(e.tools,c=>(C(),B(s,{key:c.id,"tool-id":c.id,"is-placing":c.id===e.placingToolID,"image-id":e.imageId,"view-id":e.viewId,"view-direction":e.viewDirection,onContextmenu:u=>e.openContextMenu(c.id,u),onPlaced:e.onToolPlaced,onWidgetHover:u=>e.onHover(c.id,u)},null,8,["tool-id","is-placing","image-id","view-id","view-direction","onContextmenu","onPlaced","onWidgetHover"]))),128))])),f(r,{info:e.overlayInfo,"tool-store":e.activeToolStore},null,8,["info","tool-store"]),f(l,{ref:"contextMenu","tool-store":e.activeToolStore},null,8,["tool-store"])])}const dy=z(ry,[["render",uy],["__scopeId","data-v-f0ec7a7b"]]),py=F({__name:"SelectTool",setup(e){const t=ge(ve);if(!t)throw new Error("No VtkView");const n=Cn();ie(t.interactor,"onLeftButtonPress",a=>{const i=!!(a.shiftKey||a.controlKey),s=t.widgetManager.getSelectedData();if("widget"in s){const l=s.widget.getWidgetState(),c=l.getId(),u=l.getToolType();i?n.toggleSelection(c,u):(n.clearSelection(),n.addSelection(c,u))}else i||n.clearSelection()},{priority:Rd+1});const o=()=>{};return(a,i)=>(C(),B(o))}}),fy=["x","y","width","height"],my=2,gy=F({__name:"BoundingRectangle",props:{points:{},padding:{default:my}},setup(e){const t=e,n=ge(ve);if(!n)throw new Error("No VtkView");const o=w(()=>t.points.length>0),a=O({x:0,y:0,width:0,height:0}),i=()=>{const c=n.renderer,u=[...Ue.INIT_BOUNDS];un(t.points).map(h=>Et(h,c)).filter(Oo).forEach(([h,S])=>{Ue.addPoint(u,h,S,0)}),Ue.inflate(u,t.padding);const[p,d]=Ue.getMinPoint(u),[m,g]=Ue.getMaxPoint(u),A=Eo+2,y=2*A;a.value={x:p-A,y:d-A,width:m-p+y,height:g-d+y}},{points:s}=ae(t);X(s,i,{immediate:!0,deep:!0});const r=he(n.renderer,"activeCamera");ie(r,"onModified",i);const l=he(n.renderWindowView,"container");return Qt(l,()=>{i()}),(c,u)=>o.value?(C(),L("rect",{key:0,x:a.value.x,y:a.value.y,width:a.value.width,height:a.value.height,"stroke-width":"2",fill:"transparent",stroke:"lightgray"},null,8,fy)):G("",!0)}});function vy(e){if(!e||e==="none")return 0;const t=e.match(/matrix(?:3d)?\((.+)\)/)[1].split(",").map(o=>Number(o));return e.includes("3d")?t[13]:t[5]}const hy={props:{modelValue:{type:Number,default:0},min:{type:Number,required:!0},max:{type:Number,required:!0},step:{type:Number,required:!0},handleHeight:{type:Number,default:20}},emits:["update:modelValue"],data(){return{maxHandlePos:0,dragging:!1,initialHandlePos:0,initialMousePosY:0,yOffset:0}},computed:{handlePosition(){const e=this.max-this.min<=0?1:this.max-this.min,t=this.maxHandlePos*((this.modelValue-this.min)/e);return this.dragging?this.draggingHandlePos:t},draggingHandlePos(){return Math.min(Math.max(0,this.initialHandlePos+this.yOffset),this.maxHandlePos)}},mounted(){this.updateMaxHandlePos(),this.resizeObserver=new ResizeObserver(e=>{e.length===1&&this.updateMaxHandlePos()}),this.resizeObserver.observe(this.$refs.handleContainer)},beforeUnmount(){this.resizeObserver.disconnect()},methods:{updateMaxHandlePos(){this.maxHandlePos=this.$refs.handleContainer.clientHeight-this.handleHeight},onDragStart(e){if(e.preventDefault(),this.dragging=!0,this.initialMousePosY=e.pageY,e.target===this.$refs.handle){const t=window.getComputedStyle(this.$refs.handle);this.initialHandlePos=vy(t.transform)}else{const{y:t}=this.$refs.handleContainer.getBoundingClientRect();this.initialHandlePos=Math.max(0,Math.min(this.maxHandlePos,e.pageY-t-this.handleHeight/2));const n=this.getNearestSlice(this.initialHandlePos);this.$emit("update:modelValue",n)}this.yOffset=0,this.$refs.handleContainer.setPointerCapture(e.pointerId)},onDragMove(e){if(!this.$refs.handleContainer.hasPointerCapture(e.pointerId))return;e.preventDefault(),this.yOffset=e.pageY-this.initialMousePosY;const t=this.getNearestSlice(this.handlePosition);this.$emit("update:modelValue",t)},onDragEnd(e){if(!this.$refs.handleContainer.hasPointerCapture(e.pointerId))return;e.preventDefault(),this.$refs.handleContainer.releasePointerCapture(e.pointerId),this.dragging=!1;const t=this.getNearestSlice(this.handlePosition);this.$emit("update:modelValue",t)},getNearestSlice(e){const n=e/this.maxHandlePos*(this.max-this.min)+this.min;return Math.round(n/this.step)*this.step}}},Ay=e=>($e("data-v-daf72b9c"),e=e(),xe(),e),yy=Ay(()=>_("div",{class:"slice-slider-track"},null,-1));function wy(e,t,n,o,a,i){return C(),L("div",{class:"slice-slider",ref:"handleContainer",onPointerdown:t[0]||(t[0]=(...s)=>i.onDragStart&&i.onDragStart(...s)),onPointermove:t[1]||(t[1]=(...s)=>i.onDragMove&&i.onDragMove(...s)),onPointerup:t[2]||(t[2]=(...s)=>i.onDragEnd&&i.onDragEnd(...s)),onPointercancel:t[3]||(t[3]=(...s)=>i.onDragEnd&&i.onDragEnd(...s)),onContextmenu:t[4]||(t[4]=s=>s.preventDefault())},[yy,_("div",{class:"slice-slider-handle",ref:"handle",style:nt({height:`${n.handleHeight}px`,transform:`translate3d(0, ${i.handlePosition}px, 0)`})},null,4)],544)}const Sy=z(hy,[["render",wy],["__scopeId","data-v-daf72b9c"]]);function Cy(e,t,n,o){const a=Dt(),{config:i}=bt(e,t),{metadata:s,isLoading:r}=Ce(t),l=w(()=>Te(b(n))),c=w(()=>{const u=b(o);if(u)return u;const{lpsOrientation:p,dimensions:d}=s.value,m=p[l.value];return{min:0,max:d[m]-1}});Ee([ht(c),ht(n),ht(t),r],([u,p,d,m])=>{if(m||!d)return;const g=!!i.value;a.updateConfig(b(e),d,{...u,axisDirection:p}),g||a.resetSlice(b(e),d)})}const by=F({__name:"VtkSliceViewSlicingManipulator",props:{viewId:{},imageId:{},viewDirection:{},manipulatorConfig:{}},setup(e){const t=e,{viewId:n,imageId:o,viewDirection:a,manipulatorConfig:i}=ae(t),s=ge(ve);if(!s)throw new Error("No VtkView");const r=s.interactorStyle;if(!(r!=null&&r.isA("vtkInteractorStyleManipulator")))throw new Error("No vtkInteractorStyleManipulator");const l=w(()=>({button:1,dragEnabled:!1,scrollEnabled:!0,...i==null?void 0:i.value})),{instance:c}=xt(r,gr,l),u=bt(n,o);Cy(n,o,a);const p=ba(c,"scroll",u.range,1,u.slice.value);return X(p,()=>{const d=Me();b(n)!==d.activeViewID&&d.setActiveViewID(b(n))}),dn(p,u.slice,{immediate:!0}),(d,m)=>se(d.$slots,"default")}}),_y=e=>($e("data-v-57db1cae"),e=e(),xe(),e),Iy={class:"vtk-gutter"},ky={class:"vtk-container","data-testid":"two-view-container"},Dy={class:"vtk-sub-container"},Ey={class:"overlay-no-events"},Ry={key:0,class:"overlay-no-events loading"},Vy=_y(()=>_("div",null,"Loading the image",-1)),Ty=F({__name:"SliceViewer",props:{viewDirection:{},viewUp:{},id:{},type:{}},setup(e){const t=e,n=O(),{disableCameraAutoReset:o}=ye(Yt()),{id:a,type:i,viewDirection:s,viewUp:r}=ae(t),l=w(()=>Te(s.value)),c=O(!1);function u(){n.value&&n.value.resetCamera()}In().onClick(u),Ss(n),Ko(n,a,i);const{currentTool:p}=ye(Le()),d=w(()=>p.value===oe.WindowLevel?{button:1}:{button:-1}),{currentImageID:m,currentLayers:g,currentImageMetadata:A,isImageLoading:y}=me(),{slice:h,range:S}=bt(a,m);Pt(w(()=>!y.value),()=>{u()});const E=w(()=>m.value?et().orderByParent[m.value]:[]),k=Cn(),R=w(()=>k.selection.map(D=>{const $=Tn(D.type);return{store:$,tool:$.toolByID[D.id]}}).filter(({tool:D})=>D.slice===h.value&&!D.hidden&&Sc(l,D,A)).flatMap(({store:D,tool:$})=>D.getPoints($.id)));return(D,$)=>(C(),L("div",{class:"vtk-container-wrapper",tabindex:"0",onPointerenter:$[1]||($[1]=M=>c.value=!0),onPointerleave:$[2]||($[2]=M=>c.value=!1),onFocusin:$[3]||($[3]=M=>c.value=!0),onFocusout:$[4]||($[4]=M=>c.value=!1)},[_("div",Iy,[f(te,{dark:"",icon:"",size:"medium",variant:"text",onClick:u},{default:v(()=>[f(K,{size:"medium",class:"py-1"},{default:v(()=>[P("mdi-camera-flip-outline")]),_:1}),f(fe,{location:"right",activator:"parent",transition:"slide-x-transition"},{default:v(()=>[P(" Reset Camera ")]),_:1})]),_:1}),f(Sy,{modelValue:b(h),"onUpdate:modelValue":$[0]||($[0]=M=>Ln(h)?h.value=M:null),class:"slice-slider",min:b(S)[0],max:b(S)[1],step:1,"handle-height":20},null,8,["modelValue","min","max"])]),_("div",ky,[_("div",Dy,[f(mc,{class:"vtk-view",ref_key:"vtkView",ref:n,"data-testid":"vtk-view vtk-two-view","disable-auto-reset-camera":b(o),"view-id":D.id,"image-id":b(m),"view-direction":b(s),"view-up":b(r)},{default:v(()=>[b(p)===b(oe).Pan?(C(),B(vt,{key:0,"manipulator-constructor":b(Nt),"manipulator-props":{button:1}},null,8,["manipulator-constructor"])):G("",!0),f(vt,{"manipulator-constructor":b(Nt),"manipulator-props":{button:1,shift:!0}},null,8,["manipulator-constructor"]),f(vt,{"manipulator-constructor":b(Nt),"manipulator-props":{button:2}},null,8,["manipulator-constructor"]),b(p)===b(oe).Zoom?(C(),B(vt,{key:1,"manipulator-constructor":b(mo),"manipulator-props":{button:1}},null,8,["manipulator-constructor"])):G("",!0),f(vt,{"manipulator-constructor":b(mo),"manipulator-props":{button:3}},null,8,["manipulator-constructor"]),f(by,{"view-id":D.id,"image-id":b(m),"view-direction":b(s)},null,8,["view-id","image-id","view-direction"]),f(hc,{"view-id":D.id,"image-id":b(m),"manipulator-config":d.value},null,8,["view-id","image-id","manipulator-config"]),f(vc,{"view-id":D.id,"image-id":b(m)},null,8,["view-id","image-id"]),f(Mh,{"view-id":D.id,"image-id":b(m),axis:l.value},null,8,["view-id","image-id","axis"]),(C(!0),L(ne,null,de(E.value,M=>(C(),B(Lh,{key:`seg-${M}`,"view-id":D.id,"segmentation-id":M,axis:l.value},null,8,["view-id","segmentation-id","axis"]))),128)),b(m)?(C(!0),L(ne,{key:2},de(b(g),M=>(C(),B(xh,{key:`layer-${M.id}`,"view-id":D.id,"layer-id":M.id,"parent-id":b(m),axis:l.value},null,8,["view-id","layer-id","parent-id","axis"]))),128)):G("",!0),f(wc,{"view-id":b(a),"image-id":b(m)},null,8,["view-id","image-id"]),f(AA,{"view-id":b(a),"image-id":b(m),"view-direction":b(s)},null,8,["view-id","image-id","view-direction"]),f(bA,{"view-id":b(a),"image-id":b(m),"view-direction":b(s)},null,8,["view-id","image-id","view-direction"]),f(v3,{"view-id":b(a),"image-id":b(m),"view-direction":b(s)},null,8,["view-id","image-id","view-direction"]),f(U3,{"view-id":b(a),"image-id":b(m),"view-direction":b(s)},null,8,["view-id","image-id","view-direction"]),f(dy,{"view-id":b(a),"image-id":b(m),"view-direction":b(s)},null,8,["view-id","image-id","view-direction"]),f(py),(C(),L("svg",Ey,[f(gy,{points:R.value},null,8,["points"])])),se(D.$slots,"default",{},void 0,!0)]),_:3},8,["disable-auto-reset-camera","view-id","image-id","view-direction","view-up"])]),f(nr,{name:"loading"},{default:v(()=>[b(y)?(C(),L("div",Ry,[Vy,_("div",null,[f(wt,{indeterminate:"",color:"blue"})])])):G("",!0)]),_:1})])],32))}});const Py=z(Ty,[["__scopeId","data-v-57db1cae"]]);function My(e,t){return qo({view:e,data:t,vtkActorClass:br,vtkMapperClass:_r})}function Zo(e,t){const n=Lt(),o=w(()=>n.getConfig(b(e),b(t))),{imageData:a,isLoading:i}=Ce(t);Ee([o,e,t,i],()=>{if(o.value||i.value)return;const s=b(e),r=b(t);!r||!a.value||n.resetToDefaultColoring(s,r,a.value)})}function Oy(e){const t=O(!1);return ie(e.interactor,"onStartAnimation",()=>{t.value=!0}),ie(e.interactor,"onEndAnimation",()=>{t.value=!1}),t}function Ly({renderer:e,enabled:t,center:n,lightFollowsCamera:o}){e.getLights().length===0&&e.createLight();const a=e.getLights()[0];t?(a.setFocalPoint(...n),a.setColor(1,1,1),a.setIntensity(1),a.setConeAngle(90),a.setPositional(!0),e.setTwoSidedLighting(!1),o?(a.setLightTypeToHeadLight(),e.updateLightsGeometryToFollowCamera()):a.setLightTypeToSceneLight()):a.setPositional(!1)}function By({enabled:e,mapper:t,quality:n,isAnimating:o,image:a}){if(o)t.setSampleDistance(.75),t.setMaximumSamplesPerRay(1e3),t.setGlobalIlluminationReach(0),t.setComputeNormalFromOpacity(!1);else{const i=a.getDimensions(),s=a.getSpacing(),r=Au(mt(i[0]*s[0],i[1]*s[1],i[2]*s[2]));let l=s.reduce((u,p)=>u+p)/3;l/=n>1?.5*n**2:1;const c=r/l+1;t.setMaximumSamplesPerRay(c),t.setSampleDistance(l),t.setGlobalIlluminationReach(e?.25*n:0),t.setComputeNormalFromOpacity(!e&&n>2)}}function $y({enabled:e,image:t,property:n,ambient:o,diffuse:a,specular:i,component:s=0}){n.setScalarOpacityUnitDistance(0,.5*Ir(t.getBounds())/Math.max(...t.getDimensions())),n.setShade(!0),n.setUseGradientOpacity(s,!e),n.setGradientOpacityMinimumValue(s,0);const r=t.getPointData().getScalars().getRange();n.setGradientOpacityMaximumValue(s,(r[1]-r[0])*.01),n.setGradientOpacityMinimumOpacity(s,0),n.setGradientOpacityMaximumOpacity(s,1),n.setAmbient(e?o:Ka),n.setDiffuse(e?a:Za),n.setSpecular(e?i:Ya)}function xy({enabled:e,mapper:t,blending:n}){window.am=t,t.setVolumetricScatteringBlending(e?n:0)}function Uy({enabled:e,mapper:t,kernelSize:n,kernelRadius:o}){e?(t.setLocalAmbientOcclusion(!0),t.setLAOKernelSize(n),t.setLAOKernelRadius(o)):(t.setLocalAmbientOcclusion(!1),t.setLAOKernelSize(0),t.setLAOKernelRadius(0))}function Ny(e,t){Ee(ht(t),(n,o)=>{n&&(o&&Yp(n,o)||(e.removeAllClippingPlanes(),n.forEach(a=>e.addClippingPlane(a))))})}const Fy=F({__name:"VtkBaseVolumeRepresentation",props:{viewId:{},imageId:{}},setup(e,{expose:t}){const n=e,{viewId:o,imageId:a}=ae(n),i=ge(ve);if(!i)throw new Error("No VtkView");const{imageData:s,metadata:r}=Ce(a),l=w(()=>Lt().getConfig(o.value,a.value)),c=My(i,s),u=Nn.newInstance(),p=Mo.newInstance();c.property.setRGBTransferFunction(0,u),c.property.setScalarOpacity(0,p),c.property.setShade(!0),c.property.setInterpolationType(Vd.LINEAR),c.property.setAmbient(Ka),c.property.setDiffuse(Za),c.property.setSpecular(Ya),[u,p].forEach(h=>{ie(h,"onModified",i.requestRender)});const d=w(()=>{var h;return(h=l.value)==null?void 0:h.cvr}),m=w(()=>Ue.getCenter(r.value.worldBounds)),g=Oy(i);le(()=>{const h=s.value;if(!d.value||!h)return;const{enabled:S,lightFollowsCamera:E,ambient:k,diffuse:R,specular:D,volumetricScatteringBlending:$,volumeQuality:M,useLocalAmbientOcclusion:x,useVolumetricScatteringBlending:V,laoKernelRadius:T,laoKernelSize:U}=d.value,{property:Q,mapper:Z}=c,ee=S&&!g.value,N=h.getPointData().getScalars();Ly({enabled:ee,renderer:i.renderer,lightFollowsCamera:E,center:m.value});for(let j=0;j<N.getNumberOfComponents();j++)$y({enabled:ee,image:h,ambient:k,diffuse:R,specular:D,property:Q,component:j});xy({enabled:ee&&V,mapper:Z,blending:$}),By({enabled:ee,image:h,mapper:Z,quality:M,isAnimating:g.value}),Uy({enabled:ee&&x,kernelRadius:T,kernelSize:U,mapper:Z}),i.requestRender()}),Zo(o,a),$h(l,u,p);const y=Sn().getComputedVTKPlanes(a);return Ny(c.mapper,y),t(c),(h,S)=>se(h.$slots,"default")}}),Wy=Td.BOTTOM_LEFT,Hy=.1;function Gy(e,t,n){const o=Pd.newInstance({interactor:t});le(()=>{const s=b(e);s?(o.setActor(s),o.setEnabled(!0)):o.setEnabled(!1)}),kt(()=>{o.setEnabled(!1)});const a=w(()=>{var s;return((s=b(n))==null?void 0:s.corner)??Wy});le(()=>{o.setViewportCorner(a.value)});const i=w(()=>{var s;return((s=b(n))==null?void 0:s.size)??Hy});return le(()=>{o.setViewportSize(i.value)}),{widget:o}}const zy=F({__name:"VtkOrientationMarker",setup(e){const t=ge(ve);if(!t)throw new Error("No VtkView");const n=Md.newInstance();return Gs.applyPreset("default",n),Gs.applyPreset("lps",n),Gy(n,t.interactor),(o,a)=>se(o.$slots,"default")}}),jy=e=>($e("data-v-6f1cf8ef"),e=e(),xe(),e),Qy={class:"vtk-container-wrapper volume-viewer-container",tabindex:"0"},qy={class:"vtk-container","data-testid":"two-view-container"},Ky={class:"vtk-sub-container"},Zy={class:"annotation-cell"},Yy={class:"ml-3"},Jy={key:0,class:"overlay-no-events loading"},Xy=jy(()=>_("div",null,"Loading the image",-1)),e5=F({__name:"VolumeViewer",props:{viewDirection:{},viewUp:{},id:{},type:{}},setup(e){const t=e,n=O(),{id:o,type:a,viewDirection:i,viewUp:s}=ae(t);function r(){n.value&&(n.value.resetCamera(),n.value.renderer.updateLightsGeometryToFollowCamera())}In().onClick(r),Ss(n),Ko(n,o,a);const{currentImageID:l,isImageLoading:c}=me();Pt(w(()=>!c.value),()=>{r()});const u=Lt(),p=w(()=>u.getConfig(o.value,l.value)),d=w(()=>{var m;return((m=p.value)==null?void 0:m.transferFunction.preset.replace(/-/g," "))??""});return(m,g)=>(C(),L("div",Qy,[_("div",qy,[_("div",Ky,[f(lc,{class:"vtk-view",ref_key:"vtkView",ref:n,"data-testid":"vtk-view vtk-two-view","view-id":m.id,"image-id":b(l),"view-direction":b(i),"view-up":b(s)},{default:v(()=>[f(Fy,{"view-id":m.id,"image-id":b(l)},null,8,["view-id","image-id"]),f(zy),f(wc,{"view-id":b(o),"image-id":b(l)},null,8,["view-id","image-id"]),se(m.$slots,"default",{},void 0,!0)]),_:3},8,["view-id","image-id","view-direction","view-up"])]),f(gc,{class:"overlay-no-events view-annotations"},{"top-left":v(()=>[_("div",Zy,[f(te,{class:"pointer-events-all",dark:"",icon:"",size:"medium",variant:"text",onClick:r},{default:v(()=>[f(K,{size:"medium",class:"py-1"},{default:v(()=>[P(" mdi-camera-flip-outline ")]),_:1}),f(fe,{location:"right",activator:"parent",transition:"slide-x-transition"},{default:v(()=>[P(" Reset Camera ")]),_:1})]),_:1}),_("span",Yy,H(d.value),1)])]),_:1}),f(nr,{name:"loading"},{default:v(()=>[b(c)?(C(),L("div",Jy,[Xy,_("div",null,[f(wt,{indeterminate:"",color:"blue"})])])):G("",!0)]),_:1})])]))}});const t5=z(e5,[["__scopeId","data-v-6f1cf8ef"]]),n5={"2D":Py,"3D":t5,Oblique:Ph,Oblique3D:Qv},o5=F({name:"LayoutGrid",methods:{onFocusView(e,t){t==="2D"&&Me().setActiveViewID(e)}},props:{layout:{type:Object,required:!0}},setup(e){const{layout:t}=ae(e),n=Me(),{viewSpecs:o}=ye(n),a=w(()=>t.value.direction===Ve.H?"flex-column":"flex-row");return{items:w(()=>{const s=o.value;return t.value.items.map(r=>{if(typeof r=="string"){const l=s[r];return{type:"view",id:r,viewType:l.viewType,component:n5[l.viewType],props:l.props}}return{type:"layout",...r}})}),flexFlow:a}}});const a5={key:1,class:"layout-item"};function s5(e,t,n,o,a,i){const s=q("layout-grid",!0);return C(),L("div",{class:be(["layout-container flex-equal",e.flexFlow]),"data-testid":"layout-grid"},[(C(!0),L(ne,null,de(e.items,(r,l)=>(C(),L("div",{key:l,class:"d-flex flex-equal"},[r.type==="layout"?(C(),B(s,{key:0,layout:r},null,8,["layout"])):(C(),L("div",a5,[(C(),B(_o(r.component),ze({key:r.id,id:r.id,type:r.viewType},r.props,{onFocus:c=>e.onFocusView(r.id,r.viewType)}),null,16,["id","type","onFocus"]))]))]))),128))],2)}const i5=z(o5,[["render",s5],["__scopeId","data-v-bcaa91ed"]]);const r5={__name:"PersistentOverlay",props:{disabled:{type:Boolean,default:!1},color:{type:String,default:""},opacity:{type:Number,default:.2},zIndex:{type:Number,default:10}},setup(e){const t=e,{disabled:n,color:o,opacity:a,zIndex:i}=ae(t),s=w(()=>o.value&&o.value.startsWith("#")?o.value:""),r=w(()=>o.value&&!s.value?`bg-${o.value}`:""),l=w(()=>{const p={"persistent-overlay-scrim":!0,"persistent-overlay-scrim-themed":o.value.length===0};return r.value&&(p[r.value]=!0),p}),c=w(()=>{const p={opacity:a.value};return s.value&&(p["background-color"]=s.value),p}),u=w(()=>({zIndex:i.value}));return(p,d)=>b(n)?G("",!0):(C(),L("div",{key:0,class:"persistent-overlay",style:nt(u.value)},[_("div",{class:be(l.value),style:nt(c.value)},null,6),se(p.$slots,"default",{},void 0,!0)],4))}},qn=z(r5,[["__scopeId","data-v-dc194336"]]),l5=F({name:"ImageListCard",props:{active:Boolean,imageSize:{type:Number,default:80},imageUrl:{type:String},selectable:{type:Boolean,default:!1},id:String,modelValue:Array,inputValue:String,disabled:Boolean,htmlTitle:String},components:{PersistentOverlay:qn}});function c5(e,t,n,o,a,i){const s=q("persistent-overlay");return C(),B(Uu,null,{default:v(({isHovering:r,props:l})=>[f(Pe,ze({disabled:e.disabled,variant:"outlined",ripple:!e.disabled,class:{"image-list-card-hover":!e.disabled&&r,"image-list-card-active":!e.disabled&&e.active}},{...l,...e.$attrs}),{default:v(()=>[f(St,{title:e.htmlTitle},{default:v(()=>[f(pe,{"no-gutters":"",class:"flex-nowrap"},{default:v(()=>[e.selectable?(C(),B(ue,{key:0,cols:"1",class:"d-flex align-center"},{default:v(()=>[(C(),B(Ke,{onClick:t[0]||(t[0]=J(()=>{},["stop"])),key:e.id,density:"compact",disabled:e.disabled,value:e.inputValue,"model-value":e.modelValue,"onUpdate:modelValue":t[1]||(t[1]=c=>e.$emit("update:model-value",c))},null,8,["disabled","value","model-value"]))]),_:1})):G("",!0),f(ue,{cols:"4",class:"image-container flex-grow-0",style:nt({maxWidth:`${e.imageSize}px`})},{default:v(()=>[f(Un,{contain:"",height:`${e.imageSize}px`,width:`${e.imageSize}px`,src:e.imageUrl},null,8,["height","width","src"]),f(s,{disabled:!e.$slots["image-overlay"]},{default:v(()=>[se(e.$slots,"image-overlay",{},void 0,!0)]),_:3},8,["disabled"])]),_:3},8,["style"]),f(ue,{cols:e.selectable?7:8,class:"ml-2"},{default:v(()=>[se(e.$slots,"default",{},void 0,!0)]),_:3},8,["cols"])]),_:3})]),_:3},8,["title"])]),_:2},1040,["disabled","ripple","class"])]),_:3})}const Tc=z(l5,[["render",c5],["__scopeId","data-v-02dccfca"]]),u5=F({components:{ImageListCard:Tc},setup(){const e=Oe(),t=_e({progress:{}}),n=_e({urlToID:{},idToURL:{}}),o=l=>{const c=n.idToURL[l];c&&(delete n.idToURL[l],delete n.urlToID[c])};Ae().$onAction(({name:l,args:c,after:u})=>{l==="deleteData"&&u(()=>{const[p]=c;o(p)})}),Se().$onAction(({name:l,args:c,after:u})=>{l==="deleteVolume"&&u(()=>{const[p]=c;o(p)})});async function s(l){var u;const c=p=>{t.progress[l.name]={state:0,progress:p*100}};try{c(1/0);const p=await wl(l.url,l.filename,{progress:c});t.progress[l.name].state=2;const[d]=await ds([J1(p,l.url)]);if(!d)throw new Error("Did not receive a load result");if(!d.ok)throw d.errors[0].cause;const m=Tl(d);m&&(n.idToURL[m]=l.url,n.urlToID[l.url]=m,Lt().setDefaults(m,{transferFunction:{preset:(u=l.defaults)==null?void 0:u.colorPreset}})),e.setPrimarySelection(m)}catch(p){t.progress[l.name].state=1,Ze().addError("Failed to load sample data",p)}finally{delete t.progress[l.name]}}return{samples:w(()=>s1.map(l=>{var m,g,A;const c=((m=t.progress[l.name])==null?void 0:m.state)===2,u=((g=t.progress[l.name])==null?void 0:g.state)===1,p=!!n.urlToID[l.url],d=c||p?100:Math.floor((A=t.progress[l.name])==null?void 0:A.progress);return{...l,isDownloading:l.name in t.progress,isDone:c,isError:u,isLoaded:p,indeterminate:d===1/0,progress:d}})),downloadSample:s}}});const d5={"data-testid":"samples-list"},p5={class:"text-body-2 font-weight-bold text-no-wrap text-truncate"},f5={class:"text-body-2 mt-2"},m5={key:2,class:"text-caption text--white"};function g5(e,t,n,o,a,i){const s=q("image-list-card");return C(),L("div",d5,[(C(!0),L(ne,null,de(e.samples,r=>(C(),B(s,{disabled:r.isDownloading||r.isLoaded,key:r.name,"html-title":r.name,"image-url":r.image,"image-size":100,class:"mb-1",onClick:l=>e.downloadSample(r)},yu({default:v(()=>[_("div",p5,H(r.name),1),_("div",f5,H(r.description),1)]),_:2},[r.isDownloading||r.isLoaded?{name:"image-overlay",fn:v(()=>[f(pe,{class:"fill-height ma-0 align-center justify-center"},{default:v(()=>[f(wt,{class:"sample-progress",color:"white",indeterminate:r.indeterminate&&!r.isDone,"model-value":r.progress},{default:v(()=>[r.isDone||r.isLoaded?(C(),B(K,{key:0,small:"",color:"white"},{default:v(()=>[P(" mdi-check ")]),_:1})):r.isError?(C(),B(K,{key:1,small:"",color:"white"},{default:v(()=>[P(" mdi-alert-circle ")]),_:1})):r.indeterminate?G("",!0):(C(),L("span",m5,H(r.progress),1))]),_:2},1032,["indeterminate","model-value"])]),_:2},1024)]),key:"0"}:void 0]),1032,["disabled","html-title","image-url","onClick"]))),128))])}const v5=z(u5,[["render",g5],["__scopeId","data-v-2f8ee421"]]);var On=(e=>(e[e.First=0]="First",e[e.Middle=1]="Middle",e[e.Last=2]="Last",e))(On||{});function h5(e,t,n,o,a){const i=new ImageData(t,n),s=new Uint32Array(i.data.buffer),r=255/(a-o);for(let l=0;l<e.length;l+=1){const c=Math.floor((e[l]-o)*r);s[l]=255<<24|c<<16|c<<8|c}return i}function A5(e,t=2,n=On.Middle){const o=e.getPointData().getScalars(),a=o.getData(),i=o.getRange(),s=e.getDimensions();let r=0;n===On.Middle?r=Math.floor(s[t]/2):n===On.Last&&(r=s[t]-1);let l,c,u;if(t===0){l=new a.constructor(s[1]*s[2]),[,c,u]=s;for(let p=0;p<s[2];p++)for(let d=0;d<s[1];d++){const m=r+d*s[0]+p*s[0]*s[1],g=p*s[1]+d;l[g]=a[m]}}else if(t===1){l=new a.constructor(s[0]*s[2]),[c,,u]=s;for(let p=0;p<s[2];p++)for(let d=0;d<s[0];d++){const m=d+r*s[0]+p*s[0]*s[1],g=p*s[0]+d;l[g]=a[m]}}else if(t===2){[c,u]=s;const p=s[0]*s[1],d=r*p;l=Array.isArray(a)?a.slice(d,d+p):a.subarray(d,d+p)}return h5(l,c,u,i[0],i[1])}function y5(){const e=document.createElement("canvas"),t=e.getContext("2d"),n=document.createElement("canvas"),o=n.getContext("2d");if(!t||!o)throw new Error("[thumbnailer] Failed to create a 2D context");return{generate(a,i=2,s=On.Middle){return A5(a,i,s)},imageDataToDataURI(a,i,s){e.width=a.width,e.height=a.height,t.putImageData(a,0,0);let{width:r,height:l}=a;return a.width>a.height?(r=i,l*=i/a.width):(l=s,r*=s/a.height),n.width=r,n.height=l,o.clearRect(0,0,r,l),o.scale(r/a.width,l/a.height),o.drawImage(e,0,0),n.toDataURL("image/jpeg")}}}function Yo(e){const t=O([]);X(e,()=>{t.value=t.value.filter(i=>e.value.includes(i))});const n=w(()=>t.value.length>0),o=w(()=>t.value.length>0&&t.value.length===e.value.length);return{selected:t,selectedAll:o,selectedSome:n,toggleSelectAll:()=>{o.value?t.value=[]:t.value=e.value}}}function sa(e){return`image-${e}`}const w5=F({components:{ItemGroup:Go,GroupableItem:zo,ImageListCard:Tc},setup(){const e=Ae(),t=Oe(),n=st(),o=et(),a=Dt(),i=Yt(),s=w(()=>t.primarySelection),r=w(()=>e.idList.filter(R=>Ft(R))),l=w(()=>{const{metadata:R}=e,D=n.getLayers(s.value).filter(({selection:V})=>Ft(V)),$=D.map(({selection:V})=>V),M=D.filter(({id:V})=>V in n.layerImages).map(({selection:V})=>V),x=Ft(s.value)&&s.value;return r.value.map(V=>{const T=V,U=$.includes(V),Q=M.includes(V),Z=U&&!Q,ee=V!==x&&s.value!=null;return{id:V,cacheKey:sa(V),selectionKey:T,name:R[V].name,dimensions:R[V].dimensions,spacing:[...R[V].spacing].map(N=>N.toFixed(2)),layerable:ee,layerLoading:Z,isLayer:U,layerHandler:()=>{!Z&&ee&&(U?n.deleteLayer(s.value,T):n.addLayer(s.value,T))}}})}),c=_e({}),u=y5();X(r,R=>{R.forEach(async $=>{const M=sa($);if(!(M in c)){const x=e.dataIndex[$],V=u.generate(x),T=u.imageDataToDataURI(V,100,100),U=x.getDimensions(),Q=U[0]/U[1];c[M]={imageURI:T,aspectRatio:Q}}});const D=new Set(R.map($=>sa($)));Object.keys(c).forEach($=>{D.has($)||delete c[$]})},{immediate:!0,deep:!0});const p=w(()=>e.checkAllImagesSameSpace()),d=w(()=>a.isSync()&&i.isSync());function m(){a.toggleSyncImages(),i.toggleSyncCameras(),i.disableCameraAutoReset=d.value}X(d,()=>{a.updateSyncConfigs(),i.updateSyncConfigs()});const{selected:g,selectedAll:A,selectedSome:y,toggleSelectAll:h}=Yo(r);function S(){g.value.forEach(t.remove),g.value=[]}function E(R){s.value&&o.convertImageToLabelmap(R,s.value)}function k(R){t.remove(R)}return{selected:g,selectedAll:A,selectedSome:y,toggleSelectAll:h,removeSelection:S,removeData:k,convertToLabelMap:E,images:l,thumbnails:c,primarySelection:s,selectionEquals:Qa,setPrimarySelection:R=>{t.setPrimarySelection(R)},sameSpaceImages:p,toggleSyncImages:m,isSync:d}}});const S5={key:0,class:"text-center"},C5={class:"d-flex flex-row justify-space-between"},b5={class:"allow-trunc-text-flex-child"},_5={class:"text-body-2 font-weight-bold text-no-wrap text-truncate"},I5={class:"text-caption"},k5={class:"text-caption"},D5={key:0,style:{margin:"0 auto"}},E5={key:0},R5={key:1};function V5(e,t,n,o,a,i){const s=q("image-list-card"),r=q("groupable-item"),l=q("item-group");return C(),L("div",null,[e.images.length===0?(C(),L("div",S5,"No images loaded")):G("",!0),Vt(f(St,{class:"pa-0"},{default:v(()=>[f(pe,{"no-gutters":"",justify:"space-between",align:"center",class:"mb-1"},{default:v(()=>[f(ue,{cols:"6"},{default:v(()=>[f(Ke,{class:"ml-3",indeterminate:e.selectedSome&&!e.selectedAll,label:"Select All",modelValue:e.selectedAll,"onUpdate:modelValue":t[0]||(t[0]=c=>e.selectedAll=c),onClick:J(e.toggleSelectAll,["stop"]),density:"compact","hide-details":""},null,8,["indeterminate","modelValue","onClick"])]),_:1}),f(ue,{cols:"6","align-self":"center",class:"d-flex justify-end"},{default:v(()=>[f(te,{icon:"",variant:"text",disabled:!e.sameSpaceImages,onClick:J(e.toggleSyncImages,["stop"])},{default:v(()=>[e.isSync?(C(),B(K,{key:0},{default:v(()=>[P("mdi-lock")]),_:1})):(C(),B(K,{key:1,flip:"vertical"},{default:v(()=>[P("mdi-lock-open-variant")]),_:1})),f(fe,{disabled:!e.sameSpaceImages,location:"left",activator:"parent"},{default:v(()=>[P(" Sync Images ")]),_:1},8,["disabled"])]),_:1},8,["disabled","onClick"]),f(te,{icon:"",variant:"text",disabled:!e.selectedSome,onClick:J(e.removeSelection,["stop"])},{default:v(()=>[f(K,null,{default:v(()=>[P("mdi-delete")]),_:1}),f(fe,{disabled:!e.selectedSome,location:"left",activator:"parent"},{default:v(()=>[P(" Delete selected ")]),_:1},8,["disabled"])]),_:1},8,["disabled","onClick"])]),_:1})]),_:1})]),_:1},512),[[Tt,e.images.length]]),f(l,{"model-value":e.primarySelection,"equals-test":e.selectionEquals,"onUpdate:modelValue":e.setPrimarySelection},{default:v(()=>[(C(!0),L(ne,null,de(e.images,c=>(C(),B(r,{key:c.id,value:c.selectionKey},{default:v(({active:u,select:p})=>[f(s,{modelValue:e.selected,"onUpdate:modelValue":t[1]||(t[1]=d=>e.selected=d),class:"mt-1 position-relative",selectable:"",inputValue:c.id,active:u,"html-title":c.name,"image-url":(e.thumbnails[c.cacheKey]||{}).imageURI||"","image-size":100,id:c.id,onClick:p},{default:v(()=>[_("div",C5,[_("div",b5,[_("div",_5,H(c.name),1),_("div",I5," Dims: ("+H(c.dimensions.join(", "))+") ",1),_("div",k5," Spacing: ("+H(c.spacing.join(", "))+") ",1)]),f(te,{icon:"",variant:"plain",size:"x-small",class:"dataset-menu"},{default:v(()=>[f(Mt,{activator:"parent"},{default:v(()=>[f(It,null,{default:v(()=>[c.layerable?(C(),B(ke,{key:0,onClick:J(d=>c.layerHandler(),["stop"])},{default:v(()=>[c.layerLoading?(C(),L("div",D5,[f(wt,{indeterminate:"",size:"small"})])):(C(),L(ne,{key:1},[c.isLayer?(C(),L("span",E5,"Remove as layer")):(C(),L("span",R5,"Add as layer"))],64))]),_:2},1032,["onClick"])):G("",!0),f(ke,{onClick:d=>c.layerable?e.convertToLabelMap(c.id):null},{default:v(()=>[c.layerable?G("",!0):(C(),B(K,{key:0,class:"mr-1"},{default:v(()=>[P(" mdi-alert ")]),_:1})),P(" Convert to Segment Group "),f(fe,{activator:"parent",location:"end","max-width":"200px",disabled:c.layerable},{default:v(()=>[P(" Must load a background image before converting ")]),_:2},1032,["disabled"])]),_:2},1032,["onClick"]),f(ke,{onClick:d=>e.removeData(c.id)},{default:v(()=>[P(" Delete ")]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024),f(K,{size:"medium"},{default:v(()=>[P("mdi-dots-vertical")]),_:1})]),_:2},1024)])]),_:2},1032,["modelValue","inputValue","active","html-title","image-url","id","onClick"])]),_:2},1032,["value"]))),128))]),_:1},8,["model-value","equals-test","onUpdate:modelValue"])])}const T5=z(w5,[["render",V5],["__scopeId","data-v-dc8763a3"]]),no=document.createElement("canvas");function ia(e){return`dicom-${e}`}function P5(e){const[t,n]=e.size,o=new ImageData(t,n),a=new Uint32Array(o.data.buffer),i=e.data;if(!i)return"";for(let r=0;r<i.length;r+=1){const l=i[r];a[r]=255<<24|l<<16|l<<8|l}no.width=t,no.height=n;const s=no.getContext("2d");return s?(s.putImageData(o,0,0),no.toDataURL("image/png")):""}async function M5(e,t){if(t in e.volumeInfo)return await e.getVolumeThumbnail(t);throw new Error("No matching volume key in dicomStore")}const O5=F({name:"PatientStudyVolumeBrowser",props:{volumeKeys:{type:Array,required:!0}},components:{GroupableItem:zo,PersistentOverlay:qn},setup(e){const{volumeKeys:t}=ae(e),n=Se(),o=Oe(),a=st(),i=w(()=>o.primarySelection),s=w(()=>{const g=n.volumeInfo,A=i.value,y=a.getLayers(A).filter(({selection:k})=>Ge(k)),h=y.map(({selection:k})=>k),S=y.filter(({id:k})=>k in a.layerImages).map(({selection:k})=>k),E=Ge(A)&&A;return t.value.map(k=>{const R=k,D=h.includes(k),$=S.includes(k),M=D&&!$,x=k!==E&&A;return{key:k,cacheKey:ia(k),info:g[k],name:ja(g[k]),selectionKey:R,isLayer:D,layerable:x,layerLoading:M,layerHandler:()=>{!M&&x&&(D?a.deleteLayer(A,R):a.addLayer(A,R))}}})}),r=_e({});X(t,g=>{g.forEach(async y=>{const h=ia(y);if(!(h in r))try{const S=await M5(n,y);if(S!==null){const E=P5(S);r[h]={kind:"image",value:E}}else r[h]={kind:"text",value:n.volumeInfo[y].Modality}}catch(S){S instanceof Error&&Ze().addError("Failed to generate thumbnails",{details:`${S}. More details can be found in the developer's console.`}),r[h]={kind:"text",value:n.volumeInfo[y].Modality}}});const A=new Set(g.map(y=>ia(y)));Object.keys(r).forEach(y=>{A.has(y)||delete r[y]})},{immediate:!0,deep:!0});const{selected:l,selectedAll:c,selectedSome:u,toggleSelectAll:p}=Yo(t),d=g=>{o.remove(g)};return{selected:l,selectedAll:c,selectedSome:u,toggleSelectAll:p,thumbnailCache:r,volumes:s,removeData:d,removeSelectedDICOMVolumes:()=>{[...l.value].forEach(d),l.value=[]}}}});const L5={class:"my-2 volume-list"},B5={class:"thumbnail-container"},$5={key:1},x5={class:"d-flex flex-column fill-height"},U5={class:"mb-1 ml-1 text-caption"},N5={key:0,style:{margin:"0 auto"}},F5={key:0},W5={key:1},H5={class:"text-ellipsis"};function G5(e,t,n,o,a,i){const s=q("persistent-overlay"),r=q("groupable-item");return C(),B(St,{class:"pa-0"},{default:v(()=>[f(pe,{"no-gutters":"",justify:"space-between"},{default:v(()=>[f(ue,{cols:"6","align-self":"center"},{default:v(()=>[f(Ke,{class:"ml-3 align-center justify-center",indeterminate:e.selectedSome&&!e.selectedAll,label:"Select All",modelValue:e.selectedAll,"onUpdate:modelValue":t[0]||(t[0]=l=>e.selectedAll=l),onClick:J(e.toggleSelectAll,["stop"]),density:"compact","hide-details":""},null,8,["indeterminate","modelValue","onClick"])]),_:1}),f(ue,{cols:"6","align-self":"center",class:"d-flex justify-end mt-2"},{default:v(()=>[f(te,{icon:"",variant:"text",disabled:!e.selectedSome,onClick:J(e.removeSelectedDICOMVolumes,["stop"])},{default:v(()=>[f(K,null,{default:v(()=>[P("mdi-delete")]),_:1}),f(fe,{location:"left",activator:"parent"},{default:v(()=>[P(" Delete selected ")]),_:1})]),_:1},8,["disabled","onClick"])]),_:1})]),_:1}),f(pe,{"no-gutters":""},{default:v(()=>[f(ue,null,{default:v(()=>[_("div",L5,[(C(!0),L(ne,null,de(e.volumes,l=>(C(),B(r,{key:l.info.VolumeID,value:l.selectionKey},{default:v(({active:c,select:u})=>[f(Pe,{variant:"outlined",ripple:"",class:be({"volume-card":!0,"mt-1":!0,"volume-card-active":c}),"min-height":"180px","min-width":"180px","html-title":l.info.SeriesDescription,onClick:u},{default:v(()=>[f(pe,{"no-gutters":"",class:"pa-0",justify:"center"},{default:v(()=>[_("div",B5,[f(Un,{cover:"",height:"150",width:"150",src:e.thumbnailCache[l.cacheKey]&&e.thumbnailCache[l.cacheKey].kind==="image"&&e.thumbnailCache[l.cacheKey].value||""},{placeholder:v(()=>[f(pe,{class:"fill-height ma-0",align:"center",justify:"center"},{default:v(()=>[e.thumbnailCache[l.cacheKey]===void 0?(C(),B(wt,{key:0,indeterminate:"",color:"grey-lighten-5"})):e.thumbnailCache[l.cacheKey]&&e.thumbnailCache[l.cacheKey].kind==="text"?(C(),L("span",$5,H(e.thumbnailCache[l.cacheKey].value),1)):G("",!0)]),_:2},1024)]),default:v(()=>[f(s,null,{default:v(()=>[_("div",x5,[f(pe,{"no-gutters":"",justify:"end","align-content":"start"},{default:v(()=>[(C(),B(Ke,{key:l.info.VolumeID,value:l.key,modelValue:e.selected,"onUpdate:modelValue":t[1]||(t[1]=p=>e.selected=p),onClick:t[2]||(t[2]=J(()=>{},["stop"])),density:"compact","hide-details":"",class:"series-selector"},null,8,["value","modelValue"]))]),_:2},1024),f(pt),f(pe,{"no-gutters":"",justify:"start",align:"end"},{default:v(()=>[_("div",U5," ["+H(l.info.NumberOfSlices)+"] ",1)]),_:2},1024)])]),_:2},1024)]),_:2},1032,["src"])]),f(te,{icon:"",variant:"plain",size:"x-small",class:"dataset-menu",onClick:t[3]||(t[3]=J(()=>{},["stop"])),"data-testid":"dataset-menu-button"},{default:v(()=>[f(Mt,{activator:"parent"},{default:v(()=>[f(It,null,{default:v(()=>[l.layerable?(C(),B(ke,{key:0,onClick:J(p=>l.layerHandler(),["stop"]),"data-testid":"dataset-menu-layer-item"},{default:v(()=>[l.layerLoading?(C(),L("div",N5,[f(wt,{indeterminate:"",size:"small"})])):(C(),L(ne,{key:1},[l.isLayer?(C(),L("span",F5,"Remove as layer")):(C(),L("span",W5,"Add as layer"))],64))]),_:2},1032,["onClick"])):G("",!0),f(ke,{onClick:p=>e.removeData(l.key)},{default:v(()=>[P(" Delete ")]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024),f(K,{size:"medium"},{default:v(()=>[P("mdi-dots-vertical")]),_:1})]),_:2},1024)]),_:2},1024),f(ot,{class:"text--primary text-caption text-center series-desc mt-n3"},{default:v(()=>[_("div",H5,H(l.name),1)]),_:2},1024)]),_:2},1032,["class","html-title","onClick"])]),_:2},1032,["value"]))),128))])]),_:1})]),_:1})]),_:1})}const z5=z(O5,[["render",G5],["__scopeId","data-v-48fa33b8"]]),j5=F({name:"PatientBrowser",props:{patientKey:{type:String,required:!0}},components:{ItemGroup:Go,PatientStudyVolumeBrowser:z5},setup(e){const{patientKey:t}=ae(e),n=Se(),o=Oe(),a=w(()=>o.primarySelection),i=w(()=>{const m=t.value,{patientStudies:g,studyInfo:A,studyVolumes:y}=n;return(g[m]??[]).map(h=>{const S=A[h];return{...S,key:h,title:S.StudyDescription||S.StudyDate||S.StudyInstanceUID,volumeKeys:y[h].sort()}})}),s=w(()=>i.value.map(m=>m.key)),r=O([]);X(s,m=>{r.value=Array.from(new Set([...r.value,...m]))},{immediate:!0});const{selected:l,selectedAll:c,selectedSome:u,toggleSelectAll:p}=Yo(s);return{selected:l,selectedAll:c,selectedSome:u,toggleSelectAll:p,primarySelection:a,removeSelectedStudies:()=>{l.value.flatMap(m=>n.studyVolumes[m]).forEach(o.remove),l.value=[]},studies:i,selectionEquals:Qa,setPrimarySelection:m=>{o.setPrimarySelection(m)},panels:r}}});const Q5={class:"study-header"},q5={class:"study-header-title"},K5={class:"ml-2 overflow-hidden text-no-wrap"},Z5=["title"],Y5={key:0,class:"text-caption text-truncate"},J5={class:"d-flex flex-column align-center justify-end mx-2"},X5={class:"d-flex flex-row align-center mr-2"},e8={class:"text-caption text--secondary text-no-wrap"};function t8(e,t,n,o,a,i){const s=q("patient-study-volume-browser"),r=q("item-group");return C(),B(r,{"model-value":e.primarySelection,"equals-test":e.selectionEquals,"onUpdate:modelValue":e.setPrimarySelection},{default:v(()=>[f(St,{class:"pa-0"},{default:v(()=>[f(pe,{"no-gutters":"",justify:"space-between",class:"mb-2"},{default:v(()=>[f(ue,{cols:"6","align-self":"center"},{default:v(()=>[f(Ke,{class:"ml-3 align-center justify-center",indeterminate:e.selectedSome&&!e.selectedAll,label:"Select All Studies",modelValue:e.selectedAll,"onUpdate:modelValue":t[0]||(t[0]=l=>e.selectedAll=l),onClick:J(e.toggleSelectAll,["stop"]),density:"compact","hide-details":""},null,8,["indeterminate","modelValue","onClick"])]),_:1}),f(ue,{cols:"6","align-self":"center",class:"d-flex justify-end mt-2"},{default:v(()=>[f(te,{icon:"",variant:"text",disabled:!e.selectedSome,onClick:J(e.removeSelectedStudies,["stop"])},{default:v(()=>[f(K,null,{default:v(()=>[P("mdi-delete")]),_:1}),f(fe,{activator:"parent",location:"left"},{default:v(()=>[P(" Delete Selected ")]),_:1})]),_:1},8,["disabled","onClick"])]),_:1})]),_:1})]),_:1}),f(Kt,{modelValue:e.panels,"onUpdate:modelValue":t[3]||(t[3]=l=>e.panels=l),id:"patient-data-studies",accordion:"",multiple:""},{default:v(()=>[(C(!0),L(ne,null,de(e.studies,l=>(C(),B(Ne,{key:l.StudyInstanceUID,value:l.StudyInstanceUID,class:"patient-data-study-panel"},{default:v(()=>[f(Fe,{color:"#1976fa0a",class:"pl-3 no-select",title:l.StudyDate},{default:v(()=>[_("div",Q5,[_("div",q5,[(C(),B(Ke,{class:"study-selector",density:"compact","hide-details":"",key:l.StudyInstanceUID,value:l.StudyInstanceUID,modelValue:e.selected,"onUpdate:modelValue":t[1]||(t[1]=c=>e.selected=c),onClick:t[2]||(t[2]=J(()=>{},["stop"]))},null,8,["value","modelValue"])),f(K,null,{default:v(()=>[P("mdi-folder-table")]),_:1}),_("div",K5,[_("div",{class:"text-subtitle-2 text-truncate",title:l.title},H(l.title),9,Z5),l.StudyDescription?(C(),L("div",Y5,H(l.StudyDate),1)):G("",!0)])]),_("div",J5,[_("div",X5,[f(K,{small:""},{default:v(()=>[P("mdi-folder-open")]),_:1}),_("span",e8," : "+H(l.volumeKeys.length),1),f(fe,{location:"bottom",activator:"parent"},{default:v(()=>[P(" Total series in study ")]),_:1})])])])]),_:2},1032,["title"]),f(We,null,{default:v(()=>[f(s,{"volume-keys":l.volumeKeys},null,8,["volume-keys"])]),_:2},1024)]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"])]),_:1},8,["model-value","equals-test","onUpdate:modelValue"])}const n8=z(j5,[["render",t8],["__scopeId","data-v-e8d2834d"]]),o8=e=>{if(!e||e.total===0)return 0;const{total:t,loaded:n}=e;return Math.round(100*n/t)},a8=F({name:"StudyVolumeDicomWeb",props:{volumeKeys:{type:Array,required:!0}},components:{PersistentOverlay:qn},setup(e){const t=gt(),n=Gn(),{volumeKeys:o}=ae(e),a=w(()=>{const{volumeInstances:c,instanceInfo:u}=t;return o.value.filter(p=>u[c[p][0]])}),i=O(!0);n.fetchVolumesMeta(o.value).then(()=>{i.value=!1});const s=w(()=>{if(i.value)return[];const{volumeInfo:c,volumeInstances:u,instanceInfo:p}=t;return a.value.map(d=>{const{Rows:m,Columns:g}=p[u[d][0]],A=c[d];return{key:d,info:A,widthHeightFrames:`${g} x ${m} x ${A.NumberOfSlices}`,isDisabled:!Ul(n.volumes[d]),progress:{...n.volumes[d],percent:o8(n.volumes[d])}}})}),r=_e({});X([a,i],([c,u])=>{u||c.filter(p=>!(p in r)).forEach(async p=>{const d=await n.fetchVolumeThumbnail(p);d!==null&&(r[p]=d)})},{immediate:!0,deep:!0});function l(c){n.downloadVolume(c)}return{thumbnailCache:r,volumes:s,downloadDicom:l,formatBytes:Gd,isFetching:i}}});const s8={class:"my-2 volume-list"},i8={class:"thumbnail-container"},r8={class:"mb-1 ml-1 text-caption"},l8={class:"d-flex flex-column fill-height ma-0"},c8={key:2,class:"text-caption text--white"},u8={key:0,class:"mb-1 text-caption"},d8={class:"text-ellipsis"};function p8(e,t,n,o,a,i){const s=q("persistent-overlay");return C(),B(St,{class:"pa-0"},{default:v(()=>[f(pe,{"no-gutters":""},{default:v(()=>[f(ue,null,{default:v(()=>[_("div",s8,[e.isFetching?(C(),B(wt,{key:0,class:"fetching",indeterminate:""})):G("",!0),(C(!0),L(ne,null,de(e.volumes,r=>(C(),B(Pe,{key:r.info.VolumeID,variant:"outlined",class:"volume-card mt-1","min-height":"180px","min-width":"180px","html-title":r.info.SeriesDescription,disabled:r.isDisabled,ripple:!r.isDisabled,onClick:l=>e.downloadDicom(r.info.VolumeID)},{default:v(()=>[f(pe,{"no-gutters":"",class:"pa-0",justify:"center"},{default:v(()=>[_("div",i8,[f(Un,{cover:"",height:"150",width:"150",src:(e.thumbnailCache||{})[r.key]||""},{default:v(()=>[f(s,null,{default:v(()=>[f(pe,{"no-gutters":""},{default:v(()=>[_("div",r8,[P(H(r.widthHeightFrames)+" ",1),f(fe,{location:"top",activator:"parent"},{default:v(()=>[P(" Width by height by frames ")]),_:1})])]),_:2},1024)]),_:2},1024),r.progress&&r.progress.state&&r.progress.state!=="Remote"?(C(),B(s,{key:0},{default:v(()=>[_("div",l8,[f(pe,{"no-gutters":"",justify:"center",align:"end"},{default:v(()=>[f(wt,{color:"white",indeterminate:r.progress.percent===0&&r.progress.state==="Pending","model-value":r.progress.percent},{default:v(()=>[r.progress.state==="Done"?(C(),B(K,{key:0,color:"white"},{default:v(()=>[P(" mdi-check ")]),_:1})):r.progress.state==="Error"?(C(),B(K,{key:1,color:"white"},{default:v(()=>[P(" mdi-alert-circle ")]),_:1})):r.progress.percent!==0?(C(),L("span",c8,H(r.progress.percent),1)):G("",!0)]),_:2},1032,["indeterminate","model-value"])]),_:2},1024),f(pe,{"no-gutters":"",justify:"center",align:"end"},{default:v(()=>[r.progress.loaded!==0?(C(),L("div",u8,H(e.formatBytes(r.progress.loaded)),1)):G("",!0)]),_:2},1024)])]),_:2},1024)):G("",!0)]),_:2},1032,["src"])])]),_:2},1024),f(ot,{class:"text--primary text-caption text-center series-desc mt-n3"},{default:v(()=>[_("div",d8,H(r.info.SeriesDescription||"(no series description)"),1)]),_:2},1024)]),_:2},1032,["html-title","disabled","ripple","onClick"]))),128))])]),_:1})]),_:1})]),_:1})}const f8=z(a8,[["render",p8],["__scopeId","data-v-10103d30"]]),m8=F({name:"PatientDetails",props:{patientKey:{type:String,required:!0}},components:{StudyVolumeDicomWeb:f8},setup(e){const{patientKey:t}=ae(e),n=gt(),o=Gn(),a=O(!0);o.fetchPatientMeta(t.value).then(()=>{a.value=!1});const i=w(()=>{const{patientStudies:l,studyInfo:c,studyVolumes:u}=n;return l[t.value].map(p=>{const d=c[p];return{...d,key:p,title:d.StudyDescription||d.StudyDate||d.StudyInstanceUID,volumeKeys:u[p].sort()}})}),s=w(()=>i.value.map(({key:l})=>l)),r=O([]);return X(s,l=>{o.linkedToStudyOrSeries&&(r.value=Array.from(new Set([...r.value,...l])))},{immediate:!0}),{studies:i,isFetching:a,panels:r}}});const g8={class:"study-header"},v8={class:"study-header-title"},h8={class:"ml-2 overflow-hidden text-no-wrap"},A8=["title"],y8={key:0,class:"text-caption text-truncate"},w8={class:"d-flex flex-column align-center justify-end mx-2"},S8={class:"d-flex flex-row align-center mr-2"},C8={class:"text-caption text--secondary text-no-wrap"};function b8(e,t,n,o,a,i){const s=q("study-volume-dicom-web");return C(),B(Kt,{id:"patient-data-studies",modelValue:e.panels,"onUpdate:modelValue":t[0]||(t[0]=r=>e.panels=r),accordion:"",multiple:""},{default:v(()=>[(C(!0),L(ne,null,de(e.studies,r=>(C(),B(Ne,{key:r.StudyInstanceUID,value:r.StudyInstanceUID,class:"patient-data-study-panel"},{default:v(()=>[f(Fe,{color:"#1976fa0a",class:"pl-3 no-select",title:r.StudyDate},{default:v(()=>[_("div",g8,[_("div",v8,[f(K,{class:"mb-2"},{default:v(()=>[P("mdi-folder-table")]),_:1}),_("div",h8,[_("div",{class:"text-subtitle-2 text-truncate",title:r.title},H(r.title),9,A8),r.StudyDescription?(C(),L("div",y8,H(r.StudyDate),1)):G("",!0)])]),_("div",w8,[_("div",S8,[e.isFetching?(C(),B(wt,{key:0,indeterminate:"",size:20,width:2,class:"mr-2"})):G("",!0),f(K,{size:"small"},{default:v(()=>[P("mdi-folder-open")]),_:1}),_("span",C8," : "+H(r.volumeKeys.length),1),f(fe,{location:"bottom",activator:"parent"},{default:v(()=>[P(" Total series in study ")]),_:1})])])])]),_:2},1032,["title"]),f(We,null,{default:v(()=>[f(s,{"volume-keys":r.volumeKeys},null,8,["volume-keys"])]),_:2},1024)]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"])}const _8=z(m8,[["render",b8],["__scopeId","data-v-8aca1cfa"]]),I8=F({components:{PatientDetails:_8},setup(){const e=Gn(),t=gt();e.fetchDicomsOnce();const n=w(()=>Object.values(t.patientInfo).map(i=>({key:i.PatientID,name:i.PatientName})).sort((i,s)=>i.name<s.name?-1:1)),o=w(()=>n.value.map(({key:i})=>i)),a=O([]);return X(o,i=>{e.linkedToStudyOrSeries&&(a.value=Array.from(new Set([...a.value,...i])))},{immediate:!0}),{patients:n,dicomWebStore:e,panels:a}}});const k8={key:0,class:"error-message"},D8={class:"patient-header"},E8=["title"];function R8(e,t,n,o,a,i){const s=q("patient-details");return e.dicomWebStore.message.length>0?(C(),L("p",k8,H(e.dicomWebStore.message),1)):e.patients.length>0?(C(),B(Kt,{key:1,modelValue:e.panels,"onUpdate:modelValue":t[0]||(t[0]=r=>e.panels=r),multiple:"",accordion:""},{default:v(()=>[(C(!0),L(ne,null,de(e.patients,r=>(C(),B(Ne,{key:r.key,value:r.key},{default:v(()=>[f(Fe,null,{default:v(()=>[_("div",D8,[f(K,{class:"collection-header-icon"},{default:v(()=>[P("mdi-account")]),_:1}),_("span",{class:"patient-header-name",title:r.name},H(r.name),9,E8)])]),_:2},1024),f(We,null,{default:v(()=>[f(s,{"patient-key":r.key},null,8,["patient-key"])]),_:2},1024)]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"])):G("",!0)}const V8=z(I8,[["render",R8],["__scopeId","data-v-74e782a4"]]),ra="sampleData",Pi="anonymousData",Mi="dicomWeb",T8=F({name:"DataBrowser",components:{SampleDataBrowser:v5,ImageDataBrowser:T5,PatientBrowser:n8,PatientList:V8},setup(){const e=Se(),t=Ae(),n=Gn(),o=Dl(),a=Oe(),i=w(()=>Object.entries(e.patientInfo).map(([u,p])=>({key:u,name:p.PatientName,info:p})).sort((u,p)=>u.name<p.name?-1:1)),s=w(()=>t.idList.filter(u=>Ft(u)).length>0),r=O([ra,Mi]);X([s,i],([u,p])=>{const d=p.length>0;u&&r.value.push(Pi),d&&r.value.push(...p.map(m=>m.key)),(u||d)&&ft(r.value,ra)});const l=w(()=>o.hideSampleData);return{panels:r,patients:i,deletePatient:u=>{e.patientStudies[u].flatMap(p=>e.studyVolumes[p]).forEach(a.remove)},hasAnonymousImages:s,dicomWeb:n,SAMPLE_DATA_KEY:ra,ANONYMOUS_DATA_KEY:Pi,DICOM_WEB_KEY:Mi,hideSampleData:l}}});const Os=e=>($e("data-v-089ea6a8"),e=e(),xe(),e),P8={id:"data-module",class:"mx-1 fill-height"},M8={id:"data-panels"},O8=Os(()=>_("span",null,"Anonymous",-1)),L8={class:"patient-header"},B8=["title"],$8={class:"text-truncate"},x8=Os(()=>_("span",null,"Sample Data",-1)),U8=Os(()=>_("div",{class:"empty-state ma-4 text-center"},"No data loaded",-1));function N8(e,t,n,o,a,i){const s=q("image-data-browser"),r=q("patient-browser"),l=q("patient-list"),c=q("sample-data-browser");return C(),L("div",P8,[_("div",M8,[f(Kt,{modelValue:e.panels,"onUpdate:modelValue":t[1]||(t[1]=u=>e.panels=u),multiple:"",variant:"accordion",class:"no-panels"},{default:v(()=>[e.hasAnonymousImages?(C(),B(Ne,{key:0,value:e.ANONYMOUS_DATA_KEY},{default:v(()=>[f(Fe,null,{default:v(()=>[f(K,{class:"collection-header-icon"},{default:v(()=>[P("mdi-image")]),_:1}),O8]),_:1}),f(We,null,{default:v(()=>[f(s)]),_:1})]),_:1},8,["value"])):G("",!0),(C(!0),L(ne,null,de(e.patients,u=>(C(),B(Ne,{key:u.key,value:u.key},{default:v(()=>[f(Fe,null,{default:v(()=>[_("div",L8,[f(K,{class:"collection-header-icon"},{default:v(()=>[P("mdi-account")]),_:1}),_("span",{class:"patient-header-name",title:u.name},H(u.name),9,B8),f(pt),f(Mt,{"offset-x":""},{activator:v(({props:p})=>[f(te,ze(p,{variant:"text",icon:"mdi-dots-vertical",size:"small",class:"mr-3",onClick:t[0]||(t[0]=J(()=>{},["stop"]))}),null,16)]),default:v(()=>[f(It,{density:"compact"},{default:v(()=>[f(ke,{onClick:J(p=>e.deletePatient(u.key),["stop"])},{default:v(()=>[f(Be,null,{default:v(()=>[P("Delete Patient")]),_:1})]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024)])]),_:2},1024),f(We,null,{default:v(()=>[f(r,{"patient-key":u.key},null,8,["patient-key"])]),_:2},1024)]),_:2},1032,["value"]))),128)),e.dicomWeb.isConfigured?(C(),B(Ne,{key:1,value:e.DICOM_WEB_KEY},{default:v(()=>[f(Fe,null,{default:v(()=>[f(K,{class:"collection-header-icon"},{default:v(()=>[P("mdi-cloud-download")]),_:1}),_("span",$8,H(`${e.dicomWeb.hostName||e.dicomWeb.host} | DICOMWeb`),1)]),_:1}),f(We,null,{default:v(()=>[f(l)]),_:1})]),_:1},8,["value"])):G("",!0),e.hideSampleData?G("",!0):(C(),B(Ne,{key:2,value:e.SAMPLE_DATA_KEY},{default:v(()=>[f(Fe,null,{default:v(()=>[f(K,{class:"collection-header-icon"},{default:v(()=>[P("mdi-card-bulleted")]),_:1}),x8]),_:1}),f(We,null,{default:v(()=>[f(c)]),_:1})]),_:1},8,["value"]))]),_:1},8,["modelValue"]),U8])])}const F8=z(T8,[["render",N8],["__scopeId","data-v-089ea6a8"]]),la=re.Three,W8={standard:"Standard",hybrid:"Hybrid"},H8=F({name:"VolumeRendering",setup(){const e=Lt(),{currentImageID:t}=me();Zo(la,t);const n=w(()=>e.getConfig(la,t.value)),o=w(()=>{var d;return(d=n.value)==null?void 0:d.cvr}),a=(d,m)=>{t.value&&e.updateCVRParameters(la,t.value,{[d]:m})},i=w(()=>{var d;return!!((d=o.value)!=null&&d.useLocalAmbientOcclusion)}),s=w(()=>{var d;return!!((d=o.value)!=null&&d.useVolumetricScatteringBlending)}),r=w(()=>{var d;return(d=o.value)!=null&&d.useVolumetricScatteringBlending?"hybrid":"standard"}),l=d=>{a("useVolumetricScatteringBlending",d==="hybrid")},c={1:"Good",2:"Better",3:"Ultra",4:"Beta"},u=O(!1),p=O(!1);return{LIGHTING_MODELS:W8,cvrParams:o,disableQualityWarning:p,laoEnabled:i,lightingModel:r,selectLightingMode:l,setCVRParam:a,showQualityWarning:u,volumeQualityLabels:c,vsbEnabled:s}}}),G8={class:"mx-2"},z8={class:"mt-4",ref:"editorContainerRef"},j8={ref:"pwfEditorRef"},Q8={key:0},q8=_("div",null,[_("b",null,"Ultra"),P(" and "),_("b",null,"Beta"),P(" modes are unstable on some systems. ")],-1);function K8(e,t,n,o,a,i){return C(),L("div",G8,[_("div",z8,[_("div",j8,null,512)],512),e.cvrParams?(C(),L("div",Q8,[f(Ye,{"show-ticks":"always","tick-size":"4",ticks:e.volumeQualityLabels,min:"1",max:"4",step:"1","model-value":e.cvrParams.volumeQuality,"onUpdate:modelValue":t[0]||(t[0]=s=>{e.showQualityWarning=!e.disableQualityWarning&&s>2,e.setCVRParam("volumeQuality",s)})},null,8,["ticks","model-value"]),f(ko,{modelValue:e.showQualityWarning,"onUpdate:modelValue":t[2]||(t[2]=s=>e.showQualityWarning=s),border:"top",variant:"tonal",type:"warning",color:"grey",elevation:"2","close-text":"Close Warning",transition:"slide-y-transition",density:"compact",onClick:t[3]||(t[3]=s=>e.showQualityWarning=!1)},{default:v(()=>[q8,f(te,{size:"small",variant:"tonal",block:"",class:"mt-2",onClick:t[1]||(t[1]=s=>{e.disableQualityWarning=!0,e.showQualityWarning=!1})},{default:v(()=>[P(" Don't Show Again ")]),_:1})]),_:1},8,["modelValue"]),f(Re,{class:"my-8"}),f(Ye,{label:"Ambient",min:"0",max:"1",step:"0.1",density:"compact","hide-details":"","thumb-label":"","model-value":e.cvrParams.ambient,"onUpdate:modelValue":t[4]||(t[4]=s=>e.setCVRParam("ambient",s))},null,8,["model-value"]),f(Ye,{label:"Diffuse",min:"0",max:"1",step:"0.1",density:"compact","hide-details":"","thumb-label":"","model-value":e.cvrParams.diffuse,"onUpdate:modelValue":t[5]||(t[5]=s=>e.setCVRParam("diffuse",s))},null,8,["model-value"]),f(sn,{label:"Light follows camera",density:"compact","hide-details":"","model-value":e.cvrParams.lightFollowsCamera,"onUpdate:modelValue":t[6]||(t[6]=s=>e.setCVRParam("lightFollowsCamera",!!s))},null,8,["model-value"]),f(Re,{class:"my-8"}),f(sn,{label:"Local Ambient Occlusion",density:"compact","hide-details":"","model-value":e.cvrParams.useLocalAmbientOcclusion,"onUpdate:modelValue":t[7]||(t[7]=s=>e.setCVRParam("useLocalAmbientOcclusion",!!s))},null,8,["model-value"]),f(pe,{class:"my-4"},{default:v(()=>[f(Nu,{"model-value":e.lightingModel,"onUpdate:modelValue":e.selectLightingMode,mandatory:"",divided:"",variant:"outlined",class:"w-100"},{default:v(()=>[(C(!0),L(ne,null,de(Object.keys(e.LIGHTING_MODELS),s=>(C(),B(te,{key:s,value:s,class:"w-50"},{default:v(()=>[P(H(s),1)]),_:2},1032,["value"]))),128))]),_:1},8,["model-value","onUpdate:modelValue"])]),_:1}),f(pt,{class:"my-2"}),e.vsbEnabled?(C(),B(Ye,{key:0,label:"Scatter Blending",min:"0",max:"1",step:"0.05",density:"compact","hide-details":"","thumb-label":"","model-value":e.cvrParams.volumetricScatteringBlending,"onUpdate:modelValue":t[8]||(t[8]=s=>e.setCVRParam("volumetricScatteringBlending",s))},null,8,["model-value"])):G("",!0)])):G("",!0)])}const Z8=z(H8,[["render",K8]]),Y8=[{Name:"CT-AAA",NanColor:[1,1,0],ColorSpace:"RGB",AbsoluteRange:!0,OpacityPoints:[-3024,0,143.556,0,166.222,.686275,214.389,.696078,419.736,.833333,3071,.803922],RGBPoints:[-3024,0,0,0,143.556,.615686,.356863,.184314,166.222,.882353,.603922,.290196,214.389,1,1,1,419.736,1,.937033,.954531,3071,.827451,.658824,1],EffectiveRange:[143.556,419.736]},{Name:"CT-AAA2",NanColor:[1,1,0],ColorSpace:"RGB",AbsoluteRange:!0,OpacityPoints:[-3024,0,129.542,0,145.244,.166667,157.02,.5,169.918,.627451,395.575,.8125,1578.73,.8125,3071,.8125],RGBPoints:[-3024,0,0,0,129.542,.54902,.25098,.14902,145.244,.6,.627451,.843137,157.02,.890196,.47451,.6,169.918,.992157,.870588,.392157,395.575,1,.886275,.658824,1578.73,1,.829256,.957922,3071,.827451,.658824,1],EffectiveRange:[0,1600]},{Name:"CT-Bone",NanColor:[1,1,0],ColorSpace:"RGB",AbsoluteRange:!0,OpacityPoints:[-3024,0,-16.4458,0,641.385,.715686,3071,.705882],RGBPoints:[-3024,0,0,0,-16.4458,.729412,.254902,.301961,641.385,.905882,.815686,.552941,3071,1,1,1],EffectiveRange:[-16.4458,641.385]},{Name:"CT-Bones",NanColor:[1,1,0],ColorSpace:"RGB",AbsoluteRange:!0,OpacityPoints:[-1e3,0,152.19,0,278.93,.190476,952,.2],RGBPoints:[-1e3,.3,.3,1,-488,.3,1,.3,463.28,1,0,0,659.15,1,.912535,.0374849,953,1,.3,.3],EffectiveRange:[152.19,952]},{Name:"CT-Cardiac",NanColor:[1,1,0],ColorSpace:"RGB",AbsoluteRange:!0,OpacityPoints:[-3024,0,-77.6875,0,94.9518,.285714,179.052,.553571,260.439,.848214,3071,.875],RGBPoints:[-3024,0,0,0,-77.6875,.54902,.25098,.14902,94.9518,.882353,.603922,.290196,179.052,1,.937033,.954531,260.439,.615686,0,0,3071,.827451,.658824,1],EffectiveRange:[-77.6875,260.439]},{Name:"CT-Cardiac2",NanColor:[1,1,0],ColorSpace:"RGB",AbsoluteRange:!0,OpacityPoints:[-3024,0,42.8964,0,163.488,.428571,277.642,.776786,1587,.754902,3071,.754902],RGBPoints:[-3024,0,0,0,42.8964,.54902,.25098,.14902,163.488,.917647,.639216,.0588235,277.642,1,.878431,.623529,1587,1,1,1,3071,.827451,.658824,1],EffectiveRange:[42.8964,1587]},{Name:"CT-Cardiac3",NanColor:[1,1,0],ColorSpace:"RGB",AbsoluteRange:!0,OpacityPoints:[-3024,0,-86.9767,0,45.3791,.169643,139.919,.589286,347.907,.607143,1224.16,.607143,3071,.616071],RGBPoints:[-3024,0,0,0,-86.9767,0,.25098,1,45.3791,1,0,0,139.919,1,.894893,.894893,347.907,1,1,.25098,1224.16,1,1,1,3071,.827451,.658824,1],EffectiveRange:[-86.9767,1224.16]},{Name:"CT-Chest-Contrast-Enhanced",NanColor:[1,1,0],ColorSpace:"RGB",AbsoluteRange:!0,OpacityPoints:[-3024,0,67.0106,0,251.105,.446429,439.291,.625,3071,.616071],RGBPoints:[-3024,0,0,0,67.0106,.54902,.25098,.14902,251.105,.882353,.603922,.290196,439.291,1,.937033,.954531,3071,.827451,.658824,1],EffectiveRange:[67.0106,439.291]},{Name:"CT-Chest-Vessels",NanColor:[1,1,0],ColorSpace:"RGB",AbsoluteRange:!0,OpacityPoints:[-3024,0,-1278.35,0,22.8277,.428571,439.291,.625,3071,.616071],RGBPoints:[-3024,0,0,0,-1278.35,.54902,.25098,.14902,22.8277,.882353,.603922,.290196,439.291,1,.937033,.954531,3071,.827451,.658824,1],EffectiveRange:[-1278.35,439.291]},{Name:"CT-Coronary-Arteries",NanColor:[1,1,0],ColorSpace:"RGB",AbsoluteRange:!0,OpacityPoints:[-2048,0,136.47,0,159.215,.258929,318.43,.571429,478.693,.776786,3661,1],RGBPoints:[-2048,0,0,0,136.47,0,0,0,159.215,.159804,.159804,.159804,318.43,.764706,.764706,.764706,478.693,1,1,1,3661,1,1,1],EffectiveRange:[136.47,478.693]},{Name:"CT-Coronary-Arteries-2",NanColor:[1,1,0],ColorSpace:"RGB",AbsoluteRange:!0,OpacityPoints:[-2048,0,142.677,0,145.016,.116071,192.174,.5625,217.24,.776786,384.347,.830357,3661,.830357],RGBPoints:[-2048,0,0,0,142.677,0,0,0,145.016,.615686,0,.0156863,192.174,.909804,.454902,0,217.24,.972549,.807843,.611765,384.347,.909804,.909804,1,3661,1,1,1],EffectiveRange:[142.677,384.347]},{Name:"CT-Coronary-Arteries-3",NanColor:[1,1,0],ColorSpace:"RGB",AbsoluteRange:!0,OpacityPoints:[-2048,0,128.643,0,129.982,.0982143,173.636,.669643,255.884,.857143,584.878,.866071,3661,1],RGBPoints:[-2048,0,0,0,128.643,0,0,0,129.982,.615686,0,.0156863,173.636,.909804,.454902,0,255.884,.886275,.886275,.886275,584.878,.968627,.968627,.968627,3661,1,1,1],EffectiveRange:[128.643,584.878]},{Name:"CT-Cropped-Volume-Bone",NanColor:[1,1,0],ColorSpace:"RGB",AbsoluteRange:!0,OpacityPoints:[-2048,0,-451,0,-450,1,1050,1,3661,1],RGBPoints:[-2048,0,0,0,-451,0,0,0,-450,.0556356,.0556356,.0556356,1050,1,1,1,3661,1,1,1],EffectiveRange:[-451,1050]},{Name:"CT-Fat",NanColor:[1,1,0],ColorSpace:"RGB",AbsoluteRange:!0,OpacityPoints:[-1e3,0,-100,0,-99,.15,-60,.15,-59,0,101.2,0,952,0],RGBPoints:[-1e3,.3,.3,1,-497.5,.3,1,.3,-99,0,0,1,-76.946,0,1,0,-65.481,.835431,.888889,.0165387,83.89,1,0,0,463.28,1,0,0,659.15,1,.912535,.0374849,2952,1,.300267,.299886],EffectiveRange:[-100,101.2]},{Name:"CT-Liver-Vasculature",NanColor:[1,1,0],ColorSpace:"RGB",AbsoluteRange:!0,OpacityPoints:[-2048,0,149.113,0,157.884,.482143,339.96,.660714,388.526,.830357,1197.95,.839286,3661,.848214],RGBPoints:[-2048,0,0,0,149.113,0,0,0,157.884,.501961,.25098,0,339.96,.695386,.59603,.36886,388.526,.854902,.85098,.827451,1197.95,1,1,1,3661,1,1,1],EffectiveRange:[149.113,1197.95]},{Name:"CT-Lung",NanColor:[1,1,0],ColorSpace:"RGB",AbsoluteRange:!0,OpacityPoints:[-1e3,0,-600,0,-599,.15,-400,.15,-399,0,2952,0],RGBPoints:[-1e3,.3,.3,1,-600,0,0,1,-530,.134704,.781726,.0724558,-460,.929244,1,.109473,-400,.888889,.254949,.0240258,2952,1,.3,.3],EffectiveRange:[-600,-399]},{Name:"CT-MIP",NanColor:[1,1,0],ColorSpace:"RGB",AbsoluteRange:!0,OpacityPoints:[-3024,0,-637.62,0,700,1,3071,1],RGBPoints:[-3024,0,0,0,-637.62,1,1,1,700,1,1,1,3071,1,1,1],EffectiveRange:[-637.62,700]},{Name:"CT-Muscle",NanColor:[1,1,0],ColorSpace:"RGB",AbsoluteRange:!0,OpacityPoints:[-3024,0,-155.407,0,217.641,.676471,419.736,.833333,3071,.803922],RGBPoints:[-3024,0,0,0,-155.407,.54902,.25098,.14902,217.641,.882353,.603922,.290196,419.736,1,.937033,.954531,3071,.827451,.658824,1],EffectiveRange:[-155.407,419.736]},{Name:"CT-Pulmonary-Arteries",NanColor:[1,1,0],ColorSpace:"RGB",AbsoluteRange:!0,OpacityPoints:[-2048,0,-568.625,0,-364.081,.0714286,-244.813,.401786,18.2775,.607143,447.798,.830357,3592.73,.839286],RGBPoints:[-2048,0,0,0,-568.625,0,0,0,-364.081,.396078,.301961,.180392,-244.813,.611765,.352941,.0705882,18.2775,.843137,.0156863,.156863,447.798,.752941,.752941,.752941,3592.73,1,1,1],EffectiveRange:[-568.625,447.798]},{Name:"CT-Soft-Tissue",NanColor:[1,1,0],ColorSpace:"RGB",AbsoluteRange:!0,OpacityPoints:[-2048,0,-167.01,0,-160,1,240,1,3661,1],RGBPoints:[-2048,0,0,0,-167.01,0,0,0,-160,.0556356,.0556356,.0556356,240,1,1,1,3661,1,1,1],EffectiveRange:[-167.01,240]},{Name:"CT-Air",NanColor:[1,1,0],ColorSpace:"RGB",AbsoluteRange:!0,OpacityPoints:[-3024,.705882,-900,.715686,-500,0,3071,0],RGBPoints:[-3024,1,1,1,-900,.2,1,1,-500,.3,.3,1,3071,0,0,0],EffectiveRange:[-1200,-200]},{Name:"CT-X-ray",NanColor:[1,1,0],ColorSpace:"RGB",AbsoluteRange:!0,OpacityPoints:[-3024,0,-200,0,1500,.05,3071,.05],RGBPoints:[-3024,1,1,1,3071,1,1,1],EffectiveRange:[-250,1550]},{Name:"MR-Angio",NanColor:[1,1,0],ColorSpace:"RGB",AbsoluteRange:!0,OpacityPoints:[-2048,0,151.354,0,158.279,.4375,190.112,.580357,200.873,.732143,3661,.741071],RGBPoints:[-2048,0,0,0,151.354,0,0,0,158.279,.74902,.376471,0,190.112,1,.866667,.733333,200.873,.937255,.937255,.937255,3661,1,1,1],EffectiveRange:[151.354,200.873]},{Name:"MR-Default",NanColor:[1,1,0],ColorSpace:"RGB",AbsoluteRange:!0,OpacityPoints:[0,0,20,0,40,.15,120,.3,220,.375,1024,.5],RGBPoints:[0,0,0,0,20,.168627,0,0,40,.403922,.145098,.0784314,120,.780392,.607843,.380392,220,.847059,.835294,.788235,1024,1,1,1],EffectiveRange:[0,220]},{Name:"MR-MIP",NanColor:[1,1,0],ColorSpace:"RGB",AbsoluteRange:!0,OpacityPoints:[0,0,98.3725,0,416.637,1,2800,1],RGBPoints:[0,1,1,1,98.3725,1,1,1,416.637,1,1,1,2800,1,1,1],EffectiveRange:[0,416.637]},{Name:"MR-T2-Brain",NanColor:[1,1,0],ColorSpace:"RGB",AbsoluteRange:!0,OpacityPoints:[0,0,36.05,0,218.302,.171429,412.406,1,641,1],RGBPoints:[0,0,0,0,98.7223,.956863,.839216,.192157,412.406,0,.592157,.807843,641,1,1,1],EffectiveRange:[0,412.406]},{Name:"DTI-FA-Brain",NanColor:[1,1,0],ColorSpace:"RGB",AbsoluteRange:!0,OpacityPoints:[0,0,0,0,.3501,.0158,.49379,.7619,.6419,1,.992,1,.995,0,.995,0],RGBPoints:[0,1,0,0,0,1,0,0,.24974,.4941,1,0,.49949,0,.9882,1,.7492,.51764,0,1,.995,1,0,0,.995,1,0,0],EffectiveRange:[0,1]},{Name:"US-Fetal",NanColor:[1,1,0],ColorSpace:"RGB",AbsoluteRange:!0,OpacityPoints:[-10,0,0,0,270,.8],RGBPoints:[-10,.325,.153,.153,74,.474,.392,.302,136,.718,.51,.443,270,.76,.44,.53],EffectiveRange:[-10,270]},{ColorSpace:"Lab",Name:"2hot",RGBPoints:[-1,.0416667,0,0,-.873016,.208333,0,0,-.746032,.375,0,0,-.619048,.541667,0,0,-.492063,.708333,0,0,-.365079,.854137,0,0,-.238095,.937488,.039062,0,-.111111,1,.208333,0,.015873,1,.375,0,.142857,1,.541667,0,.269841,1,.708333,0,.396825,1,.858805,.03125,.52381,1,.947392,.15625,.650794,1,1,.3125,.777778,1,1,.5625,.904762,1,1,.8125,1,1,1,1]},{ColorSpace:"HSV",Name:"Blue to Red Rainbow",NanColor:[.498039215686,.498039215686,.498039215686],RGBPoints:[0,0,0,1,1,1,0,0]}];function J8(e){for(let t=0;t<e.length;t+=1)at.addPreset(e[t])}J8(Y8);const X8={...at.getPresetByName("2hot"),Name:"2hot-opaque",OpacityPoints:[0,1]};at.addPreset(X8);const ew=[{group:"CT",presets:["CT-AAA","CT-AAA2","CT-Bone","CT-Bones","CT-Cardiac","CT-Cardiac2","CT-Cardiac3","CT-Chest-Contrast-Enhanced","CT-Chest-Vessels","CT-Coronary-Arteries","CT-Coronary-Arteries-2","CT-Coronary-Arteries-3","CT-Cropped-Volume-Bone","CT-Fat","CT-Liver-Vasculature","CT-Lung","CT-MIP","CT-Muscle","CT-Pulmonary-Arteries","CT-Soft-Tissue","CT-Air","CT-X-ray"]},{group:"MR",presets:["MR-Default","MR-Angio","MR-MIP","MR-T2-Brain"]},{group:"DTI",presets:["DTI-FA-Brain"]},{group:"US",presets:["US-Fetal"]}],Ls=ew.flatMap(e=>e.presets),kn={Gaussians:1,Points:2},tw="-webkit-grab";function Oi(e,t=0,n=0,o=256){const a=[...e];a.push([e[0][0],0]),a.push([e[e.length-1][0],0]);const i=[];let s=0,r=a[0],l=a[1],c=(l[1]-r[1])/(l[0]-r[0]);for(let u=0;u<o;u+=1){const p=u/(o-1)-t;if(u<o-1){for(;p>l[0]&&s<a.length-2;)s+=1,r=a[s],l=a[s+1],Math.abs(l[0]-r[0])<1e-8?c=1/0*Math.sign(l[1]-r[1]):c=(l[1]-r[1])/(l[0]-r[0]);if(c===1/0)i.push(1);else if(c===-1/0)i.push(0);else{let d=c*(p-r[0])+r[1];d=d&&d-n,i.push(d)}}}return i}function nw(e,t){t.classHierarchy.push("vtkPiecewiseWidget");const n={...e};t.pwMode=kn.Gaussians,t.opacityPoints=[],t.opacityPointShift=0,t.opacityValueShift=0,e.setGaussiansMode=()=>{t.pwMode=kn.Gaussians},e.setPointsMode=()=>{t.gaussians=[],t.pwMode=kn.Points},e.isModeGaussians=()=>t.pwMode===kn.Gaussians,e.isModePoints=()=>t.pwMode===kn.Points,e.getMode=()=>t.pwMode,e.shiftPosition=(o,a)=>(t.shiftOpacityValues?t.opacityValueShift=a.originalOpacityValueShift+o[1]-a.originalXY[1]:t.opacityPointShift=a.originalOpacityPointShift+o[0]-a.originalXY[0],!0),e.onHover=(o,a)=>e.isModeGaussians()?n.onHover(o,a):(t.canvas.style.cursor=tw,!0),e.onClick=(o,a)=>{if(e.isModeGaussians())return n.onClick(o,a)},e.onDown=(o,a)=>{if(e.isModeGaussians())return n.onDown(o,a);t.mouseIsDown||e.invokeAnimation(!0);const i=go.normalizeCoordinates(o,a,t.graphArea);return t.mouseIsDown=!0,t.activeGaussian=-1,t.dragAction={originalXY:i,originalOpacityPointShift:t.opacityPointShift,originalOpacityValueShift:t.opacityValueShift},!0},e.onDrag=(o,a)=>{if(e.isModeGaussians())return n.onDrag(o,a);const i=go.normalizeCoordinates(o,a,t.graphArea);return e.shiftPosition(i,t.dragAction)&&(t.opacities=Oi(t.opacityPoints,t.opacityPointShift,t.opacityValueShift),e.invokeOpacityChange(e,!0)),e.modified(),!0},e.setOpacityPoints=(o,a=0,i=0)=>{e.isModePoints()&&(t.opacityPoints=o.map(s=>[s[0],s[1]]),t.opacityPointShift=a,t.opacityValueShift=i,t.opacities=Oi(t.opacityPoints,t.opacityPointShift,t.opacityValueShift),e.modified())},e.getEffectiveOpacityPoints=()=>t.opacityPoints.map(o=>[o[0]+t.opacityPointShift,o[1]+t.opacityValueShift]),e.render=()=>{e.isModePoints()&&(t.activeGaussian=-1,t.selectedGaussian=-1),n.render()}}const ow={};function Pc(e,t,n={}){Object.assign(t,ow,n),go.extend(e,t,n),W.setGet(e,t,["opacityPoints","opacityPointShift","opacityValueShift","shiftOpacityValues"]),nw(e,t)}const aw=W.newInstance(Pc,"vtkPiecewiseWidget"),sw={newInstance:aw,extend:Pc};function iw(e,t){const n=new ResizeObserver(o=>{o.length===1&&t(o[0])});return X(e,(o,a)=>{a&&n.unobserve(a),o&&n.observe(o)},{immediate:!0}),Ut(()=>{n.disconnect()}),n}function rw(){const e=br.newInstance(),t=_r.newInstance(),n=e.getProperty(),o=Nn.newInstance(),a=Mo.newInstance();return n.setRGBTransferFunction(0,o),n.setScalarOpacity(0,a),e.setMapper(t),{actor:e,mapper:t,property:n,cfun:o,ofun:a}}function lw(e,t,n){const a=n.getPointData().getScalars().getRange(),i=.7*Math.sqrt(n.getSpacing().map(s=>s*s).reduce((s,r)=>s+r,0));t.setSampleDistance(i*2**(.4*3-1.5)),e.setScalarOpacityUnitDistance(0,Ir(n.getBounds())/Math.max(...n.getDimensions())),e.setGradientOpacityMinimumValue(0,0),e.setGradientOpacityMaximumValue(0,(a[1]-a[0])*.05),e.setShade(!0),e.setUseGradientOpacity(0,!0),e.setGradientOpacityMinimumOpacity(0,0),e.setGradientOpacityMaximumOpacity(0,1),e.setAmbient(.2),e.setDiffuse(.7),e.setSpecular(.3),e.setSpecularPower(8)}function cw(e){const t=document.createElement("div");t.style.width=`${e}px`,t.style.height=`${e}px`;const n=Od.newInstance({listenWindowResize:!1,background:[.2,.3,.4]});n.setContainer(t);const o=rw(),{actor:a,mapper:i}=o,s=n.getRenderer(),r=De.newInstance({piecewiseFunction:o.ofun}),l=Ld.newInstance({lookupTable:o.cfun});return{scene:n,pipeline:o,opacityFuncProxy:r,colorTransferFuncProxy:l,setInputImage(c){c?(i.setInputData(c),lw(a.getProperty(),i,c),s.hasViewProp(a)||s.addVolume(a)):s.removeVolume(a)},resetCameraWithOrientation(c,u){const p=i.getInputData();if(p){const d=s.getActiveCamera(),m=p.getBounds(),g=[(m[0]+m[1])/2,(m[2]+m[3])/2,(m[4]+m[5])/2],A=Ra(g);Ea(A,A,c),d.setFocalPoint(...g),d.setPosition(...A),d.setDirectionOfProjection(...c),d.setViewUp(...u),s.resetCamera(),s.updateLightsGeometryToFollowCamera()}}}}function uw(e,t,n){const o=w(()=>n.value.orientation),a=w(()=>Na(o.value)),i=w(()=>a.value[b(e)]),s=w(()=>a.value[b(t)]);return{cameraDirVec:i,cameraUpVec:s}}function dw(e,t,n){e.setDataRange(...t);const o=at.getPresetByName(n);if(o.OpacityPoints){const a=o.OpacityPoints,i=[];for(let u=0;u<a.length;u+=2)i.push([a[u],a[u+1]]);const[s,r]=t,l=r-s,c=i.map(([u,p])=>[(u-s)/l,p]);e.setMode(De.Mode.Points),e.setPoints(c)}else e.setMode(De.Mode.Gaussians),e.setGaussians(De.Defaults.Gaussians)}function Mc(e){const t=_e({}),n=cw(e),o=O({}),{currentImageMetadata:a,currentImageID:i,currentImageData:s}=me(),{cameraDirVec:r,cameraUpVec:l}=uw(Gt[re.Three].props.viewDirection,Gt[re.Three].props.viewUp,a);let c=Symbol("interrupt");async function u(d,m){const g=Symbol("interrupt");c=g,n.setInputImage(m);const A=m.getPointData().getScalars().getRange();async function y(h){if(c!==g||d!==i.value||(d in t||(t[d]={}),h in t[d]))return;const S=kp(h);dw(n.opacityFuncProxy,S||A,h),n.colorTransferFuncProxy.setMode(Bd.Preset),n.colorTransferFuncProxy.setPresetName(h);const E=Wn(h);n.colorTransferFuncProxy.setDataRange(...E||A),n.resetCameraWithOrientation(r.value,l.value);const k=n.scene.getRenderWindow();k.render();const R=await k.captureImages()[0];R&&(t[d][h]=R)}Ls.reduce((h,S)=>h.then(()=>y(S)),Promise.resolve())}return X(t,()=>{i.value&&(o.value=t[i.value])},{deep:!0}),Ut(()=>{c=Symbol("unmount")}),X(i,d=>{d&&u(d,s.value)},{immediate:!0}),Ae().$onAction(({name:d,args:m,after:g})=>{if(d==="deleteData"){const[A]=m;A in t&&g(()=>{delete t[A]})}}),{currentThumbnails:o}}const pw=250,Li=150,Bi=80,$t=re.Three,fw=F({name:"VolumeRendering",setup(){const e=Lt(),t=O(null),n=O(null);let o=!1;const{currentImageID:a,currentImageData:i}=me();Zo($t,a);const s=w(()=>e.getConfig($t,a.value)),r=w(()=>{var T;return(T=s.value)==null?void 0:T.transferFunction}),l=w(()=>{var T;return(T=s.value)==null?void 0:T.opacityFunction}),c=sw.newInstance({numberOfBins:256,size:[pw,Li]});c.updateStyle({backgroundColor:"rgba(255, 255, 255, 0.6)",histogramColor:"rgba(100, 100, 100, 0.5)",strokeColor:"rgb(0, 0, 0)",activeColor:"rgb(255, 255, 255)",handleColor:"rgb(50, 150, 50)",buttonDisableFillColor:"rgba(255, 255, 255, 0.5)",buttonDisableStrokeColor:"rgba(0, 0, 0, 0.5)",buttonStrokeColor:"rgba(0, 0, 0, 1)",buttonFillColor:"rgba(255, 255, 255, 1)",strokeWidth:2,activeStrokeWidth:3,buttonStrokeWidth:1.5,handleWidth:3,iconSize:0,padding:10});const u=Nn.newInstance();c.setColorTransferFunction(u);const p=[];Ut(()=>{for(;p.length;)p.pop().unsubscribe()});function d(){if(o||!a.value)return;o=!0;const{mode:T}=l.value??{};T===De.Mode.Gaussians?e.updateOpacityFunction($t,a.value,{mode:T,gaussians:c.getGaussians()}):T===De.Mode.Points&&e.updateOpacityFunction($t,a.value,{mode:T,shift:c.getOpacityPointShift(),shiftAlpha:c.getOpacityValueShift()}),c.render(),o=!1}ie(c,"onOpacityChange",d);const m=ys();let g=!1;const A=()=>{g||(g=!0,m.requestAnimation(c,{byViewType:["3D"]}))},y=()=>{g=!1,m.cancelAnimation(c)};ie(c,"onAnimation",T=>{T?A():y()}),Ut(()=>{y()}),iw(t,T=>{const{width:U}=T.contentRect;U>0&&c.setSize(U,Li),c.render()}),le(()=>{n.value&&(c.setContainer(n.value),c.bindMouseListeners())}),Ut(()=>{c.unbindMouseListeners(),c.setContainer(null)}),X(i,T=>{if(T){const U=T.getPointData().getScalars();c.setDataArray(U.getData()),c.render()}},{immediate:!0}),X(r,T=>{if(T){const{preset:U,mappingRange:Q}=T,Z=at.getPresetByName(U);u.applyColorMap(Z),u.setMappingRange(...Q),u.modified()}},{immediate:!0}),ie(u,"onModified",()=>c.render()),X(l,T=>{if(T){if(T.mode===De.Mode.Gaussians)c.setGaussiansMode(),c.setGaussians(T.gaussians);else if(T.mode===De.Mode.Points){c.setPointsMode();const U=el(T.preset,T.mappingRange,0,0);c.setOpacityPoints(U,T.shift,T.shiftAlpha)}}},{immediate:!0});const{currentThumbnails:h}=Mc(Bi),S=w(()=>{var T;return((T=r.value)==null?void 0:T.preset)||null}),E=w(()=>!!i.value),k=w(()=>{const T=i.value;return T?T.getPointData().getScalars().getRange():[0,1]}),R=w(()=>Wn(S.value||"")||k.value),D=w(()=>{const T=R.value;return T[1]-T[0]}),$=T=>{a.value&&e.setColorPreset($t,a.value,T)},M=O(0),x=O(0);bo("Control",()=>c.setShiftOpacityValues(!0)),wu("Control",()=>c.setShiftOpacityValues(!1));const V=()=>{M.value=0,x.value=D.value};return X([S,a],V,{immediate:!0}),In().onClick(V),X([M,x],([T,U])=>{const Q=a.value,Z=e.getConfig($t,Q);if(!Q||!Z)return;const ee=R.value,N=D.value,j=ee[0]+Math.floor((N-U)/2)+T,Y=ee[1]-Math.ceil((N-U)/2)+T;e.updateColorTransferFunction($t,Q,{mappingRange:[j,Y]})}),{editorContainerRef:t,pwfEditorRef:n,thumbnails:h,hasCurrentImage:E,preset:S,fullMappingRange:R,mappingRange:w(()=>r.value.mappingRange),colorSliderStep:w(()=>{const[T,U]=k.value,Q=U-T,Z=Math.min(1,Q/256);return Z>1?Math.round(Z):Z}),presetList:Ls,size:Bi,rangeShiftMin:w(()=>-D.value/2),rangeShiftMax:w(()=>D.value/2),rangeShift:M,rangeWidth:x,rangeWidthMax:w(()=>D.value*2),request3DAnimation:A,cancel3DAnimation:y,selectPreset:$}}});const mw={class:"overflow-hidden"},gw={class:"mt-4 pwf-editor",ref:"editorContainerRef"},vw={ref:"pwfEditorRef"},hw={class:"mapping-range-editor"};function Aw(e,t,n,o,a,i){return C(),L("div",mw,[_("div",gw,[_("div",vw,null,512)],512),_("div",hw,[f(Ye,{modelValue:e.rangeShift,"onUpdate:modelValue":t[0]||(t[0]=s=>e.rangeShift=s),density:"compact","hide-details":"",label:"Shift",min:e.rangeShiftMin,max:e.rangeShiftMax,step:e.colorSliderStep,onPointerdown:e.request3DAnimation,onPointerup:e.cancel3DAnimation},null,8,["modelValue","min","max","step","onPointerdown","onPointerup"]),f(Ye,{modelValue:e.rangeWidth,"onUpdate:modelValue":t[1]||(t[1]=s=>e.rangeWidth=s),density:"compact","hide-details":"",label:"Width",min:"1",max:e.rangeWidthMax,step:e.colorSliderStep,onPointerdown:e.request3DAnimation,onPointerup:e.cancel3DAnimation},null,8,["modelValue","max","step","onPointerdown","onPointerup"])])])}const yw=z(fw,[["render",Aw],["__scopeId","data-v-f682f0e5"]]),$i=80,oo=re.Three,ww=F({name:"VolumePresets",components:{ItemGroup:Go,GroupableItem:zo,PersistentOverlay:qn},setup(){const e=Lt(),{currentImageID:t,currentImageData:n}=me();Zo(oo,t);const o=w(()=>e.getConfig(oo,t.value)),a=w(()=>{var m;return(m=o.value)==null?void 0:m.transferFunction}),{currentThumbnails:i}=Mc($i),s=w(()=>{var m;return((m=a.value)==null?void 0:m.preset)||null}),r=w(()=>!!n.value),l=w(()=>{const m=n.value;return m?m.getPointData().getScalars().getRange():[0,1]}),c=w(()=>Wn(s.value||"")||l.value),u=m=>{t.value&&e.setColorPreset(oo,t.value,m)},p=w(()=>{var m;return(m=at.getPresetByName(a.value.preset))==null?void 0:m.RGBPoints}),d=m=>{const{mappingRange:g}=a.value??{};t.value&&g&&(Math.abs(m[0]-g[0])>1e-6||Math.abs(m[1]-g[1])>1e-6)&&e.updateColorTransferFunction(oo,t.value,{mappingRange:m})};return{thumbnails:i,hasCurrentImage:r,preset:s,fullMappingRange:c,mappingRange:w(()=>a.value.mappingRange),presetList:Ls,size:$i,rgbPoints:p,selectPreset:u,updateColorMappingRange:d}}});const Sw={class:"overflow-x-visible mx-2"},Cw={class:"thumbnail-overlay-text"};function bw(e,t,n,o,a,i){const s=q("persistent-overlay"),r=q("groupable-item"),l=q("item-group");return C(),L("div",Sw,[f(l,{"model-value":e.preset,"onUpdate:modelValue":e.selectPreset},{default:v(()=>[f(pe,{"no-gutters":"",justify:"center"},{default:v(()=>[(C(!0),L(ne,null,de(e.presetList,c=>(C(),B(r,{key:c,value:c},{default:v(({active:u,select:p})=>[f(ue,{cols:"4",class:be({"thumbnail-container":!0,"bg-blue":u}),onClick:p},{default:v(()=>[f(Un,{src:e.thumbnails[c]||"",cover:"","aspect-ratio":"1"},{default:v(()=>[f(s,{class:"thumbnail-overlay"},{default:v(()=>[_("div",Cw,H(c.replace(/-/g," ")),1)]),_:2},1024)]),_:2},1032,["src"])]),_:2},1032,["class","onClick"])]),_:2},1032,["value"]))),128))]),_:1})]),_:1},8,["model-value","onUpdate:modelValue"])])}const _w=z(ww,[["render",bw],["__scopeId","data-v-39cffe03"]]),Iw=Object.entries(Gt).filter(([,{viewType:e}])=>e==="2D").map(([e])=>e),kw=F({name:"LayerProperties",props:{layer:{required:!0,type:Object}},setup(e){const{layer:t}=ae(e),n=Ae(),o=w(()=>{const{selection:c}=e.layer;return n.metadata[c].name}),a=Zt(),i=w(()=>t.value.id),s=w(()=>Iw.map(c=>({config:a.getConfig(c,i.value),viewID:c}))),r=w(()=>{var c,u;return(u=(c=s.value.find(({config:p})=>p))==null?void 0:c.config)==null?void 0:u.blendConfig});return{imageName:o,blendConfig:r,setBlendConfig:(c,u)=>{s.value.length!==0&&s.value.forEach(({viewID:p})=>a.updateBlendConfig(p,i.value,{[c]:u}))}}}}),Dw={key:0,class:"mx-2"};function Ew(e,t,n,o,a,i){return e.blendConfig?(C(),L("div",Dw,[f(fe,{text:e.imageName,location:"top"},{activator:v(({props:s})=>[_("h4",ze({class:"text-ellipsis"},s),H(e.imageName),17)]),_:1},8,["text"]),f(Ye,{class:"pt-4",label:"Opacity",min:"0",max:"1",step:"0.01",density:"compact","hide-details":"","thumb-label":"","model-value":e.blendConfig.opacity,"onUpdate:modelValue":t[0]||(t[0]=s=>e.setBlendConfig("opacity",s)),"data-testid":"layer-opacity-slider"},null,8,["model-value"])])):G("",!0)}const Rw=z(kw,[["render",Ew]]),Vw=F({name:"LayerList",components:{LayerProperties:Rw},setup(){const{currentLayers:e}=me();return{layers:w(()=>[...e.value].reverse())}}}),Tw={class:"mx-2"};function Pw(e,t,n,o,a,i){const s=q("layer-properties");return C(),L("div",Tw,[(C(!0),L(ne,null,de(e.layers,r=>(C(),B(s,{key:r.id,layer:r,class:"py-4"},null,8,["layer"]))),128))])}const Mw=z(Vw,[["render",Pw]]),Ow=F({components:{VolumeRendering:yw,VolumePresets:_w,VolumeProperties:Z8,LayerList:Mw},setup(){const{currentImageData:e}=me(),t=w(()=>!!e.value),{currentLayers:n}=me(),o=w(()=>!!n.value.length);return{panels:O(["properties","layers"]),hasCurrentImage:t,hasLayers:o}}}),Lw={class:"overflow-y-auto mx-2 fill-height"},Bw={key:1,class:"text-center pt-12 text-subtitle-1"};function $w(e,t,n,o,a,i){const s=q("volume-rendering"),r=q("volume-presets"),l=q("volume-properties"),c=q("layer-list");return C(),L("div",Lw,[e.hasCurrentImage?(C(),L(ne,{key:0},[f(s),f(Kt,{modelValue:e.panels,"onUpdate:modelValue":t[0]||(t[0]=u=>e.panels=u),multiple:"",variant:"accordion"},{default:v(()=>[f(Ne,{value:"preset"},{default:v(()=>[f(Fe,null,{default:v(()=>[f(K,{class:"flex-grow-0 mr-4"},{default:v(()=>[P("mdi-palette")]),_:1}),P(" Color Presets ")]),_:1}),f(We,null,{default:v(()=>[f(r)]),_:1})]),_:1}),f(Ne,{value:"properties"},{default:v(()=>[f(Fe,null,{default:v(()=>[f(K,{class:"flex-grow-0 mr-4"},{default:v(()=>[P("mdi-cube-scan")]),_:1}),P(" Cinematic Rendering ")]),_:1}),f(We,null,{default:v(()=>[f(l)]),_:1})]),_:1}),e.hasLayers?(C(),B(Ne,{key:0,value:"layers"},{default:v(()=>[f(Fe,null,{default:v(()=>[f(K,{class:"flex-grow-0 mr-4"},{default:v(()=>[P("mdi-layers")]),_:1}),P(" Layers ")]),_:1}),f(We,null,{default:v(()=>[f(c)]),_:1})]),_:1})):G("",!0)]),_:1},8,["modelValue"])],64)):(C(),L("div",Bw,"No image selected"))])}const xw=z(Ow,[["render",$w]]);var on=(e=>(e[e.None=0]="None",e[e.Some=1]="Some",e[e.All=2]="All",e))(on||{});const Uw=e=>{const t=Cn(),n=w(()=>b(e).reduce((r,{id:l,type:c})=>({...r,[l]:c}),{})),o=w({get:()=>t.selection.map(({id:r})=>r),set:r=>{t.clearSelection(),r.forEach(l=>{t.addSelection(l,n.value[l])})}}),a=w(()=>{const r=b(e),{length:l}=b(r).filter(c=>t.isSelected(c.id));return l===0?0:l===r.length?2:1});return{selectAll:()=>{b(e).forEach(r=>t.addSelection(r.id,r.type))},deselectAll:()=>{t.clearSelection()},selected:o,selectionState:a}},Nw=F({__name:"MeasurementToolDetails",props:{tool:{}},setup(e){return(t,n)=>(C(),B(pe,null,{default:v(()=>[f(ue,{cols:"4"},{default:v(()=>[P("Slice: "+H(t.tool.slice+1),1)]),_:1}),f(ue,{cols:"4"},{default:v(()=>[P("Axis: "+H(t.tool.axis),1)]),_:1})]),_:1}))}}),Fw={class:"ml-auto flex-shrink-0"},Ww=F({__name:"MeasurementsToolList",props:{tools:{}},setup(e){const t=e,{currentImageID:n,currentImageMetadata:o}=me(),a=y=>Tn(y).finishedTools.filter(S=>S.imageID===n.value).map(S=>{const{axis:E}=xo(S.frameOfReference,o.value,{allowOutOfBoundsSlice:!0})??{axis:"unknown"};return{...S,axis:E}}),i=w(()=>t.tools.flatMap(({type:y,icon:h,details:S=Nw})=>{const E=Tn(y);return a(y).map(R=>({id:R.id,type:y,toolData:R,icon:h,details:S,remove:()=>E.removeTool(R.id),jumpTo:()=>E.jumpToTool(R.id),toggleHidden:()=>{const D=!E.toolByID[R.id].hidden;E.updateTool(R.id,{hidden:D})},updateTool:D=>{E.updateTool(R.id,D)}}))})),s=Cn(),{selectAll:r,deselectAll:l,selected:c,selectionState:u}=Uw(i),p=y=>{y?r():l()};function d(){s.selection.forEach(y=>{Tn(y.type).removeTool(y.id)})}const m=w(()=>c.value.map(y=>i.value.find(h=>y===h.id)).filter(Oo).every(y=>y.toolData.hidden)),g=y=>i.value.filter(h=>s.isSelected(h.id)).forEach(y);function A(){const y=!m.value;g(h=>{h.updateTool({hidden:y})})}return(y,h)=>(C(),L(ne,null,[f(pe,{"no-gutters":"",justify:"space-between",align:"center",class:"mb-1"},{default:v(()=>[f(ue,{class:"d-flex"},{default:v(()=>[f(Ke,{class:"ml-3",indeterminate:b(u)===b(on).Some,label:"Select All","model-value":b(u)===b(on).All,"onUpdate:modelValue":p,density:"compact","hide-details":""},null,8,["indeterminate","model-value"])]),_:1}),f(ue,{class:"v-label"},{default:v(()=>[P(H(b(c).length)+" of "+H(i.value.length)+" selected ",1)]),_:1}),f(ue,{"align-self":"center",class:"d-flex justify-end"},{default:v(()=>[f(te,{icon:"",variant:"text",disabled:b(u)===b(on).None,onClick:J(A,["stop"])},{default:v(()=>[m.value?(C(),B(K,{key:0},{default:v(()=>[P("mdi-eye-off")]),_:1})):(C(),B(K,{key:1},{default:v(()=>[P("mdi-eye")]),_:1})),f(fe,{location:"top",activator:"parent"},{default:v(()=>[P(H(m.value?"Show":"Hide"),1)]),_:1})]),_:1},8,["disabled","onClick"]),f(te,{icon:"",variant:"text",disabled:b(u)===b(on).None,onClick:J(d,["stop"])},{default:v(()=>[f(K,null,{default:v(()=>[P("mdi-delete")]),_:1}),f(fe,{disabled:b(u)===b(on).None,location:"top",activator:"parent"},{default:v(()=>[P(" Delete selected ")]),_:1},8,["disabled"])]),_:1},8,["disabled","onClick"])]),_:1})]),_:1}),(C(!0),L(ne,null,de(i.value,S=>(C(),B(ke,{key:S.id},{default:v(()=>[f(St,null,{default:v(()=>[f(pe,{class:"d-flex align-center main-row"},{default:v(()=>[(C(),B(Ke,{class:"no-grow mr-4",density:"compact","hide-details":"",key:S.id,value:S.id,modelValue:b(c),"onUpdate:modelValue":h[0]||(h[0]=E=>Ln(c)?c.value=E:null),onClick:h[1]||(h[1]=J(()=>{},["stop"]))},null,8,["value","modelValue"])),f(K,{class:"tool-icon mr-4"},{default:v(()=>[P(H(S.icon),1)]),_:2},1024),_("div",{class:"color-dot flex-shrink-0 mr-2",style:nt({backgroundColor:S.toolData.color})},null,4),f(Be,er(tr(y.$attrs)),{default:v(()=>[P(H(S.toolData.labelName),1)]),_:2},1040),_("span",Fw,[f(te,{icon:"",variant:"text",onClick:E=>S.jumpTo()},{default:v(()=>[f(K,null,{default:v(()=>[P("mdi-target")]),_:1}),f(fe,{location:"top",activator:"parent"},{default:v(()=>[P(" Reveal Slice ")]),_:1})]),_:2},1032,["onClick"]),f(te,{icon:"",variant:"text",onClick:E=>S.toggleHidden()},{default:v(()=>[S.toolData.hidden?(C(),B(K,{key:0},{default:v(()=>[P("mdi-eye-off")]),_:1})):(C(),B(K,{key:1},{default:v(()=>[P("mdi-eye")]),_:1})),f(fe,{location:"top",activator:"parent"},{default:v(()=>[P(H(S.toolData.hidden?"Show":"Hide"),1)]),_:2},1024)]),_:2},1032,["onClick"]),f(te,{icon:"",variant:"text",onClick:E=>S.remove()},{default:v(()=>[f(K,null,{default:v(()=>[P("mdi-delete")]),_:1}),f(fe,{location:"top",activator:"parent"},{default:v(()=>[P("Delete")]),_:1})]),_:2},1032,["onClick"])])]),_:2},1024),f(pe,{class:"mt-4"},{default:v(()=>[f(Fu,{class:"w-100"},{default:v(()=>[(C(),B(_o(S.details),{tool:S.toolData},null,8,["tool"]))]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))],64))}});const Hw=z(Ww,[["__scopeId","data-v-9af0aecb"]]),Co=e=>{const t=Zt(),n=Object.entries(Gt).filter(([,{viewType:s}])=>s==="2D").map(([s])=>s);Ac(n[0],b(e));const o=w(()=>n.map(s=>({config:t.getConfig(s,b(e)),viewID:s})));return{sampledConfig:w(()=>o.value.find(({config:s})=>s)),updateConfig:s=>{o.value.forEach(({viewID:r})=>t.updateConfig(r,b(e),s))}}},Gw=F({__name:"SegmentGroupOpacity",props:{groupId:{},selected:{}},setup(e){const t=e,{groupId:n,selected:o}=ae(t),{sampledConfig:a}=Co(n),i=w(()=>a.value.config.blendConfig),s=w(()=>o.value.map(d=>Co(d).updateConfig)),r=d=>{s.value.forEach(m=>{m({blendConfig:{...i.value,opacity:Math.min(d,.9999)}})})},{config:l}=Di(n),c=w(()=>o.value.map(d=>Di(d).updateConfig)),u=w({get:()=>l.value.config.outlineOpacity,set:d=>{c.value.forEach(m=>{m({outlineOpacity:d})})}}),p=w({get:()=>l.value.config.outlineThickness,set:d=>{c.value.forEach(m=>{m({outlineThickness:d})})}});return(d,m)=>(C(),L(ne,null,[f(Ye,{class:"mx-4",label:"Fill Opacity",min:"0",max:"1",step:"0.01",density:"compact","hide-details":"","thumb-label":"","model-value":i.value.opacity,"onUpdate:modelValue":m[0]||(m[0]=g=>r(g))},null,8,["model-value"]),f(Ye,{class:"mx-4",label:"Outline Opacity",min:"0",max:"1",step:"0.01",density:"compact","hide-details":"","thumb-label":"",modelValue:u.value,"onUpdate:modelValue":m[1]||(m[1]=g=>u.value=g)},null,8,["modelValue"]),f(Ye,{class:"mx-4",label:"Outline Thickness",min:"0",max:"10",step:"1",density:"compact","hide-details":"","thumb-label":"",modelValue:p.value,"onUpdate:modelValue":m[2]||(m[2]=g=>p.value=g)},null,8,["modelValue"])],64))}}),zw=F({__name:"SegmentEditor",props:{name:{},color:{},invalidNames:{},opacity:{}},emits:["done","cancel","delete","update:name","update:color","update:opacity"],setup(e){const t=e;function n(i){return!t.invalidNames.has(i.trim())}function o(i){return n(i)||"Name is not unique"}const a=w(()=>n(t.name));return(i,s)=>(C(),B(Yl,{color:i.color,valid:a.value,"onUpdate:color":s[2]||(s[2]=r=>i.$emit("update:color",r)),onDelete:s[3]||(s[3]=r=>i.$emit("delete")),onCancel:s[4]||(s[4]=r=>i.$emit("cancel")),onDone:s[5]||(s[5]=r=>i.$emit("done"))},{fields:v(({done:r})=>[f(qe,{label:"Name",class:"flex-grow-0","model-value":i.name,"onUpdate:modelValue":s[0]||(s[0]=l=>i.$emit("update:name",l)),onKeydown:co(J(r,["stop"]),["enter"]),rules:[o]},null,8,["model-value","onKeydown","rules"]),f(Ye,{class:"mx-4 my-1",label:"Segment Fill Opacity",min:"0",max:"1",step:"0.01",density:"compact","hide-details":"","thumb-label":"","model-value":i.opacity,"onUpdate:modelValue":s[1]||(s[1]=l=>i.$emit("update:opacity",l))},null,8,["model-value"])]),_:1},8,["color","valid"]))}});function xi(e){return`#${e.map(n=>`0${n.toString(16)}`.slice(-2)).join("")}`}function jw(e){const t=e.startsWith("#")?e.substring(1):e,n=[0,0,0,255],o=Math.min(4,t.length/2);for(let a=0;a<o;a++)n[a]=Number.parseInt(t.substring(2*a,2*a+2),16);return n}const Qw={class:"dot-container mr-3"},qw=F({__name:"SegmentList",props:{groupId:{required:!0,type:String}},setup(e){const t=e,{groupId:n}=ae(t),o=et(),a=Rt(),i=w(()=>o.segmentByGroupID[n.value]??[]);function s(){o.addSegment(n.value)}const r=w({get:()=>a.activeSegment,set:k=>{a.setActiveSegment(k)}});X(i,k=>{let R=!0;k&&r.value&&(R=!k.find(D=>D.value===r.value)),R&&(r.value=k!=null&&k.length?k[0].value:null)},{immediate:!0});const l=k=>{const R=o.getSegment(n.value,k);R&&o.updateSegment(n.value,k,{visible:!R.visible})},c=w(()=>i.value.every(k=>k.visible));function u(){const k=!c.value;i.value.forEach(R=>{o.updateSegment(n.value,R.value,{visible:k})})}const p=O(null),d=_e({name:"",color:"",opacity:1}),m=O(!1),g=w(()=>p.value==null?null:o.getSegment(n.value,p.value)),A=w(()=>{var D;const k=new Set(i.value.map($=>$.name)),R=(D=g.value)==null?void 0:D.name;return R&&k.delete(R),k});function y(k){m.value=!0,p.value=k,g.value&&(d.name=g.value.name,d.color=xi(g.value.color),d.opacity=g.value.color[3]/255)}function h(k){if(p.value&&k){const R=[...jw(d.color).slice(0,3),Math.round(d.opacity*255)];o.updateSegment(n.value,p.value,{name:d.name??wa(p.value),color:R})}p.value=null,m.value=!1}function S(k){o.deleteSegment(n.value,k)}function E(){p.value&&S(p.value),h(!1)}return(k,R)=>(C(),L(ne,null,[f(te,{onClick:J(u,["stop"]),class:"my-1"},{default:v(()=>[P(" Toggle Segments "),se(k.$slots,"append",{},()=>[c.value?(C(),B(K,{key:0,class:"pl-2"},{default:v(()=>[P("mdi-eye")]),_:1})):(C(),B(K,{key:1,class:"pl-2"},{default:v(()=>[P("mdi-eye-off")]),_:1})),f(fe,{location:"top",activator:"parent"},{default:v(()=>[P(H(c.value?"Hide":"Show"),1)]),_:1})],!0)]),_:3},8,["onClick"]),f(Zl,{modelValue:r.value,"onUpdate:modelValue":R[0]||(R[0]=D=>r.value=D),items:i.value,"item-key":"value","item-title":"name","create-label-text":"New segment",onCreate:s,class:"my-4"},{"item-prepend":v(({item:D})=>[_("div",Qw,[_("div",{class:"color-dot",style:nt({background:b(xi)([...D.color.slice(0,3),255])})},null,4)])]),"item-append":v(({key:D,item:$})=>[f(te,{icon:"",size:"small",density:"compact",class:"ml-auto mr-1",variant:"plain",onClick:J(M=>l(D),["stop"])},{default:v(()=>[$.visible?(C(),B(K,{key:0,style:{"pointer-events":"none"}},{default:v(()=>[P("mdi-eye")]),_:1})):(C(),B(K,{key:1,style:{"pointer-events":"none"}},{default:v(()=>[P("mdi-eye-off")]),_:1})),f(fe,{location:"left",activator:"parent"},{default:v(()=>[P(H($.visible?"Hide":"Show"),1)]),_:2},1024)]),_:2},1032,["onClick"]),f(te,{icon:"mdi-pencil",size:"small",density:"compact",class:"ml-auto mr-1",variant:"plain",onClick:J(M=>y(D),["stop"])},null,8,["onClick"]),f(te,{icon:"mdi-delete",size:"small",density:"compact",class:"ml-auto",variant:"plain",onClick:J(M=>S(D),["stop"])},null,8,["onClick"])]),_:1},8,["modelValue","items"]),f(ls,{modelValue:m.value,"onUpdate:modelValue":R[6]||(R[6]=D=>m.value=D),onKeydown:R[7]||(R[7]=J(()=>{},["stop"])),"max-width":"800px"},{default:v(()=>[g.value?(C(),B(zw,{key:0,name:d.name,"onUpdate:name":R[1]||(R[1]=D=>d.name=D),color:d.color,"onUpdate:color":R[2]||(R[2]=D=>d.color=D),opacity:d.opacity,"onUpdate:opacity":R[3]||(R[3]=D=>d.opacity=D),onDelete:E,onCancel:R[4]||(R[4]=D=>h(!1)),onDone:R[5]||(R[5]=D=>h(!0)),invalidNames:A.value},null,8,["name","color","opacity","invalidNames"])):G("",!0)]),_:1},8,["modelValue"])],64))}});const Kw=z(qw,[["__scopeId","data-v-7bfbbbc6"]]),Zw=_("span",{"data-testid":"save-confirm-button"},"Save",-1),Yw=F({__name:"SaveSegmentGroupDialog",props:{id:{}},emits:["done"],setup(e,{emit:t}){const n=e,o=["nrrd","nii","nii.gz","dcm","hdf5","tif","mha","vtk","iwi.cbor"],a=O(""),i=O(!0),s=O(!1),r=O(o[0]),l=et();async function c(){a.value.trim().length!==0&&(s.value=!0,await $o("Failed to save segment group",async()=>{const p=l.dataIndex[n.id],d=await il(r.value,p);Qi.saveAs(new Blob([d]),`${a.value}.${r.value}`)}),s.value=!1,t("done"))}dt(()=>{a.value=l.metadataByID[n.id].name}),bo("Enter",()=>{c()});function u(p){return p.trim().length>0||"Required"}return(p,d)=>(C(),B(Pe,null,{default:v(()=>[f(qt,{class:"d-flex flex-row align-center"},{default:v(()=>[P(" Save Segment Group ")]),_:1}),f(ot,null,{default:v(()=>[f(sr,{modelValue:i.value,"onUpdate:modelValue":d[2]||(d[2]=m=>i.value=m),onSubmit:J(c,["prevent"])},{default:v(()=>[f(qe,{modelValue:a.value,"onUpdate:modelValue":d[0]||(d[0]=m=>a.value=m),hint:"Filename that will appear in downloads.",label:"Filename",rules:[u],required:"",id:"filename"},null,8,["modelValue","rules"]),f(Wu,{label:"Format",modelValue:r.value,"onUpdate:modelValue":d[1]||(d[1]=m=>r.value=m),items:o},null,8,["modelValue"])]),_:1},8,["modelValue","onSubmit"])]),_:1}),f(Do,null,{default:v(()=>[f(pt),f(te,{loading:s.value,color:"secondary",onClick:c,disabled:!i.value},{default:v(()=>[f(K,{class:"mr-2"},{default:v(()=>[P("mdi-content-save")]),_:1}),Zw]),_:1},8,["loading","disabled"])]),_:1})]),_:1}))}}),Jw={key:0,class:"mt-2"},Xw={class:"text-grey text-subtitle-2 d-flex align-center justify-space-evenly mb-2"},e4={key:1,class:"d-flex align-center"},t4=["title"],n4={class:"group-name"},o4=_("div",{class:"text-center text-grey-darken-1 py-4 w-100"}," Create a segment group with the above buttons or click the paint tool ",-1),a4={key:1,class:"text-center text-caption"},Ui="Unnamed Segment Group",s4=F({__name:"SegmentGroupControls",setup(e){const t=et(),{currentImageID:n}=me(),o=Oe(),a=w(()=>{if(!n.value)return[];const{orderByParent:N,metadataByID:j}=t;return n.value in N?N[n.value].map(Y=>{var Bt,Zn;const{sampledConfig:we,updateConfig:Xt}=Co(Y);return{id:Y,name:j[Y].name,visibility:((Zn=(Bt=we.value)==null?void 0:Bt.config)==null?void 0:Zn.blendConfig.visibility)??!0,toggleVisibility:()=>{const Yn=we.value.config.blendConfig;Xt({blendConfig:{...Yn,visibility:!Yn.visibility}})}}}):[]}),i=Rt(),s=w({get:()=>i.activeSegmentGroupID,set:N=>i.setActiveSegmentGroup(N)});X(a,()=>{const N=s.value;N&&!(N in t.dataIndex)&&(s.value=null)});function r(N){t.removeGroup(N)}const l=O(null),c=_e({name:""}),u=O(!1),p=w(()=>l.value?t.metadataByID[l.value]:null),d=w(()=>new Set(Object.values(t.metadataByID).map(N=>N.name)));function m(N){var j;return!d.value.has(N)||N===((j=p.value)==null?void 0:j.name)}const g=w(()=>!m(c.name));function A(N){return m(N)||"Name is not unique"}function y(N){u.value=!0,l.value=N,p.value&&(c.name=p.value.name)}function h(N){g.value||(u.value=!1,l.value&&N&&t.updateMetadata(l.value,{name:c.name||Ui}),l.value=null)}function S(){if(!n.value)throw new Error("Cannot create a labelmap without a base image");const N=t.newLabelmapFromImage(n.value);if(!N)throw new Error("Could not create a new labelmap");if(s.value){const j=t.metadataByID[s.value],Y=structuredClone(un(j.segments));t.updateMetadata(N,{segments:Y})}s.value=N,y(N)}const E=w(()=>{const N=o.primarySelection;return N?o.idsAsSelections.filter(j=>!Qa(j,N)).map(j=>({selection:j,name:vp(j)})):[]});function k(N){const j=o.primarySelection;if(!j)throw new Error("No primary selection");t.convertImageToLabelmap(N,j)}const R=O(""),D=O(!1);function $(N){R.value=N,D.value=!0}const M=w(()=>a.value.map(N=>N.id)),{selected:x,selectedAll:V,selectedSome:T}=Yo(M);X([s,n],()=>{const N=s.value;N&&(x.value=[N])},{immediate:!0});function U(){V.value&&s.value?x.value=[s.value]:V.value?x.value=[]:x.value=M.value}const Q=w(()=>x.value.map(N=>a.value.find(j=>N===j.id)).filter(N=>N!=null).every(N=>!N.visibility));function Z(){const N=Q.value;x.value.forEach(j=>{if(a.value.find(we=>we.id===j)){const{sampledConfig:we,updateConfig:Xt}=Co(j),Bt=we.value.config.blendConfig;Xt({blendConfig:{...Bt,visibility:N}})}})}function ee(){x.value.forEach(N=>r(N))}return(N,j)=>(C(),L(ne,null,[b(n)?(C(),L("div",Jw,[_("div",Xw,[f(te,{variant:"tonal",color:"secondary",density:"compact",onClick:J(S,["stop"])},{default:v(()=>[f(K,{class:"mr-1"},{default:v(()=>[P("mdi-plus")]),_:1}),P(" New Group ")]),_:1},8,["onClick"]),f(Mt,{location:"bottom"},{activator:v(({props:Y})=>[f(te,ze({variant:"tonal",color:"secondary",density:"compact"},Y),{default:v(()=>[f(K,{class:"mr-1"},{default:v(()=>[P("mdi-chevron-down")]),_:1}),P("From Image ")]),_:2},1040)]),default:v(()=>[E.value.length!==0?(C(),B(It,{key:0},{default:v(()=>[(C(!0),L(ne,null,de(E.value,(Y,we)=>(C(),B(ke,{key:we,onClick:Xt=>k(Y.selection)},{default:v(()=>[P(H(Y.name)+" ",1),f(fe,{activator:"parent",location:"end","max-width":"200px"},{default:v(()=>[P(" Convert to segment group ")]),_:1})]),_:2},1032,["onClick"]))),128))]),_:1})):(C(),B(It,{key:1},{default:v(()=>[f(ke,{class:"font-italic",title:"No eligible images found"})]),_:1}))]),_:1})]),s.value?(C(),B(Gw,{key:0,"group-id":s.value,selected:b(x)},null,8,["group-id","selected"])):G("",!0),a.value.length>0?(C(),L("div",e4,[f(Ke,{class:"ml-3",indeterminate:b(T)&&!b(V),label:"Select All","model-value":b(V),"onUpdate:modelValue":U,density:"compact","hide-details":""},null,8,["indeterminate","model-value"]),f(te,{icon:"",variant:"text",disabled:b(x).length===0,onClick:J(Z,["stop"])},{default:v(()=>[Q.value?(C(),B(K,{key:0},{default:v(()=>[P("mdi-eye-off")]),_:1})):(C(),B(K,{key:1},{default:v(()=>[P("mdi-eye")]),_:1})),f(fe,{location:"top",activator:"parent"},{default:v(()=>[P(H(Q.value?"Show":"Hide")+" selected ",1)]),_:1})]),_:1},8,["disabled","onClick"]),f(te,{icon:"",variant:"text",disabled:b(x).length===0,onClick:J(ee,["stop"])},{default:v(()=>[f(K,null,{default:v(()=>[P("mdi-delete")]),_:1}),f(fe,{location:"top",activator:"parent"},{default:v(()=>[P(" Delete selected ")]),_:1})]),_:1},8,["disabled","onClick"])])):G("",!0),f(It,{density:"comfortable",class:"my-1 segment-group-list"},{default:v(()=>[(C(!0),L(ne,null,de(a.value,Y=>(C(),B(ke,{key:Y.id,active:s.value===Y.id,onClick:we=>s.value=Y.id},{default:v(()=>[_("div",{class:"d-flex flex-row align-center w-100",title:Y.name},[f(Ke,{class:"no-grow mr-4",density:"compact","hide-details":"",onClick:j[0]||(j[0]=J(()=>{},["stop"])),value:Y.id,modelValue:b(x),"onUpdate:modelValue":j[1]||(j[1]=we=>Ln(x)?x.value=we:null),disabled:Y.id===s.value},null,8,["value","modelValue","disabled"]),_("span",n4,H(Y.name),1),f(pt),f(te,{icon:"",variant:"text",size:"small",onClick:J(Y.toggleVisibility,["stop"])},{default:v(()=>[Y.visibility?(C(),B(K,{key:0,style:{"pointer-events":"none"}},{default:v(()=>[P("mdi-eye")]),_:1})):(C(),B(K,{key:1,style:{"pointer-events":"none"}},{default:v(()=>[P("mdi-eye-off")]),_:1})),f(fe,{location:"left",activator:"parent"},{default:v(()=>[P(H(Y.visibility?"Hide":"Show"),1)]),_:2},1024)]),_:2},1032,["onClick"]),f(te,{icon:"mdi-content-save",size:"small",variant:"text",onClick:J(we=>$(Y.id),["stop"])},null,8,["onClick"]),f(te,{icon:"mdi-pencil",size:"small",variant:"text",onClick:J(we=>y(Y.id),["stop"])},null,8,["onClick"]),f(te,{icon:"mdi-delete",size:"small",variant:"text",onClick:J(we=>r(Y.id),["stop"])},null,8,["onClick"])],8,t4)]),_:2},1032,["active","onClick"]))),128)),a.value.length===0?(C(),B(ke,{key:0},{default:v(()=>[o4]),_:1})):G("",!0)]),_:1}),f(Re,{class:"my-4"})])):(C(),L("div",a4,"No selected image")),s.value?(C(),B(Kw,{key:2,"group-id":s.value},null,8,["group-id"])):G("",!0),f(or,{modelValue:u.value,"onUpdate:modelValue":j[6]||(j[6]=Y=>u.value=Y),"max-width":"400px"},{default:v(()=>[f(Pe,null,{default:v(()=>[f(ot,null,{default:v(()=>[f(qe,{modelValue:c.name,"onUpdate:modelValue":j[2]||(j[2]=Y=>c.name=Y),placeholder:Ui,rules:[A],onKeydown:j[3]||(j[3]=co(J(Y=>h(!0),["stop"]),["enter"]))},null,8,["modelValue","rules"])]),_:1}),f(Do,null,{default:v(()=>[f(pt),f(te,{color:"error",onClick:j[4]||(j[4]=Y=>h(!1))},{default:v(()=>[P("Cancel")]),_:1}),f(te,{disabled:g.value,onClick:j[5]||(j[5]=Y=>h(!0))},{default:v(()=>[P(" Done ")]),_:1},8,["disabled"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),f(Wt,{modelValue:D.value,"onUpdate:modelValue":j[7]||(j[7]=Y=>D.value=Y),"max-width":"30%"},{default:v(({close:Y})=>[f(Yw,{id:R.value,onDone:Y},null,8,["id","onDone"])]),_:1},8,["modelValue"])],64))}});const i4=F({name:"PaintControls",setup(){const e=Rt(),{brushSize:t,activeMode:n}=ye(e),o=i=>{e.setBrushSize(Number(i))},a=w({get:()=>n.value,set:i=>{e.setMode(i)}});return{brushSize:t,setBrushSize:o,mode:a,PaintMode:ts}}});const Oc=e=>($e("data-v-d6ea2bbc"),e=e(),xe(),e),r4=Oc(()=>_("span",{class:"text-caption"},"Paint",-1)),l4=Oc(()=>_("span",{class:"text-caption"},"Eraser",-1));function c4(e,t,n,o,a,i){return C(),B(St,null,{default:v(()=>[f(pe,{"no-gutters":"",align:"center",class:"mb-4 ml-1"},{default:v(()=>[f(ir,{modelValue:e.mode,"onUpdate:modelValue":t[0]||(t[0]=s=>e.mode=s),mandatory:"","selected-class":"selected"},{default:v(()=>[f(da,{value:e.PaintMode.CirclePaint},{default:v(({selectedClass:s,toggle:r})=>[f(te,{variant:"tonal",rounded:"8",stacked:"",class:be(["mode-button",s]),onClick:J(r,["stop"])},{default:v(()=>[f(K,null,{default:v(()=>[P("mdi-brush")]),_:1}),r4]),_:2},1032,["class","onClick"])]),_:1},8,["value"]),f(da,{value:e.PaintMode.Erase},{default:v(({selectedClass:s,toggle:r})=>[f(te,{variant:"tonal",rounded:"8",stacked:"",class:be(["mode-button",s]),onClick:J(r,["stop"])},{default:v(()=>[f(K,null,{default:v(()=>[P("mdi-eraser")]),_:1}),l4]),_:2},1032,["class","onClick"])]),_:1},8,["value"])]),_:1},8,["modelValue"])]),_:1}),f(pe,{"no-gutters":"",align:"center"},{default:v(()=>[f(ue,null,{default:v(()=>[f(Ye,{"model-value":e.brushSize,"onUpdate:modelValue":e.setBrushSize,density:"compact","hide-details":"",label:"Size",min:"1",max:"50"},{append:v(()=>[f(qe,{"model-value":e.brushSize,onInput:e.setBrushSize,variant:"plain",class:"mt-n3 pt-0 pl-2",style:{width:"60px"},density:"compact","hide-details":"",type:"number",min:"1",max:"50"},null,8,["model-value","onInput"])]),_:1},8,["model-value","onUpdate:modelValue"])]),_:1})]),_:1})]),_:1})}const u4=z(i4,[["render",c4],["__scopeId","data-v-d6ea2bbc"]]),d4={key:0},p4={class:"header"},f4={class:"content"},m4=F({__name:"ToolControls",setup(e){const t=Le(),n=new Map([[oe.Rectangle,{component:Xl,label:"Rectangle"}],[oe.Ruler,{component:Jl,label:"Ruler"}],[oe.Polygon,{component:ec,label:"Polygon"}],[oe.Paint,{component:u4,label:"Paint"}]]),o=w(()=>n.get(t.currentTool));return(a,i)=>o.value?(C(),L("div",d4,[_("div",p4,H(o.value.label),1),_("div",f4,[(C(),B(_o(o.value.component)))])])):G("",!0)}});const g4=z(m4,[["__scopeId","data-v-21c6f6a4"]]),v4={class:"value"},h4=F({__name:"MeasurementRulerDetails",props:{tool:{}},setup(e){const t=Jt();return(n,o)=>(C(),B(pe,null,{default:v(()=>[f(ue,{cols:"4"},{default:v(()=>[P("Slice: "+H(n.tool.slice+1),1)]),_:1}),f(ue,{cols:"4"},{default:v(()=>[P("Axis: "+H(n.tool.axis),1)]),_:1}),f(ue,null,{default:v(()=>[P(" Length: "),_("span",v4,H(b(t).lengthByID[n.tool.id].toFixed(2))+"mm ",1)]),_:1})]),_:1}))}}),A4={class:"overflow-y-auto mx-2 fill-height"},y4=F({__name:"AnnotationsModule",setup(e){const t={Measurements:"measurements",SegmentGroups:"segmentGroups"},n=[{type:tt.Ruler,icon:"mdi-ruler",details:h4},{type:tt.Rectangle,icon:"mdi-vector-square"},{type:tt.Polygon,icon:"mdi-pentagon-outline"}],o=new Set(n.map(({type:r})=>r)),a=O(t.SegmentGroups),{currentTool:i}=ye(Le());function s(){i.value===oe.Paint?a.value=t.SegmentGroups:o.has(i.value)&&(a.value=t.Measurements)}return X(i,()=>{s()},{immediate:!0}),(r,l)=>(C(),L("div",A4,[f(g4),f(Re,{thickness:"4"}),f(lr,{modelValue:a.value,"onUpdate:modelValue":l[0]||(l[0]=c=>a.value=c),"align-tabs":"center",density:"compact",class:"my-1"},{default:v(()=>[f(pa,{value:"segmentGroups",class:"tab-header"},{default:v(()=>[P("Segment Groups")]),_:1}),f(pa,{value:"measurements",class:"tab-header"},{default:v(()=>[P("Measurements")]),_:1})]),_:1},8,["modelValue"]),f(cr,{modelValue:a.value,"onUpdate:modelValue":l[1]||(l[1]=c=>a.value=c)},{default:v(()=>[f(fa,{value:"segmentGroups"},{default:v(()=>[f(s4)]),_:1}),f(fa,{value:"measurements"},{default:v(()=>[f(Hw,{tools:n})]),_:1})]),_:1},8,["modelValue"])]))}});const w4=z(y4,[["__scopeId","data-v-aa6718d0"]]),S4={class:"overflow-y-auto overflow-x-hidden ma-2 fill-height"},C4={class:"ml-3"},b4={for:"remote-trivia-text"},_4=["value"],I4={class:"ml-3"},k4={key:0,class:"ml-4 body-2"},D4=F({__name:"ServerModule",setup(e){const t=zn(),{client:n}=t,o=w(()=>t.connState===je.Connected),a=O(0),i=O(0),s=O(0),r=O(!1),l=async()=>{r.value=!0;try{a.value=await n.call("add",[i.value,s.value])}finally{r.value=!1}},c=O(""),u=O(!1),p=async()=>{u.value=!0;try{c.value=await n.call("number_trivia")}finally{u.value=!1}},d=O(0),m=O(!1),g=w(()=>{const D=d.value;return D<100?D:"Done!"}),A=D=>{const{progress:$}=D;d.value=$,$===100&&(m.value=!1)},y=async()=>{m.value=!0,await n.stream("progress",A)},h=O(!1),{currentImageID:S}=me(),E=O(2),k=async()=>{const D=S.value;if(D){h.value=!0;try{await n.call("medianFilter",[D,E.value])}finally{h.value=!1}}},R=w(()=>!!S.value);return(D,$)=>(C(),L("div",S4,[o.value?G("",!0):(C(),B(ko,{key:0,color:"info"},{default:v(()=>[P("Not connected to the server.")]),_:1})),f(Re),f(Jn,null,{default:v(()=>[P("Add numbers")]),_:1}),f(pe,{class:"pb-3"},{default:v(()=>[f(ue,{cols:"3"},{default:v(()=>[f(qe,{"model-value":i.value,"onUpdate:modelValue":$[0]||($[0]=M=>i.value=Number(M||0)),type:"number",variant:"outlined",density:"compact","hide-details":"",placeholder:"0"},null,8,["model-value"])]),_:1}),f(ue,{cols:"1",class:"d-flex flex-row align-center"},{default:v(()=>[P("+")]),_:1}),f(ue,{cols:"3"},{default:v(()=>[f(qe,{"model-value":s.value,"onUpdate:modelValue":$[1]||($[1]=M=>s.value=Number(M||0)),type:"number",variant:"outlined",density:"compact","hide-details":"",placeholder:"0"},null,8,["model-value"])]),_:1}),f(ue,{cols:"1",class:"d-flex flex-row align-center"},{default:v(()=>[f(te,{onClick:l,loading:r.value,disabled:!o.value},{default:v(()=>[P(" => ")]),_:1},8,["loading","disabled"]),_("span",C4,H(a.value),1)]),_:1})]),_:1}),f(Re),f(Jn,null,{default:v(()=>[P("Trivia")]),_:1}),f(pe,null,{default:v(()=>[f(te,{onClick:p,loading:u.value,disabled:!o.value},{default:v(()=>[P(" Random number trivia ")]),_:1},8,["loading","disabled"])]),_:1}),f(pe,null,{default:v(()=>[f(ue,null,{default:v(()=>[_("label",b4,[_("textarea",{id:"remote-trivia-text",readonly:"",class:"text-white",style:{width:"100%"},value:c.value},null,8,_4)])]),_:1})]),_:1}),f(Re),f(Jn,null,{default:v(()=>[P("Progress")]),_:1}),f(pe,{class:"mb-4"},{default:v(()=>[f(ue,null,{default:v(()=>[f(te,{onClick:y,loading:m.value,disabled:!o.value},{default:v(()=>[P(" Start progress ")]),_:1},8,["loading","disabled"]),_("span",I4," Progress: "+H(g.value),1)]),_:1})]),_:1}),f(Re),f(Jn,null,{default:v(()=>[P("Median Filter")]),_:1}),_("div",null,[f(pe,null,{default:v(()=>[f(ue,{cols:"3"},{default:v(()=>[f(qe,{"model-value":E.value,"onUpdate:modelValue":$[2]||($[2]=M=>E.value=Number(M||0)),type:"number",variant:"outlined",density:"compact","hide-details":"",placeholder:"1"},null,8,["model-value"])]),_:1}),f(ue,null,{default:v(()=>[f(te,{onClick:k,loading:h.value,disabled:!o.value||!R.value},{default:v(()=>[P(" Run Median Filter ")]),_:1},8,["loading","disabled"]),R.value?G("",!0):(C(),L("span",k4," No image loaded "))]),_:1})]),_:1})])]))}}),ca=[{name:"Data",icon:"database",component:F8},{name:"Annotations",icon:"pencil",component:w4},{name:"Rendering",icon:"cube",component:xw},{name:"Remote",icon:"server-network",component:D4}],E4=[oe.Rectangle,oe.Ruler,oe.Polygon,oe.Paint],R4=F({name:"ModulePanel",setup(){const e=O(0),t=Le();X(()=>t.currentTool,a=>{E4.includes(a)&&(e.value=1)});const n=zn(),o=w(()=>n.url?n.connState===je.Connected?ca:ca.map(a=>a.name==="Remote"?{...a,disabled:!0}:a):ca.filter(a=>a.name!=="Remote"));return{selectedModuleIndex:e,modules:o}}});const V4={class:"fill-height d-flex flex-column"},T4={id:"module-switcher"},P4={class:"tab-content"},M4={class:"mb-0 mt-1 module-text"},O4={id:"module-container"};function L4(e,t,n,o,a,i){return C(),L("div",V4,[_("div",T4,[f(lr,{id:"module-switcher-tabs",modelValue:e.selectedModuleIndex,"onUpdate:modelValue":t[0]||(t[0]=s=>e.selectedModuleIndex=s),"icons-and-text":"","show-arrows":""},{default:v(()=>[(C(!0),L(ne,null,de(e.modules,s=>(C(),B(pa,{key:s.name,"data-testid":`module-tab-${s.name}`,disabled:s.disabled},{default:v(()=>[_("div",P4,[_("span",M4,H(s.name),1),f(K,null,{default:v(()=>[P("mdi-"+H(s.icon),1)]),_:2},1024)])]),_:2},1032,["data-testid","disabled"]))),128))]),_:1},8,["modelValue"])]),_("div",O4,[f(cr,{modelValue:e.selectedModuleIndex,"onUpdate:modelValue":t[1]||(t[1]=s=>e.selectedModuleIndex=s),touchless:"",class:"fill-height"},{default:v(()=>[(C(!0),L(ne,null,de(e.modules,s=>(C(),B(fa,{key:s.name,class:"fill-height"},{default:v(()=>[Vt((C(),B(_o(s.component),{key:s.name})),[[Tt,e.modules[e.selectedModuleIndex]===s]])]),_:2},1024))),128))]),_:1},8,["modelValue"])])])}const B4=z(R4,[["render",L4],["__scopeId","data-v-2b1e337b"]]);async function $4(e){const t=e.createReader(),n=[];let o=[];do o=await new Promise((a,i)=>{t.readEntries(a,i)}),n.push(...o);while(o.length);return n}async function x4(e){return new Promise((t,n)=>{e.file(t,n)})}async function U4(e){const t=[...e],n=[];for(;t.length;){const o=t.shift();o.isFile?n.push(o):t.push(...await $4(o))}return Promise.all(n.map(x4))}const N4={name:"DragAndDrop",props:{enabled:Boolean},data(){return{dragHover:!1}},methods:{onDragOver(e){if(this.enabled){e.preventDefault();const{types:t}=e.dataTransfer;(t&&t instanceof Array?t.indexOf("Files")!==-1:"Files"in t)&&(this.dragHover=!0,this.dragTimeout!==null&&(window.clearTimeout(this.dragTimeout),this.dragTimeout=null))}},onDragLeave(){this.enabled&&(this.dragTimeout=window.setTimeout(()=>{this.dragHover=!1,this.dragTimeout=null},50))},async onDrop(e){if(this.enabled)if(this.dragHover=!1,e.dataTransfer.items){const t=[...e.dataTransfer.items].map(o=>(o.webkitGetAsEntry||o.getAsEntry).call(o)).filter(Boolean),n=await U4(t);this.$emit("drop-files",n)}else this.$emit("drop-files",Array.from(e.dataTransfer.files))}},created(){this.dragTimeout=null}};function F4(e,t,n,o,a,i){return C(),L("div",ze({onDragover:t[0]||(t[0]=J((...s)=>i.onDragOver&&i.onDragOver(...s),["prevent"])),onDragleave:t[1]||(t[1]=(...s)=>i.onDragLeave&&i.onDragLeave(...s)),onDrop:t[2]||(t[2]=J((...s)=>i.onDrop&&i.onDrop(...s),["prevent"]))},e.$attrs),[se(e.$slots,"default",{dragHover:a.dragHover})],16)}const W4=z(N4,[["render",F4]]),Bs=e=>($e("data-v-97158d03"),e=e(),xe(),e),H4=Bs(()=>_("div",{class:"text-h4 pb-2"},"View Controls",-1)),G4=Bs(()=>_("tbody",null,[_("tr",null,[_("td",null,"Scroll Slices"),_("td",null,"Mouse wheel or 2 finger vertical scroll")]),_("tr",null,[_("td",null,"Zoom"),_("td",null,"Right mouse button + move vertically")]),_("tr",null,[_("td",null,"Pan"),_("td",null,"Shift + left mouse button + move")])],-1)),z4=Bs(()=>_("div",{class:"text-h4 pb-2"},"Keyboard Shortcuts",-1)),j4={class:"keybinding"},Q4=F({__name:"ControlsModal",setup(e){const t=Uo(),n=w(()=>Rr(gn.value).map(([o,a])=>[ar[o].readable,a]));return(o,a)=>(C(),B(Wt,{modelValue:b(t).settingsOpen,"onUpdate:modelValue":a[0]||(a[0]=i=>b(t).settingsOpen=i)},{default:v(()=>[f(Pe,{class:"pa-4"},{default:v(()=>[H4,f(Hs,null,{default:v(()=>[G4]),_:1}),z4,f(Hs,null,{default:v(()=>[_("tbody",null,[(C(!0),L(ne,null,de(n.value,([i,s])=>(C(),L("tr",{key:i},[_("td",null,H(i),1),_("td",j4,H(s),1)]))),128))])]),_:1})]),_:1})]),_:1},8,["modelValue"]))}});const q4=z(Q4,[["__scopeId","data-v-97158d03"]]);function K4(){const e=Ze(),t=n=>{console.error(n);const o=n.message??"Unknown global error";qi(n.error??o);const a=n.error?n.error:{details:o};e.addError("Application error (click for details)",a)};dt(()=>{window.addEventListener("error",t)}),Ut(()=>{window.removeEventListener("error",t)})}function Z4(){const e=new URLSearchParams(window.location.search),t=new URL(window.location.toString());e.delete("token"),t.search=`?${e.toString()}`,window.history.replaceState(null,"",t.toString())}function Y4(){const e=Oa.extractURLParameters();e.token&&li("Authorization",`Bearer ${e.token}`),e.tokenUrl&&fetch(String(e.tokenUrl),{method:String(e.tokenUrlMethod||"GET")}).then(t=>{if(t.status%100!==2)throw new Error("received non-200 response");return t.text()}).then(t=>{li("Authorization",`Bearer ${t}`)}).catch(t=>{console.error("error while fetching token from tokenUrl:",t)})}const J4=F({name:"App",components:{ControlsStrip:cv,LayoutGrid:i5,DragAndDrop:W4,ModulePanel:B4,PersistentOverlay:qn,ControlsModal:q4,WelcomePage:Iv,AppBar:Pm},setup(){const e=Ae(),t=Se();K4(),gg();const n=ho(),o=w(()=>e.idList.length>0||Object.keys(t.volumeInfo).length>0),a=w(()=>n.isLoading||o.value),{currentImageMetadata:i,isImageLoading:s}=me(),r=wo().name;X(i,d=>{let m="";d!=null&&d.name&&(d.name!==r||!s)&&(m=`${d.name} -`),document.title=`${m}VolView`}),Y4(),Z4();const l=Oa.extractURLParameters();dt(()=>{l.urls&&zg(l)});const c=zn();if(dt(()=>{c.connect()}),{}.VITE_ENABLE_REMOTE_SAVE&&l.save){const d=Array.isArray(l.save)?l.save[0]:l.save;rs().setSaveUrl(d)}const{layout:u}=ye(Me()),p=xn();return{leftSideBar:O(!p.mobile.value),loadUserPromptedFiles:Bl,loadFiles:Ll,hasData:o,showLoading:a,layout:u}}});const X4=e=>($e("data-v-02bfa8db"),e=e(),xe(),e),e6={class:"fill-height d-flex flex-row flex-grow-1"},t6={class:"d-flex flex-column flex-grow-1"},n6={class:"d-flex flex-column align-center justify-center h-100"},o6={class:"dnd-prompt"},a6=X4(()=>_("div",{class:"text-h2 font-weight-bold"},"Drop your files to open",-1));function s6(e,t,n,o,a,i){const s=q("app-bar"),r=q("module-panel"),l=q("controls-strip"),c=q("layout-grid"),u=q("welcome-page"),p=q("controls-modal"),d=q("persistent-overlay"),m=q("drag-and-drop");return C(),B(m,{enabled:"",onDropFiles:e.loadFiles,id:"app-container"},{default:v(({dragHover:g})=>[f(zu,null,{default:v(()=>[f(s,{"onClick:leftMenu":t[0]||(t[0]=A=>e.leftSideBar=!e.leftSideBar)}),f(Hu,{modelValue:e.leftSideBar,"onUpdate:modelValue":t[2]||(t[2]=A=>e.leftSideBar=A),app:"",clipped:"",touchless:"",width:"450",id:"left-nav"},{default:v(()=>[f(r,{onClose:t[1]||(t[1]=A=>e.leftSideBar=!1)})]),_:1},8,["modelValue"]),f(Gu,{id:"content-main"},{default:v(()=>[_("div",e6,[f(l,{"has-data":e.hasData},null,8,["has-data"]),_("div",t6,[Vt(f(c,{layout:e.layout},null,8,["layout"]),[[Tt,e.hasData]]),e.hasData?G("",!0):(C(),B(u,{key:0,loading:e.showLoading,class:"clickable",onClick:e.loadUserPromptedFiles},null,8,["loading","onClick"]))])])]),_:1}),f(p)]),_:1}),f(d,{disabled:!g,color:"#000",opacity:.3,"z-index":2e3,class:"text-center"},{default:v(()=>[_("div",n6,[_("div",o6,[f(K,{size:"4.75rem"},{default:v(()=>[P("mdi-download")]),_:1}),a6])])]),_:2},1032,["disabled"])]),_:1},8,["onDropFiles"])}const i6=z(J4,[["render",s6],["__scopeId","data-v-02bfa8db"]]),r6=Array.from(new Set(Array.from(Su.keys()).map(e=>mn[e.toLowerCase()])));async function l6(e){const{image:t}=await Da(e,{webWorker:yn()});return $d(t)}function c6(e){e.set("application/vnd.unknown.vti",sl),e.set("application/vnd.unknown.vtp",Lp),e.set("model/stl",Op),r6.forEach(t=>{e.set(t,l6)})}function u6({paint:e}={}){const t={$paint:e??new Sf};return()=>t}function d6(){const{exitPointerLock:e}=document;document.exitPointerLock=()=>{try{e==null||e.call(document)}catch{}}}d6();ap();Po.setResolveCoincidentTopologyToPolygonOffset();Po.setResolveCoincidentTopologyPolygonOffsetParameters(-3,-3);Po.setResolveCoincidentTopologyLineOffsetParameters(-3,-3);c6(Ca);Cu(Ht.pipelinesUrl);bu(Ht.pipelineWorkerUrl);Du(Ht.imageIOUrl);const $s=_u();$s.use(u6({}));$s.use(Z2);const Kn=Iu(i6);p0(Kn);Kn.use($s);Kn.use(ku);Kn.use(ju);Kn.mount("#app");
//# sourceMappingURL=index-ceb24fb5.js.map
