{"version":3,"file":"index-ceb24fb5.js","sources":["../../src/io/itk/itkConfig.js","../../src/utils/url.ts","../../src/utils/index.ts","../../src/store/messages.ts","../../src/utils/loggers.ts","../../src/composables/useToast.js","../../src/store/load-data.ts","../../src/assets/samples/MRI-Cardiac.jpg","../../src/assets/samples/MRI-PROSTATEx.jpg","../../src/assets/samples/MRA-Head_and_Neck.jpg","../../src/assets/samples/CTA-Head_and_Neck.jpg","../../src/assets/samples/3DUS-Fetus.jpg","../../src/types/layout.ts","../../src/config.ts","../../src/utils/doubleKeyRecord.ts","../../src/store/id.ts","../../src/utils/lps.ts","../../src/store/tools/types.ts","../../src/io/state-file/schema.ts","../../src/io/import/dataSource.ts","../../src/store/datasets-files.ts","../../src/io/state-file/utils.ts","../../src/utils/imageSpace.ts","../../src/store/datasets-images.ts","../../src/io/itk/worker.ts","../../src/io/dicom.ts","../../src/store/datasets-dicom.ts","../../src/composables/useErrorMessage.ts","../../src/utils/dataSelection.ts","../../src/io/resample/itkWasmUtils.js","../../src/io/resample/resample.ts","../../src/store/datasets-layers.ts","../../src/store/datasets-models.ts","../../src/store/datasets.ts","../../src/composables/useCurrentImage.ts","../../src/store/view-configs/common.ts","../../src/store/view-configs/slicing.ts","../../src/store/view-configs/windowing.ts","../../src/utils/vtk-helpers.ts","../../src/store/view-configs/layers.ts","../../src/store/view-configs/camera.ts","../../src/store/view-configs/volume-coloring.ts","../../src/store/view-configs.ts","../../src/store/views.ts","../../src/utils/path.ts","../../src/composables/onImageDeleted.ts","../../src/utils/promise-worker.ts","../../src/io/vtk/async.ts","../../src/io/readWriteImage.ts","../../src/utils/imageExtractComponentsFilter.js","../../src/vtk/LabelMap/index.js","../../src/store/segmentGroups.ts","../../src/store/tools/crop.ts","../../src/vtk/CrosshairsWidget/state.ts","../../src/vtk/CrosshairsWidget/behavior.ts","../../src/vtk/CrosshairsWidget/index.js","../../src/store/tools/crosshairs.ts","../../src/vtk/PaintBrushContextRepresentation/index.js","../../src/vtk/ToolWidgetUtils/utils.ts","../../src/vtk/PaintWidget/behavior.ts","../../src/vtk/PaintWidget/state.ts","../../src/vtk/PaintWidget/index.js","../../src/core/tools/paint/ellipse-brush.ts","../../src/core/tools/paint/index.ts","../../src/store/tools/paint.ts","../../src/utils/defineAnnotationToolStore.ts","../../src/utils/frameOfReference.ts","../../src/store/tools/toolSelection.ts","../../src/store/tools/useLabels.ts","../../src/store/tools/useAnnotationTool.ts","../../src/store/tools/rulers.ts","../../src/store/tools/rectangles.ts","../../src/store/tools/polygons.ts","../../src/store/tools/index.ts","../../src/io/mimeTypes.ts","../../src/io/magic.ts","../../src/io/io.ts","../../src/io/state-file/index.ts","../../src/utils/fetch.ts","../../src/store/remote-save-state.ts","../../src/components/IsolatedDialog.vue","../../src/components/CloseableDialog.vue","../../src/components/icons/VolViewFullLogo.vue","../../src/store/keyboard-shortcuts.ts","../../src/assets/KitwareHeadAndNeck.jpg","../../src/components/AboutBox.vue","../../src/components/icons/VolViewLogo.vue","../../src/components/AppBar.vue","../../src/core/pipeline.ts","../../src/io/import/common.ts","../../src/io/import/processors/handleDicomFile.ts","../../src/io/import/processors/downloadUrl.ts","../../src/io/zip.ts","../../src/io/import/processors/extractArchive.ts","../../src/io/import/processors/extractArchiveTarget.ts","../../src/io/amazonS3.ts","../../src/io/import/processors/handleAmazonS3.ts","../../src/io/googleCloudStorage.ts","../../src/io/import/processors/handleGoogleCloudStorage.ts","../../src/io/index.ts","../../src/io/import/processors/importSingleFile.ts","../../src/io/manifest.ts","../../src/io/import/processors/remoteManifest.ts","../../src/utils/functional.ts","../../src/io/import/processors/doneWithDataSource.ts","../../src/io/import/processors/updateFileMimeType.ts","../../src/io/import/processors/restoreStateFile.ts","../../src/store/data-browser.ts","../../src/composables/useSliceConfig.ts","../../src/composables/actions.ts","../../src/composables/useKeyboardShortcuts.ts","../../src/io/import/configJson.ts","../../src/io/import/processors/handleConfig.ts","../../src/io/import/importDataSources.ts","../../src/actions/loadUserFiles.ts","../../src/components/SaveSession.vue","../../src/components/ControlButton.vue","../../src/components/MessageNotificationContent.vue","../../src/components/MessageNotifications.vue","../../src/store/dicom-web/dicom-meta-store.ts","../../src/core/dicom-web-api.ts","../../src/store/dicom-web/dicom-web-store.ts","../../src/components/dicom-web/DicomWebSettings.vue","../../src/core/remote/transformers/vtkImageData.ts","../../src/core/remote/transformers/index.ts","../../src/core/remote/chunkedParser.ts","../../src/core/remote/client.ts","../../src/plugins/storeRegistry.ts","../../src/core/remote/storeApi.ts","../../src/store/server.ts","../../src/components/ServerSettings.vue","../../src/utils/gpuInfo.ts","../../src/utils/errorReporting.ts","../../src/components/Settings.vue","../../src/components/ItemGroup.vue","../../src/components/GroupableItem.vue","../../src/components/MenuControlButton.vue","../../src/components/tools/crop/CropControls.vue","../../src/components/tools/ResetViews.vue","../../src/components/EditableChipList.vue","../../src/components/LabelEditor.vue","../../src/components/ToolLabelEditor.vue","../../src/components/LabelControls.vue","../../src/components/RulerControls.vue","../../src/components/RectangleControls.vue","../../src/components/PolygonControls.vue","../../src/components/tools/windowing/WindowLevelControls.vue","../../src/components/ControlsStripTools.vue","../../src/components/MessageItem.vue","../../src/components/MessageCenter.vue","../../src/components/ControlsStrip.vue","../../src/components/DataSecurityBox.vue","../../src/components/WelcomePage.vue","../../src/composables/onVTKEvent.ts","../../src/utils/batchForNextTask.ts","../../src/core/vtk/useVtkView.ts","../../src/core/vtk/useVtkInteractorStyle.ts","../../src/utils/watchCompare.ts","../../src/composables/stableDeepRef.ts","../../src/core/vtk/useVtkInteractionManipulator.ts","../../src/utils/camera.ts","../../src/composables/onPausableVTKEvent.ts","../../src/core/vtk/vtkFieldRef.ts","../../src/utils/guardedWritableRef.ts","../../src/composables/usePersistCameraConfig.ts","../../src/components/vtk/context.ts","../../src/components/vtk/VtkVolumeView.vue","../../src/core/vtk/useVtkRepresentation.ts","../../src/core/vtk/useResliceRepresentation.ts","../../src/composables/useWindowingConfig.ts","../../src/components/vtk/VtkBaseObliqueSliceRepresentation.vue","../../src/core/vtk/useVtkFilter.ts","../../src/components/vtk/VtkImageOutlineRepresentation.vue","../../src/store/view-animation.ts","../../src/composables/useViewAnimationListener.ts","../../src/store/reslice-cursor.ts","../../src/components/MultiObliqueSliceViewer.vue","../../src/core/vtk/onViewMounted.ts","../../src/components/tools/ResliceCursorTool.vue","../../src/composables/useAutoFitState.ts","../../src/components/vtk/VtkSliceView.vue","../../src/composables/useWebGLWatchdog.ts","../../src/components/ViewOverlayGrid.vue","../../src/composables/useOrientationLabels.ts","../../src/components/DicomQuickInfoButton.vue","../../src/components/SliceViewerOverlay.vue","../../src/composables/useWindowingConfigInitializer.ts","../../src/core/vtk/useMouseRangeManipulatorListener.ts","../../src/components/vtk/VtkSliceViewWindowManipulator.vue","../../src/components/vtk/VtkMouseInteractionManipulator.vue","../../src/components/ObliqueSliceViewer.vue","../../src/core/vtk/useSliceRepresentation.ts","../../src/components/vtk/VtkBaseSliceRepresentation.vue","../../src/store/view-configs/segmentGroups.ts","../../src/composables/useSegmentGroupConfigInitializer.ts","../../src/components/vtk/VtkSegmentationSliceRepresentation.vue","../../src/composables/useLayerConfigInitializer.ts","../../src/composables/useColoringEffect.ts","../../src/components/vtk/VtkLayerSliceRepresentation.vue","../../src/composables/wheneverImageLoaded.ts","../../src/composables/useSliceInfo.ts","../../src/composables/useVTKWorldToDisplay.ts","../../src/components/tools/crop/Crop2DLineHandle.vue","../../src/components/tools/crop/Crop2D.vue","../../src/components/tools/crop/Crop3D.vue","../../src/components/tools/crop/CropTool.vue","../../src/utils/manipulators.ts","../../src/components/tools/crosshairs/CrosshairsWidget2D.vue","../../src/components/tools/crosshairs/CrosshairSVG2D.vue","../../src/components/tools/crosshairs/CrosshairsTool.vue","../../src/components/tools/paint/PaintWidget2D.vue","../../src/components/tools/paint/PaintTool.vue","../../src/composables/usePopperState.ts","../../src/composables/annotationTool.ts","../../src/components/tools/AnnotationContextMenu.vue","../../src/components/tools/AnnotationInfo.vue","../../src/composables/useFrameOfReference.ts","../../src/vtk/LineGlyphRepresentation/index.js","../../src/vtk/PolygonWidget/behavior.ts","../../src/vtk/ToolWidgetUtils/annotationWidgetState.ts","../../src/vtk/ToolWidgetUtils/pointState.js","../../src/vtk/PolygonWidget/decimate.ts","../../src/vtk/PolygonWidget/state.ts","../../src/vtk/PolygonWidget/index.js","../../src/components/tools/polygon/PolygonSVG2D.vue","../../src/components/tools/polygon/PolygonWidget2D.vue","../../src/components/tools/polygon/PolygonTool.vue","../../src/vtk/RulerWidget/behavior.ts","../../src/vtk/RulerWidget/state.ts","../../src/vtk/RulerWidget/index.js","../../src/components/tools/ruler/RulerSVG2D.vue","../../src/components/tools/ruler/RulerWidget2D.vue","../../src/components/tools/ruler/RulerTool.vue","../../src/vtk/RectangleWidget/RectangleLineRepresentation.js","../../src/vtk/RectangleWidget/index.js","../../src/components/tools/rectangle/RectangleSVG2D.vue","../../src/components/tools/rectangle/RectangleWidget2D.vue","../../src/components/tools/rectangle/RectangleTool.vue","../../src/components/tools/SelectTool.vue","../../src/components/tools/BoundingRectangle.vue","../../src/components/SliceSlider.vue","../../src/composables/useSliceConfigInitializer.ts","../../src/components/vtk/VtkSliceViewSlicingManipulator.vue","../../src/components/SliceViewer.vue","../../src/core/vtk/useVolumeRepresentation.ts","../../src/composables/useVolumeColoringInitializer.ts","../../src/composables/isViewAnimating.ts","../../src/utils/volumeProperties.ts","../../src/composables/useCroppingEffect.ts","../../src/components/vtk/VtkBaseVolumeRepresentation.vue","../../src/core/vtk/useOrientationMarker.ts","../../src/components/vtk/VtkOrientationMarker.vue","../../src/components/VolumeViewer.vue","../../src/core/viewTypes.ts","../../src/components/LayoutGrid.vue","../../src/components/PersistentOverlay.vue","../../src/components/ImageListCard.vue","../../src/components/SampleDataBrowser.vue","../../src/core/thumbnailers/index.ts","../../src/core/thumbnailers/vtk-image.ts","../../src/composables/useMultiSelection.ts","../../src/components/ImageDataBrowser.vue","../../src/components/PatientStudyVolumeBrowser.vue","../../src/components/PatientBrowser.vue","../../src/components/dicom-web/StudyVolumeDicomWeb.vue","../../src/components/dicom-web/PatientDetails.vue","../../src/components/dicom-web/PatientList.vue","../../src/components/DataBrowser.vue","../../src/components/VolumeProperties.vue","../../src/vtk/ColorMaps.ts","../../src/vtk/PiecewiseWidget/index.js","../../src/composables/useResizeObserver.ts","../../src/core/thumbnailers/volume-thumbnailer.ts","../../src/composables/useCameraOrientation.ts","../../src/composables/useVolumeThumbnailing.ts","../../src/components/VolumeRendering.vue","../../src/components/VolumePresets.vue","../../src/components/LayerProperties.vue","../../src/components/LayerList.vue","../../src/components/RenderingModule.vue","../../src/composables/useMultipleToolSelection.ts","../../src/components/MeasurementsToolList.vue","../../src/composables/useGlobalLayerColorConfig.ts","../../src/components/SegmentGroupOpacity.vue","../../src/components/SegmentEditor.vue","../../src/utils/color.ts","../../src/components/SegmentList.vue","../../src/components/SaveSegmentGroupDialog.vue","../../src/components/SegmentGroupControls.vue","../../src/components/PaintControls.vue","../../src/components/ToolControls.vue","../../src/components/MeasurementRulerDetails.vue","../../src/components/AnnotationsModule.vue","../../src/components/ServerModule.vue","../../src/components/ModulePanel.vue","../../src/components/DragAndDrop.vue","../../src/components/ControlsModal.vue","../../src/composables/useGlobalErrorHook.ts","../../src/utils/token.ts","../../src/components/App.vue","../../src/io/readers.ts","../../src/core/provider.ts","../../src/utils/hacks.ts","../../src/main.js"],"sourcesContent":["const fullUrl = (relative) => {\n  // ex: /itk/image-io\n  const u = new URL(document.location); // ex: http://localhost:8043/orthanc/volview/index.html\n  const origin = u.origin; // ex: http://localhost:8043\n  const pathParts = u.pathname.split('/'); // ex: ['', 'orthanc', 'volview', 'index.html']\n  pathParts.pop(); // ex: ['', 'orthanc', 'volview']\n\n  const url = origin + pathParts.join('/') + relative; // ex http://localhost:8043/orthanc/volview/itk/image-io\n  return url;\n};\n\nconst itkConfig = {\n  pipelineWorkerUrl: fullUrl('/itk/itk-wasm-pipeline.min.worker.js'),\n  imageIOUrl: fullUrl('/itk/image-io'),\n  meshIOUrl: fullUrl('/itk/mesh-io'),\n  pipelinesUrl: fullUrl('/itk/pipelines'),\n};\n\nexport default itkConfig;\n","const SPECIAL_SCHEME_RE = /^(https?|ftp|file|wss?):$/;\n\n/**\n * Represents a URL object with relaxed writing semantics.\n *\n * The protocol field is now unconditionally writeable,\n * regardless of whether the protocol is special.\n */\nexport class WriteableURL extends URL {\n  _proto: string;\n\n  constructor(url: string, base?: string) {\n    super(url, base);\n    this._proto = this.protocol;\n  }\n\n  set protocol(proto: string) {\n    this._proto = proto;\n  }\n\n  get protocol() {\n    return this._proto;\n  }\n\n  private replaceProtocol(url: string) {\n    const re = new RegExp(`^${super.protocol}`);\n    return url.replace(re, this._proto);\n  }\n\n  get origin() {\n    return this.replaceProtocol(super.origin);\n  }\n\n  get href() {\n    return this.replaceProtocol(super.href);\n  }\n\n  toString() {\n    return this.replaceProtocol(super.toString());\n  }\n}\n\n/**\n * Parses a URL.\n *\n * Chrome, Firefox, and Safari parse URLS differently for\n * non-special schemes. parseUrl's goal is to have uniform\n * output across browsers for non-special schemes.\n *\n * @param url\n * @param base\n * @returns\n */\nexport function parseUrl(url: string, base?: string) {\n  let parsed = new URL(url, base);\n  if (SPECIAL_SCHEME_RE.test(parsed.protocol)) {\n    return parsed;\n  }\n\n  // replace the scheme with a special scheme to get uniform parsing.\n  const proto = parsed.protocol;\n  const re = new RegExp(`^${proto}`);\n  parsed = new WriteableURL(url.replace(re, 'ws:'), base?.replace(re, 'ws:'));\n  // This line doesn't work with the standard URL API.\n  parsed.protocol = proto;\n  return parsed;\n}\n","import { z } from 'zod';\nimport { TypedArray } from 'itk-wasm';\nimport { parseUrl } from '@/src/utils/url';\nimport { EPSILON } from '../constants';\nimport { Maybe } from '../types';\n\nexport function identity<T>(arg: T) {\n  return arg;\n}\n\nexport const isFulfilled = <T>(\n  input: PromiseSettledResult<T>\n): input is PromiseFulfilledResult<T> => input.status === 'fulfilled';\n\ntype PromiseResolveFunction<T> = (value: T) => void;\ntype PromiseRejectFunction = (reason?: Error) => void;\nexport interface Deferred<T> {\n  promise: Promise<T>;\n  resolve: PromiseResolveFunction<T>;\n  reject: PromiseRejectFunction;\n}\n\nexport function defer<T>(): Deferred<T> {\n  let innerResolve: PromiseResolveFunction<T> | null = null;\n  let innerReject: PromiseRejectFunction | null = null;\n\n  const resolve = (value: T) => {\n    if (innerResolve) innerResolve(value);\n  };\n  const reject = (reason?: Error) => {\n    if (innerReject) innerReject(reason);\n  };\n\n  const promise = new Promise<T>((res, rej) => {\n    innerResolve = res;\n    innerReject = rej;\n  });\n\n  return { promise, resolve, reject };\n}\n\nexport function removeFromArray<T>(arr: Array<T>, el: T) {\n  const idx = arr.indexOf(el);\n  if (idx > -1) {\n    arr.splice(idx, 1);\n  }\n}\n\nexport function clampValue(value: number, min: number, max: number) {\n  return Math.min(max, Math.max(min, value));\n}\n\nexport function pick<T, K extends keyof T>(obj: T, ...keys: K[]): Pick<T, K> {\n  return keys.reduce((o, k) => ({ ...o, [k]: obj[k] }), {} as Pick<T, K>);\n}\n\nexport const pluck =\n  <T, K extends keyof T>(key: K) =>\n  (obj: T): T[K] =>\n    obj[key];\n\n/**\n * Takes a predicate and a list of values and returns a a tuple (2-item array),\n *  with each item containing the subset of the list that matches the predicate\n *  and the complement of the predicate respectively\n *\n * @sig (T -> Boolean, T[]) -> [T[], T[]]\n *\n * @param {Function} predicate A predicate to determine which side the element belongs to.\n * @param {Array} arr The list to partition\n *\n * Inspired by the Ramda function of the same name\n * @see https://ramdajs.com/docs/#partition\n *\n * @example\n *\n *     const isNegative: (n: number) => boolean = n => n < 0\n *     const numbers = [1, 2, -4, -7, 4, 22]\n *     partition(isNegative, numbers)\n *     // => [ [-4, -7], [1, 2, 4, 22] ]\n *\n * Source https://gist.github.com/zachlysobey/71ac85046d0d533287ed85e1caa64660\n */\nexport function partition<T>(\n  predicate: (val: T) => boolean,\n  arr: Array<T>\n): [Array<T>, Array<T>] {\n  const partitioned: [Array<T>, Array<T>] = [[], []];\n  arr.forEach((val: T) => {\n    const partitionIndex: 0 | 1 = predicate(val) ? 0 : 1;\n    partitioned[partitionIndex].push(val);\n  });\n  return partitioned;\n}\n\nexport function partitionByType<T, U extends T>(\n  guard: (x: T) => x is U,\n  arr: T[]\n): [U[], Exclude<T, U>[]] {\n  const ret: [U[], Exclude<T, U>[]] = [[], []];\n  arr.forEach((el) =>\n    guard(el) ? ret[0].push(el) : ret[1].push(el as Exclude<T, U>)\n  );\n  return ret;\n}\n\nexport const chunk = <T>(arr: T[], size: number) =>\n  Array.from({ length: Math.ceil(arr.length / size) }, (_: any, i: number) =>\n    arr.slice(i * size, i * size + size)\n  );\n\nexport function plural(n: number, word: string, pluralWord?: string) {\n  return n > 1 ? pluralWord ?? `${word}s` : word;\n}\n\nexport const ensureDefault = <T>(\n  key: string,\n  records: Record<string, T>,\n  default_: T\n) => {\n  if (!(key in records)) {\n    // eslint-disable-next-line no-param-reassign\n    records[key] = default_;\n  }\n\n  return records[key];\n};\n\ntype ArrayLike<T> = T extends unknown[] ? T : T extends TypedArray ? T : never;\nexport function arrayEquals<T>(a: ArrayLike<T>, b: ArrayLike<T>) {\n  if (a.length !== b.length) return false;\n  for (let i = 0; i < a.length; i++) {\n    if (a[i] !== b[i]) return false;\n  }\n  return true;\n}\n\ntype ComparatorFunction<T> = (a: T, b: T) => boolean;\nexport function arrayEqualsWithComparator<T>(\n  a: T[],\n  b: T[],\n  cmp: ComparatorFunction<T>\n) {\n  if (a.length !== b.length) return false;\n  for (let i = 0; i < a.length; i++) {\n    if (!cmp(a[i], b[i])) return false;\n  }\n  return true;\n}\n\n/**\n * Wraps non-arrays in an array.\n * @param maybeArray\n */\nexport function wrapInArray<T>(maybeArray: T | T[]): T[] {\n  return Array.isArray(maybeArray) ? maybeArray : [maybeArray];\n}\n\n/**\n * Extracts the basename from a URL.\n */\nexport function getURLBasename(url: string) {\n  return parseUrl(url, window.location.href).pathname.split('/').at(-1) ?? '';\n}\n\n// from https://stackoverflow.com/a/18650828\nexport function formatBytes(bytes: number, decimals = 2) {\n  if (!+bytes) return '0 Bytes';\n\n  const k = 1024;\n  const dm = decimals < 0 ? 0 : decimals;\n  const sizes = ['Bytes', 'KB', 'MB', 'GB', 'TB', 'PB', 'EB', 'ZB', 'YB'];\n\n  const i = Math.floor(Math.log(bytes) / Math.log(k));\n\n  return `${parseFloat((bytes / k ** i).toFixed(dm))} ${sizes[i]}`;\n}\n\nexport function roundIfCloseToInteger(value: number, eps = EPSILON) {\n  const rounded = Math.round(value);\n  if (Math.abs(rounded - value) <= eps) {\n    return rounded;\n  }\n  return value;\n}\n\nexport function hasKey<O extends Object>(\n  obj: O,\n  key: PropertyKey\n): key is keyof O {\n  return key in obj;\n}\n\nexport function remapKeys<O extends Object, K extends keyof O>(\n  obj: O,\n  keyMap: Record<K, K>\n) {\n  return Object.fromEntries(\n    Object.entries(obj).map(([key, value]) => {\n      if (hasKey(keyMap, key)) return [keyMap[key], value];\n      throw new Error(`Key ${key} not found in keyMap`);\n    })\n  );\n}\n\n// return object without the given keys\nexport const omit = <T extends Record<string, unknown>, K extends keyof T>(\n  obj: T,\n  keys: K[] | K\n) =>\n  Object.fromEntries(\n    Object.entries(obj).filter(([key]) => !wrapInArray(keys).includes(key as K))\n  ) as Omit<T, K>;\n\nexport function ensureError(e: unknown) {\n  return e instanceof Error ? e : new Error(JSON.stringify(e));\n}\n\n// remove undefined properties\nexport function cleanUndefined(obj: Object) {\n  return Object.entries(obj).reduce(\n    (cleaned, [key, value]) =>\n      value === undefined ? cleaned : { ...cleaned, [key]: value },\n    {}\n  );\n}\n\n// converts named colors (red, antiquewhite, etc) to hex\nexport function standardizeColor(color: Maybe<string>) {\n  if (!color) return '#ffffff';\n  const ctx = document.createElement('canvas').getContext('2d');\n  if (!ctx) throw new Error('Could not create canvas context');\n  ctx.fillStyle = color;\n  return ctx.fillStyle;\n}\n\n// https://github.com/colinhacks/zod/discussions/839#discussioncomment-4335236\nexport function zodEnumFromObjKeys<K extends string>(\n  obj: Record<K, any>\n): z.ZodEnum<[K, ...K[]]> {\n  const [firstKey, ...otherKeys] = Object.keys(obj) as K[];\n  return z.enum([firstKey, ...otherKeys]);\n}\n\nexport function nonNullable<T>(value: T): value is NonNullable<T> {\n  return value != null;\n}\n\nexport const TypedArrayConstructorNames = [\n  'Uint8Array',\n  'Uint8ClampedArray',\n  'Uint16Array',\n  'Uint32Array',\n  'Int8Array',\n  'Int16Array',\n  'Int32Array',\n  'Float32Array',\n  'Float64Array',\n];\n\n// https://stackoverflow.com/a/74823834\ntype Entries<T> = {\n  [K in keyof T]-?: [K, T[K]];\n}[keyof T][];\n\n// Object.entries with keys preserved rather as string\nexport const getEntries = <T extends object>(obj: T) =>\n  Object.entries(obj) as Entries<T>;\n\n/**\n * Normalizes a list of objects to { order, byKey }\n * @param objects\n * @param key\n * @returns\n */\nexport function normalizeForStore<T, K extends keyof T>(objects: T[], key: K) {\n  type KeyType = T[K];\n  const order: KeyType[] = objects.map((obj) => obj[key]);\n  const byKey = objects.reduce<Record<K, T>>(\n    (acc, obj) => ({ ...acc, [obj[key] as string | number | symbol]: obj }),\n    {} as Record<string | number | symbol, T>\n  );\n\n  return { order, byKey };\n}\n","import { defineStore } from 'pinia';\nimport { removeFromArray } from '../utils';\n\nexport enum MessageType {\n  Error,\n  Warning,\n  Info,\n  Success,\n}\n\nexport type MessageOptions = {\n  details?: string;\n  persist?: boolean;\n};\n\nexport interface Message {\n  id: string;\n  type: MessageType;\n  title: string;\n  options: MessageOptions;\n}\n\nexport type UpdateProgressFunction = (progress: number) => void;\nexport type TaskFunction = (updateProgress?: UpdateProgressFunction) => any;\ninterface State {\n  _nextID: number;\n  byID: Record<string, Message>;\n  msgList: string[];\n}\n\nexport const useMessageStore = defineStore('message', {\n  state: (): State => ({\n    _nextID: 1,\n    byID: {},\n    msgList: [],\n  }),\n  getters: {\n    messages(): Array<Message> {\n      return this.msgList.map((id: string) => this.byID[id]);\n    },\n    // only info, error, warn\n    importantMessages(): Array<Message> {\n      return this.messages.filter((msg) => msg.type !== MessageType.Success);\n    },\n  },\n  actions: {\n    /**\n     * Adds an error message.\n     * @param title message title\n     * @param opts an Error, a string containing details, or a MessageOptions\n     */\n    addError(title: string, opts?: Error | string | MessageOptions) {\n      if (opts instanceof Error) {\n        return this._addMessage(\n          {\n            type: MessageType.Error,\n            title,\n          },\n          {\n            details: String(opts),\n            persist: false,\n          }\n        );\n      }\n      return this._addMessage(\n        {\n          type: MessageType.Error,\n          title,\n        },\n        opts\n      );\n    },\n    /**\n     * Adds a warning message.\n     * @param title message title\n     * @param opts a string containing details or a MessageOptions\n     */\n    addWarning(title: string, details?: string | MessageOptions) {\n      return this._addMessage(\n        {\n          type: MessageType.Warning,\n          title,\n        },\n        details\n      );\n    },\n    /**\n     * Adds a success message.\n     * @param title message title\n     * @param opts a string containing details or a MessageOptions\n     */\n    addInfo(title: string, details?: string | MessageOptions) {\n      return this._addMessage(\n        {\n          type: MessageType.Info,\n          title,\n        },\n        details\n      );\n    },\n    /**\n     * Adds a success message.\n     * @param title message title\n     * @param opts a string containing details or a MessageOptions\n     */\n    addSuccess(title: string, details?: string | MessageOptions) {\n      return this._addMessage(\n        {\n          type: MessageType.Success,\n          title,\n        },\n        details\n      );\n    },\n    clearOne(id: string) {\n      if (id in this.byID) {\n        removeFromArray(this.msgList, id);\n        delete this.byID[id];\n      }\n    },\n    clearAll() {\n      this.byID = {};\n      this.msgList = [];\n    },\n    _addMessage(\n      msg: Omit<Message, 'id' | 'options'>,\n      details?: string | MessageOptions\n    ) {\n      const id = String(this._nextID++);\n      const options: MessageOptions = {\n        persist: false,\n        ...(typeof details === 'string' ? { details } : details),\n      };\n      this.byID[id] = {\n        ...msg,\n        options,\n        id,\n      };\n      this.msgList.push(id);\n      return id;\n    },\n  },\n});\n","import { NOOP } from '@/src/constants';\n\n/**\n * Recursively logs error causes\n * @param error\n */\nexport function logError(error: unknown) {\n  let cur = error;\n  while (cur) {\n    if (cur !== error) {\n      console.error('The above error was caused by:', cur);\n    } else {\n      console.error(cur);\n    }\n\n    if (cur instanceof Error) {\n      cur = cur.cause;\n    } else {\n      cur = null;\n    }\n  }\n}\n\nconst isProd = process.env.NODE_ENV === 'production';\n\nexport const debug = {\n  debug: isProd ? NOOP : console.debug,\n  log: isProd ? NOOP : console.log,\n  info: isProd ? NOOP : console.info,\n  warn: isProd ? NOOP : console.warn,\n  error: isProd ? NOOP : console.error,\n};\n","import { createToastInterface } from 'vue-toastification';\n\nconst toast = createToastInterface({\n  position: 'bottom-left',\n  timeout: 3000,\n  hideProgressBar: true,\n  maxToasts: 3,\n  transition: 'Vue-Toastification__fade',\n});\n\nexport const useToast = () => toast;\n","import { useMessageStore } from '@/src/store/messages';\nimport { Maybe } from '@/src/types';\nimport { logError } from '@/src/utils/loggers';\nimport { defineStore } from 'pinia';\nimport { computed, ref, watch } from 'vue';\nimport { useToast } from '@/src/composables/useToast';\nimport { TYPE } from 'vue-toastification';\nimport { ToastID, ToastOptions } from 'vue-toastification/dist/types/types';\n\nconst NotificationMessages = {\n  Loading: 'Loading datasets...',\n  Done: 'Datasets loaded!',\n  Error: 'Some files failed to load',\n};\n\nconst LoadingToastOptions = {\n  type: TYPE.INFO,\n  timeout: false,\n  closeButton: false,\n  closeOnClick: false,\n} satisfies ToastOptions;\n\nexport function useLoadingNotifications() {\n  const messageStore = useMessageStore();\n\n  const loadingCount = ref(0);\n  const loadingError = ref<Maybe<Error>>();\n\n  const startLoading = () => {\n    loadingCount.value += 1;\n  };\n\n  const stopLoading = () => {\n    if (loadingCount.value === 0) return;\n    loadingCount.value -= 1;\n  };\n\n  const setError = (err: Error) => {\n    loadingError.value = err;\n  };\n\n  const toast = useToast();\n  let toastID: Maybe<ToastID> = null;\n\n  const showLoadingToast = () => {\n    if (toastID == null) {\n      toastID = toast.info(NotificationMessages.Loading, LoadingToastOptions);\n    } else {\n      toast.update(toastID, {\n        content: NotificationMessages.Loading,\n        options: LoadingToastOptions,\n      });\n    }\n  };\n\n  const showResults = () => {\n    if (toastID == null) return;\n    const error = loadingError.value;\n    loadingError.value = null;\n\n    if (error) {\n      logError(error);\n      toast.dismiss(toastID);\n      messageStore.addError(NotificationMessages.Error, error);\n    } else {\n      toast.update(toastID, {\n        content: NotificationMessages.Done,\n        options: {\n          type: TYPE.SUCCESS,\n          timeout: 3000,\n          closeButton: 'button',\n          closeOnClick: true,\n          onClose() {\n            toastID = null;\n          },\n        },\n      });\n    }\n  };\n\n  watch(loadingCount, (count) => {\n    if (count) showLoadingToast();\n    else showResults();\n  });\n\n  const isLoading = computed(() => {\n    return loadingCount.value > 0;\n  });\n\n  return {\n    isLoading,\n    startLoading,\n    stopLoading,\n    setError,\n  };\n}\n\nconst useLoadDataStore = defineStore('loadData', () => {\n  const { startLoading, stopLoading, setError, isLoading } =\n    useLoadingNotifications();\n\n  const segmentGroupExtension = ref('');\n\n  return {\n    segmentGroupExtension,\n    isLoading,\n    startLoading,\n    stopLoading,\n    setError,\n  };\n});\n\nexport default useLoadDataStore;\n","export default \"data:image/jpeg;base64,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\"","export default \"data:image/jpeg;base64,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\"","export default \"data:image/jpeg;base64,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\"","export default \"data:image/jpeg;base64,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\"","export default \"data:image/jpeg;base64,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\"","export enum LayoutDirection {\n  V = 'V',\n  H = 'H',\n}\n\nexport type Layout = {\n  direction: LayoutDirection;\n  items: ReadonlyArray<Layout | string>;\n  name?: string;\n};\n","import MRICardiacThumbnail from '@/src/assets/samples/MRI-Cardiac.jpg';\nimport MRIPROSTATExThumbnail from '@/src/assets/samples/MRI-PROSTATEx.jpg';\nimport MRAHeadThumbnail from '@/src/assets/samples/MRA-Head_and_Neck.jpg';\nimport CTAHeadThumbnail from '@/src/assets/samples/CTA-Head_and_Neck.jpg';\nimport USFetusThumbnail from '@/src/assets/samples/3DUS-Fetus.jpg';\nimport { SegmentMask } from '@/src/types/segment';\nimport { Layout, LayoutDirection } from './types/layout';\nimport { ViewSpec } from './types/views';\nimport { SampleDataset } from './types';\nimport { Action } from './constants';\n\n/**\n * These are the initial view IDs.\n *\n * These view IDs get mapped to components in core/viewTypes.ts.\n */\nexport const InitViewIDs: Record<string, string> = {\n  Coronal: 'Coronal',\n  Sagittal: 'Sagittal',\n  Axial: 'Axial',\n  Three: '3D',\n  ObliqueCoronal: 'ObliqueCoronal',\n  ObliqueSagittal: 'ObliqueSagittal',\n  ObliqueAxial: 'ObliqueAxial',\n  ObliqueThree: 'Oblique3D',\n};\n\n/**\n * View spec for the initial view IDs.\n */\nexport const InitViewSpecs: Record<string, ViewSpec> = {\n  [InitViewIDs.Coronal]: {\n    viewType: '2D',\n    props: {\n      viewDirection: 'Posterior',\n      viewUp: 'Superior',\n    },\n  },\n  [InitViewIDs.Sagittal]: {\n    viewType: '2D',\n    props: {\n      viewDirection: 'Right',\n      viewUp: 'Superior',\n    },\n  },\n  [InitViewIDs.Axial]: {\n    viewType: '2D',\n    props: {\n      viewDirection: 'Superior',\n      viewUp: 'Anterior',\n    },\n  },\n  [InitViewIDs.ObliqueCoronal]: {\n    viewType: 'Oblique',\n    props: {\n      viewDirection: 'Posterior',\n      viewUp: 'Superior',\n    },\n  },\n  [InitViewIDs.ObliqueSagittal]: {\n    viewType: 'Oblique',\n    props: {\n      viewDirection: 'Right',\n      viewUp: 'Superior',\n    },\n  },\n  [InitViewIDs.ObliqueAxial]: {\n    viewType: 'Oblique',\n    props: {\n      viewDirection: 'Superior',\n      viewUp: 'Anterior',\n    },\n  },\n  [InitViewIDs.Three]: {\n    viewType: '3D',\n    props: {\n      viewDirection: 'Posterior',\n      viewUp: 'Superior',\n    },\n  },\n  [InitViewIDs.ObliqueThree]: {\n    viewType: 'Oblique3D',\n    props: {\n      viewDirection: 'Posterior',\n      viewUp: 'Superior',\n      slices: [\n        {\n          viewID: InitViewIDs.ObliqueSagittal,\n          axis: 'Sagittal',\n        },\n        {\n          viewID: InitViewIDs.ObliqueCoronal,\n          axis: 'Coronal',\n        },\n        {\n          viewID: InitViewIDs.ObliqueAxial,\n          axis: 'Axial',\n        },\n      ],\n    },\n  },\n};\n\n/**\n * The default view spec.\n */\nexport const DefaultViewSpec = InitViewSpecs[InitViewIDs.Axial];\n\n/**\n * The default layout.\n */\nexport const DefaultLayoutName = 'Quad View';\n\n/**\n * Defines the default layouts.\n */\nexport const Layouts: Record<string, Layout> = [\n  {\n    name: 'Axial Only',\n    direction: LayoutDirection.H,\n    items: [InitViewIDs.Axial],\n  },\n  {\n    name: 'Axial Primary',\n    direction: LayoutDirection.V,\n    items: [\n      InitViewIDs.Axial,\n      {\n        direction: LayoutDirection.H,\n        items: [InitViewIDs.Three, InitViewIDs.Coronal, InitViewIDs.Sagittal],\n      },\n    ],\n  },\n  {\n    name: '3D Primary',\n    direction: LayoutDirection.V,\n    items: [\n      InitViewIDs.Three,\n      {\n        direction: LayoutDirection.H,\n        items: [InitViewIDs.Coronal, InitViewIDs.Sagittal, InitViewIDs.Axial],\n      },\n    ],\n  },\n  {\n    name: 'Quad View',\n    direction: LayoutDirection.H,\n    items: [\n      {\n        direction: LayoutDirection.V,\n        items: [InitViewIDs.Coronal, InitViewIDs.Three],\n      },\n      {\n        direction: LayoutDirection.V,\n        items: [InitViewIDs.Sagittal, InitViewIDs.Axial],\n      },\n    ],\n  },\n  {\n    name: 'Oblique View',\n    direction: LayoutDirection.H,\n    items: [\n      {\n        direction: LayoutDirection.V,\n        items: [InitViewIDs.ObliqueCoronal, InitViewIDs.ObliqueThree],\n      },\n      {\n        direction: LayoutDirection.V,\n        items: [InitViewIDs.ObliqueSagittal, InitViewIDs.ObliqueAxial],\n      },\n    ],\n  },\n  {\n    name: '3D Only',\n    direction: LayoutDirection.H,\n    items: [InitViewIDs.Three],\n  },\n].reduce((layouts, layout) => {\n  return { ...layouts, [layout.name]: layout };\n}, {});\n\nexport const SAMPLE_DATA: SampleDataset[] = [\n  {\n    name: 'CTA Head and Neck',\n    filename: 'CTA-Head_and_Neck.zip',\n    description:\n      'CTA head and neck scan of elderly patient with tumor. (80 MB)',\n    url: 'https://data.kitware.com/api/v1/item/6347159711dab81428208e24/download',\n    image: CTAHeadThumbnail,\n  },\n  {\n    name: 'MRA Head and Neck',\n    filename: 'MRA-Head_and_Neck.zip',\n    description:\n      'MRA from Patient Contributed Image Repository. Click application help icon \"(?)\" for more info. (15 MB)',\n    url: 'https://data.kitware.com/api/v1/item/6352a2b311dab8142820a33b/download',\n    image: MRAHeadThumbnail,\n  },\n  {\n    name: 'MRI Cardiac 3D and Cine',\n    filename: 'MRI-Cardiac-3D_and_Cine.zip',\n    description:\n      'MRI scan with two series: 3D axial non-gated and 2 chamber cine. (4 MB)',\n    url: 'https://data.kitware.com/api/v1/item/6350b28f11dab8142820949d/download',\n    image: MRICardiacThumbnail,\n  },\n  {\n    name: 'MRI PROSTATEx',\n    filename: 'MRI-PROSTATEx-0004.zip',\n    description:\n      'MRI from the SPIE-AAPM-NCI PROSTATEx challenge. Click application help \"(?)\" icon for more info. (3 MB)',\n    url: 'https://data.kitware.com/api/v1/item/63527c7311dab8142820a338/download',\n    image: MRIPROSTATExThumbnail,\n  },\n  {\n    name: '3D US Fetus',\n    filename: '3DUS-Fetus.mha',\n    description:\n      '3D ultrasound of a baby. Downloaded from tomovision.com.(8 MB)',\n    url: 'https://data.kitware.com/api/v1/item/635679c311dab8142820a4f4/download',\n    image: USFetusThumbnail,\n    defaults: {\n      colorPreset: 'US-Fetal',\n    },\n  },\n];\n\nexport const TOOL_COLORS = [\n  '#58f24c',\n  '#8de4d3',\n  '#f0a4b1',\n  '#a3c9fe',\n  '#c8f251',\n  '#fea53b',\n];\n\nexport const STROKE_WIDTH_ANNOTATION_TOOL_DEFAULT = 1;\n\nexport const RULER_LABEL_DEFAULTS = {\n  red: { color: 'red' },\n  green: { color: '#00ff00' },\n  white: { color: '#ffffff' },\n};\n\nexport const RECTANGLE_LABEL_DEFAULTS = {\n  artifact: { color: '#888888' },\n  innocuous: { color: '#00ff00' },\n  lesion: { color: 'red' },\n};\n\nexport const POLYGON_LABEL_DEFAULTS = {\n  red: { color: 'red' },\n  green: { color: '#00ff00' },\n  white: { color: '#ffffff' },\n};\n\nexport const DEFAULT_PRESET_BY_MODALITY: Record<string, string> = {\n  CT: 'CT-AAA',\n  MR: 'CT-Coronary-Arteries-2',\n  US: 'US-Fetal',\n};\nexport const DEFAULT_PRESET = 'CT-AAA';\n\nexport const LAYER_PRESET_BY_MODALITY: Record<string, string> = {\n  ...DEFAULT_PRESET_BY_MODALITY,\n  PT: '2hot-opaque',\n};\nexport const LAYER_PRESET_DEFAULT = 'Blue to Red Rainbow';\n\n// Keyboard shortcuts/hotkeys. Can add modifiers: 'Shift+Ctrl+a'\nexport const ACTION_TO_KEY = {\n  windowLevel: 'l',\n  pan: 'n',\n  zoom: 'z',\n  ruler: 'm',\n  paint: 'p',\n  rectangle: 'r',\n  crosshairs: 'c',\n  crop: 'b',\n  polygon: 'g',\n  mergeNewPolygon: 'Shift',\n  select: 's',\n\n  nextSlice: 'arrowdown',\n  previousSlice: 'arrowup',\n\n  decrementLabel: 'q',\n  incrementLabel: 'w',\n\n  deleteCurrentImage: 'ctrl+.',\n  clearScene: 'ctrl+/',\n\n  showKeyboardShortcuts: '?',\n} satisfies Record<Action, string>;\n\nexport const DEFAULT_SEGMENT_MASKS: SegmentMask[] = [\n  {\n    value: 1,\n    name: 'Tissue',\n    color: [255, 0, 0, 255],\n    visible: true,\n  },\n  {\n    value: 2,\n    name: 'Liver',\n    color: [0, 255, 0, 255],\n    visible: true,\n  },\n  {\n    value: 3,\n    name: 'Heart',\n    color: [0, 0, 255, 255],\n    visible: true,\n  },\n];\n\n// from https://github.com/InsightSoftwareConsortium/itk-viewer-color-maps/blob/main/src/CategoricalColors.json\nexport const CATEGORICAL_COLORS = [\n  [214, 0, 0],\n  [59, 255, 1],\n  [0, 0, 172],\n  [151, 255, 0],\n  [126, 209, 107],\n  [79, 255, 165],\n  [87, 59, 0],\n  [86, 89, 0],\n  [221, 0, 253],\n  [161, 117, 105],\n  [182, 255, 149],\n  [119, 191, 3],\n  [100, 84, 116],\n  [0, 0, 7],\n  [216, 253, 244],\n  [0, 75, 0],\n  [121, 0, 255],\n  [102, 237, 184],\n  [93, 126, 102],\n  [228, 255, 235],\n  [119, 165, 123],\n  [89, 0, 163],\n  [198, 0, 158],\n  [0, 156, 59],\n  [202, 195, 0],\n  [130, 151, 0],\n  [137, 130, 135],\n  [93, 54, 59],\n  [0, 0, 253],\n  [255, 189, 230],\n  [219, 109, 1],\n  [184, 181, 228],\n  [255, 47, 82],\n  [195, 102, 144],\n  [98, 31, 196],\n  [114, 3, 130],\n  [105, 230, 128],\n  [38, 144, 109],\n  [255, 77, 51],\n  [133, 163, 1],\n  [3, 202, 193],\n  [196, 196, 86],\n  [117, 87, 61],\n  [103, 66, 0],\n  [212, 218, 223],\n  [249, 255, 0],\n  [103, 175, 195],\n  [0, 225, 205],\n  [218, 149, 255],\n  [3, 253, 145],\n  [130, 160, 0],\n  [86, 154, 84],\n  [140, 142, 54],\n  [38, 151, 165],\n  [142, 140, 94],\n  [70, 0, 200],\n  [249, 174, 109],\n  [110, 207, 167],\n  [255, 140, 140],\n  [177, 119, 54],\n  [255, 160, 121],\n  [0, 31, 255],\n  [68, 94, 17],\n  [103, 151, 147],\n  [94, 147, 75],\n  [116, 82, 145],\n  [170, 112, 49],\n  [207, 253, 0],\n  [107, 96, 52],\n  [144, 212, 47],\n  [212, 124, 80],\n  [161, 77, 35],\n  [124, 89, 0],\n  [205, 68, 130],\n  [207, 77, 253],\n  [137, 0, 61],\n  [82, 91, 0],\n  [156, 170, 130],\n  [128, 112, 142],\n  [100, 253, 195],\n  [137, 205, 40],\n  [255, 154, 181],\n  [93, 186, 33],\n  [1, 0, 142],\n  [98, 128, 35],\n  [135, 191, 151],\n  [212, 205, 126],\n  [209, 182, 91],\n  [0, 110, 153],\n  [68, 175, 198],\n  [242, 255, 209],\n  [235, 1, 205],\n  [188, 68, 0],\n  [121, 156, 126],\n  [112, 70, 147],\n  [186, 0, 84],\n  [172, 147, 235],\n  [163, 22, 94],\n  [128, 0, 75],\n  [124, 184, 211],\n  [42, 0, 56],\n  [100, 184, 0],\n  [255, 128, 61],\n  [209, 232, 128],\n  [89, 33, 52],\n  [161, 93, 110],\n  [181, 175, 158],\n  [70, 51, 124],\n  [193, 65, 0],\n  [232, 61, 107],\n  [232, 117, 188],\n  [165, 196, 168],\n  [84, 110, 216],\n  [56, 251, 124],\n  [75, 100, 73],\n  [195, 235, 121],\n  [54, 75, 142],\n  [70, 135, 255],\n  [0, 195, 233],\n  [212, 255, 188],\n  [70, 72, 0],\n  [198, 255, 144],\n  [233, 79, 105],\n  [230, 93, 177],\n  [144, 175, 87],\n  [42, 175, 93],\n  [133, 109, 225],\n  [110, 114, 228],\n  [226, 184, 182],\n  [56, 45, 0],\n  [126, 163, 172],\n  [47, 168, 186],\n  [105, 181, 130],\n  [209, 144, 175],\n  [70, 7, 94],\n  [0, 151, 137],\n  [15, 1, 91],\n  [128, 47, 87],\n  [228, 100, 59],\n  [63, 40, 114],\n  [188, 75, 82],\n  [200, 121, 221],\n  [49, 144, 200],\n  [242, 5, 170],\n  [167, 107, 154],\n  [175, 0, 96],\n  [98, 242, 221],\n  [119, 68, 1],\n  [36, 65, 103],\n  [202, 121, 158],\n  [12, 232, 161],\n  [247, 219, 131],\n  [117, 142, 109],\n  [226, 65, 47],\n  [73, 107, 121],\n  [133, 255, 207],\n  [75, 93, 198],\n  [179, 145, 255],\n  [237, 214, 239],\n  [191, 96, 38],\n  [163, 181, 188],\n  [0, 135, 110],\n  [255, 47, 161],\n  [232, 175, 51],\n  [75, 184, 140],\n  [107, 135, 82],\n  [147, 209, 26],\n  [253, 161, 59],\n  [163, 80, 168],\n  [0, 151, 137],\n  [123, 89, 87],\n  [249, 142, 138],\n  [214, 124, 112],\n  [1, 24, 89],\n  [22, 38, 255],\n  [216, 86, 247],\n  [253, 121, 149],\n  [177, 167, 212],\n  [207, 221, 0],\n  [175, 121, 70],\n  [218, 255, 230],\n  [5, 177, 242],\n  [255, 163, 228],\n  [137, 19, 35],\n  [103, 130, 232],\n  [112, 216, 170],\n  [223, 186, 212],\n  [82, 105, 117],\n  [154, 151, 51],\n  [228, 114, 126],\n  [89, 38, 119],\n  [105, 47, 61],\n] as const;\n","import { Maybe } from '../types';\n\nexport type DoubleKeyRecord<V> = Record<string, Record<string, V>>;\n\n/* eslint-disable no-param-reassign */\n\nexport function patchDoubleKeyRecord<V>(\n  record: DoubleKeyRecord<V>,\n  k1: string,\n  k2: string,\n  patch: Partial<V>\n) {\n  if (!(k1 in record)) {\n    record[k1] = {};\n  }\n\n  // triggers shallow record[k1][k2] watchers\n  record[k1][k2] = {\n    ...record[k1][k2],\n    ...patch,\n  };\n}\n\nexport function deleteSecondKey<V>(record: DoubleKeyRecord<V>, k2: string) {\n  Object.keys(record).forEach((k1) => {\n    delete record[k1][k2];\n  });\n}\n\n/* eslint-enable no-param-reassign */\n\nexport function getDoubleKeyRecord<V>(\n  record: DoubleKeyRecord<V>,\n  k1: Maybe<string>,\n  k2: Maybe<string>\n): Maybe<V> {\n  if (k1 == null || k2 == null) return null;\n  return record[k1]?.[k2];\n}\n","import { defineStore } from 'pinia';\n\nconst START_ID = 0;\n\nexport const useIdStore = defineStore('id', () => {\n  let id: number = START_ID;\n  return {\n    nextId() {\n      return String(++id);\n    },\n    reset() {\n      id = START_ID;\n    },\n  };\n});\n","import type { Bounds } from '@kitware/vtk.js/types';\nimport { vec3, mat3 } from 'gl-matrix';\nimport { ViewTypes } from '@kitware/vtk.js/Widgets/Core/WidgetManager/Constants';\nimport {\n  LPSAxis,\n  LPSAxisDir,\n  LPSBounds,\n  LPSDirections,\n  LPSPoint,\n} from '../types/lps';\n\nexport const LPSAxes: LPSAxis[] = ['Sagittal', 'Coronal', 'Axial'];\n\nexport function createLPSPoint(): LPSPoint {\n  return {\n    Sagittal: 0,\n    Coronal: 0,\n    Axial: 0,\n  };\n}\n\nexport function createLPSBounds(): LPSBounds {\n  return {\n    Sagittal: [0, 0],\n    Coronal: [0, 0],\n    Axial: [0, 0],\n  };\n}\n\nexport function getAxisBounds(\n  bounds: Bounds,\n  axis: LPSAxis,\n  directions: LPSDirections\n) {\n  const index = 2 * directions[axis];\n  return bounds.slice(index, index + 2) as [number, number];\n}\n\nexport function getLPSAxisFromDir(dir: LPSAxisDir): LPSAxis {\n  switch (dir) {\n    case 'Superior':\n    case 'Inferior':\n      return 'Axial';\n    case 'Left':\n    case 'Right':\n      return 'Sagittal';\n    case 'Posterior':\n    case 'Anterior':\n      return 'Coronal';\n    default:\n      throw new Error(`Invalid LPS direction: ${dir}`);\n  }\n}\n\nexport function getVTKViewTypeFromLPSAxis(axis: LPSAxis): ViewTypes {\n  switch (axis) {\n    case 'Sagittal':\n      return ViewTypes.YZ_PLANE;\n    case 'Coronal':\n      return ViewTypes.XZ_PLANE;\n    case 'Axial':\n      return ViewTypes.XY_PLANE;\n    default:\n      throw new Error(`Invalid LPS axis: ${axis}`);\n  }\n}\n\nexport const defaultLPSDirections = () => ({\n  Left: vec3.fromValues(1, 0, 0),\n  Right: vec3.fromValues(-1, 0, 0),\n  Posterior: vec3.fromValues(0, 1, 0),\n  Anterior: vec3.fromValues(0, -1, 0),\n  Superior: vec3.fromValues(0, 0, 1),\n  Inferior: vec3.fromValues(0, 0, -1),\n\n  Sagittal: 0 as const,\n  Coronal: 1 as const,\n  Axial: 2 as const,\n});\n\n/**\n * Associates the column vectors of a 3x3 matrix with the LPS axes.\n *\n * For each of the LPS axes, this function returns the associated column index (0, 1, 2)\n * in the provided 3x3 column-major matrix.\n *\n * Approach:\n *   - find the max of the direction matrix, ignoring columns and rows marked as done\n *   - assign the column vector of that max value to the row axis\n *   - mark that row and column as done\n *   - continue until all rows and columns are done\n */\nexport function getLPSDirections(direction: mat3): LPSDirections {\n  // Track the rows and columns that have yet to be assigned.\n  const availableCols = [0, 1, 2];\n  const availableRows = [0, 1, 2];\n  const lpsDirs: LPSDirections = defaultLPSDirections();\n\n  for (let i = 0; i < 3; i++) {\n    let bestValue = 0;\n    let bestValueLoc = [0, 0]; // col, row\n    let removeIndices = [0, 0]; // indices into availableCols/Rows for deletion\n\n    availableCols.forEach((col, colIdx) => {\n      availableRows.forEach((row, rowIdx) => {\n        const value = direction[col * 3 + row];\n        if (Math.abs(value) > Math.abs(bestValue)) {\n          bestValue = value;\n          bestValueLoc = [col, row];\n          removeIndices = [colIdx, rowIdx];\n        }\n      });\n    });\n\n    // the row index corresponds to the index of the LPS axis\n    const [col, axis] = bestValueLoc;\n    const axisVector = direction.slice(col * 3, (col + 1) * 3);\n    const vecSign = Math.sign(bestValue);\n    const posVector = axisVector.map((c) => c * vecSign) as vec3;\n    const negVector = axisVector.map((c) => c * -vecSign) as vec3;\n    if (axis === 0) {\n      // Sagittal\n      lpsDirs.Left = posVector;\n      lpsDirs.Right = negVector;\n      lpsDirs.Sagittal = col as 0 | 1 | 2;\n    } else if (axis === 1) {\n      // Coronal\n      lpsDirs.Posterior = posVector;\n      lpsDirs.Anterior = negVector;\n      lpsDirs.Coronal = col as 0 | 1 | 2;\n    } else if (axis === 2) {\n      // Axial\n      lpsDirs.Superior = posVector;\n      lpsDirs.Inferior = negVector;\n      lpsDirs.Axial = col as 0 | 1 | 2;\n    }\n\n    availableCols.splice(removeIndices[0], 1);\n    availableRows.splice(removeIndices[1], 1);\n  }\n\n  return lpsDirs;\n}\n","import type { Manifest, StateFile } from '@/src/io/state-file/schema';\nimport { Store } from 'pinia';\n\nexport enum AnnotationToolType {\n  Rectangle = 'Rectangle',\n  Ruler = 'Ruler',\n  Polygon = 'Polygon',\n}\n\nexport enum Tools {\n  WindowLevel = 'WindowLevel',\n  Pan = 'Pan',\n  Zoom = 'Zoom',\n  Crop = 'Crop',\n  Paint = 'Paint',\n  Select = 'Select',\n  Crosshairs = 'Crosshairs',\n  Rectangle = 'Rectangle',\n  Ruler = 'Ruler',\n  Polygon = 'Polygon',\n}\n\nexport interface IActivatableTool {\n  activateTool: () => boolean;\n  deactivateTool: () => void;\n}\n\nexport interface ISerializableTool {\n  serialize: (state: StateFile) => void;\n  deserialize: (manifest: Manifest, dataIDMap: Record<string, string>) => void;\n}\n\nexport interface IToolStore\n  extends Partial<IActivatableTool>,\n    Partial<ISerializableTool>,\n    Store {}\n","import JSZip from 'jszip';\nimport { z } from 'zod';\nimport type { Vector3 } from '@kitware/vtk.js/types';\nimport vtkPiecewiseFunctionProxy from '@kitware/vtk.js/Proxy/Core/PiecewiseFunctionProxy';\nimport type {\n  PiecewiseGaussian,\n  PiecewiseNode,\n} from '@kitware/vtk.js/Proxy/Core/PiecewiseFunctionProxy';\n\nimport type { AnnotationTool, ToolID } from '@/src/types/annotation-tool';\nimport { Tools as ToolsEnum } from '@/src/store/tools/types';\nimport type { Ruler } from '@/src/types/ruler';\nimport type { Rectangle } from '@/src/types/rectangle';\nimport type { Polygon } from '@/src/types/polygon';\nimport type { LPSCroppingPlanes } from '@/src/types/crop';\nimport type { FrameOfReference } from '@/src/utils/frameOfReference';\nimport type { Optional } from '@/src/types';\n\nimport type {\n  CameraConfig,\n  SliceConfig,\n  WindowLevelConfig,\n  LayersConfig,\n  SegmentGroupConfig,\n  VolumeColorConfig,\n} from '../../store/view-configs/types';\nimport type { LPSAxisDir, LPSAxis } from '../../types/lps';\nimport { LayoutDirection } from '../../types/layout';\nimport type {\n  ColorBy,\n  ColorTransferFunction,\n  OpacityFunction,\n  OpacityGaussians,\n  OpacityPoints,\n  OpacityNodes,\n  ColoringConfig,\n  CVRConfig,\n  BlendConfig,\n} from '../../types/views';\nimport { WLAutoRanges } from '../../constants';\n\nexport enum DatasetType {\n  DICOM = 'dicom',\n  IMAGE = 'image',\n}\n\nconst DatasetTypeNative = z.nativeEnum(DatasetType);\n\nconst LPSAxisDir = z.union([\n  z.literal('Left'),\n  z.literal('Right'),\n  z.literal('Posterior'),\n  z.literal('Anterior'),\n  z.literal('Superior'),\n  z.literal('Inferior'),\n]);\n\nconst Dataset = z.object({\n  id: z.string(),\n  path: z.string(),\n  type: DatasetTypeNative,\n});\nexport type Dataset = z.infer<typeof Dataset>;\n\nconst baseRemoteFileSchema = z.object({\n  archiveSrc: z.object({ path: z.string() }).optional(),\n  uriSrc: z.object({ uri: z.string(), name: z.string() }).optional(),\n});\n\ntype RemoteFileType = z.infer<typeof baseRemoteFileSchema> & {\n  parent?: RemoteFileType;\n};\n\n// This is a serialized DataSource that has a UriSource ancestor.\nconst RemoteFile: z.ZodType<RemoteFileType> = baseRemoteFileSchema.extend({\n  parent: z.lazy(() => RemoteFile.optional()),\n});\nexport type RemoteFile = z.infer<typeof RemoteFile>;\n\nconst LayoutDirectionNative = z.nativeEnum(LayoutDirection);\n\nexport interface Layout {\n  name?: string;\n  direction: LayoutDirection;\n  items: Array<Layout | string>;\n}\n\nconst Layout: z.ZodType<Layout> = z.lazy(() =>\n  z.object({\n    name: z.string().optional(),\n    direction: LayoutDirectionNative,\n    items: z.array(z.union([Layout, z.string()])),\n  })\n);\n\nconst Vector3 = z.tuple([\n  z.number(),\n  z.number(),\n  z.number(),\n]) satisfies z.ZodType<Vector3>;\n\ntype AutoRangeKeys = keyof typeof WLAutoRanges;\nconst WindowLevelConfig = z.object({\n  width: z.number(),\n  level: z.number(),\n  min: z.number(),\n  max: z.number(),\n  auto: z.string() as z.ZodType<AutoRangeKeys>,\n  preset: z.object({ width: z.number(), level: z.number() }),\n}) satisfies z.ZodType<WindowLevelConfig>;\n\nconst SliceConfig = z.object({\n  slice: z.number(),\n  min: z.number(),\n  max: z.number(),\n  axisDirection: LPSAxisDir,\n  syncState: z.boolean(),\n}) satisfies z.ZodType<SliceConfig>;\n\nconst CameraConfig = z.object({\n  parallelScale: z.number().optional(),\n  position: Vector3.optional(),\n  focalPoint: Vector3.optional(),\n  directionOfProjection: Vector3.optional(),\n  viewUp: Vector3.optional(),\n  syncState: z.boolean().optional(),\n}) satisfies z.ZodType<CameraConfig>;\n\nconst ColorBy = z.object({\n  arrayName: z.string(),\n  location: z.string(),\n}) satisfies z.ZodType<ColorBy>;\n\nconst PiecewiseGaussian = z.object({\n  position: z.number(),\n  height: z.number(),\n  width: z.number(),\n  xBias: z.number(),\n  yBias: z.number(),\n}) satisfies z.ZodType<PiecewiseGaussian>;\n\nconst PiecewiseNode = z.object({\n  x: z.number(),\n  y: z.number(),\n  midpoint: z.number(),\n  sharpness: z.number(),\n}) as z.ZodType<PiecewiseNode>;\n\nconst OpacityGaussians = z.object({\n  mode: z.literal(vtkPiecewiseFunctionProxy.Mode.Gaussians),\n  gaussians: PiecewiseGaussian.array(),\n  mappingRange: z.tuple([z.number(), z.number()]),\n}) satisfies z.ZodType<OpacityGaussians>;\n\nconst OpacityPoints = z.object({\n  mode: z.literal(vtkPiecewiseFunctionProxy.Mode.Points),\n  preset: z.string(),\n  shift: z.number(),\n  shiftAlpha: z.number(),\n  mappingRange: z.tuple([z.number(), z.number()]),\n}) satisfies z.ZodType<OpacityPoints>;\n\nconst OpacityNodes = z.object({\n  mode: z.literal(vtkPiecewiseFunctionProxy.Mode.Nodes),\n  nodes: PiecewiseNode.array(),\n  mappingRange: z.tuple([z.number(), z.number()]),\n}) satisfies z.ZodType<OpacityNodes>;\n\nconst OpacityFunction = z.union([\n  OpacityGaussians,\n  OpacityPoints,\n  OpacityNodes,\n]);\n\nconst ColorTransferFunction = z.object({\n  preset: z.string(),\n  mappingRange: z.tuple([z.number(), z.number()]),\n}) satisfies z.ZodType<ColorTransferFunction>;\n\nconst ColoringConfig = z.object({\n  colorBy: ColorBy,\n  transferFunction: ColorTransferFunction,\n  opacityFunction: OpacityFunction,\n}) satisfies z.ZodType<ColoringConfig>;\n\nconst CVRConfig = z.object({\n  enabled: z.boolean(),\n  lightFollowsCamera: z.boolean(),\n  volumeQuality: z.number(),\n  useVolumetricScatteringBlending: z.boolean(),\n  volumetricScatteringBlending: z.number(),\n  useLocalAmbientOcclusion: z.boolean(),\n  laoKernelSize: z.number(),\n  laoKernelRadius: z.number(),\n  ambient: z.number(),\n  diffuse: z.number(),\n  specular: z.number(),\n}) satisfies z.ZodType<CVRConfig>;\n\nconst VolumeColorConfig = z.object({\n  colorBy: ColorBy,\n  transferFunction: ColorTransferFunction,\n  opacityFunction: OpacityFunction,\n  cvr: CVRConfig,\n}) satisfies z.ZodType<VolumeColorConfig>;\n\nconst BlendConfig = z.object({\n  opacity: z.number(),\n  visibility: z.boolean(),\n}) satisfies z.ZodType<BlendConfig>;\n\nconst LayersConfig = z.object({\n  colorBy: ColorBy,\n  transferFunction: ColorTransferFunction,\n  opacityFunction: OpacityFunction,\n  blendConfig: BlendConfig,\n}) satisfies z.ZodType<LayersConfig>;\n\nconst SegmentGroupConfig = z.object({\n  outlineOpacity: z.number(),\n  outlineThickness: z.number(),\n}) satisfies z.ZodType<SegmentGroupConfig>;\n\nconst ViewConfig = z.object({\n  window: WindowLevelConfig.optional(),\n  slice: SliceConfig.optional(),\n  layers: LayersConfig.optional(),\n  segmentGroup: SegmentGroupConfig.optional(),\n  camera: CameraConfig.optional(),\n  volumeColorConfig: VolumeColorConfig.optional(),\n});\n\nexport type ViewConfig = z.infer<typeof ViewConfig>;\n\nconst View = z.object({\n  id: z.string(),\n  type: z.string(),\n  props: z.record(z.any()),\n  config: z.record(ViewConfig),\n});\n\nexport type View = z.infer<typeof View>;\n\nconst RGBAColor = z.tuple([z.number(), z.number(), z.number(), z.number()]);\n\nconst SegmentMask = z.object({\n  value: z.number(),\n  name: z.string(),\n  color: RGBAColor,\n  visible: z.boolean().default(true),\n});\n\nexport const SegmentGroupMetadata = z.object({\n  name: z.string(),\n  parentImage: z.string(),\n  segments: z.object({\n    order: z.number().array(),\n    byValue: z.record(z.string(), SegmentMask),\n  }),\n});\n\nexport const LabelMap = z.object({\n  id: z.string(),\n  path: z.string(),\n  metadata: SegmentGroupMetadata,\n});\n\nexport type LabelMap = z.infer<typeof LabelMap>;\n\nconst LPSAxis = z.union([\n  z.literal('Axial'),\n  z.literal('Sagittal'),\n  z.literal('Coronal'),\n]) satisfies z.ZodType<LPSAxis>;\n\nconst FrameOfReference = z.object({\n  planeOrigin: Vector3,\n  planeNormal: Vector3,\n}) satisfies z.ZodType<FrameOfReference>;\n\nconst annotationTool = z.object({\n  imageID: z.string(),\n  frameOfReference: FrameOfReference,\n  slice: z.number(),\n  id: z.string() as unknown as z.ZodType<ToolID>,\n  name: z.string(),\n  color: z.string(),\n  strokeWidth: z.number().optional(),\n  label: z.string().optional(),\n  labelName: z.string().optional(),\n}) satisfies z.ZodType<AnnotationTool>;\n\nconst makeToolEntry = <T extends z.ZodRawShape>(tool: z.ZodObject<T>) =>\n  z.object({ tools: z.array(tool), labels: z.record(tool.partial()) });\n\nconst Ruler = annotationTool.extend({\n  firstPoint: Vector3,\n  secondPoint: Vector3,\n}) satisfies z.ZodType<Ruler>;\n\nconst Rulers = makeToolEntry(Ruler);\n\nconst Rectangle = Ruler.extend({\n  fillColor: z.string().optional(),\n}) satisfies z.ZodType<Optional<Rectangle, 'fillColor'>>;\n\nconst Rectangles = makeToolEntry(Rectangle);\n\nconst Polygon = annotationTool.extend({\n  id: z.string() as unknown as z.ZodType<ToolID>,\n  points: z.array(Vector3),\n}) satisfies z.ZodType<Omit<Polygon, 'movePoint'>>;\n\nconst Polygons = makeToolEntry(Polygon);\n\nconst Crosshairs = z.object({\n  position: Vector3,\n});\n\nexport type Crosshairs = z.infer<typeof Crosshairs>;\n\nconst ToolsEnumNative = z.nativeEnum(ToolsEnum);\n\nconst Paint = z.object({\n  activeSegmentGroupID: z.string().nullable(),\n  activeSegment: z.number().nullish(),\n  brushSize: z.number(),\n  labelmapOpacity: z.number().optional(), // labelmapOpacity now ignored.  Opacity per segment group via layerColoring store.\n});\n\nconst LPSCroppingPlanes = z.object({\n  Sagittal: z.tuple([z.number(), z.number()]),\n  Coronal: z.tuple([z.number(), z.number()]),\n  Axial: z.tuple([z.number(), z.number()]),\n}) satisfies z.ZodType<LPSCroppingPlanes>;\n\nconst Cropping = z.record(LPSCroppingPlanes);\n\nconst Tools = z.object({\n  rulers: Rulers.optional(),\n  rectangles: Rectangles.optional(),\n  polygons: Polygons.optional(),\n  crosshairs: Crosshairs,\n  paint: Paint,\n  crop: Cropping,\n  current: ToolsEnumNative,\n});\n\nexport type Tools = z.infer<typeof Tools>;\n\nexport const ParentToLayers = z\n  .object({\n    selectionKey: z.string(),\n    sourceSelectionKeys: z.string().array(),\n  })\n  .array();\n\nexport type ParentToLayers = z.infer<typeof ParentToLayers>;\n\nexport const ManifestSchema = z.object({\n  version: z.string(),\n  datasets: Dataset.array(),\n  remoteFiles: z.record(RemoteFile.array()),\n  labelMaps: LabelMap.array(),\n  tools: Tools,\n  views: View.array(),\n  primarySelection: z.string().optional(),\n  layout: Layout,\n  parentToLayers: ParentToLayers,\n});\n\nexport type Manifest = z.infer<typeof ManifestSchema>;\n\nexport interface StateFile {\n  zip: JSZip;\n  manifest: Manifest;\n}\n","import { Maybe } from '@/src/types';\n\n/**\n * Represents a URI source with a file name for the downloaded resource.\n *\n * This can optionally be paired with a FileSource, indicating that the\n * FileSource is a remote FileSource.\n */\nexport interface UriSource {\n  uri: string;\n  name: string;\n}\n\n/**\n * Represents a user-specified file.\n *\n * This can optionally be paired with an ArchiveSource.\n */\nexport interface FileSource {\n  file: File;\n  fileType: string;\n}\n\n/**\n * If an archive source is specified, then it is assumed that the data source\n * has a FileSource (representing the file inside the archive), and a parent\n * data source with a FileSource that refers to the archive.\n */\nexport interface ArchiveSource {\n  // Full path + filename inside the archive\n  path: string;\n}\n\n/**\n * Used to collect DICOM file data sources.\n *\n * This is currently used for consolidating multiple DICOM files into one\n * DataSource for error stack trace purposes.\n */\nexport interface DicomSource {\n  // eslint-disable-next-line no-use-before-define\n  sources: DataSource[];\n}\n\n/**\n * Represents a source of data.\n *\n * If the parent property is set, it represents the DataSource from which this\n * DataSource was derived.\n *\n * Examples:\n * - { uriSrc }: a file that has yet to be downloaded.\n * - { fileSrc, parent: { uriSrc } }: a file with URI provenance info.\n * - { fileSrc, archiveSrc, parent }: a file originating from an archive.\n * - { dicomSrc }: a list of dicom data sources.\n */\nexport interface DataSource {\n  fileSrc?: FileSource;\n  uriSrc?: UriSource;\n  archiveSrc?: ArchiveSource;\n  dicomSrc?: DicomSource;\n  parent?: DataSource;\n}\n\nexport type DataSourceWithFile = DataSource & { fileSrc: FileSource };\n\n/**\n * Creates a DataSource from a single file.\n * @param file\n * @returns\n */\nexport const fileToDataSource = (file: File): DataSource => ({\n  fileSrc: {\n    file,\n    fileType: file.type,\n  },\n});\n\n/**\n * Creates a DataSource from a URI.\n * @param uri\n * @returns\n */\nexport const uriToDataSource = (uri: string, name: string): DataSource => ({\n  uriSrc: {\n    uri,\n    name,\n  },\n});\n\n/**\n * Creates a DataSource from a file downloaded from a URI.\n * @param uri\n * @returns\n */\nexport const remoteFileToDataSource = (\n  file: File,\n  uri: string\n): DataSource => ({\n  ...fileToDataSource(file),\n  ...uriToDataSource(uri, file.name),\n});\n\n/**\n * Determines if a data source has remote provenance.\n * @param ds\n * @returns\n */\nexport function isRemoteDataSource(ds: DataSource): boolean {\n  return !!ds.uriSrc || (!!ds.parent && isRemoteDataSource(ds.parent));\n}\n\n/**\n * Flattens a data source hierarchy, ordered by descendant first.\n *\n * For a given data source `ds`, `ds` is the descendant and `ds.parent` is the\n * ancestor.\n *\n * @param ds\n * @returns\n */\nexport function flattenDataSourceHierarchy(ds: DataSource): DataSource[] {\n  const sources: DataSource[] = [];\n  let cur: Maybe<DataSource> = ds;\n  while (cur) {\n    sources.push(cur);\n    cur = cur.parent;\n  }\n  return sources;\n}\n\n/**\n * Gets the name associated with a data source, if any.\n * @param ds\n */\nexport function getDataSourceName(ds: Maybe<DataSource>): Maybe<string> {\n  if (ds?.fileSrc) {\n    return ds.fileSrc.file.name;\n  }\n\n  if (ds?.uriSrc) {\n    return ds.uriSrc.name;\n  }\n\n  if (ds?.dicomSrc?.sources.length) {\n    const { sources } = ds.dicomSrc;\n    const [first] = sources;\n    const more = sources.length > 1 ? ` (+${sources.length - 1} more)` : '';\n    return `${getDataSourceName(first)}${more}`;\n  }\n\n  return null;\n}\n\n/**\n * Serializes a data source into a JSON formattable object.\n *\n * FileSources are stripped, as they cannot be properly serialized. This\n * includes the fileType property, which should be inferred when retyping the\n * file.\n * @param ds\n */\nexport function serializeDataSource(ds: DataSource) {\n  const output = { ...ds };\n  delete output.fileSrc;\n  if (output.parent) {\n    output.parent = serializeDataSource(output.parent);\n  }\n  return output;\n}\n","import { defineStore } from 'pinia';\nimport { DataSourceWithFile } from '@/src/io/import/dataSource';\n\ninterface State {\n  byDataID: Record<string, DataSourceWithFile[]>;\n}\n\n/**\n * Store the File objects associated with a given dataset.\n */\nexport const useFileStore = defineStore('files', {\n  state: (): State => ({\n    byDataID: {},\n  }),\n\n  getters: {\n    // Returns DataSource[] used to build a dataID\n    getDataSources: (state) => (dataID: string) => state.byDataID[dataID] ?? [],\n\n    // Returns [File] used to build a dataID\n    getFiles: (state) => (dataID: string) =>\n      (state.byDataID[dataID] ?? []).map((ds) => ds.fileSrc.file),\n  },\n\n  actions: {\n    remove(dataID: string) {\n      if (dataID in this.byDataID) {\n        delete this.byDataID[dataID];\n      }\n    },\n\n    add(dataID: string, files: DataSourceWithFile[]) {\n      this.byDataID[dataID] = files;\n    },\n  },\n});\n","import { partition } from '@/src/utils';\nimport {\n  isRemoteDataSource,\n  serializeDataSource,\n} from '@/src/io/import/dataSource';\nimport { StateFile, DatasetType } from './schema';\nimport { useFileStore } from '../../store/datasets-files';\n\nexport async function serializeData(\n  stateFile: StateFile,\n  dataIDs: string[],\n  dataType: DatasetType\n) {\n  const fileStore = useFileStore();\n  const { zip } = stateFile;\n  const {\n    manifest: { datasets, remoteFiles },\n  } = stateFile;\n\n  dataIDs.forEach((id) => {\n    const sources = fileStore.getDataSources(id);\n    if (!sources.length) {\n      throw new Error(`No files for dataID: ${id}`);\n    }\n\n    const [remotes, toZip] = partition(isRemoteDataSource, sources);\n\n    remoteFiles[id] = remotes.map(serializeDataSource);\n\n    const dataPath = `data/${id}/`;\n\n    toZip.forEach((ds) => {\n      const { file } = ds.fileSrc;\n      const filePath = `${dataPath}/${file.name}`;\n      zip.file(filePath, file);\n    });\n\n    datasets.push({\n      id,\n      path: dataPath,\n      type: dataType,\n    });\n  });\n}\n","import { EPSILON } from '@/src/constants';\nimport { areEquals } from '@kitware/vtk.js/Common/Core/Math';\nimport vtkImageData from '@kitware/vtk.js/Common/DataModel/ImageData';\nimport { Vector3 } from '@kitware/vtk.js/types';\n\n// give more fp tolerance due to transforms\nconst RELAXED_EPSILON = EPSILON * 1e2;\n\nfunction getImageWorldCorners(im: vtkImageData) {\n  const extent = im.getExtent();\n  const worldCorners: Vector3[] = [];\n  for (let i = 0; i < 2; i++) {\n    for (let j = 0; j < 2; j++) {\n      for (let k = 0; k < 2; k++) {\n        worldCorners.push(\n          im.indexToWorld([extent[i], extent[j], extent[k]]) as Vector3\n        );\n      }\n    }\n  }\n  return worldCorners;\n}\n\n/**\n * Determines if two images occupy the same space.\n *\n * This will produce invalid results under certain scenarios:\n * - image direction matrices are not invertible\n * @param im1\n * @param im2\n */\nexport function compareImageSpaces(\n  im1: vtkImageData,\n  im2: vtkImageData,\n  eps = RELAXED_EPSILON\n) {\n  const corners1 = getImageWorldCorners(im1);\n  const corners2 = getImageWorldCorners(im2);\n  return corners1.every((p1) => corners2.some((p2) => areEquals(p1, p2, eps)));\n}\n","import { defineStore } from 'pinia';\nimport { vec3, mat3, mat4 } from 'gl-matrix';\nimport { vtkImageData } from '@kitware/vtk.js/Common/DataModel/ImageData';\nimport type { Bounds } from '@kitware/vtk.js/types';\n\nimport { useIdStore } from '@/src/store/id';\nimport { defaultLPSDirections, getLPSDirections } from '../utils/lps';\nimport { removeFromArray } from '../utils';\nimport { StateFile, DatasetType } from '../io/state-file/schema';\nimport { serializeData } from '../io/state-file/utils';\nimport { useFileStore } from './datasets-files';\nimport { ImageMetadata } from '../types/image';\nimport { compareImageSpaces } from '../utils/imageSpace';\n\nexport const defaultImageMetadata = () => ({\n  name: '(none)',\n  orientation: mat3.create(),\n  lpsOrientation: defaultLPSDirections(),\n  spacing: vec3.fromValues(1, 1, 1),\n  origin: vec3.create(),\n  dimensions: vec3.fromValues(1, 1, 1),\n  worldBounds: [0, 1, 0, 1, 0, 1] as Bounds,\n  worldToIndex: mat4.create(),\n  indexToWorld: mat4.create(),\n});\n\ninterface State {\n  idList: string[]; // list of IDs\n  dataIndex: Record<string, vtkImageData>; // ID -> VTK object\n  metadata: Record<string, ImageMetadata>; // ID -> metadata\n}\n\nexport const useImageStore = defineStore('images', {\n  state: (): State => ({\n    idList: [],\n    dataIndex: Object.create(null),\n    metadata: Object.create(null),\n  }),\n  actions: {\n    addVTKImageData(name: string, imageData: vtkImageData, useId?: string) {\n      if (useId && useId in this.dataIndex) {\n        throw new Error('ID already exists');\n      }\n\n      const id = useId || useIdStore().nextId();\n\n      this.idList.push(id);\n      this.dataIndex[id] = imageData;\n\n      this.metadata[id] = { ...defaultImageMetadata(), name };\n      this.updateData(id, imageData);\n      return id;\n    },\n\n    updateData(id: string, imageData: vtkImageData) {\n      if (id in this.metadata) {\n        const metadata: ImageMetadata = {\n          name: this.metadata[id].name,\n          dimensions: imageData.getDimensions() as vec3,\n          spacing: imageData.getSpacing() as vec3,\n          origin: imageData.getOrigin() as vec3,\n          orientation: imageData.getDirection(),\n          lpsOrientation: getLPSDirections(imageData.getDirection()),\n          worldBounds: imageData.getBounds(),\n          worldToIndex: imageData.getWorldToIndex(),\n          indexToWorld: imageData.getIndexToWorld(),\n        };\n\n        this.metadata[id] = metadata;\n        this.dataIndex[id] = imageData;\n      }\n      this.dataIndex[id] = imageData;\n    },\n\n    deleteData(id: string) {\n      if (id in this.dataIndex) {\n        delete this.dataIndex[id];\n        delete this.metadata[id];\n        removeFromArray(this.idList, id);\n      }\n    },\n\n    checkAllImagesSameSpace() {\n      if (this.idList.length < 2) return false;\n\n      const dataFirst = this.dataIndex[this.idList[0]];\n      const allEqual = this.idList.slice(1).every((id) => {\n        return compareImageSpaces(this.dataIndex[id], dataFirst);\n      });\n\n      return allEqual;\n    },\n\n    async serialize(stateFile: StateFile) {\n      const fileStore = useFileStore();\n      // We want to filter out volume images (which are generated and don't have\n      // input files in fileStore with matching imageID.)\n      const dataIDs = this.idList.filter((id) => id in fileStore.byDataID);\n\n      await serializeData(stateFile, dataIDs, DatasetType.IMAGE);\n    },\n  },\n});\n","import {\n  readDicomTags,\n  readImageDicomFileSeriesWorkerFunction,\n} from '@itk-wasm/dicom';\nimport { readImage } from '@itk-wasm/image-io';\nimport { WorkerPool, getDefaultWebWorker } from 'itk-wasm';\n\nconst DEFAULT_NUM_WORKERS = 4;\n\nlet readDicomSeriesWorkerPool: WorkerPool | null = null;\nlet webWorker: Worker | null = null;\n\nexport async function ensureWorker() {\n  if (webWorker) return;\n  webWorker = getDefaultWebWorker();\n}\n\nexport function ensureDicomSeriesWorkerPool() {\n  if (readDicomSeriesWorkerPool) return;\n  // copied from read-image-dicom-file-series.ts\n  const numberOfWorkers =\n    typeof globalThis.navigator?.hardwareConcurrency === 'number'\n      ? globalThis.navigator.hardwareConcurrency\n      : DEFAULT_NUM_WORKERS;\n  readDicomSeriesWorkerPool = new WorkerPool(\n    numberOfWorkers,\n    readImageDicomFileSeriesWorkerFunction\n  );\n}\n\nexport function getWorker() {\n  return webWorker;\n}\n\nexport function getDicomSeriesWorkerPool() {\n  return readDicomSeriesWorkerPool;\n}\n\nexport async function initItkWorker() {\n  await Promise.all([ensureWorker(), ensureDicomSeriesWorkerPool()]);\n\n  // preload\n  try {\n    await readDicomTags(new File([], 'a.dcm'));\n  } catch (err) {\n    // ignore\n  }\n  try {\n    await readImage(new File([], 'a.dcm'));\n  } catch (err) {\n    // ignore\n  }\n}\n","import { runPipeline, TextStream, InterfaceTypes, Image } from 'itk-wasm';\n\nimport {\n  readDicomTags,\n  readImageDicomFileSeries,\n  readOverlappingSegmentation,\n  ReadOverlappingSegmentationResult,\n} from '@itk-wasm/dicom';\n\nimport itkConfig from '@/src/io/itk/itkConfig';\nimport { getDicomSeriesWorkerPool, getWorker } from '@/src/io/itk/worker';\n\nexport interface TagSpec {\n  name: string;\n  tag: string;\n}\n\nexport type SpatialParameters = Pick<\n  Image,\n  'size' | 'spacing' | 'origin' | 'direction'\n>;\n\n// volume ID => file names\nexport type VolumesToFileNamesMap = Record<string, string[]>;\n\n/**\n * Filenames must be sanitized prior to being passed into itk-wasm.\n *\n * In particular, forward slashes cause FS errors in itk-wasm.\n * @param name\n * @returns\n */\nfunction sanitizeFileName(name: string) {\n  return name.replace(/\\//g, '_');\n}\n\n/**\n * Returns a new File instance with a sanitized name.\n * @param file\n */\nfunction sanitizeFile(file: File) {\n  return new File([file], sanitizeFileName(file.name));\n}\n\nasync function runTask(\n  module: string,\n  args: any[],\n  inputs: any[],\n  outputs: any[]\n) {\n  return runPipeline(module, args, outputs, inputs, {\n    webWorker: getWorker(),\n    pipelineBaseUrl: itkConfig.pipelinesUrl,\n    pipelineWorkerUrl: itkConfig.pipelineWorkerUrl,\n  });\n}\n\n/**\n * Split and sort DICOM files\n * @async\n * @returns volumeID => file names mapping\n */\nexport async function splitAndSort<T>(\n  instances: T[],\n  mapToBlob: (inst: T, index: number) => Blob\n) {\n  const inputs = await Promise.all(\n    instances.map(async (instance, index) => {\n      const blob = mapToBlob(instance, index);\n      const buffer = await blob.arrayBuffer();\n      return {\n        type: InterfaceTypes.BinaryFile,\n        data: {\n          path: index.toString(), // make each file name unique\n          data: new Uint8Array(buffer),\n        },\n      };\n    })\n  );\n\n  const args = [\n    '--action',\n    'categorize',\n    '--memory-io',\n    '0',\n    '--files',\n    ...inputs.map((fd) => fd.data.path),\n  ];\n\n  const outputs = [{ type: InterfaceTypes.TextStream }];\n\n  const result = await runTask('dicom', args, inputs, outputs);\n\n  // File names are indexes into input files array\n  const volumeToFileIndexes = JSON.parse(\n    (result.outputs[0].data as TextStream).data\n  ) as VolumesToFileNamesMap;\n\n  const volumeToInstances = Object.fromEntries(\n    Object.entries(volumeToFileIndexes).map(([volumeKey, fileIndexes]) => [\n      volumeKey,\n      // file indexes to Files\n      fileIndexes.map((fileIndex) => instances[parseInt(fileIndex, 10)]),\n    ])\n  );\n\n  return volumeToInstances;\n}\n\n/**\n * Reads a list of tags out from a given file.\n *\n * @param {File} file\n * @param {[]Tag} tags\n */\nexport async function readTags<T extends TagSpec[]>(\n  file: File,\n  tags: T\n): Promise<Record<T[number]['name'], string>> {\n  const tagsArgs = { tagsToRead: { tags: tags.map(({ tag }) => tag) } };\n\n  const result = await readDicomTags(sanitizeFile(file), {\n    ...tagsArgs,\n    webWorker: getWorker(),\n  });\n  const tagValues = new Map(result.tags);\n\n  return tags.reduce((info, t) => {\n    const { tag, name } = t;\n    if (tagValues.has(tag)) {\n      return { ...info, [name]: tagValues.get(tag) };\n    }\n    return info;\n  }, {} as Record<T[number]['name'], string>);\n}\n\n/**\n * Retrieves a slice of a volume.\n * @async\n * @param {File} file containing the slice\n * @param {Boolean} asThumbnail cast image to unsigned char. Defaults to false.\n * @returns ItkImage\n */\nexport async function readVolumeSlice(\n  file: File,\n  asThumbnail: boolean = false\n) {\n  const buffer = await file.arrayBuffer();\n\n  const inputs = [\n    {\n      type: InterfaceTypes.BinaryFile,\n      data: {\n        path: sanitizeFileName(file.name),\n        data: new Uint8Array(buffer),\n      },\n    },\n  ];\n\n  const args = [\n    '--action',\n    'getSliceImage',\n    '--thumbnail',\n    asThumbnail.toString(),\n    '--file',\n    sanitizeFileName(file.name),\n    '--memory-io',\n    '0',\n  ];\n\n  const outputs = [{ type: InterfaceTypes.Image }];\n\n  const result = await runTask('dicom', args, inputs, outputs);\n\n  return result.outputs[0].data as Image;\n}\n\ntype Segment = {\n  SegmentLabel: string;\n  labelID: number;\n  recommendedDisplayRGBValue: [number, number, number];\n};\n\ntype ReadOverlappingSegmentationMeta = {\n  segmentAttributes: Segment[][];\n};\n\ntype ReadOverlappingSegmentationResultWithRealMeta =\n  ReadOverlappingSegmentationResult & {\n    metaInfo: ReadOverlappingSegmentationMeta;\n  };\n\nexport async function buildSegmentGroups(file: File) {\n  const inputImage = sanitizeFile(file);\n  const result = (await readOverlappingSegmentation(inputImage, {\n    webWorker: getWorker(),\n    mergeSegments: true,\n  })) as ReadOverlappingSegmentationResultWithRealMeta;\n  return {\n    ...result,\n    outputImage: result.segImage,\n  };\n}\n\n/**\n * Builds a volume for a set of files.\n * @async\n * @param {File[]} seriesFiles the set of files to build volume from\n * @returns ItkImage\n */\nexport async function buildImage(seriesFiles: File[]) {\n  const inputImages = seriesFiles.map((file) => sanitizeFile(file));\n  const result = await readImageDicomFileSeries({\n    webWorkerPool: getDicomSeriesWorkerPool(),\n    inputImages,\n    singleSortedSeries: false,\n  });\n  return result;\n}\n","import vtkITKHelper from '@kitware/vtk.js/Common/DataModel/ITKHelper';\nimport { defineStore } from 'pinia';\nimport { Image } from 'itk-wasm';\nimport { DataSourceWithFile } from '@/src/io/import/dataSource';\nimport * as DICOM from '@/src/io/dicom';\nimport { identity, pick, removeFromArray } from '../utils';\nimport { useImageStore } from './datasets-images';\nimport { useFileStore } from './datasets-files';\nimport { StateFile, DatasetType } from '../io/state-file/schema';\nimport { serializeData } from '../io/state-file/utils';\nimport { useMessageStore } from './messages';\n\nexport const ANONYMOUS_PATIENT = 'Anonymous';\nexport const ANONYMOUS_PATIENT_ID = 'ANONYMOUS';\n\nexport function imageCacheMultiKey(offset: number, asThumbnail: boolean) {\n  return `${offset}!!${asThumbnail}`;\n}\n\nexport interface VolumeKeys {\n  patientKey: string;\n  studyKey: string;\n  volumeKey: string;\n}\n\nexport interface PatientInfo {\n  PatientID: string;\n  PatientName: string;\n  PatientBirthDate: string;\n  PatientSex: string;\n}\n\nexport interface StudyInfo {\n  StudyID: string;\n  StudyInstanceUID: string;\n  StudyDate: string;\n  StudyTime: string;\n  AccessionNumber: string;\n  StudyDescription: string;\n}\n\nexport interface VolumeInfo {\n  NumberOfSlices: number;\n  VolumeID: string;\n  Modality: string;\n  SeriesInstanceUID: string;\n  SeriesNumber: string;\n  SeriesDescription: string;\n  WindowLevel: string;\n  WindowWidth: string;\n}\n\nconst buildImage = async (seriesFiles: File[], modality: string) => {\n  const messages: string[] = [];\n  if (modality === 'SEG') {\n    const segFile = seriesFiles[0];\n    const results = await DICOM.buildSegmentGroups(segFile);\n    if (seriesFiles.length > 1)\n      messages.push(\n        'Tried to make one volume from 2 SEG modality files. Using only the first file!'\n      );\n    return {\n      modality: 'SEG',\n      builtImageResults: results,\n      messages,\n    };\n  }\n  return {\n    builtImageResults: await DICOM.buildImage(seriesFiles),\n    messages,\n  };\n};\n\nconst constructImage = async (volumeKey: string, volumeInfo: VolumeInfo) => {\n  const fileStore = useFileStore();\n  const files = fileStore.getFiles(volumeKey);\n  if (!files) throw new Error('No files for volume key');\n  const results = await buildImage(files, volumeInfo.Modality);\n  const image = vtkITKHelper.convertItkToVtkImage(\n    results.builtImageResults.outputImage\n  );\n  return {\n    ...results,\n    image,\n  };\n};\n\ninterface State {\n  // volumeKey -> imageCacheMultiKey -> ITKImage\n  sliceData: Record<string, Record<string, Image>>;\n\n  // volume invalidation information\n  needsRebuild: Record<string, boolean>;\n\n  // Avoid recomputing image data for the same volume by checking this for existing buildVolume tasks\n  volumeBuildResults: Record<string, ReturnType<typeof constructImage>>;\n\n  // patientKey -> patient info\n  patientInfo: Record<string, PatientInfo>;\n  // patientKey -> array of studyKeys\n  patientStudies: Record<string, string[]>;\n\n  // studyKey -> study info\n  studyInfo: Record<string, StudyInfo>;\n  // studyKey -> array of volumeKeys\n  studyVolumes: Record<string, string[]>;\n\n  // volumeKey -> volume info\n  volumeInfo: Record<string, VolumeInfo>;\n\n  // parent pointers\n  // volumeKey -> studyKey\n  volumeStudy: Record<string, string>;\n  // studyKey -> patientKey\n  studyPatient: Record<string, string>;\n}\n\nconst readDicomTags = (file: File) =>\n  DICOM.readTags(file, [\n    { name: 'PatientName', tag: '0010|0010', strconv: true },\n    { name: 'PatientID', tag: '0010|0020', strconv: true },\n    { name: 'PatientBirthDate', tag: '0010|0030' },\n    { name: 'PatientSex', tag: '0010|0040' },\n    { name: 'StudyInstanceUID', tag: '0020|000d' },\n    { name: 'StudyDate', tag: '0008|0020' },\n    { name: 'StudyTime', tag: '0008|0030' },\n    { name: 'StudyID', tag: '0020|0010', strconv: true },\n    { name: 'AccessionNumber', tag: '0008|0050' },\n    { name: 'StudyDescription', tag: '0008|1030', strconv: true },\n    { name: 'Modality', tag: '0008|0060' },\n    { name: 'SeriesInstanceUID', tag: '0020|000e' },\n    { name: 'SeriesNumber', tag: '0020|0011' },\n    { name: 'SeriesDescription', tag: '0008|103e', strconv: true },\n    { name: 'WindowLevel', tag: '0028|1050' },\n    { name: 'WindowWidth', tag: '0028|1051' },\n  ]);\n\n/**\n * Trims and collapses multiple spaces into one.\n * @param name\n * @returns string\n */\nconst cleanupName = (name: string) => {\n  return name.trim().replace(/\\s+/g, ' ');\n};\n\nexport const getDisplayName = (info: VolumeInfo) => {\n  return (\n    cleanupName(info.SeriesDescription || info.SeriesNumber) ||\n    info.SeriesInstanceUID\n  );\n};\n\nexport const getWindowLevels = (info: VolumeInfo) => {\n  const { WindowWidth, WindowLevel } = info;\n  if (\n    WindowWidth == null ||\n    WindowLevel == null ||\n    WindowWidth === '' ||\n    WindowLevel === ''\n  )\n    return []; // missing tag\n  const widths = WindowWidth.split('\\\\').map(parseFloat);\n  const levels = WindowLevel.split('\\\\').map(parseFloat);\n  if (\n    widths.some((w) => Number.isNaN(w)) ||\n    levels.some((l) => Number.isNaN(l))\n  ) {\n    console.error('Invalid WindowWidth or WindowLevel DICOM tags');\n    return [];\n  }\n  if (widths.length !== levels.length) {\n    console.error(\n      'Different numbers of WindowWidth and WindowLevel DICOM tags'\n    );\n    return [];\n  }\n  return widths.map((width, i) => ({ width, level: levels[i] }));\n};\n\nexport const useDICOMStore = defineStore('dicom', {\n  state: (): State => ({\n    sliceData: {},\n    volumeBuildResults: {},\n    patientInfo: {},\n    patientStudies: {},\n    studyInfo: {},\n    studyVolumes: {},\n    volumeInfo: {},\n    volumeStudy: {},\n    studyPatient: {},\n    needsRebuild: {},\n  }),\n  actions: {\n    async importFiles(datasets: DataSourceWithFile[]) {\n      if (!datasets.length) return [];\n\n      const fileToDataSource = new Map(\n        datasets.map((ds) => [ds.fileSrc.file, ds])\n      );\n      const allFiles = [...fileToDataSource.keys()];\n\n      const volumeToFiles = await DICOM.splitAndSort(allFiles, identity);\n      if (Object.keys(volumeToFiles).length === 0)\n        throw new Error('No volumes categorized from DICOM file(s)');\n\n      const fileStore = useFileStore();\n\n      // Link VolumeKey and DatasetFiles in fileStore\n      Object.entries(volumeToFiles).forEach(([volumeKey, files]) => {\n        const volumeDatasetFiles = files.map((file) => {\n          const source = fileToDataSource.get(file);\n          if (!source)\n            throw new Error('Did not match File with source DataSource');\n          return source;\n        });\n        fileStore.add(volumeKey, volumeDatasetFiles);\n      });\n\n      await Promise.all(\n        Object.entries(volumeToFiles).map(async ([volumeKey, files]) => {\n          // Read tags of first file\n          if (!(volumeKey in this.volumeInfo)) {\n            const rawTags = await readDicomTags(files[0]);\n            // trim whitespace from all values\n            const tags = Object.fromEntries(\n              Object.entries(rawTags).map(([key, value]) => [key, value.trim()])\n            );\n            // TODO parse the raw string values\n            const patient = {\n              PatientID: tags.PatientID || ANONYMOUS_PATIENT_ID,\n              PatientName: tags.PatientName || ANONYMOUS_PATIENT,\n              PatientBirthDate: tags.PatientBirthDate || '',\n              PatientSex: tags.PatientSex || '',\n            };\n\n            const study = pick(\n              tags,\n              'StudyID',\n              'StudyInstanceUID',\n              'StudyDate',\n              'StudyTime',\n              'AccessionNumber',\n              'StudyDescription'\n            );\n\n            const volumeInfo = {\n              ...pick(\n                tags,\n                'Modality',\n                'SeriesInstanceUID',\n                'SeriesNumber',\n                'SeriesDescription',\n                'WindowLevel',\n                'WindowWidth'\n              ),\n              NumberOfSlices: files.length,\n              VolumeID: volumeKey,\n            };\n\n            this._updateDatabase(patient, study, volumeInfo);\n          }\n\n          // invalidate any existing volume\n          if (volumeKey in useImageStore().dataIndex) {\n            // buildVolume requestor uses this as a rebuild hint\n            this.needsRebuild[volumeKey] = true;\n          }\n        })\n      );\n\n      return Object.keys(volumeToFiles);\n    },\n\n    _updateDatabase(\n      patient: PatientInfo,\n      study: StudyInfo,\n      volume: VolumeInfo\n    ) {\n      const patientKey = patient.PatientID;\n      const studyKey = study.StudyInstanceUID;\n      const volumeKey = volume.VolumeID;\n\n      if (!(patientKey in this.patientInfo)) {\n        this.patientInfo[patientKey] = patient;\n        this.patientStudies[patientKey] = [];\n      }\n\n      if (!(studyKey in this.studyInfo)) {\n        this.studyInfo[studyKey] = study;\n        this.studyVolumes[studyKey] = [];\n        this.studyPatient[studyKey] = patientKey;\n        this.patientStudies[patientKey].push(studyKey);\n      }\n\n      if (!(volumeKey in this.volumeInfo)) {\n        this.volumeInfo[volumeKey] = volume;\n        this.volumeStudy[volumeKey] = studyKey;\n        this.sliceData[volumeKey] = {};\n        this.studyVolumes[studyKey].push(volumeKey);\n      }\n    },\n\n    // You should probably call datasetStore.remove instead as this does not\n    // remove files/images/layers associated with the volume\n    deleteVolume(volumeKey: string) {\n      if (volumeKey in this.volumeInfo) {\n        const studyKey = this.volumeStudy[volumeKey];\n        delete this.volumeInfo[volumeKey];\n        delete this.sliceData[volumeKey];\n        delete this.volumeStudy[volumeKey];\n\n        if (volumeKey in this.volumeBuildResults) {\n          delete this.volumeBuildResults[volumeKey];\n        }\n\n        removeFromArray(this.studyVolumes[studyKey], volumeKey);\n        if (this.studyVolumes[studyKey].length === 0) {\n          this._deleteStudy(studyKey);\n        }\n      }\n    },\n\n    _deleteStudy(studyKey: string) {\n      if (studyKey in this.studyInfo) {\n        const patientKey = this.studyPatient[studyKey];\n        delete this.studyInfo[studyKey];\n        delete this.studyPatient[studyKey];\n\n        [...this.studyVolumes[studyKey]].forEach((volumeKey) =>\n          this.deleteVolume(volumeKey)\n        );\n        delete this.studyVolumes[studyKey];\n\n        removeFromArray(this.patientStudies[patientKey], studyKey);\n        if (this.patientStudies[patientKey].length === 0) {\n          this._deletePatient(patientKey);\n        }\n      }\n    },\n\n    _deletePatient(patientKey: string) {\n      if (patientKey in this.patientInfo) {\n        delete this.patientInfo[patientKey];\n\n        [...this.patientStudies[patientKey]].forEach((studyKey) =>\n          this._deleteStudy(studyKey)\n        );\n        delete this.patientStudies[patientKey];\n      }\n    },\n\n    async serialize(stateFile: StateFile) {\n      const dataIDs = Object.keys(this.volumeInfo);\n      await serializeData(stateFile, dataIDs, DatasetType.DICOM);\n    },\n\n    async deserialize(files: DataSourceWithFile[]) {\n      return this.importFiles(files).then((volumeKeys) => {\n        if (volumeKeys.length !== 1) {\n          // Volumes are store individually so we should get one back.\n          throw new Error('Invalid state file.');\n        }\n\n        return volumeKeys[0];\n      });\n    },\n\n    // returns an ITK image object\n    async getVolumeSlice(\n      volumeKey: string,\n      sliceIndex: number,\n      asThumbnail = false\n    ) {\n      const fileStore = useFileStore();\n\n      const cacheKey = imageCacheMultiKey(sliceIndex, asThumbnail);\n      if (\n        volumeKey in this.sliceData &&\n        cacheKey in this.sliceData[volumeKey]\n      ) {\n        return this.sliceData[volumeKey][cacheKey];\n      }\n\n      if (!(volumeKey in this.volumeInfo)) {\n        throw new Error(`Cannot find given volume key: ${volumeKey}`);\n      }\n      const volumeInfo = this.volumeInfo[volumeKey];\n      const numSlices = volumeInfo.NumberOfSlices;\n\n      if (sliceIndex < 1 || sliceIndex > numSlices) {\n        throw new Error(`Slice ${sliceIndex} is out of bounds`);\n      }\n\n      const volumeFiles = fileStore.getFiles(volumeKey);\n\n      if (!volumeFiles) {\n        throw new Error(`No files found for volume key: ${volumeKey}`);\n      }\n\n      const sliceFile = volumeFiles[sliceIndex - 1];\n\n      const itkImage = await DICOM.readVolumeSlice(sliceFile, asThumbnail);\n\n      this.sliceData[volumeKey][cacheKey] = itkImage;\n      return itkImage;\n    },\n\n    // returns an ITK image object\n    async getVolumeThumbnail(volumeKey: string) {\n      const { NumberOfSlices } = this.volumeInfo[volumeKey];\n      const middleSlice = Math.ceil(NumberOfSlices / 2);\n      return this.getVolumeSlice(volumeKey, middleSlice, true);\n    },\n\n    async buildVolume(volumeKey: string, forceRebuild: boolean = false) {\n      const imageStore = useImageStore();\n\n      const alreadyBuilt = volumeKey in this.volumeBuildResults;\n      const buildNeeded =\n        forceRebuild || this.needsRebuild[volumeKey] || !alreadyBuilt;\n      delete this.needsRebuild[volumeKey];\n\n      // wait for old buildVolume call so we can run imageStore update side effects after\n      const oldImagePromise = alreadyBuilt\n        ? [this.volumeBuildResults[volumeKey]]\n        : [];\n      // actually build volume or wait for existing build?\n      const newVolumeBuildResults = buildNeeded\n        ? constructImage(volumeKey, this.volumeInfo[volumeKey])\n        : this.volumeBuildResults[volumeKey];\n      // let other calls to buildVolume reuse this constructImage work\n      this.volumeBuildResults[volumeKey] = newVolumeBuildResults;\n      const [volumeBuildResults] = await Promise.all([\n        newVolumeBuildResults,\n        ...oldImagePromise,\n      ]);\n\n      // update image store\n      const imageExists = imageStore.dataIndex[volumeKey];\n      if (imageExists) {\n        // was a rebuild\n        imageStore.updateData(volumeKey, volumeBuildResults.image);\n      } else {\n        const info = this.volumeInfo[volumeKey];\n        const name = getDisplayName(info);\n        imageStore.addVTKImageData(name, volumeBuildResults.image, volumeKey);\n      }\n\n      const messageStore = useMessageStore();\n      volumeBuildResults.messages.forEach((message) => {\n        console.warn(message);\n        messageStore.addWarning(message);\n      });\n\n      return volumeBuildResults;\n    },\n  },\n});\n","import { useMessageStore } from '../store/messages';\n\nexport async function useErrorMessage(message: string, task: Function) {\n  try {\n    return await task();\n  } catch (err) {\n    if (err instanceof Error) {\n      const messageStore = useMessageStore();\n      messageStore.addError(message, {\n        details: `${err}. More details can be found in the developer's console.`,\n      });\n    }\n    console.error(err);\n  }\n  return undefined;\n}\n","import { getDisplayName, useDICOMStore } from '@/src/store/datasets-dicom';\nimport { useImageStore } from '@/src/store/datasets-images';\nimport { useErrorMessage } from '@/src/composables/useErrorMessage';\nimport { Maybe } from '@/src/types';\n\nexport type DataSelection = string;\n\nexport const selectionEquals = (a: DataSelection, b: DataSelection) => a === b;\n\nexport const isDicomImage = (imageID: Maybe<string>) => {\n  if (!imageID) return false;\n  const store = useDICOMStore();\n  return imageID in store.volumeInfo;\n};\n\nexport const isRegularImage = (imageID: Maybe<string>) => {\n  if (!imageID) return false;\n  return !isDicomImage(imageID);\n};\n\nexport const getImage = async (imageID: string) => {\n  const images = useImageStore();\n  const dicoms = useDICOMStore();\n  if (isDicomImage(imageID)) {\n    // ensure image data exists\n    await useErrorMessage('Failed to build volume', () =>\n      dicoms.buildVolume(imageID)\n    );\n  }\n  return images.dataIndex[imageID];\n};\n\nconst getImageName = (imageID: string) => {\n  return useImageStore().metadata[imageID].name;\n};\n\nexport const getSelectionName = (selection: string) => {\n  if (isDicomImage(selection)) {\n    return getDisplayName(useDICOMStore().volumeInfo[selection]);\n  }\n  return getImageName(selection);\n};\n","import {\n  runPipeline,\n  InterfaceTypes,\n  imageSharedBufferOrCopy,\n  WorkerPool,\n  stackImages,\n} from 'itk-wasm';\n\nimport itkConfig from '@/src/io/itk/itkConfig';\n\n// Splits the input image into multiple slices and processes them in parallel\nexport async function runWasm(\n  pipeline,\n  args,\n  images,\n  outputs = [{ type: InterfaceTypes.Image }]\n) {\n  const numberOfWorkers = navigator.hardwareConcurrency\n    ? navigator.hardwareConcurrency\n    : 6;\n\n  const aImage = images[0];\n  const splits = Math.min(\n    parseInt(numberOfWorkers / 2, 10),\n    Math.max(aImage.size[aImage.size.length - 1], 1),\n    4 // avoid out of memory errors with larger images\n  );\n\n  const splitsArg = splits.toString();\n  const tasks = [...Array(splits).keys()].map((split) => {\n    const taskArgs = [\n      ...[...Array(images.length).keys()].map((num) => num.toString()),\n      '0', // input image space\n      ...args,\n      '--max-total-splits',\n      splitsArg,\n      '--split',\n      split.toString(),\n      '--number-of-splits',\n      splitsArg,\n      '--memory-io',\n    ];\n\n    const inputs = images.map((image) => ({\n      type: InterfaceTypes.Image,\n      data: imageSharedBufferOrCopy(image),\n    }));\n\n    return [pipeline, taskArgs, outputs, inputs, {\n      pipelineBaseUrl: itkConfig.pipelinesUrl,\n      pipelineWorkerUrl: itkConfig.pipelineWorkerUrl,\n    }];\n\n\n  });\n\n  const workerPool = new WorkerPool(numberOfWorkers, runPipeline);\n  const results = await workerPool.runTasks(tasks).promise;\n  workerPool.terminateWorkers();\n  const validResults = results.filter((r) => r.returnValue === 0);\n  const imageSplits = validResults.map(\n    ({ outputs: pipelineOutput }) => pipelineOutput[0].data\n  );\n\n  return stackImages(imageSplits);\n}\n","import { Image } from 'itk-wasm';\nimport vtkImageData from '@kitware/vtk.js/Common/DataModel/ImageData';\nimport vtkITKHelper from '@kitware/vtk.js/Common/DataModel/ITKHelper';\nimport { compareImageSpaces } from '@/src/utils/imageSpace';\nimport { runWasm } from './itkWasmUtils';\n\n\nexport async function resample(fixed: Image, moving: Image, label = false) {\n  const labelFlag = label ? ['--label'] : [];\n  const { size, spacing, origin, direction } = fixed;\n  const args = [\n    ...labelFlag,\n    '--size',\n    size.join(','),\n    '--spacing',\n    spacing.join(','),\n    '--origin',\n    origin.join(','),\n    '--direction',\n    direction.join(','),\n  ];\n\n  return runWasm('resample', args, [moving]);\n}\n\nexport async function ensureSameSpace(target: vtkImageData, resampleCandidate: vtkImageData, label = false) {\n  if (compareImageSpaces(target, resampleCandidate)) {\n    return resampleCandidate; // could still be different pixel dimensions\n  } \n  const itkImage = await resample(\n    vtkITKHelper.convertVtkToItkImage(target),\n    vtkITKHelper.convertVtkToItkImage(resampleCandidate),\n    label\n  );\n  return vtkITKHelper.convertItkToVtkImage(itkImage);\n}","import { ref } from 'vue';\nimport vtkImageData from '@kitware/vtk.js/Common/DataModel/ImageData';\nimport vtkBoundingBox from '@kitware/vtk.js/Common/DataModel/BoundingBox';\nimport { defineStore } from 'pinia';\nimport { type DataSelection, getImage } from '@/src/utils/dataSelection';\nimport { Maybe } from '@/src/types';\nimport { ensureSameSpace } from '@/src/io/resample/resample';\nimport { useErrorMessage } from '../composables/useErrorMessage';\nimport { Manifest, StateFile } from '../io/state-file/schema';\n\nexport type Layer = {\n  selection: DataSelection;\n  id: string;\n};\n\nexport const useLayersStore = defineStore('layer', () => {\n  type _This = ReturnType<typeof useLayersStore>;\n\n  const parentToLayers = ref<Record<string, Layer[]>>({});\n  const layerImages = ref<Record<string, vtkImageData>>({});\n\n  async function _addLayer(\n    this: _This,\n    parent: DataSelection,\n    source: DataSelection\n  ) {\n    if (!parent) {\n      throw new Error('Tried to addLayer without parent data selection');\n    }\n\n    const id = `${parent}::${source}` as string;\n    this.parentToLayers[parent] = [\n      ...(this.parentToLayers[parent] ?? []),\n      { selection: source, id } as Layer,\n    ];\n\n    const [parentImage, sourceImage] = await Promise.all(\n      [parent, source].map(getImage)\n    );\n\n    if (!sourceImage) {\n      throw new Error('Failed to load layer image');\n    }\n    if (\n      !vtkBoundingBox.intersects(\n        parentImage.getBounds(),\n        sourceImage.getBounds()\n      )\n    ) {\n      this.deleteLayer(parent, source);\n      throw new Error(\n        'Image bounds do not intersect, so no overlap in physical space'\n      );\n    }\n\n    const image = await ensureSameSpace(parentImage, sourceImage);\n\n    this.layerImages[id] = image;\n  }\n\n  async function addLayer(\n    this: _This,\n    parent: DataSelection,\n    source: DataSelection\n  ) {\n    return useErrorMessage('Failed to build layer', async () => {\n      try {\n        await this._addLayer(parent, source);\n      } catch (error) {\n        // remove failed layer from parent's layer list\n        this.parentToLayers[parent] = this.parentToLayers[parent]?.filter(\n          ({ selection }) => selection !== source\n        );\n        throw error;\n      }\n    });\n  }\n\n  function deleteLayer(\n    this: _This,\n    parent: DataSelection,\n    source: DataSelection\n  ) {\n    if (!parent) {\n      throw new Error('Tried to deleteLayer without parent data selection');\n    }\n\n    const layers = this.parentToLayers[parent] ?? [];\n\n    const layerToDelete = layers.find(({ selection }) => selection === source);\n    if (!layerToDelete) return;\n\n    this.parentToLayers[parent] = layers.filter(\n      (layer) => layer !== layerToDelete\n    );\n\n    delete this.layerImages[layerToDelete.id];\n  }\n\n  function getLayers(key: Maybe<DataSelection>) {\n    if (!key) return [];\n    return parentToLayers.value[key] ?? [];\n  }\n\n  const getLayer = (layerID: string) =>\n    Object.values(parentToLayers.value)\n      .flat()\n      .flat()\n      .find(({ id }) => id === layerID);\n\n  const remove = (selectionToRemove: DataSelection) => {\n    const layerStore = useLayersStore();\n    // delete as parent\n    layerStore\n      .getLayers(selectionToRemove)\n      .forEach(({ selection }) => layerStore.deleteLayer(selection, selection));\n    // delete from layer lists\n    Object.keys(layerStore.parentToLayers).forEach((parent) =>\n      layerStore.deleteLayer(parent, selectionToRemove)\n    );\n  };\n\n  function serialize(this: _This, state: StateFile) {\n    state.manifest.parentToLayers = Object.entries(this.parentToLayers).map(\n      ([selectionKey, layers]) => ({\n        selectionKey,\n        sourceSelectionKeys: layers.map(({ selection }) => selection),\n      })\n    );\n  }\n\n  function deserialize(\n    this: _This,\n    manifest: Manifest,\n    dataIDMap: Record<string, string>\n  ) {\n    const remapSelection = (selection: DataSelection) => {\n      return dataIDMap[selection];\n    };\n\n    const { parentToLayers: parentToLayersSerialized } = manifest;\n    parentToLayersSerialized.forEach(\n      ({ selectionKey, sourceSelectionKeys }) => {\n        const parent = remapSelection(selectionKey);\n        sourceSelectionKeys.forEach((sourceKey) => {\n          const source = remapSelection(sourceKey);\n          this.addLayer(parent, source);\n        });\n      }\n    );\n  }\n\n  return {\n    parentToLayers,\n    layerImages,\n    _addLayer,\n    addLayer,\n    deleteLayer,\n    remove,\n    getLayers,\n    getLayer,\n    serialize,\n    deserialize,\n  };\n});\n","import { defineStore } from 'pinia';\nimport vtkPolyData from '@kitware/vtk.js/Common/DataModel/PolyData';\nimport { useIdStore } from '@/src/store/id';\n\ninterface State {\n  idList: string[]; // list of IDs\n  dataIndex: Record<string, vtkPolyData>; // ID -> VTK object\n  metadata: Record<string, {}>; // ID -> metadata\n}\nexport const useModelStore = defineStore('models', {\n  state: (): State => ({\n    idList: [],\n    dataIndex: {},\n    metadata: {},\n  }),\n  actions: {\n    addVTKPolyData(name: string, polyData: vtkPolyData) {\n      const id = useIdStore().nextId();\n      this.idList.push(id);\n      this.dataIndex[id] = polyData;\n      return id;\n    },\n  },\n});\n","import vtkImageData from '@kitware/vtk.js/Common/DataModel/ImageData';\nimport { defineStore } from 'pinia';\nimport { computed, ref } from 'vue';\nimport {\n  isDicomImage,\n  isRegularImage,\n  type DataSelection,\n} from '@/src/utils/dataSelection';\nimport { useDICOMStore } from './datasets-dicom';\nimport { useImageStore } from './datasets-images';\nimport { useFileStore } from './datasets-files';\nimport { StateFile } from '../io/state-file/schema';\nimport { useErrorMessage } from '../composables/useErrorMessage';\nimport { useLayersStore } from './datasets-layers';\nimport { useModelStore } from './datasets-models';\n\nexport const DataType = {\n  Image: 'Image',\n  Model: 'Model',\n};\n\nexport const useDatasetStore = defineStore('dataset', () => {\n  const imageStore = useImageStore();\n  const dicomStore = useDICOMStore();\n  const fileStore = useFileStore();\n  const layersStore = useLayersStore();\n  const modelStore = useModelStore();\n\n  // --- state --- //\n\n  const primarySelection = ref<DataSelection | null>(null);\n\n  // --- getters --- //\n\n  const primaryImageID = primarySelection;\n\n  const primaryDataset = computed<vtkImageData | null>(() => {\n    const { dataIndex } = imageStore;\n    return (primaryImageID.value && dataIndex[primaryImageID.value]) || null;\n  });\n\n  const idsAsSelections = computed(() => {\n    const volumeKeys = Object.keys(dicomStore.volumeInfo);\n    const images = imageStore.idList.filter((id) => isRegularImage(id));\n    return [...volumeKeys, ...images];\n  });\n\n  // --- actions --- //\n\n  function setPrimarySelection(sel: DataSelection | null) {\n    primarySelection.value = sel;\n    if (!sel) return;\n\n    // if selection is dicom, call buildVolume\n    if (isDicomImage(sel)) {\n      useErrorMessage('Failed to build volume', () =>\n        dicomStore.buildVolume(sel)\n      );\n    }\n  }\n\n  async function serialize(stateFile: StateFile) {\n    await dicomStore.serialize(stateFile);\n    await imageStore.serialize(stateFile);\n\n    if (primarySelection.value) {\n      const { manifest } = stateFile;\n      manifest.primarySelection = primarySelection.value;\n    }\n  }\n\n  const remove = (id: string | null) => {\n    if (!id) return;\n\n    if (id === primarySelection.value) {\n      primarySelection.value = null;\n    }\n\n    if (isDicomImage(id)) {\n      dicomStore.deleteVolume(id);\n    }\n    imageStore.deleteData(id);\n\n    fileStore.remove(id);\n    layersStore.remove(id);\n  };\n\n  const removeAll = () => {\n    // Create a copy to avoid iteration issue while removing data\n    const imageIdCopy = [...imageStore.idList];\n    imageIdCopy.forEach((id) => {\n      remove(id);\n    });\n\n    const modelIdCopy = [...modelStore.idList];\n    modelIdCopy.forEach((id) => {\n      remove(id);\n    });\n  };\n\n  return {\n    primaryImageID,\n    primarySelection,\n    primaryDataset,\n    idsAsSelections,\n    setPrimarySelection,\n    serialize,\n    remove,\n    removeAll,\n  };\n});\n","import {\n  InjectionKey,\n  MaybeRef,\n  Ref,\n  computed,\n  hasInjectionContext,\n  inject,\n  unref,\n} from 'vue';\nimport { Maybe } from '@/src/types';\nimport {\n  defaultImageMetadata,\n  useImageStore,\n} from '@/src/store/datasets-images';\nimport { useLayersStore } from '@/src/store/datasets-layers';\nimport { createLPSBounds, getAxisBounds } from '@/src/utils/lps';\nimport { useDatasetStore } from '@/src/store/datasets';\nimport { storeToRefs } from 'pinia';\n\nexport interface CurrentImageContext {\n  imageID: Ref<Maybe<string>>;\n}\n\nexport const CurrentImageInjectionKey = Symbol(\n  'CurrentImage'\n) as InjectionKey<CurrentImageContext>;\n\n// Returns a spatially inflated image extent\nexport function getImageSpatialExtent(imageID: Maybe<string>) {\n  const imageStore = useImageStore();\n\n  if (imageID && imageID in imageStore.metadata) {\n    const { lpsOrientation } = imageStore.metadata[imageID];\n    const image = imageStore.dataIndex[imageID];\n    if (image) {\n      const extent = image.getSpatialExtent();\n      return {\n        Sagittal: getAxisBounds(extent, 'Sagittal', lpsOrientation),\n        Coronal: getAxisBounds(extent, 'Coronal', lpsOrientation),\n        Axial: getAxisBounds(extent, 'Axial', lpsOrientation),\n      };\n    }\n  }\n  return createLPSBounds();\n}\n\nexport function getImageMetadata(imageID: Maybe<string>) {\n  const { metadata } = useImageStore();\n  if (!imageID) return defaultImageMetadata();\n  return metadata[imageID] ?? defaultImageMetadata();\n}\n\nexport function getImageData(imageID: Maybe<string>) {\n  const { dataIndex } = useImageStore();\n  return imageID ? dataIndex[imageID] ?? null : null;\n}\n\nexport function getIsImageLoading(imageID: Maybe<string>) {\n  if (!imageID) return false;\n  const imageStore = useImageStore();\n  return !imageStore.dataIndex[imageID];\n}\n\nexport function getImageLayers(imageID: Maybe<string>) {\n  if (!imageID) return [];\n  const layersStore = useLayersStore();\n  return layersStore\n    .getLayers(imageID)\n    .filter(({ id }) => id in layersStore.layerImages);\n}\n\nexport function useImage(imageID: MaybeRef<Maybe<string>>) {\n  return {\n    id: computed(() => unref(imageID)),\n    imageData: computed(() => getImageData(unref(imageID))),\n    metadata: computed(() => getImageMetadata(unref(imageID))),\n    extent: computed(() => getImageSpatialExtent(unref(imageID))),\n    isLoading: computed(() => getIsImageLoading(unref(imageID))),\n    layers: computed(() => getImageLayers(unref(imageID))),\n  };\n}\n\nexport function useCurrentImage() {\n  const { primaryImageID } = storeToRefs(useDatasetStore());\n  const defaultContext = { imageID: primaryImageID };\n  const { imageID } = hasInjectionContext()\n    ? inject(CurrentImageInjectionKey, defaultContext)\n    : defaultContext;\n\n  const { id, imageData, metadata, extent, isLoading, layers } =\n    useImage(imageID);\n  return {\n    currentImageID: id,\n    currentImageMetadata: metadata,\n    currentImageData: imageData,\n    currentImageExtent: extent,\n    isImageLoading: isLoading,\n    currentLayers: layers,\n  };\n}\n","import { DoubleKeyRecord } from '@/src/utils/doubleKeyRecord';\nimport { StateFile, ViewConfig } from '../../io/state-file/schema';\nimport {\n  CameraConfig,\n  LayersConfig,\n  SegmentGroupConfig,\n  SliceConfig,\n  VolumeColorConfig,\n  WindowLevelConfig,\n} from './types';\nimport { ensureDefault } from '../../utils';\n\ntype SubViewConfig =\n  | CameraConfig\n  | SliceConfig\n  | VolumeColorConfig\n  | WindowLevelConfig\n  | LayersConfig\n  | SegmentGroupConfig;\n\ntype ViewConfigGetter = (\n  viewID: string,\n  dataID: string\n) => SubViewConfig | undefined;\n\ntype ViewConfigStateKey = keyof ViewConfig;\n\nexport const serializeViewConfig = <K extends ViewConfigStateKey>(\n  stateFile: StateFile,\n  configGetter: ViewConfigGetter,\n  viewConfigStateKey: K\n) => {\n  const dataIDs = stateFile.manifest.datasets.map((dataset) => dataset.id);\n  const { views } = stateFile.manifest;\n\n  views.forEach((view) => {\n    dataIDs.forEach((dataID) => {\n      const { config } = view;\n\n      const viewConfig = configGetter(view.id, dataID);\n      if (viewConfig !== undefined) {\n        const configForData = ensureDefault(dataID, config, {} as ViewConfig);\n\n        configForData[viewConfigStateKey] = viewConfig as ViewConfig[K];\n      }\n    });\n  });\n};\n\nexport const serializeViewConfigV2 = <\n  K extends ViewConfigStateKey,\n  V extends ViewConfig[K]\n>(\n  stateFile: StateFile,\n  viewConfigs: DoubleKeyRecord<V>,\n  viewConfigStateKey: K\n) => {\n  const dataIDs = stateFile.manifest.datasets.map((dataset) => dataset.id);\n  const { views } = stateFile.manifest;\n\n  views.forEach((view) => {\n    dataIDs.forEach((dataID) => {\n      const { config } = view;\n\n      const viewConfig = viewConfigs[view.id]?.[dataID];\n      if (viewConfig !== undefined) {\n        const configForData = ensureDefault(dataID, config, {} as ViewConfig);\n\n        configForData[viewConfigStateKey] = viewConfig as ViewConfig[K];\n      }\n    });\n  });\n};\n\n/**\n * @param viewConfigs Expected to be a DoubleKeyRecord. Index is ordered as (ViewID, DataID)\n * @param viewConfigStateKey\n * @returns\n */\nexport const createViewConfigSerializer = <\n  K extends ViewConfigStateKey,\n  V extends ViewConfig[K]\n>(\n  viewConfigs: DoubleKeyRecord<V>,\n  viewConfigStateKey: K\n) => {\n  return (stateFile: StateFile) => {\n    serializeViewConfigV2(stateFile, viewConfigs, viewConfigStateKey);\n  };\n};\n","import { clampValue } from '@/src/utils';\nimport { defineStore } from 'pinia';\nimport { reactive } from 'vue';\nimport {\n  DoubleKeyRecord,\n  deleteSecondKey,\n  getDoubleKeyRecord,\n  patchDoubleKeyRecord,\n} from '@/src/utils/doubleKeyRecord';\nimport { Maybe } from '@/src/types';\nimport { useCurrentImage } from '@/src/composables/useCurrentImage';\nimport { createViewConfigSerializer } from './common';\nimport { ViewConfig } from '../../io/state-file/schema';\nimport { SliceConfig } from './types';\nimport { useImageStore } from '../datasets-images';\n\nexport const defaultSliceConfig = (): SliceConfig => ({\n  slice: 0,\n  min: 0,\n  max: 1,\n  axisDirection: 'Inferior',\n  syncState: false,\n});\n\nexport const useViewSliceStore = defineStore('viewSlice', () => {\n  const imageStore = useImageStore();\n  const configs = reactive<DoubleKeyRecord<SliceConfig>>({});\n\n  const getConfig = (viewID: Maybe<string>, dataID: Maybe<string>) =>\n    getDoubleKeyRecord(configs, viewID, dataID);\n\n  const updateConfig = (\n    viewID: string,\n    dataID: string,\n    patch: Partial<SliceConfig>\n  ) => {\n    const config = {\n      ...defaultSliceConfig(),\n      ...getConfig(viewID, dataID),\n      ...patch,\n    };\n\n    config.slice = clampValue(config.slice, config.min, config.max);\n    patchDoubleKeyRecord(configs, viewID, dataID, config);\n  };\n\n  const resetSlice = (viewID: string, dataID: string) => {\n    const config = getConfig(viewID, dataID);\n    if (!config) return;\n\n    // Setting this to floor() will affect images where the\n    // middle slice is fractional.\n    // This is consistent with vtkImageMapper and SliceRepresentationProxy.\n    updateConfig(viewID, dataID, {\n      slice: Math.ceil((config.min + config.max) / 2),\n    });\n  };\n\n  const removeView = (viewID: string) => {\n    delete configs[viewID];\n  };\n\n  const removeData = (dataID: string, viewID?: string) => {\n    if (viewID) {\n      delete configs[viewID]?.[dataID];\n    } else {\n      deleteSecondKey(configs, dataID);\n    }\n  };\n\n  const toggleSyncImages = () => {\n    // Synchronize all images when toggled\n    Object.keys(configs).forEach((viewID) => {\n      imageStore.idList.forEach((imageID) => {\n        const { syncState } = {\n          ...defaultSliceConfig(),\n          ...getConfig(viewID, imageID),\n        };\n        updateConfig(viewID, imageID, { syncState: !syncState });\n      });\n    });\n  };\n\n  const isSync = () => {\n    const allSync = Object.keys(configs).every((sc) =>\n      Object.keys(configs[sc]).every((c) => configs[sc][c].syncState)\n    );\n\n    return allSync;\n  };\n\n  const updateSyncConfigs = () => {\n    Object.keys(configs).forEach((viewID) => {\n      const { currentImageID } = useCurrentImage();\n      const config = getConfig(viewID, currentImageID.value);\n      imageStore.idList.forEach((imageID) => {\n        const { syncState } = {\n          ...defaultSliceConfig(),\n          ...getConfig(viewID, imageID),\n        };\n\n        if (syncState) {\n          updateConfig(viewID, imageID, { slice: config?.slice });\n        }\n      });\n    });\n  };\n\n  const serialize = createViewConfigSerializer(configs, 'slice');\n\n  const deserialize = (viewID: string, config: Record<string, ViewConfig>) => {\n    Object.entries(config).forEach(([dataID, viewConfig]) => {\n      if (viewConfig.slice) {\n        updateConfig(viewID, dataID, viewConfig.slice);\n      }\n    });\n  };\n\n  return {\n    configs,\n    getConfig,\n    updateConfig,\n    resetSlice,\n    removeView,\n    removeData,\n    toggleSyncImages,\n    updateSyncConfigs,\n    isSync,\n    serialize,\n    deserialize,\n  };\n});\n\nexport default useViewSliceStore;\n","import { defineStore } from 'pinia';\nimport { reactive, ref } from 'vue';\nimport {\n  DoubleKeyRecord,\n  deleteSecondKey,\n  getDoubleKeyRecord,\n  patchDoubleKeyRecord,\n} from '@/src/utils/doubleKeyRecord';\nimport { Maybe } from '@/src/types';\nimport { WL_AUTO_DEFAULT } from '@/src/constants';\nimport { createViewConfigSerializer } from './common';\nimport { ViewConfig } from '../../io/state-file/schema';\nimport { WindowLevelConfig } from './types';\n\nexport const defaultWindowLevelConfig = (): WindowLevelConfig => ({\n  width: 1,\n  level: 0.5,\n  min: 0,\n  max: 1,\n  auto: WL_AUTO_DEFAULT,\n  preset: {\n    width: 1,\n    level: 0.5,\n  },\n});\n\ntype WindowLevel = {\n  width: number;\n  level: number;\n};\n\nexport const useWindowingStore = defineStore('windowing', () => {\n  const configs = reactive<DoubleKeyRecord<WindowLevelConfig>>({});\n  const syncAcrossViews = ref(true);\n  const runtimeConfigWindowLevel = ref<WindowLevel | undefined>();\n\n  const setSyncAcrossViews = (yn: boolean) => {\n    syncAcrossViews.value = yn;\n  };\n\n  const getConfig = (viewID: Maybe<string>, dataID: Maybe<string>) =>\n    getDoubleKeyRecord(configs, viewID, dataID);\n\n  /**\n   * Syncs the window/level/min/max params of (srcViewID, srcDataID) across all views sharing the dataset.\n   * @param srcViewID\n   * @param srcDataID\n   */\n  const syncWindowLevel = (srcViewID: string, srcDataID: string) => {\n    if (!syncAcrossViews.value) return;\n\n    const config = configs[srcViewID]?.[srcDataID];\n    if (!config) return;\n\n    Object.keys(configs)\n      .filter((viewID) => viewID !== srcViewID)\n      .forEach((viewID) => {\n        patchDoubleKeyRecord(configs, viewID, srcDataID, config);\n      });\n  };\n\n  const updateConfig = (\n    viewID: string,\n    dataID: string,\n    patch: Partial<WindowLevelConfig>\n  ) => {\n    patchDoubleKeyRecord(configs, viewID, dataID, {\n      ...defaultWindowLevelConfig(),\n      ...configs[viewID]?.[dataID],\n      ...patch,\n    });\n\n    if (syncAcrossViews.value) {\n      syncWindowLevel(viewID, dataID);\n    }\n  };\n\n  // not really reset, actually translate config object into W/L\n  const resetWindowLevel = (viewID: string, dataID: string) => {\n    const config = configs[viewID]?.[dataID];\n    if (config == null) return;\n\n    let { width, level } = config.preset;\n    const defaults = defaultWindowLevelConfig();\n    if (width === defaults.width && level === defaults.level) {\n      width = config.max - config.min;\n      level = (config.max + config.min) / 2;\n    }\n    updateConfig(viewID, dataID, { width, level });\n  };\n\n  const removeView = (viewID: string) => {\n    delete configs[viewID];\n  };\n\n  const removeData = (dataID: string, viewID?: string) => {\n    if (viewID) {\n      delete configs[viewID]?.[dataID];\n    } else {\n      deleteSecondKey(configs, dataID);\n    }\n  };\n\n  const serialize = createViewConfigSerializer(configs, 'window');\n\n  const deserialize = (viewID: string, config: Record<string, ViewConfig>) => {\n    Object.entries(config).forEach(([dataID, viewConfig]) => {\n      if (viewConfig.window) {\n        updateConfig(viewID, dataID, viewConfig.window);\n      }\n    });\n  };\n\n  return {\n    runtimeConfigWindowLevel,\n    configs,\n    getConfig,\n    setSyncAcrossViews,\n    updateConfig,\n    resetWindowLevel,\n    removeView,\n    removeData,\n    serialize,\n    deserialize,\n  };\n});\n\nexport default useWindowingStore;\n","import vtkPiecewiseFunctionProxy from '@kitware/vtk.js/Proxy/Core/PiecewiseFunctionProxy';\nimport vtkPiecewiseFunction from '@kitware/vtk.js/Common/DataModel/PiecewiseFunction';\nimport vtkColorMaps from '@kitware/vtk.js/Rendering/Core/ColorTransferFunction/ColorMaps';\nimport vtkRenderer from '@kitware/vtk.js/Rendering/Core/Renderer';\nimport vtkOpenGLRenderWindow from '@kitware/vtk.js/Rendering/OpenGL/RenderWindow';\nimport type { Vector2, Vector3 } from '@kitware/vtk.js/types';\nimport type { vtkObject } from '@kitware/vtk.js/interfaces';\nimport { intersectDisplayWithPlane } from '@kitware/vtk.js/Widgets/Manipulators/PlaneManipulator';\nimport { OpacityFunction } from '@/src/types/views';\nimport vtkFieldData from '@kitware/vtk.js/Common/DataModel/DataSetAttributes/FieldData';\nimport { Maybe } from '@/src/types';\n\nexport function computeWorldToDisplay(\n  xyz: Vector3,\n  renderer: vtkRenderer\n): Vector2 | null {\n  const view = renderer.getRenderWindow()?.getViews()?.[0];\n  if (view) {\n    const [x, y, z] = xyz;\n    return view.worldToDisplay(x, y, z, renderer);\n  }\n  return null;\n}\n\nexport function computeDisplayToWorld(\n  xy: Vector2,\n  renderer: vtkRenderer\n): Vector3 | null {\n  const view = renderer.getRenderWindow()?.getViews()?.[0];\n  if (view) {\n    const [x, y] = xy;\n    return view.displayToWorld(x, y, 0, renderer);\n  }\n  return null;\n}\n\nexport function normalizeMouseEventPosition(\n  ev: MouseEvent,\n  view: vtkOpenGLRenderWindow\n) {\n  const canvas = view.getCanvas();\n  if (!canvas) return null;\n\n  const bounds = canvas.getBoundingClientRect();\n  const scaleX = canvas.width / bounds.width;\n  const scaleY = canvas.height / bounds.height;\n  return [\n    scaleX * (ev.clientX - bounds.left),\n    scaleY * (bounds.height - ev.clientY + bounds.top),\n  ] as Vector2;\n}\n\nexport function intersectMouseEventWithPlane(\n  ev: MouseEvent,\n  renderer: vtkRenderer,\n  origin: Vector3,\n  normal: Vector3\n) {\n  const view = renderer\n    .getRenderWindow()\n    ?.getViews()[0] as vtkOpenGLRenderWindow;\n  if (!view) return null;\n\n  const position = normalizeMouseEventPosition(ev, view);\n  if (!position) return null;\n\n  return intersectDisplayWithPlane(\n    position[0],\n    position[1],\n    origin,\n    normal,\n    renderer,\n    view\n  );\n}\n\n/**\n * Converts world coordinates to SVG-friendly coordinates.\n *\n * Assumes that the SVG layer is the same size as the renderer.\n * TODO verify this is the case.\n */\nexport function worldToSVG(xyz: Vector3, renderer: vtkRenderer) {\n  const coords = computeWorldToDisplay(xyz, renderer);\n  const view = renderer.getRenderWindow()?.getViews()?.[0];\n  if (coords && view) {\n    const [, height] = view.getViewportSize(renderer);\n    // convert from canvas space to svg space\n    return [\n      coords[0] / devicePixelRatio,\n      (height - coords[1]) / devicePixelRatio,\n    ] as Vector2;\n  }\n  return null;\n}\n\n/**\n * Gets the CSS coordinates for a vtk.js mouse event.\n */\nexport function getCSSCoordinatesFromEvent(eventData: any) {\n  const { pokedRenderer }: { pokedRenderer: vtkRenderer } = eventData;\n  const view = pokedRenderer?.getRenderWindow()?.getViews()?.[0] as\n    | vtkOpenGLRenderWindow\n    | undefined;\n  const bbox = view?.getContainer()?.getBoundingClientRect();\n\n  if (!('position' in eventData) || !bbox) {\n    return null;\n  }\n\n  return [\n    bbox.left + eventData.position.x / devicePixelRatio,\n    bbox.top + bbox.height - eventData.position.y / devicePixelRatio,\n  ] as Vector2;\n}\n\n/**\n * Shifts the opacity points from a preset.\n */\nexport function getShiftedOpacityFromPreset(\n  presetName: string,\n  effectiveRange: [number, number],\n  shift: number,\n  shiftAlpha: number\n) {\n  const preset = vtkColorMaps.getPresetByName(presetName);\n  if (preset.OpacityPoints) {\n    const OpacityPoints = preset.OpacityPoints as number[];\n    const points = [];\n    for (let i = 0; i < OpacityPoints.length; i += 2) {\n      points.push([OpacityPoints[i], OpacityPoints[i + 1]]);\n    }\n\n    const [xmin, xmax] = effectiveRange;\n    const width = xmax - xmin;\n    return points.map(([x, y]) => {\n      // Non-zero values should be affected by shift\n      // but preset values of zero should not\n      const shifted = y && y - shiftAlpha;\n      const yVal = Math.max(Math.min(shifted, 1), 0);\n      return [(x - xmin) / width + shift, yVal] as Vector2;\n    });\n  }\n  return null;\n}\n\n/**\n * Retrieves an OpacityFunction from a preset.\n */\nexport function getOpacityFunctionFromPreset(\n  presetName: string\n): Partial<OpacityFunction> {\n  const preset = vtkColorMaps.getPresetByName(presetName);\n\n  if (preset.OpacityPoints) {\n    return {\n      mode: vtkPiecewiseFunctionProxy.Mode.Points,\n      preset: presetName,\n      shift: 0,\n      shiftAlpha: 0,\n    };\n  }\n  return {\n    mode: vtkPiecewiseFunctionProxy.Mode.Gaussians,\n    // deep-copy necessary\n    gaussians: JSON.parse(\n      JSON.stringify(vtkPiecewiseFunctionProxy.Defaults.Gaussians)\n    ),\n  };\n}\n\n/**\n * Inflate an axis bounds defined as [min, max] by some delta.\n *\n * @param bounds Must be [number, number]. (Typed number[] for convenience.)\n * @param delta\n * @returns\n */\nexport function inflateAxisBounds(bounds: number[], delta: number) {\n  return [bounds[0] + delta, bounds[1] + delta];\n}\n\n/**\n * Retrieves the color function range, if any.\n *\n * Will only return the color function range if the preset\n * has AbsoluteRange specified as true. For medical presets,\n * the range is defined by the transfer function point range,\n * rather than the dataset data range.\n * @param presetName\n * @returns\n */\nexport function getColorFunctionRangeFromPreset(\n  presetName: string\n): [number, number] | null {\n  const preset = vtkColorMaps.getPresetByName(presetName);\n  if (!preset) return null;\n\n  const { AbsoluteRange, RGBPoints } = preset;\n  if (AbsoluteRange && RGBPoints) {\n    let min = Infinity;\n    let max = -Infinity;\n    for (let i = 0; i < RGBPoints.length; i += 4) {\n      min = Math.min(min, RGBPoints[i]);\n      max = Math.max(max, RGBPoints[i]);\n    }\n    return [min, max];\n  }\n  return null;\n}\n\n/**\n * Retrieves the effective opacity mapping range, if any.\n *\n * Presets may specify an effective range for the scalar opacity\n * mapping range.\n * @param presetName\n * @returns\n */\nexport function getOpacityRangeFromPreset(presetName: string) {\n  const preset = vtkColorMaps.getPresetByName(presetName);\n  if (preset.EffectiveRange) {\n    return [...preset.EffectiveRange] as [number, number];\n  }\n  return null;\n}\n\n/**\n * Applies a set of points to a piecewise function.\n * @param pwf\n * @param points\n * @param range\n */\nexport function applyPointsToPiecewiseFunction(\n  pwf: vtkPiecewiseFunction,\n  points: Vector2[],\n  range: Vector2\n) {\n  const width = range[1] - range[0];\n  const rescaled = points.map(([x, y]) => [x * width + range[0], y]);\n\n  pwf.removeAllPoints();\n  rescaled.forEach(([x, y]) => pwf.addPoint(x, y));\n}\n\n/**\n * Applies a set of nodes to a piecewise function.\n * @param nodes\n * @param range\n * @param pwf\n */\nexport function applyNodesToPiecewiseFunction(\n  pwf: vtkPiecewiseFunction,\n  nodes: any[],\n  range: Vector2\n) {\n  const width = range[1] - range[0];\n  const rescaled = nodes.map((n) => ({ ...n, x: n.x * width + range[0] }));\n\n  pwf.setNodes(rescaled);\n}\n\n/**\n * Gets the data array given by the arrayName and arrayLocation.\n * @param obj\n * @param arrayName\n * @param arrayLocation\n * @returns\n */\nexport function getDataArray(\n  obj: vtkObject,\n  arrayName: string,\n  arrayLocation: 'pointData' | 'cellData'\n) {\n  const field: Maybe<vtkFieldData> = obj.getReferenceByName(arrayLocation);\n  const array = field?.getArrayByName(arrayName);\n  return array;\n}\n","import vtkPiecewiseFunctionProxy from '@kitware/vtk.js/Proxy/Core/PiecewiseFunctionProxy';\nimport {\n  getColorFunctionRangeFromPreset,\n  getOpacityFunctionFromPreset,\n} from '@/src/utils/vtk-helpers';\nimport { ColorTransferFunction } from '@/src/types/views';\nimport { defineStore } from 'pinia';\nimport { reactive } from 'vue';\nimport {\n  DoubleKeyRecord,\n  deleteSecondKey,\n  getDoubleKeyRecord,\n  patchDoubleKeyRecord,\n} from '@/src/utils/doubleKeyRecord';\nimport { Maybe } from '@/src/types';\nimport { identity } from '@/src/utils';\nimport { LAYER_PRESET_BY_MODALITY, LAYER_PRESET_DEFAULT } from '@/src/config';\nimport { isDicomImage } from '@/src/utils/dataSelection';\nimport { createViewConfigSerializer } from './common';\nimport { ViewConfig } from '../../io/state-file/schema';\nimport { LayersConfig } from './types';\nimport { useLayersStore } from '../datasets-layers';\nimport { useDICOMStore } from '../datasets-dicom';\n\nfunction getPreset(id: string) {\n  const layersStore = useLayersStore();\n  const layer = layersStore.getLayer(id);\n  if (!layer) {\n    throw new Error(`Layer ${id} not found`);\n  }\n\n  if (isDicomImage(layer.selection)) {\n    const dicomStore = useDICOMStore();\n    const { Modality = undefined } = dicomStore.volumeInfo[layer.selection];\n    return (\n      (Modality && LAYER_PRESET_BY_MODALITY[Modality]) || LAYER_PRESET_DEFAULT\n    );\n  }\n\n  return LAYER_PRESET_DEFAULT;\n}\n\nexport const defaultLayersConfig = (): LayersConfig => ({\n  colorBy: {\n    arrayName: '',\n    location: 'pointData',\n  },\n  transferFunction: {\n    preset: '',\n    mappingRange: [0, 1],\n  },\n  // opacity function not used in VtkTwoView\n  opacityFunction: {\n    mode: vtkPiecewiseFunctionProxy.Mode.Gaussians,\n    gaussians: [],\n    mappingRange: [0, 1],\n  },\n  blendConfig: { opacity: 0.6, visibility: true },\n});\n\nexport const useLayerColoringStore = defineStore('layerColoring', () => {\n  const configs = reactive<DoubleKeyRecord<LayersConfig>>({});\n\n  const getConfig = (viewID: Maybe<string>, dataID: Maybe<string>) =>\n    getDoubleKeyRecord(configs, viewID, dataID);\n\n  const updateConfig = (\n    viewID: string,\n    dataID: string,\n    patch: Partial<LayersConfig>\n  ) => {\n    const config = {\n      ...defaultLayersConfig(),\n      ...getConfig(viewID, dataID),\n      ...patch,\n    };\n\n    patchDoubleKeyRecord(configs, viewID, dataID, config);\n  };\n\n  const createUpdateFunc = <K extends keyof LayersConfig>(\n    key: K,\n    transform: (config: LayersConfig[K]) => LayersConfig[K] = identity\n  ) => {\n    return (\n      viewID: string,\n      dataID: string,\n      update: Partial<LayersConfig[K]>\n    ) => {\n      const config = getConfig(viewID, dataID) ?? defaultLayersConfig();\n      const updatedConfig = transform({\n        ...config[key],\n        ...update,\n      });\n      updateConfig(viewID, dataID, { [key]: updatedConfig });\n    };\n  };\n\n  const updateColorBy = createUpdateFunc('colorBy');\n  const updateColorTransferFunction = createUpdateFunc('transferFunction');\n  const updateOpacityFunction = createUpdateFunc('opacityFunction');\n  const updateBlendConfig = createUpdateFunc('blendConfig');\n\n  const setColorPreset = (viewID: string, layerID: string, preset: string) => {\n    const layersStore = useLayersStore();\n    const image = layersStore.layerImages[layerID];\n    if (!image) return;\n    const imageDataRange = image.getPointData().getScalars().getRange();\n\n    const ctRange = getColorFunctionRangeFromPreset(preset);\n    const ctFunc: Partial<ColorTransferFunction> = {\n      preset,\n      mappingRange: ctRange || imageDataRange,\n    };\n    updateColorTransferFunction(viewID, layerID, ctFunc);\n\n    const opFunc = getOpacityFunctionFromPreset(preset);\n    opFunc.mappingRange = imageDataRange;\n    updateOpacityFunction(viewID, layerID, opFunc);\n  };\n\n  const initConfig = (viewID: string, dataID: string) =>\n    updateConfig(viewID, dataID, defaultLayersConfig());\n\n  const resetColorPreset = (viewID: string, layerID: string) => {\n    setColorPreset(viewID, layerID, getPreset(layerID));\n  };\n\n  const removeView = (viewID: string) => {\n    delete configs[viewID];\n  };\n\n  const removeData = (dataID: string, viewID?: string) => {\n    if (viewID) {\n      delete configs[viewID]?.[dataID];\n    } else {\n      deleteSecondKey(configs, dataID);\n    }\n  };\n\n  const serialize = createViewConfigSerializer(configs, 'layers');\n\n  const deserialize = (viewID: string, config: Record<string, ViewConfig>) => {\n    Object.entries(config).forEach(([dataID, viewConfig]) => {\n      if (viewConfig.layers) {\n        updateConfig(viewID, dataID, viewConfig.layers);\n      }\n    });\n  };\n\n  return {\n    configs,\n    getConfig,\n    initConfig,\n    updateConfig,\n    updateColorBy,\n    updateColorTransferFunction,\n    updateOpacityFunction,\n    updateBlendConfig,\n    setColorPreset,\n    resetColorPreset,\n    removeView,\n    removeData,\n    serialize,\n    deserialize,\n  };\n});\n\nexport default useLayerColoringStore;\n","import { defineStore } from 'pinia';\nimport {\n  DoubleKeyRecord,\n  deleteSecondKey,\n  getDoubleKeyRecord,\n  patchDoubleKeyRecord,\n} from '@/src/utils/doubleKeyRecord';\nimport { reactive, ref } from 'vue';\nimport { Maybe } from '@/src/types';\nimport { useCurrentImage } from '@/src/composables/useCurrentImage';\nimport { createViewConfigSerializer } from './common';\nimport { ViewConfig } from '../../io/state-file/schema';\nimport { CameraConfig } from './types';\nimport { useImageStore } from '../datasets-images';\n\nexport const useViewCameraStore = defineStore('viewCamera', () => {\n  const imageStore = useImageStore();\n  const configs = reactive<DoubleKeyRecord<CameraConfig>>({});\n\n  const getConfig = (viewID: Maybe<string>, dataID: Maybe<string>) =>\n    getDoubleKeyRecord(configs, viewID, dataID);\n\n  const updateConfig = (\n    viewID: string,\n    dataID: string,\n    patch: Partial<CameraConfig>\n  ) => {\n    const config = {\n      ...getConfig(viewID, dataID),\n      ...patch,\n    };\n\n    patchDoubleKeyRecord(configs, viewID, dataID, config);\n  };\n\n  const disableCameraAutoReset = ref(false);\n\n  const toggleCameraAutoReset = () => {\n    disableCameraAutoReset.value = !disableCameraAutoReset.value;\n  };\n\n  const removeView = (viewID: string) => {\n    delete configs[viewID];\n  };\n\n  const removeData = (dataID: string, viewID?: string) => {\n    if (viewID) {\n      delete configs[viewID]?.[dataID];\n    } else {\n      deleteSecondKey(configs, dataID);\n    }\n  };\n\n  const toggleSyncCameras = () => {\n    // Synchronize all cameras when toggled\n    Object.keys(configs).forEach((viewID) => {\n      imageStore.idList.forEach((imageID) => {\n        const { syncState } = {\n          ...getConfig(viewID, imageID),\n        };\n        updateConfig(viewID, imageID, { syncState: !syncState });\n      });\n    });\n  };\n\n  const isSync = () => {\n    const allSync = Object.keys(configs).every((sc) =>\n      Object.keys(configs[sc]).every((c) => configs[sc][c].syncState)\n    );\n\n    return allSync;\n  };\n\n  const updateSyncConfigs = () => {\n    Object.keys(configs).forEach((viewID) => {\n      const { currentImageID } = useCurrentImage();\n      const config = getConfig(viewID, currentImageID.value);\n      imageStore.idList.forEach((imageID) => {\n        const { syncState } = {\n          ...getConfig(viewID, imageID),\n        };\n\n        if (syncState) {\n          updateConfig(viewID, imageID, {\n            position: config?.position,\n            focalPoint: config?.focalPoint,\n            parallelScale: config?.parallelScale,\n          });\n        }\n      });\n    });\n  };\n\n  const serialize = createViewConfigSerializer(configs, 'camera');\n\n  const deserialize = (viewID: string, config: Record<string, ViewConfig>) => {\n    Object.entries(config).forEach(([dataID, viewConfig]) => {\n      if (viewConfig.camera) {\n        updateConfig(viewID, dataID, viewConfig.camera);\n      }\n    });\n  };\n\n  return {\n    configs,\n    getConfig,\n    updateConfig,\n    disableCameraAutoReset,\n    toggleCameraAutoReset,\n    removeView,\n    removeData,\n    toggleSyncCameras,\n    updateSyncConfigs,\n    isSync,\n    serialize,\n    deserialize,\n  };\n});\n\nexport default useViewCameraStore;\n","import vtkImageData from '@kitware/vtk.js/Common/DataModel/ImageData';\nimport vtkPiecewiseFunctionProxy from '@kitware/vtk.js/Proxy/Core/PiecewiseFunctionProxy';\nimport {\n  getColorFunctionRangeFromPreset,\n  getOpacityFunctionFromPreset,\n} from '@/src/utils/vtk-helpers';\nimport { DEFAULT_PRESET_BY_MODALITY, DEFAULT_PRESET } from '@/src/config';\nimport { ColorTransferFunction } from '@/src/types/views';\nimport { defineStore } from 'pinia';\nimport { reactive } from 'vue';\nimport {\n  DoubleKeyRecord,\n  deleteSecondKey,\n  getDoubleKeyRecord,\n  patchDoubleKeyRecord,\n} from '@/src/utils/doubleKeyRecord';\nimport { DeepPartial, Maybe } from '@/src/types';\nimport { identity } from '@/src/utils';\nimport { isDicomImage } from '@/src/utils/dataSelection';\nimport { createViewConfigSerializer } from './common';\nimport { ViewConfig } from '../../io/state-file/schema';\nimport { VolumeColorConfig } from './types';\nimport { useDICOMStore } from '../datasets-dicom';\nimport { useImageStore } from '../datasets-images';\n\nexport const DEFAULT_AMBIENT = 0.2;\nexport const DEFAULT_DIFFUSE = 0.7;\nexport const DEFAULT_SPECULAR = 0.3;\nexport const DEFAULT_EDGE_GRADIENT = 0.2;\nexport const DEFAULT_SAMPLING_DISTANCE = 0.2;\n\nfunction getPresetFromImageModality(imageID: string) {\n  const dicomStore = useDICOMStore();\n  if (isDicomImage(imageID)) {\n    const volKey = imageID;\n    const { Modality } = dicomStore.volumeInfo[volKey];\n    if (Modality in DEFAULT_PRESET_BY_MODALITY) {\n      return DEFAULT_PRESET_BY_MODALITY[Modality];\n    }\n  }\n  return DEFAULT_PRESET;\n}\n\n/**\n * Gets partial color and opacity function configs from a preset.\n * @param preset\n * @returns\n */\nfunction getColorAndOpacityFuncsFromPreset(preset: string) {\n  const ctFunc: Partial<ColorTransferFunction> = {\n    preset,\n  };\n\n  const ctRange = getColorFunctionRangeFromPreset(preset);\n  if (ctRange) {\n    ctFunc.mappingRange = ctRange;\n  }\n\n  const opFunc = getOpacityFunctionFromPreset(preset);\n\n  return { colorFunc: ctFunc, opacityFunc: opFunc };\n}\n\nexport const defaultVolumeColorConfig = (): VolumeColorConfig => ({\n  colorBy: {\n    arrayName: '',\n    location: 'pointData',\n  },\n  transferFunction: {\n    preset: '',\n    mappingRange: [0, 1],\n  },\n  opacityFunction: {\n    mode: vtkPiecewiseFunctionProxy.Mode.Gaussians,\n    gaussians: [],\n    mappingRange: [0, 1],\n  },\n  cvr: {\n    enabled: true,\n    lightFollowsCamera: true,\n    volumeQuality: 2,\n    useVolumetricScatteringBlending: false,\n    volumetricScatteringBlending: 0.5,\n    useLocalAmbientOcclusion: true,\n    laoKernelRadius: 5,\n    laoKernelSize: 15,\n    ambient: DEFAULT_AMBIENT,\n    diffuse: DEFAULT_DIFFUSE,\n    specular: DEFAULT_SPECULAR,\n  },\n});\n\nexport const useVolumeColoringStore = defineStore('volumeColoring', () => {\n  const configs = reactive<DoubleKeyRecord<VolumeColorConfig>>(\n    Object.create(null)\n  );\n  const defaultConfigs = reactive<\n    Record<string, DeepPartial<VolumeColorConfig>>\n  >(Object.create(null));\n\n  const getConfig = (viewID: Maybe<string>, dataID: Maybe<string>) =>\n    getDoubleKeyRecord(configs, viewID, dataID);\n\n  const updateConfig = (\n    viewID: string,\n    dataID: string,\n    patch: Partial<VolumeColorConfig>\n  ) => {\n    const config = {\n      ...defaultVolumeColorConfig(),\n      ...getConfig(viewID, dataID),\n      ...patch,\n    };\n\n    patchDoubleKeyRecord(configs, viewID, dataID, config);\n  };\n\n  const createUpdateFunc = <K extends keyof VolumeColorConfig>(\n    key: K,\n    transform: (config: VolumeColorConfig[K]) => VolumeColorConfig[K] = identity\n  ) => {\n    return (\n      viewID: string,\n      dataID: string,\n      update: Partial<VolumeColorConfig[K]>\n    ) => {\n      const config = getConfig(viewID, dataID) ?? defaultVolumeColorConfig();\n      const updatedConfig = transform({\n        ...config[key],\n        ...update,\n      });\n      updateConfig(viewID, dataID, { [key]: updatedConfig });\n    };\n  };\n\n  const updateColorBy = createUpdateFunc('colorBy');\n  const updateColorTransferFunction = createUpdateFunc('transferFunction');\n  const updateOpacityFunction = createUpdateFunc('opacityFunction');\n  const updateCVRParameters = createUpdateFunc('cvr');\n\n  const setColorPreset = (viewID: string, imageID: string, preset: string) => {\n    const imageStore = useImageStore();\n    const image = imageStore.dataIndex[imageID];\n    if (!image) throw new Error('Invalid imageID');\n\n    const imageDataRange = image.getPointData().getScalars().getRange();\n    const { colorFunc, opacityFunc } =\n      getColorAndOpacityFuncsFromPreset(preset);\n    colorFunc.mappingRange ||= imageDataRange;\n    opacityFunc.mappingRange = imageDataRange;\n\n    updateColorTransferFunction(viewID, imageID, colorFunc);\n    updateOpacityFunction(viewID, imageID, opacityFunc);\n  };\n\n  const resetToDefaultColoring = (\n    viewID: string,\n    dataID: string,\n    image: vtkImageData\n  ) => {\n    const defaults = defaultConfigs[dataID];\n    const scalars = image.getPointData().getScalars();\n\n    updateColorBy(viewID, dataID, {\n      arrayName: defaults?.colorBy?.arrayName ?? scalars.getName(),\n      location: defaults?.colorBy?.location ?? 'pointData',\n    });\n    setColorPreset(\n      viewID,\n      dataID,\n      defaults?.transferFunction?.preset ?? getPresetFromImageModality(dataID)\n    );\n  };\n\n  /**\n   * Sets all views' defaults for given dataset.\n   * @param dataID\n   * @param defaults\n   */\n  const setDefaults = (\n    dataID: string,\n    defaults: DeepPartial<VolumeColorConfig>\n  ) => {\n    defaultConfigs[dataID] = defaults;\n  };\n\n  const removeView = (viewID: string) => {\n    delete configs[viewID];\n  };\n\n  const removeData = (dataID: string, viewID?: string) => {\n    if (viewID) {\n      delete configs[viewID]?.[dataID];\n    } else {\n      deleteSecondKey(configs, dataID);\n    }\n  };\n\n  const serialize = createViewConfigSerializer(configs, 'volumeColorConfig');\n\n  const deserialize = (viewID: string, config: Record<string, ViewConfig>) => {\n    Object.entries(config).forEach(([dataID, viewConfig]) => {\n      if (viewConfig.volumeColorConfig) {\n        updateConfig(viewID, dataID, viewConfig.volumeColorConfig);\n      }\n    });\n  };\n\n  return {\n    configs,\n    getConfig,\n    updateConfig,\n    updateColorBy,\n    updateColorTransferFunction,\n    updateOpacityFunction,\n    updateCVRParameters,\n    resetToDefaultColoring,\n    setDefaults,\n    setColorPreset,\n    removeView,\n    removeData,\n    serialize,\n    deserialize,\n  };\n});\n\nexport default useVolumeColoringStore;\n","import { defineStore } from 'pinia';\n\nimport useViewSliceStore from './view-configs/slicing';\nimport useWindowingStore from './view-configs/windowing';\nimport useLayerColoringStore from './view-configs/layers';\nimport useViewCameraStore from './view-configs/camera';\nimport useVolumeColoringStore from './view-configs/volume-coloring';\nimport { StateFile, ViewConfig } from '../io/state-file/schema';\nimport { useImageStore } from './datasets-images';\n\n/**\n * This store saves view configuration that is associated with a specific\n * view. The key is a synthetic id generated from the view ID and data ID.\n */\nexport const useViewConfigStore = defineStore('viewConfig', () => {\n  const viewSliceStore = useViewSliceStore();\n  const windowingStore = useWindowingStore();\n  const layerColoringStore = useLayerColoringStore();\n  const viewCameraStore = useViewCameraStore();\n  const volumeColoringStore = useVolumeColoringStore();\n\n  const removeView = (viewID: string) => {\n    viewSliceStore.removeView(viewID);\n    windowingStore.removeView(viewID);\n    layerColoringStore.removeView(viewID);\n    viewCameraStore.removeView(viewID);\n    volumeColoringStore.removeView(viewID);\n  };\n\n  const removeData = (dataID: string, viewID?: string) => {\n    viewSliceStore.removeData(dataID, viewID);\n    windowingStore.removeData(dataID, viewID);\n    layerColoringStore.removeData(dataID, viewID);\n    viewCameraStore.removeData(dataID, viewID);\n    volumeColoringStore.removeData(dataID, viewID);\n  };\n\n  const serialize = (stateFile: StateFile) => {\n    viewSliceStore.serialize(stateFile);\n    windowingStore.serialize(stateFile);\n    layerColoringStore.serialize(stateFile);\n    viewCameraStore.serialize(stateFile);\n    volumeColoringStore.serialize(stateFile);\n  };\n\n  const deserialize = (\n    viewID: string,\n    config: Record<string, ViewConfig>,\n    dataIDMap: Record<string, string>\n  ) => {\n    // First update the view config map to use the new dataIDs\n    const updatedConfig: Record<string, ViewConfig> = {};\n    Object.entries(config).forEach(([dataID, viewConfig]) => {\n      const newDataID = dataIDMap[dataID];\n      updatedConfig[newDataID] = viewConfig;\n    });\n\n    viewSliceStore.deserialize(viewID, updatedConfig);\n    windowingStore.deserialize(viewID, updatedConfig);\n    layerColoringStore.deserialize(viewID, updatedConfig);\n    viewCameraStore.deserialize(viewID, updatedConfig);\n    volumeColoringStore.deserialize(viewID, updatedConfig);\n  };\n\n  // delete hook\n  const imageStore = useImageStore();\n  imageStore.$onAction(({ name, args }) => {\n    if (name === 'deleteData') {\n      const [id] = args;\n      removeData(id);\n    }\n  });\n\n  return {\n    removeView,\n    removeData,\n    serialize,\n    deserialize,\n  };\n});\n","import { defineStore } from 'pinia';\nimport { DefaultViewSpec, InitViewSpecs } from '../config';\nimport { Layout, LayoutDirection } from '../types/layout';\nimport { useViewConfigStore } from './view-configs';\nimport { ViewSpec } from '../types/views';\nimport {\n  StateFile,\n  Layout as StateFileLayout,\n  View,\n} from '../io/state-file/schema';\n\ninterface State {\n  layout: Layout;\n  viewSpecs: Record<string, ViewSpec>;\n  activeViewID: string;\n}\n\nexport const useViewStore = defineStore('view', {\n  state: (): State => ({\n    layout: {\n      direction: LayoutDirection.V,\n      items: [],\n    },\n    viewSpecs: structuredClone(InitViewSpecs),\n    activeViewID: '',\n  }),\n  getters: {\n    viewIDs(state) {\n      return Object.keys(state.viewSpecs);\n    },\n  },\n  actions: {\n    setActiveViewID(id: string) {\n      this.activeViewID = id;\n    },\n    addView(id: string) {\n      if (!(id in this.viewSpecs)) {\n        this.viewSpecs[id] = structuredClone(DefaultViewSpec);\n      }\n    },\n    removeView(id: string) {\n      if (id in this.viewSpecs) {\n        delete this.viewSpecs[id];\n      }\n    },\n    setLayout(layout: Layout) {\n      this.layout = layout;\n\n      const layoutsToProcess = [layout];\n      while (layoutsToProcess.length) {\n        const ly = layoutsToProcess.shift()!;\n        ly.items.forEach((item) => {\n          if (typeof item === 'string') {\n            // item is a view ID\n            this.addView(item);\n          } else {\n            layoutsToProcess.push(item);\n          }\n        });\n      }\n    },\n    serialize(stateFile: StateFile) {\n      const viewConfigStore = useViewConfigStore();\n      const { manifest } = stateFile;\n      const { views } = manifest;\n\n      manifest.layout = this.layout as StateFileLayout;\n\n      // Serialize the view specs\n      Object.entries(this.viewSpecs).forEach(([id, spec]) => {\n        const type = spec.viewType;\n        const { props } = spec;\n        const config = {};\n\n        const view = {\n          id,\n          type,\n          props,\n          config,\n        };\n\n        views.push(view);\n      });\n\n      // Serialize the view config\n      viewConfigStore.serialize(stateFile);\n    },\n    deserialize(views: View[], dataIDMap: Record<string, string>) {\n      const viewConfigStore = useViewConfigStore();\n\n      views.forEach((view) => {\n        const viewID = view.id;\n\n        const viewSpec = {\n          viewType: view.type,\n          props: view.props,\n        };\n\n        this.viewSpecs[viewID] = viewSpec;\n\n        // Now delegate the deserialization of the view config\n        const { config } = view;\n        viewConfigStore.deserialize(viewID, config, dataIDMap);\n      });\n    },\n  },\n});\n","/**\n * Returns the parent directory of a path.\n * @param path\n * @returns\n */\nexport function dirname(path: string) {\n  const p = path.split(/\\/+/g);\n  p.splice(-1, 1);\n  return p.join('/');\n}\n\n/**\n * Returns the base name of a path.\n * @param path\n * @returns\n */\nexport function basename(path: string) {\n  return path.split(/\\/+/g).at(-1) ?? path;\n}\n\n/**\n * Normalizes a string.\n *\n * \"a//b\" and \"a/b/\" become \"a/b\".\n * @param path\n * @returns\n */\nexport function normalize(path: string) {\n  return path.replace(/\\/+/g, '/').replace(/\\/$/, '');\n}\n\n/**\n * Joins path segments with / and normalizes the result.\n * @param segments\n */\nexport function join(...segments: string[]) {\n  return normalize(segments.join('/'));\n}\n","import { useImageStore } from '@/src/store/datasets-images';\nimport { storeToRefs } from 'pinia';\nimport { watch } from 'vue';\n\nexport function onImageDeleted(callback: (deletedIDs: string[]) => void) {\n  const { dataIndex } = storeToRefs(useImageStore());\n\n  return watch(dataIndex, (newIndex, oldIndex) => {\n    const deleted = Object.keys(oldIndex).filter((id) => !(id in newIndex));\n    if (deleted.length) callback(deleted);\n  });\n}\n","/* eslint-disable */\nimport { defer, Deferred } from './index';\n\n// to be used to instantiate a worker\nexport default class PromiseWorker {\n  private msgID: number;\n  private worker: Worker;\n  private waiting: Record<string, Deferred<any>>;\n\n  constructor(worker: Worker) {\n    this.msgID = 0;\n    this.worker = worker;\n    this.waiting = {};\n\n    this.worker.onmessage = this.handleMessage.bind(this);\n  }\n\n  postMessage(message: any, transferables: any[] = []) {\n    const wrappedMsg = {\n      id: this.msgID,\n      message,\n    };\n\n    const deferred = defer();\n    this.waiting[wrappedMsg.id] = deferred;\n\n    this.worker.postMessage(wrappedMsg, transferables);\n\n    this.msgID += 1;\n    return deferred.promise;\n  }\n\n  handleMessage(ev: any) {\n    const { id, error, message } = ev.data;\n    if (id in this.waiting) {\n      const deferred = this.waiting[id];\n      delete this.waiting[id];\n      if (error) {\n        deferred.reject(new Error(error));\n      } else {\n        deferred.resolve(message);\n      }\n    }\n  }\n}\n","import vtk from '@kitware/vtk.js/vtk';\n\nimport PromiseWorker from '@/src/utils/promise-worker';\nimport vtkDataSet from '@kitware/vtk.js/Common/DataModel/DataSet';\nimport { vtkObject } from '@kitware/vtk.js/interfaces';\nimport { StateObject } from './common';\n\ninterface SuccessReadResult {\n  status: 'success';\n  obj: StateObject;\n}\n\ninterface FailResult {\n  status: 'fail';\n  error: Error;\n}\n\ntype ReadResult = SuccessReadResult | FailResult;\n\nexport const runAsyncVTKReader = (readerName: string) => async (file: File) => {\n  const asyncWorker = new Worker(\n    new URL('./async.reader.worker.ts', import.meta.url),\n    {\n      type: 'module',\n    }\n  );\n  const worker = new PromiseWorker(asyncWorker);\n  const data = (await worker.postMessage({\n    file,\n    readerName,\n  })) as ReadResult;\n  asyncWorker.terminate();\n  if (data.status === 'success') {\n    return vtk(data.obj) as vtkObject;\n  }\n  throw data.error;\n};\n\ninterface SuccessWriteResult {\n  status: 'success';\n  data: string;\n}\ntype WriteResult = SuccessWriteResult | FailResult;\n\nexport const runAsyncVTKWriter =\n  (writerName: string) => async (dataSet: vtkDataSet) => {\n    const asyncWorker = new Worker(\n      new URL('./async.writer.worker.ts', import.meta.url),\n      {\n        type: 'module',\n      }\n    );\n    const worker = new PromiseWorker(asyncWorker);\n    const result = (await worker.postMessage({\n      obj: dataSet.getState(),\n      writerName,\n    })) as WriteResult;\n    asyncWorker.terminate();\n    if (result.status === 'success') {\n      return result.data;\n    }\n    throw result.error;\n  };\n\nexport const stlReader = runAsyncVTKReader('stl');\nexport const vtiReader = runAsyncVTKReader('vti');\nexport const vtpReader = runAsyncVTKReader('vtp');\nexport const vtiWriter = runAsyncVTKWriter('vti');\n","import vtkITKHelper from '@kitware/vtk.js/Common/DataModel/ITKHelper';\nimport vtkImageData from '@kitware/vtk.js/Common/DataModel/ImageData';\nimport { copyImage } from 'itk-wasm';\nimport {\n  readImage as readImageItk,\n  writeImage as writeImageItk,\n} from '@itk-wasm/image-io';\nimport { vtiReader, vtiWriter } from '@/src/io/vtk/async';\nimport { getWorker } from '@/src/io/itk/worker';\n\nexport const readImage = async (file: File) => {\n  if (file.name.endsWith('.vti'))\n    return (await vtiReader(file)) as vtkImageData;\n\n  const { image } = await readImageItk(file, { webWorker: getWorker() });\n  return vtkITKHelper.convertItkToVtkImage(image);\n};\n\nexport const writeImage = async (format: string, image: vtkImageData) => {\n  if (format === 'vti') {\n    return vtiWriter(image);\n  }\n  // copyImage so writeImage does not detach live data when passing to worker\n  const itkImage = copyImage(vtkITKHelper.convertVtkToItkImage(image));\n\n  const result = await writeImageItk(itkImage, `image.${format}`, {\n    webWorker: getWorker(),\n  });\n  return result.serializedImage.data;\n};\n","/* eslint-disable no-param-reassign */\nimport macro from '@kitware/vtk.js/macro';\nimport vtkImageData from '@kitware/vtk.js/Common/DataModel/ImageData';\nimport vtkDataArray from '@kitware/vtk.js/Common/Core/DataArray';\n\nfunction vtkImageExtractComponentsFilter(publicAPI, model) {\n  model.classHierarchy.push('vtkImageExtractComponentsFilter');\n\n  publicAPI.requestData = (inData, outData) => {\n    const inputData = inData[0];\n    const outputData = vtkImageData.newInstance();\n\n    const components = model.components;\n    if (!components || !Array.isArray(components) || components.length === 0) {\n      throw Error('No components specified for extraction.');\n    }\n\n    const inputScalars = inputData.getPointData().getScalars();\n    const numInputComponents = inputScalars.getNumberOfComponents();\n    components.forEach((c) => {\n      if (c < 0) {\n        throw Error('Component index must be greater than or equal to 0.');\n      }\n      if (c >= numInputComponents) {\n        throw Error(\n          'Component index must be less than the number of components in the input data.'\n        );\n      }\n    });\n\n    outputData.shallowCopy(inputData);\n\n    const inputArray = inputScalars.getData();\n    const numPixels = inputArray.length / numInputComponents;\n\n    const outputNumComponents = components.length;\n    const outputArray = new inputArray.constructor(\n      numPixels * outputNumComponents\n    );\n\n    for (let pixel = 0; pixel < numPixels; pixel++) {\n      for (let c = 0; c < components.length; c++) {\n        outputArray[pixel * outputNumComponents + c] =\n          inputArray[pixel * numInputComponents + components[c]];\n      }\n    }\n\n    outputData.getPointData().setScalars(\n      vtkDataArray.newInstance({\n        numberOfComponents: outputNumComponents,\n        values: outputArray,\n      })\n    );\n\n    outData[0] = outputData;\n  };\n}\n\nconst DEFAULT_VALUES = {\n  components: [],\n};\n\n// ----------------------------------------------------------------------------\n\nexport function extend(publicAPI, model, initialValues = {}) {\n  Object.assign(model, DEFAULT_VALUES, initialValues);\n\n  macro.obj(publicAPI, model);\n\n  macro.algo(publicAPI, model, 1, 1);\n\n  macro.setGet(publicAPI, model, ['components']);\n\n  vtkImageExtractComponentsFilter(publicAPI, model);\n}\n\n// ----------------------------------------------------------------------------\n\nexport const newInstance = macro.newInstance(\n  extend,\n  'vtkImageExtractComponentsFilter'\n);\n\n// ----------------------------------------------------------------------------\n\nexport default { newInstance, extend };\n","import macro from '@kitware/vtk.js/macro';\nimport vtkImageData from '@kitware/vtk.js/Common/DataModel/ImageData';\nimport deepEqual from 'deep-equal';\n\n// ----------------------------------------------------------------------------\n// vtkLabelMap methods\n// ----------------------------------------------------------------------------\n\nfunction vtkLabelMap(publicAPI, model) {\n  // Set our className\n  model.classHierarchy.push('vtkLabelMap');\n\n  const originalAPI = { ...publicAPI };\n\n  publicAPI.replaceLabelValue = (from, to) => {\n    const pixels = publicAPI.getPointData().getScalars().getData();\n    const len = pixels.length;\n    for (let i = 0; i < len; i++) {\n      if (pixels[i] === from) {\n        pixels[i] = to;\n      }\n    }\n  };\n\n  publicAPI.setSegments = (segments) => {\n    if (segments === model.segments || deepEqual(segments, model.segments)) {\n      return false;\n    }\n    return originalAPI.setSegments(segments);\n  };\n}\n\n// ----------------------------------------------------------------------------\n// Object factory\n// ----------------------------------------------------------------------------\n\nconst defaultValues = () => ({\n  segments: [],\n});\n\n// ----------------------------------------------------------------------------\n\nexport function extend(publicAPI, model, initialValues = {}) {\n  Object.assign(model, defaultValues(), initialValues);\n\n  vtkImageData.extend(publicAPI, model, initialValues);\n\n  macro.setGet(publicAPI, model, ['segments']);\n\n  // Object specific methods\n  vtkLabelMap(publicAPI, model);\n}\n\n// ----------------------------------------------------------------------------\n\nexport const newInstance = macro.newInstance(extend, 'vtkLabelMap');\n\n// ----------------------------------------------------------------------------\n\nexport default { newInstance, extend };\n","import { computed, reactive, ref, toRaw, watch } from 'vue';\nimport vtkDataArray from '@kitware/vtk.js/Common/Core/DataArray';\nimport vtkImageData from '@kitware/vtk.js/Common/DataModel/ImageData';\nimport vtkBoundingBox from '@kitware/vtk.js/Common/DataModel/BoundingBox';\nimport type { TypedArray } from '@kitware/vtk.js/types';\nimport { defineStore } from 'pinia';\nimport { useImageStore } from '@/src/store/datasets-images';\nimport { join, normalize } from '@/src/utils/path';\nimport { useIdStore } from '@/src/store/id';\nimport { onImageDeleted } from '@/src/composables/onImageDeleted';\nimport { normalizeForStore, removeFromArray } from '@/src/utils';\nimport { SegmentMask } from '@/src/types/segment';\nimport { DEFAULT_SEGMENT_MASKS, CATEGORICAL_COLORS } from '@/src/config';\nimport { readImage, writeImage } from '@/src/io/readWriteImage';\nimport {\n  type DataSelection,\n  getImage,\n  isRegularImage,\n} from '@/src/utils/dataSelection';\nimport vtkImageExtractComponents from '@/src/utils/imageExtractComponentsFilter';\nimport vtkLabelMap from '../vtk/LabelMap';\nimport {\n  StateFile,\n  Manifest,\n  SegmentGroupMetadata,\n} from '../io/state-file/schema';\nimport { FileEntry } from '../io/types';\nimport { ensureSameSpace } from '../io/resample/resample';\nimport { useDICOMStore } from './datasets-dicom';\n\nconst LabelmapArrayType = Uint8Array;\nexport type LabelmapArrayType = Uint8Array;\n\nexport const LABELMAP_BACKGROUND_VALUE = 0;\nexport const makeDefaultSegmentName = (value: number) => `Segment ${value}`;\nexport const makeDefaultSegmentGroupName = (baseName: string, index: number) =>\n  `Segment Group ${index} for ${baseName}`;\nconst numberer = (index: number) => (index <= 1 ? '' : `${index}`); // start numbering at 2\n\nexport interface SegmentGroupMetadata {\n  name: string;\n  parentImage: string;\n  segments: {\n    order: number[];\n    byValue: Record<number, SegmentMask>;\n  };\n}\n\nexport function createLabelmapFromImage(imageData: vtkImageData) {\n  const points = new LabelmapArrayType(imageData.getNumberOfPoints());\n  const labelmap = vtkLabelMap.newInstance(\n    imageData.get('spacing', 'origin', 'direction')\n  );\n  labelmap.getPointData().setScalars(\n    vtkDataArray.newInstance({\n      numberOfComponents: 1,\n      values: points,\n    })\n  );\n  labelmap.setDimensions(imageData.getDimensions());\n  labelmap.computeTransforms();\n\n  return labelmap;\n}\n\nfunction convertToUint8(array: number[] | TypedArray): Uint8Array {\n  const uint8Array = new Uint8Array(array.length);\n  for (let i = 0; i < array.length; i++) {\n    const value = array[i];\n    uint8Array[i] = value < 0 || value > 255 ? 0 : value;\n  }\n  return uint8Array;\n}\n\nfunction getLabelMapScalars(imageData: vtkImageData) {\n  const scalars = imageData.getPointData().getScalars();\n  let values = scalars.getData();\n\n  if (!(values instanceof LabelmapArrayType)) {\n    values = convertToUint8(values);\n  }\n\n  return vtkDataArray.newInstance({\n    numberOfComponents: scalars.getNumberOfComponents(),\n    values,\n  });\n}\n\nexport function toLabelMap(imageData: vtkImageData) {\n  const labelmap = vtkLabelMap.newInstance(\n    imageData.get('spacing', 'origin', 'direction', 'extent', 'dataDescription')\n  );\n\n  labelmap.setDimensions(imageData.getDimensions());\n  labelmap.computeTransforms();\n\n  // outline rendering only supports UInt8Array image types\n  const scalars = getLabelMapScalars(imageData);\n  labelmap.getPointData().setScalars(scalars);\n\n  return labelmap;\n}\n\nexport function extractEachComponent(input: vtkImageData) {\n  const numComponents = input\n    .getPointData()\n    .getScalars()\n    .getNumberOfComponents();\n  const extractComponentsFilter = vtkImageExtractComponents.newInstance();\n  extractComponentsFilter.setInputData(input);\n  return Array.from({ length: numComponents }, (_, i) => {\n    extractComponentsFilter.setComponents([i]);\n    extractComponentsFilter.update();\n    return extractComponentsFilter.getOutputData() as vtkImageData;\n  });\n}\n\nexport const useSegmentGroupStore = defineStore('segmentGroup', () => {\n  type _This = ReturnType<typeof useSegmentGroupStore>;\n\n  const dataIndex = reactive<Record<string, vtkLabelMap>>(Object.create(null));\n  const metadataByID = reactive<Record<string, SegmentGroupMetadata>>(\n    Object.create(null)\n  );\n  const orderByParent = ref<Record<string, string[]>>(Object.create(null));\n\n  /**\n   * Gets the metadata for a labelmap.\n   * @param segmentGroupID\n   * @param segmentValue\n   */\n  function getMetadata(segmentGroupID: string) {\n    if (!(segmentGroupID in metadataByID))\n      throw new Error('No such labelmap ID');\n    return metadataByID[segmentGroupID];\n  }\n\n  /**\n   * Gets a segment.\n   * @param segmentGroupID\n   * @param segmentValue\n   * @returns\n   */\n  function getSegment(segmentGroupID: string, segmentValue: number) {\n    const metadata = getMetadata(segmentGroupID);\n    if (!(segmentValue in metadata.segments.byValue))\n      throw new Error('No such segment');\n    return metadata.segments.byValue[segmentValue];\n  }\n\n  /**\n   * Validates that a segment does not violate constraints.\n   *\n   * Assumes that the given segment is not yet part of the labelmap segments.\n   * @param segmentGroupID\n   * @param segment\n   */\n  function validateSegment(segmentGroupID: string, segment: SegmentMask) {\n    return (\n      // cannot be zero (background)\n      segment.value !== 0 &&\n      // cannot already exist\n      !(segment.value in getMetadata(segmentGroupID).segments.byValue)\n    );\n  }\n\n  /**\n   * Adds a given image + metadata as a labelmap.\n   */\n  function addLabelmap(\n    this: _This,\n    labelmap: vtkLabelMap,\n    metadata: SegmentGroupMetadata\n  ) {\n    const id = useIdStore().nextId();\n\n    dataIndex[id] = labelmap;\n    metadataByID[id] = metadata;\n    orderByParent.value[metadata.parentImage] ??= [];\n    orderByParent.value[metadata.parentImage].push(id);\n\n    return id;\n  }\n\n  // Used for constructing labelmap names in newLabelmapFromImage.\n  const nextDefaultIndex: Record<string, number> = Object.create(null);\n\n  // clear nextDefaultIndex\n  onImageDeleted((deleted) => {\n    deleted.forEach((id) => {\n      delete nextDefaultIndex[id];\n    });\n  });\n\n  function pickUniqueName(\n    formatName: (index: number) => string,\n    parentID: string\n  ) {\n    const existingNames = new Set(\n      Object.values(metadataByID).map((meta) => meta.name)\n    );\n    let name = '';\n    do {\n      const nameIndex = nextDefaultIndex[parentID] ?? 1;\n      nextDefaultIndex[parentID] = nameIndex + 1;\n      name = formatName(nameIndex);\n    } while (existingNames.has(name));\n    return name;\n  }\n\n  /**\n   * Creates a new labelmap entry from a parent/source image.\n   */\n  function newLabelmapFromImage(this: _This, parentID: string) {\n    const imageStore = useImageStore();\n    const imageData = imageStore.dataIndex[parentID];\n    if (!imageData) {\n      return null;\n    }\n    const { name: baseName } = imageStore.metadata[parentID];\n\n    const labelmap = createLabelmapFromImage(imageData);\n\n    const { order, byKey } = normalizeForStore(\n      structuredClone(DEFAULT_SEGMENT_MASKS),\n      'value'\n    );\n\n    const name = pickUniqueName(\n      (index: number) => makeDefaultSegmentGroupName(baseName, index),\n      parentID\n    );\n\n    return addLabelmap.call(this, labelmap, {\n      name,\n      parentImage: parentID,\n      segments: { order, byValue: byKey },\n    });\n  }\n\n  /**\n   * Deletes a labelmap.\n   */\n  function removeGroup(id: string) {\n    if (!(id in dataIndex)) return;\n    const { parentImage } = metadataByID[id];\n    removeFromArray(orderByParent.value[parentImage], id);\n    delete dataIndex[id];\n    delete metadataByID[id];\n  }\n\n  let nextColorIndex = 0;\n  function getNextColor() {\n    const color = CATEGORICAL_COLORS[nextColorIndex];\n    nextColorIndex = (nextColorIndex + 1) % CATEGORICAL_COLORS.length;\n    return [...color, 255] as const;\n  }\n\n  async function decodeSegments(\n    imageId: DataSelection,\n    image: vtkLabelMap,\n    component = 0\n  ) {\n    if (!isRegularImage(imageId)) {\n      // dicom image\n      const dicomStore = useDICOMStore();\n\n      const volumeBuildResults = await dicomStore.volumeBuildResults[imageId];\n      if (volumeBuildResults.modality === 'SEG') {\n        const segments =\n          volumeBuildResults.builtImageResults.metaInfo.segmentAttributes[\n            component\n          ];\n        return segments.map((segment) => ({\n          value: segment.labelID,\n          name: segment.SegmentLabel,\n          color: [...segment.recommendedDisplayRGBValue, 255],\n          visible: true,\n        }));\n      }\n    }\n\n    const [min, max] = image.getPointData().getScalars().getRange();\n    const noZeroBackground = Math.max(min, 1);\n    const values = Array.from(\n      { length: max - noZeroBackground + 1 },\n      (_, i) => i + noZeroBackground\n    );\n    return values.map((value) => ({\n      value,\n      name: makeDefaultSegmentName(value),\n      color: [...getNextColor()],\n      visible: true,\n    }));\n  }\n\n  /**\n   * Converts an image to a labelmap.\n   */\n  async function convertImageToLabelmap(\n    imageID: DataSelection,\n    parentID: DataSelection\n  ) {\n    if (imageID === parentID)\n      throw new Error('Cannot convert an image to be a labelmap of itself');\n\n    // Build vtkImageData for DICOMs\n    const [childImage, parentImage] = await Promise.all(\n      [imageID, parentID].map(getImage)\n    );\n\n    if (!imageID || !parentID)\n      throw new Error('Image and/or parent datasets do not exist');\n\n    const imageStore = useImageStore();\n\n    const intersects = vtkBoundingBox.intersects(\n      parentImage.getBounds(),\n      childImage.getBounds()\n    );\n    if (!intersects) {\n      throw new Error(\n        'Segment group and parent image bounds do not intersect. So there is no overlap in physical space.'\n      );\n    }\n\n    // cache name before deleting\n    const baseName = imageStore.metadata[imageID].name;\n\n    // Don't remove image if DICOM. User may have selected segment group image as primary selection by now\n    const deleteImage = isRegularImage(imageID);\n    if (deleteImage) {\n      imageStore.deleteData(imageID);\n    }\n\n    const componentCount = childImage\n      .getPointData()\n      .getScalars()\n      .getNumberOfComponents();\n    // for each component, create create new vtkImageData with just one component, pulled from each component of childImage\n    const images =\n      componentCount === 1 ? [childImage] : extractEachComponent(childImage);\n\n    images.forEach(async (image, component) => {\n      const matchingParentSpace = await ensureSameSpace(\n        parentImage,\n        image,\n        true\n      );\n      const labelmapImage = toLabelMap(matchingParentSpace);\n\n      const segments = await decodeSegments(imageID, labelmapImage, component);\n      const { order, byKey } = normalizeForStore(segments, 'value');\n      const segmentGroupStore = useSegmentGroupStore();\n\n      const name = pickUniqueName(\n        (index: number) => `${baseName} ${numberer(index)}`,\n        parentID\n      );\n      segmentGroupStore.addLabelmap(labelmapImage, {\n        name,\n        parentImage: parentID,\n        segments: { order, byValue: byKey },\n      });\n    });\n  }\n\n  /**\n   * Updates a labelmap's metadata\n   * @param segmentGroupID\n   * @param metadata\n   */\n  function updateMetadata(\n    segmentGroupID: string,\n    metadata: Partial<SegmentGroupMetadata>\n  ) {\n    metadataByID[segmentGroupID] = {\n      ...getMetadata(segmentGroupID),\n      ...metadata,\n    };\n  }\n\n  /**\n   * Creates a new default segment with an unallocated value.\n   *\n   * The value picked is the smallest unused value greater than 0.\n   * @param segmentGroupID\n   */\n  function createNewSegment(segmentGroupID: string): SegmentMask {\n    const { segments } = getMetadata(segmentGroupID);\n\n    let value = 1;\n    for (; value <= segments.order.length; value++) {\n      if (!(value in segments.byValue)) break;\n    }\n\n    return {\n      name: makeDefaultSegmentName(value),\n      value,\n      color: [...getNextColor()],\n      visible: true,\n    };\n  }\n\n  /**\n   * Adds a segment to a labelmap.\n   *\n   * If no segment is provided, a default one is provided.\n   * Duplicate segment values throw an error.\n   * @param segmentGroupID\n   * @param segment\n   */\n  function addSegment(segmentGroupID: string, segment?: SegmentMask) {\n    const metadata = getMetadata(segmentGroupID);\n    const seg = segment ?? createNewSegment(segmentGroupID);\n    if (!validateSegment(segmentGroupID, seg))\n      throw new Error('Invalid segment');\n    metadata.segments.byValue[seg.value] = seg;\n    metadata.segments.order.push(seg.value);\n  }\n\n  /**\n   * Updates a segment's properties.\n   *\n   * Does not allow updating the segment value.\n   * @param segmentGroupID\n   * @param segmentValue\n   * @param segmentUpdate\n   */\n  function updateSegment(\n    segmentGroupID: string,\n    segmentValue: number,\n    segmentUpdate: Partial<Omit<SegmentMask, 'value'>>\n  ) {\n    const metadata = getMetadata(segmentGroupID);\n    const segment = getSegment(segmentGroupID, segmentValue);\n    metadata.segments.byValue[segmentValue] = {\n      ...segment,\n      ...segmentUpdate,\n    };\n  }\n\n  /**\n   * Deletes a segment from a labelmap.\n   * @param segmentGroupID\n   * @param segmentValue\n   */\n  function deleteSegment(segmentGroupID: string, segmentValue: number) {\n    const { segments } = getMetadata(segmentGroupID);\n    removeFromArray(segments.order, segmentValue);\n    delete segments.byValue[segmentValue];\n\n    dataIndex[segmentGroupID].replaceLabelValue(\n      segmentValue,\n      LABELMAP_BACKGROUND_VALUE\n    );\n  }\n\n  const saveFormat = ref('vti');\n\n  /**\n   * Serializes the store's state.\n   */\n  async function serialize(state: StateFile) {\n    const { zip } = state;\n\n    // orderByParent is implicitly preserved based on\n    // the order of serialized entries.\n\n    const parents = Object.keys(orderByParent.value);\n    const serialized = parents.flatMap((parentID) => {\n      const segmentGroupIDs = orderByParent.value[parentID];\n      return segmentGroupIDs.map((id) => {\n        const metadata = metadataByID[id];\n        return {\n          id,\n          path: `labels/${id}.${saveFormat.value}`,\n          metadata: {\n            ...metadata,\n            parentImage: metadata.parentImage,\n          },\n        };\n      });\n    });\n\n    state.manifest.labelMaps = serialized;\n\n    // save labelmap images\n    await Promise.all(\n      serialized.map(async ({ id, path }) => {\n        const vtkImage = dataIndex[id];\n        const serializedImage = await writeImage(saveFormat.value, vtkImage);\n        zip.file(path, serializedImage);\n      })\n    );\n  }\n\n  /**\n   * Rehydrates the store's state.\n   */\n  async function deserialize(\n    this: _This,\n    manifest: Manifest,\n    stateFiles: FileEntry[],\n    dataIDMap: Record<string, string>\n  ) {\n    const { labelMaps } = manifest;\n\n    const segmentGroupIDMap: Record<string, string> = {};\n\n    // First restore the data, then restore the store.\n    // This preserves ordering from orderByParent.\n\n    const newLabelmapIDs = await Promise.all(\n      labelMaps.map(async (labelMap) => {\n        const [file] = stateFiles\n          .filter(\n            (entry) =>\n              join(entry.archivePath, entry.file.name) ===\n              normalize(labelMap.path)\n          )\n          .map((entry) => entry.file);\n\n        const vtkImage = await readImage(file);\n        const labelmapImage = toLabelMap(vtkImage);\n\n        const id = useIdStore().nextId();\n        dataIndex[id] = labelmapImage;\n        return id;\n      })\n    );\n\n    labelMaps.forEach((labelMap, index) => {\n      const { metadata } = labelMap;\n      // map parent id to new id\n      const parentImage = dataIDMap[metadata.parentImage];\n      metadata.parentImage = parentImage;\n\n      const newID = newLabelmapIDs[index];\n      segmentGroupIDMap[labelMap.id] = newID;\n\n      metadataByID[newID] = metadata;\n      orderByParent.value[parentImage] ??= [];\n      orderByParent.value[parentImage].push(newID);\n    });\n\n    return segmentGroupIDMap;\n  }\n\n  // --- sync segments --- //\n\n  const segmentByGroupID = computed(() => {\n    return Object.entries(metadataByID).reduce<Record<string, SegmentMask[]>>(\n      (acc, [id, metadata]) => {\n        const {\n          segments: { order, byValue },\n        } = metadata;\n        const segments = order.map((value) => byValue[value]);\n        return { ...acc, [id]: segments };\n      },\n      {}\n    );\n  });\n\n  watch(\n    segmentByGroupID,\n    (segsByID) => {\n      Object.entries(segsByID).forEach(([id, segments]) => {\n        // ensure segments are not proxies\n        dataIndex[id].setSegments(toRaw(segments).map((seg) => toRaw(seg)));\n      });\n    },\n    { immediate: true }\n  );\n\n  // --- handle deletions --- //\n\n  onImageDeleted((deleted) => {\n    deleted.forEach((parentID) => {\n      orderByParent.value[parentID].forEach((segmentGroupID) => {\n        removeGroup(segmentGroupID);\n      });\n    });\n  });\n\n  // --- api --- //\n\n  return {\n    dataIndex,\n    metadataByID,\n    orderByParent,\n    segmentByGroupID,\n    saveFormat,\n    addLabelmap,\n    newLabelmapFromImage,\n    removeGroup,\n    convertImageToLabelmap,\n    updateMetadata,\n    addSegment,\n    getSegment,\n    updateSegment,\n    deleteSegment,\n    serialize,\n    deserialize,\n  };\n});\n","import { getImageSpatialExtent } from '@/src/composables/useCurrentImage';\nimport { LPSAxis } from '@/src/types/lps';\nimport { getAxisBounds } from '@/src/utils/lps';\nimport { NOOP } from '@/src/constants';\nimport vtkPlane from '@kitware/vtk.js/Common/DataModel/Plane';\nimport type { Vector2, Vector3 } from '@kitware/vtk.js/types';\nimport { computed, reactive, readonly, unref } from 'vue';\nimport { MaybeRef } from '@vueuse/core';\nimport { vec3 } from 'gl-matrix';\nimport { defineStore } from 'pinia';\nimport { arrayEqualsWithComparator } from '@/src/utils';\nimport { Maybe } from '@/src/types';\nimport { useImageStore } from '../datasets-images';\nimport { LPSCroppingPlanes } from '../../types/crop';\nimport { ImageMetadata } from '../../types/image';\nimport { StateFile, Manifest } from '../../io/state-file/schema';\n\ntype Plane = {\n  origin: Vector3;\n  normal: Vector3;\n};\n\nfunction clampRangeToBounds(range: Vector2, bounds: Vector2) {\n  return [\n    Math.max(bounds[0], Math.min(bounds[1], range[0])),\n    Math.max(bounds[0], Math.min(bounds[1], range[1])),\n  ] as Vector2;\n}\n\n/**\n * Converts a cropping boundary to a plane origin + normal.\n * @param cropBounds\n * @param metadata\n * @param axis\n * @param lowerUpper 0 for the lower boundary, 1 for the upper boundary\n * @returns\n */\nfunction convertCropBoundaryToPlane(\n  cropBounds: LPSCroppingPlanes,\n  metadata: ImageMetadata,\n  axis: LPSAxis,\n  lowerUpper: 0 | 1\n): Plane {\n  const { indexToWorld, orientation, lpsOrientation: lpsDirs } = metadata;\n\n  const origin = [0, 0, 0] as Vector3;\n  const axisIndex = lpsDirs[axis];\n  origin[axisIndex] = cropBounds[axis][lowerUpper];\n  vec3.transformMat4(origin, origin, indexToWorld);\n\n  // The lower bound normal is the associated column in the\n  // image orientation matrix. The upper bound normal is the\n  // lower bound normal, but negated.\n  // 0|1 => 1|-1\n  const neg = -(lowerUpper * 2 - 1);\n  const normal = [\n    ...orientation.slice(axisIndex * 3, axisIndex * 3 + 3).map((c) => c * neg),\n  ] as Vector3;\n\n  return { origin, normal };\n}\n\n/**\n * Re-orients the lower/upper plane normals to point at each other.\n *\n * Assumes the planes are parallel.\n * @param lowerPlane\n * @param upperPlane\n */\nfunction reorientBoundaryNormals(lowerPlane: Plane, upperPlane: Plane) {\n  const lowerToUpper = lowerPlane.normal;\n  vec3.sub(lowerToUpper, upperPlane.origin, lowerPlane.origin);\n  vec3.normalize(lowerToUpper, lowerToUpper);\n  vec3.negate(upperPlane.normal, lowerPlane.normal);\n}\n\nexport function croppingPlanesEqual(a1: vtkPlane[], a2: vtkPlane[]) {\n  return arrayEqualsWithComparator<vtkPlane>(a1, a2, (p1, p2) => {\n    return (\n      vec3.equals(p1.getOrigin(), p2.getOrigin()) &&\n      vec3.equals(p1.getNormal(), p2.getNormal())\n    );\n  });\n}\n\nexport const useCropStore = defineStore('crop', () => {\n  const imageStore = useImageStore();\n\n  const state = reactive({\n    croppingByImageID: {} as Record<string, LPSCroppingPlanes>,\n  });\n\n  const getComputedVTKPlanes = (imageID: MaybeRef<Maybe<string>>) =>\n    computed(() => {\n      const id = unref(imageID);\n      if (id && id in state.croppingByImageID && id in imageStore.metadata) {\n        const cropBounds = state.croppingByImageID[id];\n        const metadata = imageStore.metadata[id];\n        const planes = [\n          convertCropBoundaryToPlane(cropBounds, metadata, 'Sagittal', 0),\n          convertCropBoundaryToPlane(cropBounds, metadata, 'Sagittal', 1),\n          convertCropBoundaryToPlane(cropBounds, metadata, 'Coronal', 0),\n          convertCropBoundaryToPlane(cropBounds, metadata, 'Coronal', 1),\n          convertCropBoundaryToPlane(cropBounds, metadata, 'Axial', 0),\n          convertCropBoundaryToPlane(cropBounds, metadata, 'Axial', 1),\n        ];\n\n        reorientBoundaryNormals(planes[0], planes[1]);\n        reorientBoundaryNormals(planes[2], planes[3]);\n        reorientBoundaryNormals(planes[4], planes[5]);\n\n        return planes.map((plane) => vtkPlane.newInstance(plane));\n      }\n      return null;\n    });\n\n  const clampCroppingPlanes = (\n    imageID: string,\n    planes: LPSCroppingPlanes\n  ): LPSCroppingPlanes => {\n    const lpsBounds = getImageSpatialExtent(imageID);\n    // if perf becomes an issue, change this to modify the planes arg\n    return {\n      Sagittal: clampRangeToBounds(planes.Sagittal, lpsBounds.Sagittal),\n      Coronal: clampRangeToBounds(planes.Coronal, lpsBounds.Coronal),\n      Axial: clampRangeToBounds(planes.Axial, lpsBounds.Axial),\n    };\n  };\n\n  const setCropping = (imageID: string, planes: LPSCroppingPlanes) => {\n    state.croppingByImageID[imageID] = clampCroppingPlanes(imageID, planes);\n  };\n\n  const setCroppingForAxis = (\n    imageID: string,\n    axis: LPSAxis,\n    planes: Vector2\n  ) => {\n    if (imageID in state.croppingByImageID) {\n      setCropping(imageID, {\n        ...state.croppingByImageID[imageID],\n        [axis]: planes,\n      });\n    }\n  };\n\n  const resetCropping = (imageID: string) => {\n    const image = imageStore.dataIndex[imageID];\n    if (!image) return;\n\n    const { lpsOrientation } = imageStore.metadata[imageID];\n    const extent = image.getSpatialExtent();\n    setCropping(imageID, {\n      Sagittal: getAxisBounds(extent, 'Sagittal', lpsOrientation),\n      Coronal: getAxisBounds(extent, 'Coronal', lpsOrientation),\n      Axial: getAxisBounds(extent, 'Axial', lpsOrientation),\n    });\n  };\n\n  function serialize(stateFile: StateFile) {\n    const { tools } = stateFile.manifest;\n    tools.crop = state.croppingByImageID;\n  }\n\n  function deserialize(manifest: Manifest, dataIDMap: Record<string, string>) {\n    const cropping = manifest.tools.crop;\n\n    Object.entries(cropping).forEach(([imageID, planes]) => {\n      const newImageID = dataIDMap[imageID];\n      setCropping(newImageID, planes);\n    });\n  }\n\n  const activateTool = () => true;\n  const deactivateTool = NOOP;\n\n  return {\n    croppingByImageID: readonly(state.croppingByImageID),\n    getComputedVTKPlanes,\n    setCropping,\n    setCroppingForAxis,\n    resetCropping,\n    serialize,\n    deserialize,\n    activateTool,\n    deactivateTool,\n  };\n});\n","import type { Bounds, Vector3 } from '@kitware/vtk.js/types';\nimport vtkStateBuilder from '@kitware/vtk.js/Widgets/Core/StateBuilder';\nimport vtkWidgetState from '@kitware/vtk.js/Widgets/Core/WidgetState';\nimport { mat4 } from 'gl-matrix';\n\nexport interface CrosshairsHandleWidgetState extends vtkWidgetState {\n  setOrigin(origin: Vector3 | null): boolean;\n  getOrigin(): Vector3 | null;\n  setScale1(scale: number): boolean;\n  getScale1(): number;\n  setVisible(visible: boolean): boolean;\n  getVisible(): boolean;\n  setBounds(bounds: Bounds): boolean;\n  getBounds(): Bounds;\n}\n\nexport interface CrosshairsWidgetState extends vtkWidgetState {\n  setPlaced(placed: boolean): boolean;\n  getPlaced(): boolean;\n  setIndexToWorld(indexToWorld: mat4): boolean;\n  getIndexToWorld(): mat4;\n  setWorldToIndex(worldToIndex: mat4): boolean;\n  getWorldToIndex(): mat4;\n  getHandle(): CrosshairsHandleWidgetState;\n}\n\nexport default function generateState() {\n  return vtkStateBuilder\n    .createBuilder()\n    .addField({\n      name: 'placed',\n      initialValue: false,\n    })\n    .addField({\n      name: 'indexToWorld',\n      initialValue: [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],\n    })\n    .addField({\n      name: 'worldToIndex',\n      initialValue: [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],\n    })\n    .addStateFromMixin({\n      labels: ['handle'],\n      mixins: ['origin', 'bounds'],\n      name: 'handle',\n      initialValues: {\n        origin: null,\n      },\n    })\n    .build();\n}\n","import macro from '@kitware/vtk.js/macro';\nimport type { Bounds } from '@kitware/vtk.js/types';\nimport { vec3 } from 'gl-matrix';\n\nfunction clampPointToBounds(bounds: Bounds, point: vec3) {\n  return point.map((p, i) =>\n    Math.max(bounds[i * 2], Math.min(bounds[i * 2 + 1], p))\n  ) as vec3;\n}\n\nexport default function widgetBehavior(publicAPI: any, model: any) {\n  model.classHierarchy.push('vtkCrosshairsWidgetProp');\n  let isDragging = false;\n\n  // support setting per-view widget manipulators\n  macro.setGet(publicAPI, model, ['manipulator']);\n\n  // --------------------------------------------------------------------------\n  // Interactor events\n  // --------------------------------------------------------------------------\n\n  function ignoreKey(e: any) {\n    return e.altKey || e.controlKey || e.shiftKey;\n  }\n\n  // --------------------------------------------------------------------------\n  // Left press: Select handle to drag\n  // --------------------------------------------------------------------------\n\n  publicAPI.handleLeftButtonPress = (e: any) => {\n    if (!model.pickable || ignoreKey(e)) {\n      return macro.VOID;\n    }\n\n    model.widgetState.setPlaced(true);\n    isDragging = true;\n    model._interactor.requestAnimation(publicAPI);\n    model._apiSpecificRenderWindow.setCursor('crosshairs');\n    publicAPI.invokeStartInteractionEvent();\n    publicAPI.handleMouseMove(e);\n    return macro.EVENT_ABORT;\n  };\n\n  // --------------------------------------------------------------------------\n  // Mouse move: Drag selected handle / Handle follow the mouse\n  // --------------------------------------------------------------------------\n\n  publicAPI.handleMouseMove = (callData: any) => {\n    // technically need to call requestAnimation during\n    // the initial phase of placing the crosshairs,\n    // but that's not needed since no VTK object\n    // is actually being rendered.\n\n    if (\n      (!model.widgetState.getPlaced() || isDragging) &&\n      model.pickable &&\n      model.manipulator &&\n      !ignoreKey(callData)\n    ) {\n      const { worldCoords: worldCoordsOfPointer } =\n        model.manipulator.handleEvent(callData, model._apiSpecificRenderWindow);\n\n      const handle = model.widgetState.getHandle();\n      const worldToIndex = model.widgetState.getWorldToIndex();\n      const indexToWorld = model.widgetState.getIndexToWorld();\n      if (worldToIndex.length && indexToWorld.length) {\n        const indexCoordsOfPointer = vec3.create();\n        const worldOrigin = vec3.create();\n        const bounds = handle.getBounds();\n\n        vec3.transformMat4(\n          indexCoordsOfPointer,\n          worldCoordsOfPointer,\n          worldToIndex\n        );\n        const indexOrigin = clampPointToBounds(bounds, indexCoordsOfPointer);\n        vec3.transformMat4(worldOrigin, indexOrigin, indexToWorld);\n\n        handle.setOrigin(worldOrigin);\n        publicAPI.invokeInteractionEvent();\n        return macro.EVENT_ABORT;\n      }\n    }\n\n    return macro.VOID;\n  };\n\n  // --------------------------------------------------------------------------\n  // Left release: Finish drag / Create new handle\n  // --------------------------------------------------------------------------\n\n  publicAPI.handleLeftButtonRelease = () => {\n    if (isDragging && model.pickable) {\n      model._interactor.cancelAnimation(publicAPI);\n      model._apiSpecificRenderWindow.setCursor('default');\n      publicAPI.invokeEndInteractionEvent();\n    }\n    isDragging = false;\n  };\n\n  // --------------------------------------------------------------------------\n  // Focus API - modeHandle follow mouse when widget has focus\n  // --------------------------------------------------------------------------\n\n  publicAPI.grabFocus = () => {};\n\n  // --------------------------------------------------------------------------\n\n  publicAPI.loseFocus = () => {};\n}\n","import macro from '@kitware/vtk.js/macro';\nimport vtkAbstractWidgetFactory from '@kitware/vtk.js/Widgets/Core/AbstractWidgetFactory';\nimport vtkPlanePointManipulator from '@kitware/vtk.js/Widgets/Manipulators/PlaneManipulator';\n\nimport { ViewTypes } from '@kitware/vtk.js/Widgets/Core/WidgetManager/Constants';\n\nimport stateGenerator from './state';\nimport widgetBehavior from './behavior';\n\n// ----------------------------------------------------------------------------\n// Factory\n// ----------------------------------------------------------------------------\n\nfunction vtkCrosshairsWidget(publicAPI, model) {\n  model.classHierarchy.push('vtkCrosshairsWidget');\n\n  // --- Widget Requirement ---------------------------------------------------\n\n  model.behavior = widgetBehavior;\n  model.widgetState = stateGenerator();\n\n  publicAPI.getRepresentationsForViewType = (viewType) => {\n    switch (viewType) {\n      case ViewTypes.DEFAULT:\n      case ViewTypes.GEOMETRY:\n      case ViewTypes.SLICE:\n      case ViewTypes.VOLUME:\n      default:\n        return [];\n    }\n  };\n\n  // --------------------------------------------------------------------------\n  // initialization\n  // --------------------------------------------------------------------------\n\n  model.widgetState.onBoundsChange((bounds) => {\n    const center = [\n      (bounds[0] + bounds[1]) * 0.5,\n      (bounds[2] + bounds[3]) * 0.5,\n      (bounds[4] + bounds[5]) * 0.5,\n    ];\n    model.widgetState.getHandle().setOrigin(center);\n  });\n\n  // Default manipulator\n  model.manipulator = vtkPlanePointManipulator.newInstance();\n}\n\n// ----------------------------------------------------------------------------\n\nconst DEFAULT_VALUES = {\n  // manipulator: null,\n};\n\n// ----------------------------------------------------------------------------\n\nexport function extend(publicAPI, model, initialValues = {}) {\n  Object.assign(model, DEFAULT_VALUES, initialValues);\n\n  vtkAbstractWidgetFactory.extend(publicAPI, model, initialValues);\n  macro.setGet(publicAPI, model, ['manipulator']);\n\n  vtkCrosshairsWidget(publicAPI, model);\n}\n\n// ----------------------------------------------------------------------------\n\nexport const newInstance = macro.newInstance(extend, 'vtkCrosshairsWidget');\n\n// ----------------------------------------------------------------------------\n\nexport default { newInstance, extend };\n","import { useCurrentImage } from '@/src/composables/useCurrentImage';\nimport vtkCrosshairsWidget from '@/src/vtk/CrosshairsWidget';\nimport type { Bounds, Vector3 } from '@kitware/vtk.js/types';\nimport { inflate } from '@kitware/vtk.js/Common/DataModel/BoundingBox';\nimport { computed, ref, unref, watch } from 'vue';\nimport { vec3 } from 'gl-matrix';\nimport { defineStore } from 'pinia';\nimport { getLPSAxisFromDir } from '@/src/utils/lps';\nimport { Manifest, StateFile } from '@/src/io/state-file/schema';\nimport { useViewStore } from '../views';\nimport useViewSliceStore from '../view-configs/slicing';\n\nexport const useCrosshairsToolStore = defineStore('crosshairs', () => {\n  type _This = ReturnType<typeof useCrosshairsToolStore>;\n\n  const factory = vtkCrosshairsWidget.newInstance();\n  const widgetState = factory.getWidgetState();\n  const handle = widgetState.getHandle();\n\n  const active = ref(false);\n  const { currentImageID, currentImageMetadata } = useCurrentImage();\n\n  // world-space\n  const position = ref<Vector3>([0, 0, 0]);\n  // image space\n  const imagePosition = computed(() => {\n    const out = vec3.create();\n    vec3.transformMat4(\n      out,\n      position.value,\n      currentImageMetadata.value.worldToIndex\n    );\n    return out as Vector3;\n  });\n\n  const viewSliceStore = useViewSliceStore();\n  const viewStore = useViewStore();\n\n  // only gets views that have a slicing config\n  const currentViewIDs = computed(() => {\n    const imageID = unref(currentImageID);\n    if (imageID) {\n      return viewStore.viewIDs.filter(\n        (viewID) => !!viewSliceStore.getConfig(viewID, imageID)\n      );\n    }\n    return [];\n  });\n\n  function getWidgetFactory(this: _This) {\n    return factory;\n  }\n\n  function setPosition(pos: Vector3) {\n    position.value = pos;\n  }\n\n  // update the slicing\n  watch(imagePosition, (indexPos) => {\n    if (active.value) {\n      const imageID = unref(currentImageID);\n      const { lpsOrientation } = unref(currentImageMetadata);\n\n      if (!imageID) {\n        return;\n      }\n\n      currentViewIDs.value.forEach((viewID) => {\n        const sliceConfig = viewSliceStore.getConfig(viewID, imageID);\n        const axis = getLPSAxisFromDir(sliceConfig!.axisDirection);\n        const index = lpsOrientation[axis];\n        const slice = Math.round(indexPos[index]);\n        viewSliceStore.updateConfig(viewID, imageID, { slice });\n      });\n    }\n  });\n\n  // update widget state based on current image\n  watch(\n    currentImageMetadata,\n    (metadata) => {\n      widgetState.setIndexToWorld(metadata.indexToWorld);\n      widgetState.setWorldToIndex(metadata.worldToIndex);\n      const [xDim, yDim, zDim] = metadata.dimensions;\n      const imageBounds: Bounds = [0, xDim - 1, 0, yDim - 1, 0, zDim - 1];\n      // inflate by 0.5, since the image slice rendering is inflated\n      // by 0.5.\n      handle.setBounds(inflate(imageBounds, 0.5));\n    },\n    { immediate: true }\n  );\n\n  // update the position\n  handle.onModified(() => {\n    const origin = handle.getOrigin();\n    if (origin) {\n      position.value = origin;\n    }\n  });\n\n  function activateTool() {\n    widgetState.setPlaced(false);\n    active.value = true;\n    return true;\n  }\n\n  function deactivateTool() {\n    active.value = false;\n  }\n\n  function serialize(state: StateFile) {\n    const { crosshairs } = state.manifest.tools;\n    crosshairs.position = position.value;\n  }\n\n  function deserialize(manifest: Manifest) {\n    const { crosshairs } = manifest.tools;\n    position.value = crosshairs.position;\n  }\n\n  return {\n    getWidgetFactory,\n    setPosition,\n    position,\n    imagePosition,\n    activateTool,\n    deactivateTool,\n    serialize,\n    deserialize,\n  };\n});\n","import vtkPolyData from '@kitware/vtk.js/Common/DataModel/PolyData';\nimport vtkActor2D from '@kitware/vtk.js/Rendering/Core/Actor2D';\nimport vtkContextRepresentation from '@kitware/vtk.js/Widgets/Representations/ContextRepresentation';\nimport vtkWidgetRepresentation from '@kitware/vtk.js/Widgets/Representations/WidgetRepresentation';\nimport macro from '@kitware/vtk.js/macros';\nimport vtkMapper2D from '@kitware/vtk.js/Rendering/Core/Mapper2D';\nimport vtkCoordinate from '@kitware/vtk.js/Rendering/Core/Coordinate';\nimport { Coordinate } from '@kitware/vtk.js/Rendering/Core/Coordinate/Constants';\nimport { Representation } from '@kitware/vtk.js/Rendering/Core/Property/Constants';\nimport { DisplayLocation } from '@kitware/vtk.js/Rendering/Core/Property2D/Constants';\nimport { vec3 } from 'gl-matrix';\n\nfunction generateContour({ stencil, location, slicingIndex, indexToWorld }) {\n  const [xdim, ydim] = stencil.size;\n  const xoffset = Math.floor((xdim - 1) / 2);\n  const yoffset = Math.floor((ydim - 1) / 2);\n\n  // grid of corner points (top-left to bottom-right)\n  const gridxdim = xdim + 1;\n  const gridydim = ydim + 1;\n\n  const vertices = []; // arr of 3-tuples\n  const lines = []; // arr of 2-tuples of vertex indices\n\n  // maps grid x/y to vertex index\n  const vertexMap = {};\n  const getOrCreateVertexIndex = (x, y) => {\n    const key = `${x},${y}`;\n    if (key in vertexMap) {\n      return vertexMap[key];\n    }\n\n    const indexCoords = [...location].map((val) => Math.round(val));\n    if (slicingIndex === 0) {\n      indexCoords[1] += x - xoffset - 0.5;\n      indexCoords[2] += y - yoffset - 0.5;\n    } else if (slicingIndex === 1) {\n      indexCoords[0] += x - xoffset - 0.5;\n      indexCoords[2] += y - yoffset - 0.5;\n    } else if (slicingIndex === 2) {\n      indexCoords[0] += x - xoffset - 0.5;\n      indexCoords[1] += y - yoffset - 0.5;\n    }\n\n    // get the grid point x/y's actual vertex in world space\n    // since grid x/y represents the top-left of the actual pixel\n    // at x/y, the true continuous index value of the vertex\n    // is x-0.5/y-0.5.\n\n    const worldCoords = [];\n    vec3.transformMat4(worldCoords, indexCoords, indexToWorld);\n    vertices.push(worldCoords);\n\n    const index = vertices.length - 1;\n    vertexMap[key] = index;\n    return index;\n  };\n\n  const getStampPixelAt = (x, y) => {\n    if (x < 0 || x >= xdim) return 0;\n    if (y < 0 || y >= ydim) return 0;\n    return stencil.pixels[y * xdim + x] || 0;\n  };\n\n  for (let gy = 0; gy < gridydim; gy++) {\n    for (let gx = 0; gx < gridxdim; gx++) {\n      // evaluate point to see if it needs inclusion\n      // by looking at all 4 pixels that share this point\n      // as a corner.\n      // if all empty or all filled, the current point is\n      // not used in the contour.\n      const count =\n        getStampPixelAt(gx, gy) +\n        getStampPixelAt(gx - 1, gy) +\n        getStampPixelAt(gx, gy - 1) +\n        getStampPixelAt(gx - 1, gy - 1);\n\n      if (count > 0 && count < 4) {\n        const v0 = getOrCreateVertexIndex(gx, gy);\n\n        // now do line check. We look at the east and south lines.\n        // east first\n        if (getStampPixelAt(gx, gy) !== getStampPixelAt(gx, gy - 1)) {\n          const v1 = getOrCreateVertexIndex(gx + 1, gy);\n          lines.push([v0, v1]);\n        }\n        // south next\n        if (getStampPixelAt(gx, gy) !== getStampPixelAt(gx - 1, gy)) {\n          const v1 = getOrCreateVertexIndex(gx, gy + 1);\n          lines.push([v0, v1]);\n        }\n      }\n    }\n  }\n\n  return {\n    points: new Float32Array(vertices.flat()),\n    lines: new Uint16Array(lines.map(([v0, v1]) => [2, v0, v1]).flat()),\n  };\n}\n\nfunction vtkPaintBrushContextRepresentation(publicAPI, model) {\n  model.classHierarchy.push('vtkPaintBrushContextRepresentation');\n\n  model.internalPolyData = vtkPolyData.newInstance({ mtime: 0 });\n  model.internalArrays = {\n    points: model.internalPolyData.getPoints(),\n    lines: model.internalPolyData.getLines(),\n  };\n\n  model.pipelines = {\n    brush: {\n      source: publicAPI,\n      mapper: vtkMapper2D.newInstance({\n        transformCoordinate: vtkCoordinate.newInstance({\n          coordinateSystem: Coordinate.WORLD,\n        }),\n      }),\n      actor: vtkActor2D.newInstance({ pickable: false, parentProp: publicAPI }),\n    },\n  };\n\n  const actorProperty = model.pipelines.brush.actor.getProperty();\n  actorProperty.setLineWidth(2);\n  actorProperty.setColor([1, 0, 0]);\n  actorProperty.setDisplayLocation(DisplayLocation.FOREGROUND);\n  actorProperty.setRepresentation(Representation.SURFACE);\n\n  vtkWidgetRepresentation.connectPipeline(model.pipelines.brush);\n\n  publicAPI.addActor(model.pipelines.brush.actor);\n\n  publicAPI.requestData = (inData, outData) => {\n    const widgetState = inData[0];\n\n    const stencil = widgetState.getStencil();\n    const brush = widgetState.getBrush();\n    const { indexToWorld, worldToIndex } = model;\n\n    if (stencil && brush.getOrigin()) {\n      const location = [];\n      vec3.transformMat4(location, brush.getOrigin(), worldToIndex);\n\n      const contour = generateContour({\n        stencil,\n        location,\n        slicingIndex: model.slicingIndex,\n        indexToWorld,\n      });\n\n      const { points, lines } = model.internalArrays;\n      points.setData(contour.points);\n      lines.setData(contour.lines);\n\n      model.internalPolyData.modified();\n    }\n    outData[0] = model.internalPolyData;\n  };\n}\n\nconst DEFAULT_VALUES = {\n  defaultScale: 1,\n  drawBorder: false,\n  drawFace: true,\n  worldToIndex: null,\n  indexToWorld: null,\n  slicingIndex: 0,\n};\n\n// ----------------------------------------------------------------------------\n\nexport function extend(publicAPI, model, initialValues = {}) {\n  Object.assign(model, DEFAULT_VALUES, initialValues);\n  vtkContextRepresentation.extend(publicAPI, model, initialValues);\n  macro.setGet(publicAPI, model, [\n    'slicingIndex',\n    'indexToWorld',\n    'worldToIndex',\n  ]);\n  macro.get(publicAPI, model, ['mapper', 'actor']);\n  vtkPaintBrushContextRepresentation(publicAPI, model);\n}\n\n// ----------------------------------------------------------------------------\n\nexport const newInstance = macro.newInstance(\n  extend,\n  'vtkPaintBrushContextRepresentation'\n);\n\nexport default { newInstance, extend };\n","import { Maybe } from '@/src/types';\nimport { Store } from 'pinia';\n\nexport function watchStore<T>(\n  publicAPI: any,\n  store: Store,\n  getter: () => Maybe<T>,\n  cmp: (a: Maybe<T>, b: Maybe<T>) => boolean\n) {\n  let cached = getter();\n  const unsubscribe = store.$subscribe(() => {\n    const val = getter();\n    if (cmp ? cmp(cached, val) : cached !== val) {\n      cached = val;\n      publicAPI.modified();\n    }\n  });\n\n  const originalDelete = publicAPI.delete;\n  publicAPI.delete = () => {\n    unsubscribe();\n    originalDelete();\n  };\n}\n\nexport function watchState(\n  publicAPI: any,\n  state: any,\n  callback: () => unknown\n) {\n  let subscription = state.onModified(callback);\n  const originalDelete = publicAPI.delete;\n  publicAPI.delete = () => {\n    subscription.unsubscribe();\n    subscription = null;\n    originalDelete();\n  };\n}\n\nexport const computeWorldCoords = (model: any) => (event: any) => {\n  const manipulator =\n    model.activeState?.getManipulator?.() ?? model.manipulator;\n  if (!manipulator) {\n    console.error('No manipulator');\n    return undefined;\n  }\n  const { worldCoords } = manipulator.handleEvent(\n    event,\n    model._apiSpecificRenderWindow\n  );\n  if (!worldCoords)\n    console.warn('Event cannot be converted to world coordinates');\n  return worldCoords;\n};\n","import macro from '@kitware/vtk.js/macro';\nimport { computeWorldCoords } from '@/src/vtk/ToolWidgetUtils/utils';\n\nexport function shouldIgnoreEvent(e: any) {\n  return e.altKey || e.controlKey || e.shiftKey;\n}\n\nexport default function widgetBehavior(publicAPI: any, model: any) {\n  model.classHierarchy.push('vtkPaintWidgetProp');\n\n  const getWorldCoords = computeWorldCoords(model);\n\n  // support setting per-view widget manipulators\n  macro.setGet(publicAPI, model, ['manipulator']);\n\n  let isPainting = false;\n\n  /**\n   * Starts painting\n   */\n  publicAPI.handleLeftButtonPress = (eventData: any) => {\n    if (!model.manipulator || shouldIgnoreEvent(eventData)) {\n      return macro.VOID;\n    }\n\n    const worldCoords = getWorldCoords(eventData);\n    if (!worldCoords) {\n      return macro.VOID;\n    }\n\n    const brush = model.widgetState.getBrush();\n    brush.setOrigin(...worldCoords);\n\n    isPainting = true;\n    publicAPI.invokeStartInteractionEvent();\n    return macro.EVENT_ABORT;\n  };\n\n  /**\n   * Paints\n   */\n  publicAPI.handleMouseMove = (eventData: any) => {\n    if (shouldIgnoreEvent(eventData)) {\n      return macro.VOID;\n    }\n\n    const worldCoords = getWorldCoords(eventData);\n\n    if (!worldCoords) {\n      return macro.VOID;\n    }\n\n    const brush = model.widgetState.getBrush();\n    brush.setOrigin(...worldCoords);\n\n    if (isPainting) {\n      publicAPI.invokeInteractionEvent();\n      return macro.EVENT_ABORT;\n    }\n\n    // Let interactor get event\n    return macro.VOID;\n  };\n\n  /**\n   * Finishes paint\n   */\n  publicAPI.handleLeftButtonRelease = (eventData: any) => {\n    if (!isPainting || shouldIgnoreEvent(eventData)) {\n      return macro.VOID;\n    }\n\n    isPainting = false;\n    publicAPI.invokeEndInteractionEvent();\n    return macro.EVENT_ABORT;\n  };\n\n  publicAPI.handleMouseWheel = () => {\n    if (isPainting) {\n      return macro.EVENT_ABORT;\n    }\n    return macro.VOID;\n  };\n\n  publicAPI.grabFocus = () => {\n    if (!model.hasFocus) {\n      model.hasFocus = true;\n      model._interactor.requestAnimation(publicAPI);\n    }\n  };\n\n  publicAPI.loseFocus = () => {\n    if (model.hasFocus) {\n      model._interactor.cancelAnimation(publicAPI);\n    }\n    model.hasFocus = false;\n    // model._widgetManager.enablePicking();\n    // model._interactor.render();\n  };\n}\n","import { IBrushStencil } from '@/src/core/tools/paint/brush';\nimport type { Vector3 } from '@kitware/vtk.js/types';\nimport vtkStateBuilder from '@kitware/vtk.js/Widgets/Core/StateBuilder';\nimport vtkWidgetState from '@kitware/vtk.js/Widgets/Core/WidgetState';\n\nexport interface PaintPointWidgetState extends vtkWidgetState {\n  setOrigin(origin: Vector3 | null): boolean;\n  getOrigin(): Vector3 | null;\n  setScale1(scale: number): boolean;\n  getScale1(): number;\n  setVisible(visible: boolean): boolean;\n  getVisible(): boolean;\n  setColor(color: number): boolean;\n  getColor(): number;\n}\n\nexport interface PaintWidgetState extends vtkWidgetState {\n  getBrush(): PaintPointWidgetState;\n  getStencil(): IBrushStencil;\n  setStencil(stencil: IBrushStencil): boolean;\n}\n\nexport default function generateState() {\n  return vtkStateBuilder\n    .createBuilder()\n    .addStateFromMixin({\n      labels: ['brush'],\n      name: 'brush',\n      mixins: ['origin', 'scale1', 'visible', 'color'],\n      initialValues: {\n        scale1: 1,\n        origin: null,\n        visible: true,\n      },\n    })\n    .addField({\n      name: 'stencil',\n      initialValue: null,\n    })\n    .build() as PaintWidgetState;\n}\n","import macro from '@kitware/vtk.js/macro';\nimport vtkAbstractWidgetFactory from '@kitware/vtk.js/Widgets/Core/AbstractWidgetFactory';\nimport vtkPlanePointManipulator from '@kitware/vtk.js/Widgets/Manipulators/PlaneManipulator';\nimport vtkPaintBrushContextRepresentation from '@/src/vtk/PaintBrushContextRepresentation';\n\nimport widgetBehavior from './behavior';\nimport stateGenerator from './state';\n\nexport { shouldIgnoreEvent } from './behavior';\n\n// ----------------------------------------------------------------------------\n// Factory\n// ----------------------------------------------------------------------------\n\nfunction vtkPaintWidget(publicAPI, model) {\n  model.classHierarchy.push('vtkPaintWidget');\n\n  model.methodsToLink = ['slicingIndex', 'indexToWorld', 'worldToIndex'];\n\n  publicAPI.getRepresentationsForViewType = () => [\n    {\n      builder: vtkPaintBrushContextRepresentation,\n      labels: ['brush'],\n    },\n  ];\n\n  // Default manipulator\n  model.manipulator = vtkPlanePointManipulator.newInstance();\n}\n\n// ----------------------------------------------------------------------------\n\nconst DEFAULT_VALUES = {};\n\n// ----------------------------------------------------------------------------\n\nexport function extend(publicAPI, model, initialValues = {}) {\n  Object.assign(model, DEFAULT_VALUES, initialValues);\n\n  vtkAbstractWidgetFactory.extend(publicAPI, model, {\n    ...initialValues,\n    behavior: widgetBehavior,\n    widgetState: stateGenerator(),\n  });\n  macro.get(publicAPI, model, ['manipulator']);\n\n  vtkPaintWidget(publicAPI, model);\n}\n\n// ----------------------------------------------------------------------------\n\nexport const newInstance = macro.newInstance(extend, 'vtkPaintWidget');\n\n// ----------------------------------------------------------------------------\n\nexport default { newInstance, extend };\n","import type { Vector2 } from '@kitware/vtk.js/types';\nimport { IBrushStencil, IPaintBrush } from './brush';\n\n// Adapted from http://members.chello.at/easyfilter/bresenham.html\nfunction rasterizeEllipse(xdiam: number, ydiam: number) {\n  const buffer = new Uint8Array(xdiam * ydiam);\n\n  const putPixel = (x: number, y: number) => {\n    buffer[x + y * xdiam] = 1;\n  };\n\n  const blitLine = (x0: number, x1: number, y: number) => {\n    const start = y * xdiam + x0;\n    const end = start + (x1 - x0 + 1);\n    buffer.fill(1, start, end);\n  };\n\n  let x0 = 0;\n  let y0 = 0;\n  let x1 = xdiam - 1;\n  let y1 = ydiam - 1;\n\n  let a = x1;\n  let b = y1;\n  // eslint-disable-next-line no-bitwise\n  const b1 = b & 1;\n  let dx = 4 * (1 - a) * b * b;\n  let dy = 4 * (b1 + 1) * a * a;\n  let err = dx + dy + b1 * a * a;\n  let e2 = 0;\n\n  y0 += Math.floor((b + 1) / 2);\n  y1 = y0 - b1;\n  a *= 8 * a;\n  b *= 8 * b;\n  do {\n    blitLine(x0, x1, y0);\n    blitLine(x0, x1, y1);\n    e2 = 2 * err;\n    if (e2 <= dy) {\n      y0++;\n      y1--;\n      dy += a;\n      err += dy;\n    }\n    if (e2 >= dx || 2 * err > dy) {\n      x0++;\n      x1--;\n      dx += b;\n      err += dx;\n    }\n  } while (x0 <= x1);\n  while (y0 - y1 < ydiam) {\n    putPixel(x0 - 1, y0);\n    putPixel(x1 + 1, y0++);\n    putPixel(x0 - 1, y1);\n    putPixel(x1 + 1, y1--);\n  }\n\n  return buffer;\n}\n\nexport default class EllipsePaintBrush implements IPaintBrush {\n  private size: number = 1;\n  private scale: Vector2 = [1, 1];\n  private cachedStencil!: IBrushStencil;\n\n  constructor() {\n    this.recomputeStencil();\n  }\n\n  setSize(size: number) {\n    this.size = Math.max(0, size);\n    this.recomputeStencil();\n  }\n\n  setScale(scale: Vector2) {\n    this.scale = scale;\n    this.recomputeStencil();\n  }\n\n  private recomputeStencil() {\n    const scaledSize = [\n      Math.ceil(this.size * this.scale[0]),\n      Math.ceil(this.size * this.scale[1]),\n    ] as Vector2;\n    this.cachedStencil = {\n      size: scaledSize,\n      pixels: rasterizeEllipse(scaledSize[0], scaledSize[1]),\n    };\n  }\n\n  getStencil() {\n    return this.cachedStencil;\n  }\n}\n","import vtkLabelMap from '@/src/vtk/LabelMap';\nimport vtkPaintWidget from '@/src/vtk/PaintWidget';\nimport type { Vector2 } from '@kitware/vtk.js/types';\nimport { vec3 } from 'gl-matrix';\nimport { Maybe } from '@/src/types';\nimport { IPaintBrush } from './brush';\nimport EllipsePaintBrush from './ellipse-brush';\n\nexport const ERASE_BRUSH_VALUE = 0;\n\nexport enum PaintMode {\n  CirclePaint,\n  Erase,\n}\n\nexport default class PaintTool {\n  readonly factory: vtkPaintWidget;\n  private mode: PaintMode;\n  private brush: IPaintBrush;\n  private brushValue: Maybe<number>;\n\n  constructor() {\n    this.factory = vtkPaintWidget.newInstance();\n    this.brush = new EllipsePaintBrush();\n    this.brushValue = 1;\n    this.mode = PaintMode.CirclePaint;\n  }\n\n  private updateWidgetStencil() {\n    // use unscaled stencil for paint outline\n    const stencil = this.brush.getStencil();\n    const widgetState = this.factory.getWidgetState();\n    widgetState.setStencil(stencil);\n  }\n\n  setBrushSize(size: number) {\n    this.brush.setSize(size);\n    this.updateWidgetStencil();\n  }\n\n  setBrushScale(scale: Vector2) {\n    this.brush.setScale(scale);\n    this.updateWidgetStencil();\n  }\n\n  setMode(mode: PaintMode) {\n    this.mode = mode;\n  }\n\n  /**\n   * Sets the brush value.\n   *\n   * If the brush value is null | undefined, then no paint will occur.\n   * @param value\n   */\n  setBrushValue(value: Maybe<number>) {\n    this.brushValue = value;\n  }\n\n  /**\n   * Adds paint to a labelmap.\n   *\n   * If endPoint is specified, then linearly interpolates the brush\n   * from the start to the end.\n   *\n   * Assumption: startPoint and endPoint are on the same slice axis.\n   *\n   * @param labelmap paint in this labelmap\n   * @param sliceAxis Which index-space axis to paint on (0, 1, or 2).\n   * @param startPoint start point\n   * @param endPoint ending point (optional)\n   */\n  paintLabelmap(\n    labelmap: vtkLabelMap,\n    sliceAxis: 0 | 1 | 2,\n    startPoint: vec3,\n    endPoint?: vec3\n  ) {\n    if (this.brushValue == null) return;\n\n    const brushValue =\n      this.mode === PaintMode.Erase ? ERASE_BRUSH_VALUE : this.brushValue;\n    const stencil = this.brush.getStencil();\n\n    const start = [\n      // transforms + floating point errors can make zero values occasionally\n      // turn into really tiny negative values\n      ...startPoint.map((val) => Math.round(val)),\n    ];\n    // Assumption: startPoint and endPoint are on the same slice axis.\n    const ijkSlice = start[sliceAxis];\n    start.splice(sliceAxis, 1);\n\n    let end = [...start];\n    if (endPoint) {\n      end = [...endPoint.map((val) => Math.round(val))];\n      end.splice(sliceAxis, 1);\n    }\n\n    const labelmapPixels = labelmap.getPointData().getScalars().getData();\n    const labelmapDims = labelmap.getDimensions();\n    const jStride = labelmapDims[0];\n    const kStride = labelmapDims[0] * labelmapDims[1];\n\n    const isInBounds = (point: number[]) =>\n      point[0] >= 0 &&\n      point[1] >= 0 &&\n      point[2] >= 0 &&\n      point[0] < labelmapDims[0] &&\n      point[1] < labelmapDims[1] &&\n      point[2] < labelmapDims[2];\n\n    const { pixels, size } = stencil;\n    const centerX = Math.floor((size[0] - 1) / 2);\n    const centerY = Math.floor((size[1] - 1) / 2);\n\n    const point1 = [...start];\n    const point2 = [...end];\n    const rounded = [0, 0, 0];\n    const curPoint: number[] = [0, 0];\n    for (let y = 0; y < size[1]; y++) {\n      const ydelta = y - centerY;\n      const yoffset = y * size[0];\n      for (let x = 0; x < size[0]; x++) {\n        const xdelta = x - centerX;\n        const pixelOffset = yoffset + x;\n        if (pixels[pixelOffset]) {\n          point1[0] = start[0] + xdelta;\n          point1[1] = start[1] + ydelta;\n          point2[0] = end[0] + xdelta;\n          point2[1] = end[1] + ydelta;\n\n          // line between the two points\n          const dx = point2[0] - point1[0];\n          const dy = point2[1] - point1[1];\n          let steps = Math.abs(Math.abs(dx) > Math.abs(dy) ? dx : dy);\n          const incX = dx / steps;\n          const incY = dy / steps;\n          [curPoint[0], curPoint[1]] = point1;\n          while (steps-- >= 0) {\n            // add slice axis to make a proper 3D index\n            curPoint.splice(sliceAxis, 0, ijkSlice);\n            rounded[0] = Math.round(curPoint[0]);\n            rounded[1] = Math.round(curPoint[1]);\n            rounded[2] = Math.round(curPoint[2]);\n\n            if (isInBounds(rounded)) {\n              const offset =\n                rounded[0] + rounded[1] * jStride + rounded[2] * kStride;\n              labelmapPixels[offset] = brushValue;\n            }\n\n            // undo adding the slice axis value\n            curPoint.splice(sliceAxis, 1);\n\n            curPoint[0] += incX;\n            curPoint[1] += incY;\n          }\n        }\n      }\n    }\n\n    labelmap.modified();\n  }\n}\n","import type { Vector2 } from '@kitware/vtk.js/types';\nimport { useCurrentImage } from '@/src/composables/useCurrentImage';\nimport { Manifest, StateFile } from '@/src/io/state-file/schema';\nimport { computed, ref } from 'vue';\nimport { vec3 } from 'gl-matrix';\nimport { defineStore } from 'pinia';\nimport { Maybe } from '@/src/types';\nimport { PaintMode } from '@/src/core/tools/paint';\nimport { Tools } from './types';\nimport { useSegmentGroupStore } from '../segmentGroups';\n\nconst DEFAULT_BRUSH_SIZE = 4;\n\nexport const usePaintToolStore = defineStore('paint', () => {\n  type _This = ReturnType<typeof usePaintToolStore>;\n\n  const activeMode = ref(PaintMode.CirclePaint);\n  const activeSegmentGroupID = ref<Maybe<string>>(null);\n  const activeSegment = ref<Maybe<number>>(null);\n  const brushSize = ref(DEFAULT_BRUSH_SIZE);\n  const strokePoints = ref<vec3[]>([]);\n  const isActive = ref(false);\n\n  const { currentImageID } = useCurrentImage();\n\n  function getWidgetFactory(this: _This) {\n    return this.$paint.factory;\n  }\n\n  const segmentGroupStore = useSegmentGroupStore();\n\n  const activeLabelmap = computed(() => {\n    if (!activeSegmentGroupID.value) return null;\n    return segmentGroupStore.dataIndex[activeSegmentGroupID.value] ?? null;\n  });\n\n  // --- actions --- //\n\n  /**\n   * Sets the painting mode.\n   * @param mode\n   */\n  function setMode(this: _This, mode: PaintMode) {\n    activeMode.value = mode;\n    this.$paint.setMode(mode);\n  }\n\n  /**\n   * Sets the active labelmap.\n   */\n  function setActiveSegmentGroup(segmentGroupID: Maybe<string>) {\n    activeSegmentGroupID.value = segmentGroupID;\n  }\n\n  function getValidSegmentGroupID(imageID: Maybe<string>): Maybe<string> {\n    if (!imageID) return null;\n\n    // If current segment group belongs to this image, keep using it\n    if (\n      activeSegmentGroupID.value &&\n      segmentGroupStore.metadataByID[activeSegmentGroupID.value]\n        ?.parentImage === imageID\n    ) {\n      return activeSegmentGroupID.value;\n    }\n\n    // Otherwise look for other segment groups for this image\n    const segmentGroups = segmentGroupStore.orderByParent[imageID];\n    if (segmentGroups && segmentGroups.length > 0) {\n      return segmentGroups[0];\n    }\n    return null;\n  }\n\n  /**\n   * Sets the active labelmap from a given image.\n   *\n   * If a labelmap exists, pick one. If no labelmap exists, create one.\n   */\n  function ensureActiveSegmentGroupForImage(imageID: Maybe<string>) {\n    if (!imageID) {\n      setActiveSegmentGroup(null);\n      return;\n    }\n\n    const segmentGroupID =\n      getValidSegmentGroupID(imageID) ??\n      segmentGroupStore.newLabelmapFromImage(imageID);\n    setActiveSegmentGroup(segmentGroupID);\n  }\n\n  /**\n   * Sets the active segment.\n   *\n   * If the segment may be null | undefined, indicating no paint will occur.\n   * @param segValue\n   */\n  function setActiveSegment(this: _This, segValue: Maybe<number>) {\n    if (segValue) {\n      if (!activeSegmentGroupID.value)\n        throw new Error('Cannot set active segment without a labelmap');\n\n      const { segments } =\n        segmentGroupStore.metadataByID[activeSegmentGroupID.value];\n\n      if (!(segValue in segments.byValue))\n        throw new Error('Segment is not available for the active labelmap');\n    }\n\n    activeSegment.value = segValue;\n    this.$paint.setBrushValue(segValue);\n  }\n\n  /**\n   * Sets the brush size\n   * @param this\n   * @param size\n   */\n  function setBrushSize(this: _This, size: number) {\n    brushSize.value = Math.round(size);\n    this.$paint.setBrushSize(size);\n  }\n\n  function doPaintStroke(this: _This, axisIndex: 0 | 1 | 2) {\n    if (!activeLabelmap.value) {\n      return;\n    }\n\n    const lastIndex = strokePoints.value.length - 1;\n    if (lastIndex >= 0) {\n      const lastPoint = strokePoints.value[lastIndex];\n      const prevPoint =\n        lastIndex >= 1 ? strokePoints.value[lastIndex - 1] : undefined;\n      this.$paint.paintLabelmap(\n        activeLabelmap.value,\n        axisIndex,\n        lastPoint,\n        prevPoint\n      );\n    }\n  }\n\n  function setSliceAxis(this: _This, axisIndex: 0 | 1 | 2) {\n    if (!activeLabelmap.value) return;\n    const spacing = activeLabelmap.value.getSpacing();\n    spacing.splice(axisIndex, 1);\n    const scale: Vector2 = [1 / spacing[0], 1 / spacing[1]];\n    this.$paint.setBrushScale(scale);\n  }\n\n  // Create segment group if paint is active and none exist.\n  // If paint is not active, but there is a segment group for the current image, set it as active.\n  function ensureSegmentGroup() {\n    const imageID = currentImageID.value;\n    if (!imageID) return;\n\n    // Check if a valid segment group is already selected\n    if (\n      activeSegmentGroupID.value &&\n      segmentGroupStore.metadataByID[activeSegmentGroupID.value]\n        ?.parentImage === imageID\n    ) {\n      return;\n    }\n\n    if (isActive.value) {\n      ensureActiveSegmentGroupForImage(imageID);\n    } else {\n      const segmentGroupID = getValidSegmentGroupID(imageID);\n      if (segmentGroupID) {\n        setActiveSegmentGroup(segmentGroupID);\n      }\n    }\n  }\n\n  function startStroke(this: _This, indexPoint: vec3, axisIndex: 0 | 1 | 2) {\n    ensureSegmentGroup();\n    strokePoints.value = [vec3.clone(indexPoint)];\n    doPaintStroke.call(this, axisIndex);\n  }\n\n  function placeStrokePoint(\n    this: _This,\n    indexPoint: vec3,\n    axisIndex: 0 | 1 | 2\n  ) {\n    strokePoints.value.push(indexPoint);\n    doPaintStroke.call(this, axisIndex);\n  }\n\n  function endStroke(this: _This, indexPoint: vec3, axisIndex: 0 | 1 | 2) {\n    strokePoints.value.push(indexPoint);\n    doPaintStroke.call(this, axisIndex);\n  }\n\n  // --- setup and teardown --- //\n\n  function activateTool(this: _This) {\n    const imageID = currentImageID.value;\n    if (!imageID) {\n      return false;\n    }\n    ensureActiveSegmentGroupForImage(imageID);\n    this.$paint.setBrushSize(this.brushSize);\n\n    isActive.value = true;\n    return true;\n  }\n\n  function deactivateTool() {\n    activeSegmentGroupID.value = null;\n    isActive.value = false;\n  }\n\n  function serialize(state: StateFile) {\n    const { paint } = state.manifest.tools;\n\n    paint.activeSegmentGroupID = activeSegmentGroupID.value ?? null;\n    paint.brushSize = brushSize.value;\n    paint.activeSegment = activeSegment.value;\n  }\n\n  function deserialize(\n    this: _This,\n    manifest: Manifest,\n    segmentGroupIDMap: Record<string, string>\n  ) {\n    const { paint } = manifest.tools;\n    setBrushSize.call(this, paint.brushSize);\n    isActive.value = manifest.tools.current === Tools.Paint;\n\n    if (paint.activeSegmentGroupID !== null) {\n      activeSegmentGroupID.value =\n        segmentGroupIDMap[paint.activeSegmentGroupID];\n      setActiveSegmentGroup(activeSegmentGroupID.value);\n      setActiveSegment.call(this, paint.activeSegment);\n    }\n  }\n\n  return {\n    // state\n    activeMode,\n    activeSegmentGroupID,\n    activeSegment,\n    brushSize,\n    strokePoints,\n    isActive,\n\n    getWidgetFactory,\n\n    activateTool,\n    deactivateTool,\n\n    setMode,\n    setActiveSegmentGroup,\n    ensureActiveSegmentGroupForImage,\n    setActiveSegment,\n    setBrushSize,\n    setSliceAxis,\n    startStroke,\n    placeStrokePoint,\n    endStroke,\n    serialize,\n    deserialize,\n  };\n});\n","import { AnnotationToolAPI } from '@/src/store/tools/useAnnotationTool';\nimport { AnnotationTool } from '@/src/types/annotation-tool';\nimport { defineStore } from 'pinia';\n\n/**\n * Type helper for enforcing the typing for annotation tool stores.\n *\n * Requires setup store usage rather than template usage.\n * @param name\n * @param setup\n * @returns\n */\nexport function defineAnnotationToolStore<\n  T extends AnnotationTool,\n  S extends AnnotationToolAPI<T>\n>(name: string, setup: () => S) {\n  return defineStore(name, setup);\n}\n","import { vec3 } from 'gl-matrix';\nimport type { Vector2, Vector3 } from '@kitware/vtk.js/types';\nimport vtkMath from '@kitware/vtk.js/Common/Core/Math';\nimport vtkPlane from '@kitware/vtk.js/Common/DataModel/Plane';\nimport { LPSAxis } from '../types/lps';\nimport { EPSILON } from '../constants';\nimport { roundIfCloseToInteger } from '.';\nimport { ImageMetadata } from '../types/image';\n\nconst tmp = vec3.create();\n\n/**\n * Defines a 2D plane used for locating annotations.\n */\nexport interface FrameOfReference {\n  planeNormal: Vector3;\n  planeOrigin: Vector3;\n}\n\nexport interface FrameOfReferenceToImageSliceAndAxisOptions {\n  epsilon?: number;\n  allowNonIntegralSlice?: boolean;\n  allowOutOfBoundsSlice?: boolean;\n}\n\n/**\n * Returns the image slice and LPS axis for a given frame of reference.\n *\n * If the frame of reference is not aligned to the image metadata, then null is returned.\n * @param {FrameOfReference} frame\n * @param {ImageMetadata} metadata\n * @param {FrameOfReferenceToImageSliceAndAxisOptions?} options\n */\nexport function frameOfReferenceToImageSliceAndAxis(\n  frame: FrameOfReference,\n  metadata: ImageMetadata,\n  options?: FrameOfReferenceToImageSliceAndAxisOptions\n): { axis: LPSAxis; slice: number } | null {\n  const epsilon = options?.epsilon ?? EPSILON;\n  const allowNonIntegralSlice = options?.allowNonIntegralSlice ?? false;\n  const allowOutOfBoundsSlice = options?.allowOutOfBoundsSlice ?? false;\n\n  const { planeNormal, planeOrigin } = frame;\n  const { dimensions, lpsOrientation, worldToIndex } = metadata;\n\n  let axis: LPSAxis | null = null;\n  const { Left, Right, Posterior, Anterior, Superior, Inferior } =\n    lpsOrientation;\n  if (vec3.equals(Left, planeNormal) || vec3.equals(Right, planeNormal)) {\n    axis = 'Sagittal';\n  } else if (\n    vec3.equals(Posterior, planeNormal) ||\n    vec3.equals(Anterior, planeNormal)\n  ) {\n    axis = 'Coronal';\n  } else if (\n    vec3.equals(Superior, planeNormal) ||\n    vec3.equals(Inferior, planeNormal)\n  ) {\n    axis = 'Axial';\n  }\n\n  if (!axis) {\n    return null;\n  }\n\n  vec3.transformMat4(tmp, planeOrigin, worldToIndex);\n  const index = lpsOrientation[axis];\n  const slice = roundIfCloseToInteger(tmp[index], epsilon);\n\n  if (!allowNonIntegralSlice && !Number.isInteger(slice)) {\n    return null;\n  }\n\n  if (!allowOutOfBoundsSlice && (slice < 0 || slice >= dimensions[index])) {\n    return null;\n  }\n\n  return { axis, slice };\n}\n\nexport function getSmallestSpacing(\n  frame: FrameOfReference,\n  metadata: ImageMetadata\n): number {\n  const sliceAxis = frameOfReferenceToImageSliceAndAxis(frame, metadata);\n  if (!sliceAxis) return Math.min(...metadata.spacing); // off orthogonal\n  const axisIndex = metadata.lpsOrientation[sliceAxis.axis];\n  const spacing = [...metadata.spacing];\n  spacing.splice(axisIndex, 1);\n  return Math.min(...spacing);\n}\n\nexport function getPlaneTransforms({\n  planeOrigin,\n  planeNormal,\n}: FrameOfReference) {\n  const scratchA = [0, 0, 0] as Vector3;\n  const scratchB = [0, 0, 0] as Vector3;\n  const e1 = [0, 0, 0] as Vector3;\n  const e2 = [0, 0, 0] as Vector3;\n  // Pick a vector orthogonal to the normal\n  if (Math.abs(planeNormal[0]) > 1e-6) {\n    e1[0] = -planeNormal[1];\n    e1[1] = planeNormal[0];\n    e1[2] = 0;\n  } else if (Math.abs(planeNormal[1]) > 1e-6) {\n    e1[0] = 0;\n    e1[1] = -planeNormal[2];\n    e1[2] = planeNormal[1];\n  } else {\n    e1[0] = planeNormal[2];\n    e1[1] = 0;\n    e1[2] = -planeNormal[0];\n  }\n  vtkMath.cross(planeNormal, e1, e2);\n  vtkMath.normalize(e1);\n  vtkMath.normalize(e2);\n\n  const plane = vtkPlane.newInstance();\n  plane.setOrigin(planeOrigin);\n  plane.setNormal(planeNormal);\n\n  const to2D = (point3D: Vector3) => {\n    plane.projectPoint(point3D, scratchA);\n    const v = vtkMath.subtract(scratchA, planeOrigin, scratchB);\n    const x = vtkMath.dot(v, e1);\n    const y = vtkMath.dot(v, e2);\n    return [x, y] as Vector2;\n  };\n\n  const to3D = (point2D: Vector2) => {\n    const [x, y] = point2D;\n\n    const point3D = [0, 0, 0] as Vector3;\n\n    scratchA[0] = e1[0];\n    scratchA[1] = e1[1];\n    scratchA[2] = e1[2];\n    scratchB[0] = e2[0];\n    scratchB[1] = e2[1];\n    scratchB[2] = e2[2];\n\n    vtkMath.multiplyScalar(scratchA, x);\n    vtkMath.multiplyScalar(scratchB, y);\n    vtkMath.add(planeOrigin, scratchA, point3D);\n    vtkMath.add(point3D, scratchB, point3D);\n\n    return point3D;\n  };\n\n  return { to2D, to3D };\n}\n","import { AnnotationToolType } from '@/src/store/tools/types';\nimport { ToolID } from '@/src/types/annotation-tool';\nimport { defineStore, storeToRefs } from 'pinia';\nimport { computed, ref, watch } from 'vue';\nimport { useDatasetStore } from '@/src/store/datasets';\n\nexport interface ToolSelection {\n  id: ToolID;\n  type: AnnotationToolType;\n}\nexport const useToolSelectionStore = defineStore('tool-selection', () => {\n  type Selections = Record<ToolID, AnnotationToolType>;\n  const selectionMap = ref<Selections>(Object.create(null));\n\n  function addSelection(id: ToolID, type: AnnotationToolType) {\n    if (id in selectionMap.value) return;\n    selectionMap.value[id] = type;\n  }\n\n  function clearSelection() {\n    selectionMap.value = Object.create(null);\n  }\n\n  function removeSelection(id: ToolID) {\n    if (!(id in selectionMap.value)) return;\n    delete selectionMap.value[id];\n  }\n\n  function toggleSelection(id: ToolID, type: AnnotationToolType) {\n    if (id in selectionMap.value) {\n      removeSelection(id);\n    } else {\n      addSelection(id, type);\n    }\n  }\n\n  function isSelected(id: ToolID) {\n    return id in selectionMap.value;\n  }\n\n  const selection = computed<ToolSelection[]>(() => {\n    return Object.entries(selectionMap.value).map(([id, type]) => ({\n      id: id as ToolID,\n      type,\n    }));\n  });\n\n  const { primarySelection } = storeToRefs(useDatasetStore());\n\n  watch(primarySelection, () => {\n    clearSelection();\n  });\n\n  return {\n    addSelection,\n    clearSelection,\n    removeSelection,\n    toggleSelection,\n    isSelected,\n    selection,\n  };\n});\n","import { Maybe } from '@/src/types';\nimport { ref } from 'vue';\nimport { StoreActions, StoreState } from 'pinia';\nimport { TOOL_COLORS } from '@/src/config';\nimport { useIdStore } from '../id';\n\nconst labelDefault = Object.freeze({\n  labelName: 'New Label' as string,\n  color: TOOL_COLORS[0] as string,\n});\n\nexport type Label<Props> = Partial<Props & typeof labelDefault>;\nexport type Labels<Props> = Record<string, Label<Props>>;\n\ntype LabelID = string;\n\n// param newLabelDefault should contain all label controlled props\n// of the tool so placing tool does hold any last active label props.\nexport const useLabels = <Props>(newLabelDefault: Props) => {\n  type ToolLabel = Label<Props>;\n  type ToolLabels = Labels<Props>;\n\n  const labels = ref<ToolLabels>({});\n\n  const activeLabel = ref<string | undefined>();\n  const setActiveLabel = (id: string) => {\n    activeLabel.value = id;\n  };\n\n  let nextToolColorIndex = 0;\n\n  const addLabel = (label: ToolLabel = {}) => {\n    const id = useIdStore().nextId();\n    labels.value[id] = {\n      ...labelDefault,\n      ...newLabelDefault,\n      color: TOOL_COLORS[nextToolColorIndex],\n      ...label,\n    };\n\n    nextToolColorIndex = (nextToolColorIndex + 1) % TOOL_COLORS.length;\n\n    setActiveLabel(id);\n    return id;\n  };\n\n  const deleteLabel = (id: LabelID) => {\n    if (!(id in labels.value)) throw new Error('Label does not exist');\n\n    delete labels.value[id];\n    labels.value = { ...labels.value }; // trigger reactive update for measurement list\n\n    // pick another active label if deleted was active\n    if (id === activeLabel.value) {\n      const labelIDs = Object.keys(labels.value);\n      if (labelIDs.length !== 0) setActiveLabel(labelIDs[0]);\n      else setActiveLabel('');\n    }\n  };\n\n  const updateLabel = (id: LabelID, patch: ToolLabel) => {\n    if (!(id in labels.value)) throw new Error('Label does not exist');\n\n    labels.value = { ...labels.value, [id]: { ...labels.value[id], ...patch } };\n  };\n\n  // Flag to indicate if should clear existing labels\n  const defaultLabels = ref(true);\n\n  const clearDefaultLabels = () => {\n    if (defaultLabels.value) labels.value = {};\n    defaultLabels.value = false;\n  };\n\n  const findLabel = (name: Maybe<string>) => {\n    return Object.entries(labels.value).find(\n      ([, { labelName }]) => name === labelName\n    );\n  };\n\n  /*\n   * If input label has the same name as existing label, update existing label with input label properties.\n   *\n   * param label: label to merge\n   * param clearDefault: if true, clear initial labels, do nothing if initial labels already cleared\n   */\n  const mergeLabel = (label: ToolLabel) => {\n    const { labelName } = label;\n    const matchingName = findLabel(labelName);\n\n    if (matchingName) {\n      const [existingID] = matchingName;\n      updateLabel(existingID, label);\n      return existingID;\n    }\n\n    return addLabel(label);\n  };\n\n  /*\n   * If input label has the same name as existing label, update existing label with input label properties.\n   *\n   * param newLabels: each key is the label name\n   * param clearDefault: if true, clear initial labels, do nothing if initial labels already cleared\n   */\n  const mergeLabels = (newLabels: Maybe<ToolLabels>) => {\n    Object.entries(newLabels ?? {}).forEach(([labelName, props]) =>\n      mergeLabel({ ...props, labelName })\n    );\n  };\n\n  return {\n    labels,\n    activeLabel,\n    setActiveLabel,\n    addLabel,\n    deleteLabel,\n    updateLabel,\n    mergeLabels,\n    findLabel,\n    clearDefaultLabels,\n  };\n};\n\ntype UseLabels<Tool> = ReturnType<typeof useLabels<Tool>>;\n\nexport type LabelsStore<Tool> = StoreState<UseLabels<Tool>> &\n  StoreActions<UseLabels<Tool>>;\n","import { Ref, UnwrapNestedRefs, computed, ref, watch } from 'vue';\nimport { StoreActions, StoreGetters, StoreState } from 'pinia';\nimport type { Vector3 } from '@kitware/vtk.js/types';\nimport type { Maybe, PartialWithRequired } from '@/src/types';\nimport {\n  STROKE_WIDTH_ANNOTATION_TOOL_DEFAULT,\n  TOOL_COLORS,\n} from '@/src/config';\nimport { removeFromArray } from '@/src/utils';\nimport { useCurrentImage } from '@/src/composables/useCurrentImage';\nimport { frameOfReferenceToImageSliceAndAxis } from '@/src/utils/frameOfReference';\nimport { useViewStore } from '@/src/store/views';\nimport { getLPSAxisFromDir } from '@/src/utils/lps';\nimport { LPSAxisDir } from '@/src/types/lps';\nimport { AnnotationTool, ToolID } from '@/src/types/annotation-tool';\nimport { useIdStore } from '@/src/store/id';\nimport { useToolSelectionStore } from '@/src/store/tools/toolSelection';\nimport type { IToolStore } from '@/src/store/tools/types';\nimport useViewSliceStore from '../view-configs/slicing';\nimport { useLabels, Labels } from './useLabels';\n\nconst annotationToolLabelDefault = Object.freeze({\n  strokeWidth: STROKE_WIDTH_ANNOTATION_TOOL_DEFAULT as number,\n});\n\nconst makeAnnotationToolDefaults = () => ({\n  frameOfReference: {\n    planeOrigin: [0, 0, 0],\n    planeNormal: [1, 0, 0],\n  },\n  slice: -1,\n  imageID: '',\n  placing: false,\n  color: TOOL_COLORS[0],\n  strokeWidth: STROKE_WIDTH_ANNOTATION_TOOL_DEFAULT,\n  name: 'baseAnnotationTool',\n});\n\n// Must return addTool in consuming Pinia store.\nexport const useAnnotationTool = <\n  MakeToolDefaults extends (...args: any) => any,\n  LabelProps\n>({\n  toolDefaults,\n  initialLabels,\n  newLabelDefault,\n}: {\n  toolDefaults: MakeToolDefaults;\n  initialLabels: Labels<LabelProps>;\n  newLabelDefault?: LabelProps;\n}) => {\n  type ToolDefaults = ReturnType<MakeToolDefaults>;\n  type Tool = ToolDefaults & AnnotationTool;\n  type ToolPatch = Partial<Omit<Tool, 'id'>>;\n\n  const toolIDs = ref<ToolID[]>([]);\n  const toolByID = ref<Record<ToolID, Tool>>(Object.create(null)) as Ref<\n    Record<ToolID, Tool>\n  >;\n\n  const tools = computed(() => {\n    const byID = toolByID.value;\n    return toolIDs.value.map((id) => byID[id]);\n  });\n\n  type FinishedTool = Tool & { placing: true };\n  const finishedTools = computed(() =>\n    tools.value.filter((tool): tool is FinishedTool => !tool.placing)\n  );\n\n  const labels = useLabels({\n    ...annotationToolLabelDefault,\n    ...newLabelDefault,\n  });\n  labels.mergeLabels(initialLabels);\n\n  function makePropsFromLabel(label: string | undefined) {\n    if (!label) return { labelName: '' };\n\n    const labelProps = labels.labels.value[label];\n    if (labelProps) return labelProps;\n\n    // if label deleted, remove label name from tool\n    return { labelName: '' };\n  }\n\n  function addTool(tool: ToolPatch): ToolID {\n    const id = useIdStore().nextId() as ToolID;\n    if (id in toolByID.value) {\n      throw new Error('Cannot add tool with conflicting ID');\n    }\n\n    toolByID.value[id] = {\n      ...makeAnnotationToolDefaults(),\n      ...toolDefaults(),\n      label: labels.activeLabel.value,\n      ...tool,\n      // updates label props if changed between sessions\n      ...makePropsFromLabel(tool.label),\n      id,\n    };\n\n    toolIDs.value.push(id);\n    return id;\n  }\n\n  function removeTool(id: ToolID) {\n    if (!(id in toolByID.value)) return;\n\n    removeFromArray(toolIDs.value, id);\n    delete toolByID.value[id];\n\n    const selectionStore = useToolSelectionStore();\n    selectionStore.removeSelection(id);\n  }\n\n  function updateTool(id: ToolID, patch: ToolPatch) {\n    if (!(id in toolByID.value)) return;\n\n    toolByID.value[id] = { ...toolByID.value[id], ...patch, id };\n  }\n\n  // updates props controlled by labels\n  watch(labels.labels, () => {\n    toolIDs.value.forEach((id) => {\n      const tool = toolByID.value[id];\n      const propsFromLabel = makePropsFromLabel(tool.label);\n      updateTool(id, { ...tool, ...propsFromLabel });\n    });\n  });\n\n  const { currentImageID, currentImageMetadata } = useCurrentImage();\n\n  function jumpToTool(toolID: ToolID) {\n    const tool = toolByID.value[toolID];\n\n    const imageID = currentImageID.value;\n    if (!imageID || tool.imageID !== imageID) return;\n\n    const toolImageFrame = frameOfReferenceToImageSliceAndAxis(\n      tool.frameOfReference,\n      currentImageMetadata.value\n    );\n\n    if (!toolImageFrame) return;\n\n    const viewStore = useViewStore();\n    const relevantViewIDs = viewStore.viewIDs.filter((viewID) => {\n      const viewSpec = viewStore.viewSpecs[viewID];\n      const viewDir = viewSpec.props.viewDirection as LPSAxisDir | undefined;\n      return viewDir && getLPSAxisFromDir(viewDir) === toolImageFrame.axis;\n    });\n\n    const viewSliceStore = useViewSliceStore();\n    relevantViewIDs.forEach((viewID) => {\n      viewSliceStore.updateConfig(viewID, imageID, {\n        slice: tool.slice!,\n      });\n    });\n  }\n\n  const serializeTools = () => {\n    const toolsSerialized = toolIDs.value\n      .map((toolID) => toolByID.value[toolID])\n      .filter((tool) => !tool.placing)\n      .map(({ imageID, ...rest }) => ({\n        imageID,\n        ...rest,\n      }));\n\n    return {\n      tools: toolsSerialized,\n      labels: labels.labels.value,\n    };\n  };\n\n  type Serialized = {\n    tools: PartialWithRequired<Tool, 'imageID'>[];\n    labels: Labels<Tool>;\n  };\n  function deserializeTools(\n    serialized: Maybe<Serialized>,\n    dataIDMap: Record<string, string>\n  ) {\n    if (serialized?.labels) {\n      labels.clearDefaultLabels();\n    }\n    const labelIDMap = Object.fromEntries(\n      Object.entries(serialized?.labels ?? {}).map(([id, label]) => {\n        const newID = labels.addLabel(label); // side effect in Array.map\n        return [id, newID];\n      })\n    );\n\n    serialized?.tools\n      .map(\n        ({ imageID, label, ...rest }) =>\n          ({\n            ...rest,\n            imageID: dataIDMap[imageID],\n            label: (label && labelIDMap[label]) || '',\n          } as ToolPatch)\n      )\n      .forEach((tool) => addTool(tool));\n  }\n\n  return {\n    ...labels,\n    toolIDs,\n    toolByID,\n    tools,\n    finishedTools,\n    addTool,\n    removeTool,\n    updateTool,\n    jumpToTool,\n    serializeTools,\n    deserializeTools,\n  };\n};\n\ntype ToolFactory<T extends AnnotationTool> = (...args: any[]) => T;\n\nexport type AnnotationToolAPI<T extends AnnotationTool> = ReturnType<\n  typeof useAnnotationTool<ToolFactory<T>, any>\n> & {\n  getPoints(id: ToolID): Vector3[];\n};\n\ntype UseAnnotationToolBasedStore<T extends AnnotationTool> = StoreState<\n  AnnotationToolAPI<T>\n> &\n  StoreActions<AnnotationToolAPI<T>> &\n  UnwrapNestedRefs<StoreGetters<AnnotationToolAPI<T>>>;\n\nexport interface AnnotationToolStore<T extends AnnotationTool = AnnotationTool>\n  extends UseAnnotationToolBasedStore<T>,\n    IToolStore {}\n","import { computed } from 'vue';\nimport { defineAnnotationToolStore } from '@/src/utils/defineAnnotationToolStore';\nimport type { Vector3 } from '@kitware/vtk.js/types';\nimport { distance2BetweenPoints } from '@kitware/vtk.js/Common/Core/Math';\nimport { ToolID } from '@/src/types/annotation-tool';\n\nimport { RULER_LABEL_DEFAULTS } from '@/src/config';\nimport { Manifest, StateFile } from '@/src/io/state-file/schema';\n\nimport { useAnnotationTool } from './useAnnotationTool';\n\nconst rulerDefaults = () => ({\n  firstPoint: [0, 0, 0] as Vector3,\n  secondPoint: [0, 0, 0] as Vector3,\n  id: '',\n  name: 'Ruler',\n});\n\nexport const useRulerStore = defineAnnotationToolStore('ruler', () => {\n  const annotationTool = useAnnotationTool({\n    toolDefaults: rulerDefaults,\n    initialLabels: RULER_LABEL_DEFAULTS,\n  });\n\n  // prefix some props with ruler\n  const {\n    toolIDs: rulerIDs,\n    toolByID: rulerByID,\n    tools: rulers,\n    addTool: addRuler,\n    updateTool: updateRuler,\n    removeTool: removeRuler,\n    jumpToTool: jumpToRuler,\n    serializeTools,\n    deserializeTools,\n  } = annotationTool;\n\n  const lengthByID = computed<Record<string, number>>(() => {\n    const byID = rulerByID.value;\n    return rulerIDs.value.reduce((lengths, id) => {\n      const { firstPoint, secondPoint } = byID[id];\n      return Object.assign(lengths, {\n        [id]: Math.sqrt(distance2BetweenPoints(firstPoint, secondPoint)),\n      });\n    }, {});\n  });\n\n  function getPoints(id: ToolID) {\n    const tool = annotationTool.toolByID.value[id];\n    return [tool.firstPoint, tool.secondPoint];\n  }\n\n  // --- serialization --- //\n\n  function serialize(state: StateFile) {\n    state.manifest.tools.rulers = serializeTools();\n  }\n\n  function deserialize(manifest: Manifest, dataIDMap: Record<string, string>) {\n    deserializeTools(manifest.tools.rulers, dataIDMap);\n  }\n\n  return {\n    ...annotationTool, // support useAnnotationTool interface (for MeasurementsToolList)\n    rulerIDs,\n    rulerByID,\n    rulers,\n    lengthByID,\n    addRuler,\n    updateRuler,\n    removeRuler,\n    jumpToRuler,\n    getPoints,\n    serialize,\n    deserialize,\n  };\n});\n","import { defineAnnotationToolStore } from '@/src/utils/defineAnnotationToolStore';\nimport type { Vector3 } from '@kitware/vtk.js/types';\nimport { Manifest, StateFile } from '@/src/io/state-file/schema';\nimport { RECTANGLE_LABEL_DEFAULTS } from '@/src/config';\nimport { ToolID } from '@/src/types/annotation-tool';\n\nimport { useAnnotationTool } from './useAnnotationTool';\n\nconst rectangleDefaults = () => ({\n  firstPoint: [0, 0, 0] as Vector3,\n  secondPoint: [0, 0, 0] as Vector3,\n  id: '' as ToolID,\n  name: 'Rectangle',\n  fillColor: 'transparent',\n});\n\nconst newLabelDefault = {\n  fillColor: 'transparent',\n};\n\nexport const useRectangleStore = defineAnnotationToolStore('rectangles', () => {\n  const toolAPI = useAnnotationTool({\n    toolDefaults: rectangleDefaults,\n    initialLabels: RECTANGLE_LABEL_DEFAULTS,\n    newLabelDefault,\n  });\n\n  function getPoints(id: ToolID) {\n    const tool = toolAPI.toolByID.value[id];\n    return [tool.firstPoint, tool.secondPoint];\n  }\n\n  // --- serialization --- //\n\n  function serialize(state: StateFile) {\n    state.manifest.tools.rectangles = toolAPI.serializeTools();\n  }\n\n  function deserialize(manifest: Manifest, dataIDMap: Record<string, string>) {\n    toolAPI.deserializeTools(manifest.tools.rectangles, dataIDMap);\n  }\n\n  return {\n    ...toolAPI,\n    getPoints,\n    serialize,\n    deserialize,\n  };\n});\n","import polybool, { Polygon as LibPolygon, Vec2, Vec6 } from '@velipso/polybool';\nimport type { Vector3, Vector2 } from '@kitware/vtk.js/types';\nimport { computed } from 'vue';\nimport {\n  ToolSelection,\n  useToolSelectionStore,\n} from '@/src/store/tools/toolSelection';\nimport { AnnotationToolType } from '@/src/store/tools/types';\nimport { POLYGON_LABEL_DEFAULTS } from '@/src/config';\nimport { Manifest, StateFile } from '@/src/io/state-file/schema';\nimport { getPlaneTransforms } from '@/src/utils/frameOfReference';\nimport { ToolID } from '@/src/types/annotation-tool';\nimport { defineAnnotationToolStore } from '@/src/utils/defineAnnotationToolStore';\nimport { useAnnotationTool } from './useAnnotationTool';\n\nconst toolDefaults = () => ({\n  points: [] as Array<Vector3>,\n  id: '' as ToolID,\n  name: 'Polygon',\n});\n\nconst ensureVec2 = (regions: (Vec2 | Vec6)[][]) => {\n  const remapToVec2Needed =\n    regions.length > 0 && regions[0].length > 0 && regions[0][0].length === 6;\n  return !remapToVec2Needed\n    ? (regions as Vec2[][])\n    : regions.map((region) => {\n        // ensure Vec2 points, and not Vec6 for bezier control points\n        return region.map((point) => [point[4], point[5]] as Vec2);\n      });\n};\n\nexport const usePolygonStore = defineAnnotationToolStore('polygon', () => {\n  const toolAPI = useAnnotationTool({\n    toolDefaults,\n    initialLabels: POLYGON_LABEL_DEFAULTS,\n  });\n\n  function getPoints(id: ToolID) {\n    const tool = toolAPI.toolByID.value[id];\n    return tool.points;\n  }\n\n  // -- merge tool helpers -- //\n  type Tool = (typeof toolAPI.tools.value)[number];\n\n  const toPolyLibStructure = (polygon: Tool) => {\n    const { to2D } = getPlaneTransforms(polygon.frameOfReference);\n    if (polygon.points.length === 0) return undefined; // empty polygons are invalid\n    return {\n      regions: [polygon.points.map(to2D)],\n      inverted: false,\n    };\n  };\n\n  const polygonsOverlap = (a: Tool, b: Tool) => {\n    const [aGeo, bGeo] = [a, b].map(toPolyLibStructure);\n    if (!aGeo || !bGeo) return false;\n    return polybool.intersect(aGeo, bGeo).regions.length > 0;\n  };\n\n  const pointEquals = (a: Vector2, b: Vector2) =>\n    a[0] === b[0] && a[1] === b[1];\n\n  // After union, regions will have shared points because we require overlap to union.\n  // Create one region/ring by splicing in the next region at the common point.\n  const mergeRegions = (regions: Vector2[][]) => {\n    const [mergedRegion, ...candidates] = regions;\n\n    while (candidates.length > 0) {\n      let regionIndex = 0;\n      let mergedCommonPointIndex = 0;\n      let candidateCommonPointIndex = 0;\n      for (let i = 0; i < candidates.length; i++) {\n        const candidate = candidates[i];\n        let candidatePointIndex = 0;\n        const commonPointIndex = mergedRegion.findIndex((point) =>\n          candidate.some((nextPoint, index) => {\n            candidatePointIndex = index;\n            return pointEquals(point, nextPoint);\n          })\n        );\n        if (commonPointIndex !== -1) {\n          regionIndex = i;\n          mergedCommonPointIndex = commonPointIndex;\n          candidateCommonPointIndex = candidatePointIndex;\n          break;\n        }\n      }\n      const [toMerge] = candidates.splice(regionIndex, 1);\n      const oldStart = toMerge.splice(0, candidateCommonPointIndex);\n      const startWithCommonPoint = [...toMerge, ...oldStart];\n      mergedRegion.splice(mergedCommonPointIndex, 0, ...startWithCommonPoint);\n    }\n\n    return mergedRegion;\n  };\n\n  const mergePolygons = (polygons: Array<Tool>) => {\n    const libPolygons = polygons.map(toPolyLibStructure) as Array<LibPolygon>;\n    if (libPolygons.some((p) => p === undefined))\n      throw new Error('Trying to merge invalid polygons');\n\n    let segments = polybool.segments(libPolygons[0]);\n    for (let i = 1; i < libPolygons.length; i++) {\n      const seg2 = polybool.segments(libPolygons[i]);\n      const comb = polybool.combine(segments, seg2);\n      segments = polybool.selectUnion(comb);\n    }\n\n    const unionPolyRegions = polybool.polygon(segments).regions;\n    const singleRegion = mergeRegions(ensureVec2(unionPolyRegions));\n\n    const firstTool = polygons[0];\n    const { to3D } = getPlaneTransforms(firstTool.frameOfReference);\n    const points = singleRegion.map(to3D);\n\n    // eslint-disable-next-line @typescript-eslint/no-unused-vars\n    const { id: _, ...toolProps } = polygons[0];\n    const mergedTool = {\n      ...toolProps,\n      points,\n    };\n    return mergedTool;\n  };\n\n  const sameSliceAndLabel = (a: Tool, b: Tool) =>\n    a.label === b.label &&\n    a.slice === b.slice &&\n    a.frameOfReference === b.frameOfReference;\n\n  const mergable = (a: Tool, b: Tool) => {\n    if (!sameSliceAndLabel(a, b)) return false;\n    return polygonsOverlap(a, b);\n  };\n  // --- //\n\n  const selectionStore = useToolSelectionStore();\n\n  const isPolygonTool = (tool: ToolSelection) =>\n    tool.type === AnnotationToolType.Polygon;\n\n  const mergeableTools = computed(() => {\n    const selectedPolygons = selectionStore.selection\n      .filter(isPolygonTool)\n      .map((sel) => {\n        return toolAPI.toolByID.value[sel.id];\n      });\n    if (selectedPolygons.length < 2) return [];\n    const [first, ...rest] = selectedPolygons;\n    const overlapping = [first];\n    while (rest.length > 0) {\n      const overlappingIndex = rest.findIndex((candidate) =>\n        overlapping.some((inTool) => mergable(candidate, inTool))\n      );\n      if (overlappingIndex < 0) return []; // selected tool is not overlapping\n      // use splice to remove the overlapping tool from the rest array\n      overlapping.push(...rest.splice(overlappingIndex, 1));\n    }\n    return overlapping;\n  });\n\n  function mergeTools(mergeGroup: Tool[]) {\n    const mergedTool = mergePolygons(mergeGroup);\n    toolAPI.addTool(mergedTool);\n    mergeGroup.map(({ id }) => id).forEach(toolAPI.removeTool);\n  }\n\n  function mergeSelectedTools() {\n    mergeTools(mergeableTools.value);\n  }\n\n  function mergeWithOtherTools(id: ToolID) {\n    const lastTool = toolAPI.toolByID.value[id];\n    const olderTools = toolAPI.tools.value.filter(\n      (tool) => tool !== lastTool && !tool.placing\n    );\n    if (!lastTool || olderTools.length === 0) return;\n    const mergeable = olderTools.filter((older) => mergable(older, lastTool));\n    if (mergeable.length === 0) return;\n    mergeTools([lastTool, ...mergeable]);\n  }\n\n  // --- serialization --- //\n\n  function serialize(state: StateFile) {\n    state.manifest.tools.polygons = toolAPI.serializeTools();\n  }\n\n  function deserialize(manifest: Manifest, dataIDMap: Record<string, string>) {\n    toolAPI.deserializeTools(manifest.tools.polygons, dataIDMap);\n  }\n\n  return {\n    ...toolAPI,\n    getPoints,\n    mergeableTools,\n    mergeSelectedTools,\n    mergeWithOtherTools,\n    serialize,\n    deserialize,\n  };\n});\n","import { Manifest, StateFile } from '@/src/io/state-file/schema';\nimport { Maybe } from '@/src/types';\nimport type { AnnotationToolStore } from '@/src/store/tools/useAnnotationTool';\nimport { defineStore } from 'pinia';\nimport { useCropStore } from './crop';\nimport { useCrosshairsToolStore } from './crosshairs';\nimport { usePaintToolStore } from './paint';\nimport { useRulerStore } from './rulers';\nimport { useRectangleStore } from './rectangles';\nimport { AnnotationToolType, IToolStore, Tools } from './types';\nimport { usePolygonStore } from './polygons';\n\ninterface State {\n  currentTool: Tools;\n}\n\n// TODO move these types out\nexport const AnnotationToolStoreMap: Record<\n  AnnotationToolType,\n  () => AnnotationToolStore\n> = {\n  [AnnotationToolType.Polygon]: usePolygonStore,\n  [AnnotationToolType.Rectangle]: useRectangleStore,\n  [AnnotationToolType.Ruler]: useRulerStore,\n} as const;\n\nexport const ToolStoreMap: Record<Tools, Maybe<() => IToolStore>> = {\n  [Tools.Pan]: null,\n  [Tools.WindowLevel]: null,\n  [Tools.Zoom]: null,\n  [Tools.Select]: null,\n  [Tools.Crop]: useCropStore,\n  [Tools.Crosshairs]: useCrosshairsToolStore,\n  [Tools.Paint]: usePaintToolStore,\n  ...AnnotationToolStoreMap,\n} as const;\n\nexport function useAnnotationToolStore(\n  type: AnnotationToolType\n): AnnotationToolStore {\n  const useStore = AnnotationToolStoreMap[type];\n  return useStore();\n}\n\n/**\n * Returns true if the tool is ready to be\n * activated. By default, a tool without a\n * store setup() will be activated.\n */\nfunction setupTool(tool: Tools) {\n  const useStore = ToolStoreMap[tool];\n  const store = useStore?.();\n  if (store?.activateTool) {\n    return store.activateTool?.();\n  }\n  return true;\n}\n\nfunction teardownTool(tool: Tools) {\n  const useStore = ToolStoreMap[tool];\n  const store = useStore?.();\n  if (store) {\n    store.deactivateTool?.();\n  }\n}\n\nexport const useToolStore = defineStore('tool', {\n  state: (): State => ({\n    currentTool: Tools.WindowLevel,\n  }),\n  actions: {\n    setCurrentTool(tool: Tools) {\n      if (!setupTool(tool)) {\n        return;\n      }\n      teardownTool(this.currentTool);\n      this.currentTool = tool;\n    },\n    serialize(state: StateFile) {\n      const { tools } = state.manifest;\n\n      Object.values(ToolStoreMap)\n        .map((useStore) => useStore?.())\n        .filter((store): store is IToolStore => !!store)\n        .forEach((store) => {\n          store.serialize?.(state);\n        });\n\n      tools.current = this.currentTool;\n    },\n    deserialize(\n      manifest: Manifest,\n      segmentGroupIDMap: Record<string, string>,\n      dataIDMap: Record<string, string>\n    ) {\n      const { tools } = manifest;\n\n      usePaintToolStore().deserialize(manifest, segmentGroupIDMap);\n\n      Object.values(ToolStoreMap)\n        // paint store uses segmentGroupIDMap\n        .filter((useStore) => useStore !== usePaintToolStore)\n        .map((useStore) => useStore?.())\n        .filter((store): store is IToolStore => !!store)\n        .forEach((store) => {\n          store.deserialize?.(manifest, dataIDMap);\n        });\n\n      this.currentTool = tools.current;\n    },\n  },\n});\n","/**\n * application/vnd.unknown is used as a collective namespace for the purpose\n * of this application only.\n */\nexport const FILE_EXT_TO_MIME: Record<string, string> = {\n  vti: 'application/vnd.unknown.vti',\n  vtp: 'application/vnd.unknown.vtp',\n\n  stl: 'model/stl',\n\n  dcm: 'application/dicom',\n\n  zip: 'application/zip',\n\n  json: 'application/json',\n\n  // itk-wasm supported formats (from extensionToImageIO)\n\n  gipl: 'application/vnd.unknown.gipl',\n  'gipl.gz': 'application/vnd.unknown.gipl',\n\n  hdf5: 'application/x-hdf5',\n\n  jpg: 'image/jpeg',\n  jpeg: 'image/jpeg',\n\n  lsm: 'application/vnd.unknown.lsm',\n\n  mnc: 'application/vnd.unknown.minc',\n  'mnc.gz': 'application/vnd.unknown.minc',\n  mnc2: 'application/vnd.unknown.minc',\n\n  mgh: 'application/vnd.unknown.mgh',\n  mgz: 'application/vnd.unknown.mgh',\n  'mgh.gz': 'application/vnd.unknown.mgh',\n\n  mha: 'application/vnd.unknown.metaimage',\n  mhd: 'application/vnd.unknown.metaimage',\n\n  mrc: 'application/vnd.unknown.mrc',\n\n  nia: 'application/vnd.unknown.nifti-1',\n  nii: 'application/vnd.unknown.nifti-1',\n  'nii.gz': 'application/vnd.unknown.nifti-1',\n  hdr: 'application/vnd.unknown.nifti-1',\n\n  nrrd: 'application/vnd.unknown.nrrd',\n  nhdr: 'application/vnd.unknown.nrrd',\n\n  png: 'image/png',\n\n  pic: 'application/vnd.unknown.biorad',\n\n  tif: 'image/tiff',\n  tiff: 'image/tiff',\n\n  vtk: 'application/vnd.unknown.vtk',\n\n  isq: 'application/vnd.unknown.scanco',\n\n  fdf: 'application/vnd.unknown.fdf',\n};\n\nexport const FILE_EXTENSIONS = new Set(Object.keys(FILE_EXT_TO_MIME));\nexport const MIME_TYPES = new Set(Object.values(FILE_EXT_TO_MIME));\n\n/**\n * Supported archives\n */\nexport const ARCHIVE_FILE_TYPES = new Set([\n  FILE_EXT_TO_MIME.zip,\n  // Windows uploads files with this non-standard mime type\n  'application/x-zip-compressed',\n]);\n","import { Maybe } from '../types';\n\ninterface MagicDatabase {\n  mime: string;\n  header: number[];\n  skip?: number;\n}\n\n/**\n * file magic database\n * Used to handle certain cases where files have no extension\n */\nconst FILE_MAGIC_DB: MagicDatabase[] = [\n  {\n    mime: 'application/dicom',\n    skip: 128,\n    header: Array.from('DICM').map((c) => c.charCodeAt(0)),\n  },\n];\n\n// How much data to read when extracting file magic.\n// This should be generous enough for most files.\nconst HEAD_CHUNK = 512;\n\nfunction prefixEquals(target: Uint8Array, prefix: number[] | Uint8Array) {\n  if (prefix.length > target.length) {\n    return false;\n  }\n  for (let i = 0; i < prefix.length; i += 1) {\n    if (prefix[i] !== target[i]) {\n      return false;\n    }\n  }\n  return true;\n}\n\nexport async function getFileMimeFromMagic(file: File): Promise<Maybe<string>> {\n  return new Promise((resolve) => {\n    const head = file.slice(0, HEAD_CHUNK);\n    const reader = new FileReader();\n    reader.onload = () => {\n      const chunk = new Uint8Array(reader.result! as ArrayBuffer);\n      for (let i = 0; i < FILE_MAGIC_DB.length; i += 1) {\n        const { mime, header, skip = 0 } = FILE_MAGIC_DB[i];\n        if (prefixEquals(chunk.slice(skip), header)) {\n          resolve(mime);\n          return;\n        }\n      }\n      resolve(null);\n    };\n    reader.readAsArrayBuffer(head);\n  });\n}\n","import { FILE_EXTENSIONS, FILE_EXT_TO_MIME, MIME_TYPES } from './mimeTypes';\nimport { Maybe } from '../types';\nimport { getFileMimeFromMagic } from './magic';\n\n/**\n * Determines the file's mime type.\n *\n * Returns the file's mime type for supported mime types.\n */\nexport async function getFileMimeType(file: File): Promise<Maybe<string>> {\n  const fileType = file.type.toLowerCase();\n  if (MIME_TYPES.has(fileType)) {\n    return fileType;\n  }\n\n  if (FILE_EXTENSIONS.has(fileType)) {\n    return FILE_EXT_TO_MIME[fileType];\n  }\n\n  const supportedExt = [...FILE_EXTENSIONS].find((ext) =>\n    file.name.toLowerCase().endsWith(`.${ext}`)\n  );\n  if (supportedExt) {\n    return FILE_EXT_TO_MIME[supportedExt];\n  }\n\n  const mimeFromMagic = await getFileMimeFromMagic(file);\n  if (mimeFromMagic && MIME_TYPES.has(mimeFromMagic)) {\n    return mimeFromMagic;\n  }\n\n  return null;\n}\n\n/**\n * Retypes a given File.\n *\n * Handy for when a file object has no type given.\n * Type is inferred from extension or magic.\n *\n * If type is not supported, file.type will be \"\".\n * @param file\n */\nexport async function retypeFile(file: File): Promise<File> {\n  const type = (await getFileMimeType(file)) ?? '';\n  return new File([file], file.name, { type: type.toLowerCase() });\n}\n\nexport type ReadAsType = 'ArrayBuffer' | 'Text';\n\nasync function readFileAs<T extends ArrayBuffer | string>(\n  file: File,\n  type: ReadAsType\n): Promise<T> {\n  return new Promise((resolve) => {\n    const fio = new globalThis.FileReader();\n    fio.onload = () => resolve(fio.result as T);\n    if (type === 'ArrayBuffer') {\n      fio.readAsArrayBuffer(file);\n    } else if (type === 'Text') {\n      fio.readAsText(file);\n    } else {\n      throw new TypeError(`readAs${type} is not a function`);\n    }\n  });\n}\n\n/**\n * Reads a file and returns an ArrayBuffer\n * @async\n * @param {File} file\n */\nexport async function readFileAsArrayBuffer(file: File) {\n  return readFileAs<ArrayBuffer>(file, 'ArrayBuffer');\n}\n\n/**\n * Reads a file and returns UTF-8 text\n * @async\n * @param {File} file\n */\nexport async function readFileAsUTF8Text(file: File) {\n  return readFileAs<string>(file, 'Text');\n}\n","import JSZip from 'jszip';\nimport { useDatasetStore } from '@/src/store/datasets';\nimport { useSegmentGroupStore } from '@/src/store/segmentGroups';\nimport { useLayersStore } from '@/src/store/datasets-layers';\nimport { useToolStore } from '@/src/store/tools';\nimport { Tools } from '@/src/store/tools/types';\nimport { useViewStore } from '@/src/store/views';\nimport { LayoutDirection } from '@/src/types/layout';\nimport { Manifest } from './schema';\n\nimport { retypeFile } from '../io';\nimport { ARCHIVE_FILE_TYPES } from '../mimeTypes';\n\nexport const MANIFEST = 'manifest.json';\nexport const MANIFEST_VERSION = '4.0.0';\n\nexport async function serialize() {\n  const datasetStore = useDatasetStore();\n  const viewStore = useViewStore();\n  const labelStore = useSegmentGroupStore();\n  const toolStore = useToolStore();\n  const layersStore = useLayersStore();\n\n  const zip = new JSZip();\n  const manifest: Manifest = {\n    version: MANIFEST_VERSION,\n    datasets: [],\n    remoteFiles: {},\n    labelMaps: [],\n    tools: {\n      crosshairs: {\n        position: [0, 0, 0],\n      },\n      paint: {\n        activeSegmentGroupID: null,\n        activeSegment: null,\n        brushSize: 8,\n      },\n      crop: {},\n      current: Tools.WindowLevel,\n    },\n    layout: {\n      direction: LayoutDirection.H,\n      items: [],\n    },\n    views: [],\n    parentToLayers: [],\n  };\n\n  const stateFile = {\n    zip,\n    manifest,\n  };\n\n  await datasetStore.serialize(stateFile);\n  viewStore.serialize(stateFile);\n  await labelStore.serialize(stateFile);\n  toolStore.serialize(stateFile);\n  await layersStore.serialize(stateFile);\n\n  zip.file(MANIFEST, JSON.stringify(manifest));\n\n  return zip.generateAsync({ type: 'blob' });\n}\n\nexport async function isStateFile(file: File) {\n  const typedFile = await retypeFile(file);\n  if (ARCHIVE_FILE_TYPES.has(typedFile.type)) {\n    const zip = await JSZip.loadAsync(typedFile);\n\n    return zip.file(MANIFEST) !== null;\n  }\n\n  return false;\n}\n","import { parseUrl } from '@/src/utils/url';\nimport { Awaitable } from '@vueuse/core';\n\nexport const globalHeaders = new Headers();\n\nexport function setGlobalHeader(name: string, value: string) {\n  globalHeaders.set(name, value);\n}\n\nexport function deleteGlobalHeader(name: string) {\n  globalHeaders.delete(name);\n}\n\n/**\n * Merges two headers.\n *\n * If a header exists in both the base and supplement, the supplement header takes priority.\n *\n * Does not handle duplicate headers.\n */\nfunction mergeHeaders(base: Headers, supplementInit?: HeadersInit) {\n  const merged = new Headers(base);\n  const supplement = new Headers(supplementInit);\n  supplement.forEach((value, name) => {\n    merged.set(name, value);\n  });\n  return merged;\n}\n\nexport const $fetch: typeof fetch = (\n  input: RequestInfo | URL,\n  init?: RequestInit\n): Promise<Response> => {\n  return fetch(input, {\n    ...init,\n    headers: mergeHeaders(globalHeaders, init?.headers),\n  });\n};\n\n/**\n * Percent is in [0, 1]. If it's Infinity, then the progress is indeterminate.\n */\nexport type ProgressCallback = (percent: number) => void;\n\nexport interface FetchCache<T> extends Map<string, Awaitable<T>> {}\n\nexport interface FetchOptions<T> {\n  progress?: ProgressCallback;\n  cache?: FetchCache<T>;\n}\n\ninterface URLHandler {\n  testURL(url: string): boolean;\n  fetchURL(url: string, options?: FetchOptions<unknown>): Promise<Blob | null>;\n}\n\n/**\n * Handles HTTP(S) connections.\n *\n * Progress is approximate, given that data can be sent over gzipped.\n */\nconst HTTPHandler: URLHandler = {\n  testURL: (url) => {\n    const { protocol } = parseUrl(url, window.location.href);\n    return protocol === 'http:' || protocol === 'https:';\n  },\n  fetchURL: async (url, options = {}) => {\n    const { progress } = options;\n\n    const response = await $fetch(url);\n    if (response.status !== 200) {\n      throw new Error(\n        `Fetching resource failed (HTTP code ${response.status})`\n      );\n    }\n\n    if (!progress) {\n      return response.blob();\n    }\n\n    const contentLength = Number(response.headers.get('content-length')) ?? -1;\n    if (contentLength < 0) {\n      progress(Infinity);\n      return response.blob();\n    }\n\n    const reader = response.body?.getReader();\n    if (!reader) {\n      return null;\n    }\n\n    const bytes = new Uint8Array(contentLength);\n    let recv = 0;\n    let done = false;\n    do {\n      // eslint-disable-next-line no-await-in-loop\n      const readData = await reader.read();\n      done = readData.done;\n      if (readData.value && !done) {\n        bytes.set(readData.value, recv);\n        recv += readData.value.length;\n        progress(recv / contentLength);\n      }\n    } while (!done);\n\n    return new Blob([bytes]);\n  },\n};\n\nconst HANDLERS = [HTTPHandler];\n\nexport function canFetchUrl(url: string) {\n  return !!HANDLERS.find((h) => h.testURL(url));\n}\n\n/**\n * Fetches a file.\n * @returns a File instance.\n */\nexport async function fetchFile(\n  url: string,\n  name: string,\n  options?: FetchOptions<File>\n) {\n  const handler = HANDLERS.find((h) => h.testURL(url));\n  if (!handler) {\n    throw new Error(`Cannot find a handler for URL: ${url}`);\n  }\n\n  const cache = options?.cache;\n  if (cache?.has(url)) {\n    return cache.get(url)!;\n  }\n\n  const promise = handler.fetchURL(url, options).then((blob) => {\n    if (!blob) {\n      throw new Error(`Failed to download ${url}`);\n    }\n    return new File([blob], name);\n  });\n\n  // allow trying again on the off-chance the error is transient\n  promise.catch(() => {\n    cache?.delete(url);\n  });\n\n  cache?.set(url, promise);\n  return promise;\n}\n\n/**\n * Fetches json.\n * @returns json data\n */\nexport async function fetchJSON<T>(url: string, options?: FetchOptions<T>) {\n  const handler = HANDLERS.find((h) => h.testURL(url));\n  if (!handler) {\n    throw new Error(`Cannot find a handler for URL: ${url}`);\n  }\n\n  const blob = await handler.fetchURL(url, options);\n  if (!blob) {\n    throw new Error(`Failed to download ${url}`);\n  }\n\n  const buffer = await blob.arrayBuffer();\n  const decoder = new TextDecoder();\n  return JSON.parse(decoder.decode(new Uint8Array(buffer))) as T;\n}\n\nexport async function fetchFileWithProgress(\n  url: string,\n  name: string,\n  progress: ProgressCallback,\n  options: RequestInit | undefined\n): Promise<File | null> {\n  const response = await $fetch(url, options);\n  const contentLength = Number(response.headers.get('content-length')) || 0;\n\n  if (contentLength <= 0) {\n    progress(Infinity);\n\n    const blob = await response.blob();\n    return new File([blob], name);\n  }\n\n  const reader = response.body?.getReader();\n  if (!reader) {\n    return null;\n  }\n\n  const bytes = new Uint8Array(contentLength);\n  let recv = 0;\n  let done = false;\n  do {\n    // eslint-disable-next-line no-await-in-loop\n    const readData = await reader.read();\n    done = readData.done;\n    if (readData.value && !done) {\n      bytes.set(readData.value, recv);\n      recv += readData.value.length;\n      progress(recv / contentLength);\n    }\n  } while (!done);\n\n  return new File([bytes], name);\n}\n","import { serialize } from '@/src/io/state-file';\nimport { useMessageStore } from '@/src/store/messages';\nimport { $fetch } from '@/src/utils/fetch';\nimport { defineStore } from 'pinia';\nimport { ref } from 'vue';\n\nconst useRemoteSaveStateStore = defineStore('remoteSaveState', () => {\n  const saveUrl = ref('');\n  const isSaving = ref(false);\n\n  const messageStore = useMessageStore();\n\n  const setSaveUrl = (url: string) => {\n    saveUrl.value = url;\n  };\n\n  const saveState = async () => {\n    if (!saveUrl.value || isSaving.value) return;\n    try {\n      isSaving.value = true;\n\n      const blob = await serialize();\n      const saveResult = await $fetch(saveUrl.value, {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/zip',\n          'Content-Length': blob.size.toString(),\n        },\n        body: blob,\n      });\n\n      if (saveResult.ok) messageStore.addSuccess('Save Successful');\n      else messageStore.addError('Save Failed', 'Network response not OK');\n    } catch (error) {\n      messageStore.addError('Save Failed with error', `Failed from: ${error}`);\n    } finally {\n      isSaving.value = false;\n    }\n  };\n\n  return {\n    saveUrl,\n    setSaveUrl,\n    isSaving,\n    saveState,\n  };\n});\n\nexport default useRemoteSaveStateStore;\n","<script setup lang=\"ts\">\nconst stopAllButEscape = (e: KeyboardEvent) => {\n  if (e.key !== 'Escape') {\n    e.stopPropagation();\n  }\n};\n</script>\n<template>\n  <v-dialog @keydown=\"stopAllButEscape\"><slot></slot></v-dialog>\n</template>\n","<script setup lang=\"ts\">\n/* globals defineOptions */\nimport { computed, PropType } from 'vue';\nimport { useDisplay } from 'vuetify';\nimport IsolatedDialog from '@/src/components/IsolatedDialog.vue';\n\ndefineOptions({\n  inheritAttrs: false,\n});\n\nconst props = defineProps({\n  modelValue: Boolean,\n  width: {\n    type: String,\n    required: false,\n  },\n  maxWidth: {\n    type: String,\n    default: '960px',\n  },\n  closeOffsetX: {\n    type: Number as PropType<string | number>,\n    default: () => 8,\n  },\n  closeOffsetY: {\n    type: Number as PropType<string | number>,\n    default: () => 8,\n  },\n});\n\nconst $emit = defineEmits(['update:model-value']);\n\nconst close = () => {\n  $emit('update:model-value', false);\n};\n\nconst display = useDisplay();\n\nconst width = computed(() => {\n  if (props.width) {\n    return props.width;\n  }\n  return display.mobile.value ? '100%' : '75%';\n});\nconst maxWidth = computed(() => {\n  return display.mobile.value ? '100%' : props.maxWidth;\n});\n</script>\n\n<template>\n  <isolated-dialog\n    v-bind=\"$attrs\"\n    :content-class=\"['closeable-dialog', $attrs['content-class']]\"\n    :width=\"width\"\n    :max-width=\"maxWidth\"\n    :model-value=\"props.modelValue\"\n    @update:model-value=\"$emit('update:model-value', $event)\"\n  >\n    <v-btn\n      variant=\"flat\"\n      class=\"close-button\"\n      :style=\"{\n        top: `${props.closeOffsetY}px`,\n        right: `${props.closeOffsetX}px`,\n      }\"\n      icon=\"mdi-close\"\n      @click=\"close\"\n    />\n    <slot :close=\"close\" />\n  </isolated-dialog>\n</template>\n\n<style scoped>\n.close-button {\n  position: absolute;\n  z-index: 100;\n}\n</style>\n\n<style>\n/* add padding to inner v-cards */\n.closeable-dialog > .v-card {\n  padding: 8px 0;\n}\n</style>\n","<template svg>\n  <svg\n    width=\"362\"\n    height=\"46\"\n    viewBox=\"0 0 362 46\"\n    fill=\"none\"\n    xmlns=\"http://www.w3.org/2000/svg\"\n  >\n    <g clip-path=\"url(#clip0_137_135)\">\n      <path\n        d=\"M217.55 26.6132C217.498 26.6912 217.447 26.7951 217.37 26.8731C216.06 28.64 213.364 29.3676 210 28.8999C209.846 28.8739 209.692 28.8479 209.537 28.8219C207.509 28.4841 205.3 27.7306 203.092 26.6132C201.782 25.9377 200.472 25.1062 199.214 24.1447C197.853 23.1054 196.621 21.988 195.568 20.7928C193.898 18.9479 192.666 16.9991 191.87 15.1282C190.56 12.0361 190.56 9.28175 191.844 7.48883C193.154 5.7219 195.722 5.04631 198.932 5.54001C200.524 5.77387 202.27 6.31954 204.068 7.12505C205.84 7.93057 207.663 8.99592 209.435 10.3471C212.979 13.0235 215.649 16.2715 217.087 19.3377C218.474 22.2479 218.654 24.8463 217.55 26.6132Z\"\n        fill=\"#3EAE2B\"\n      />\n      <path\n        d=\"M217.55 26.6132C217.498 26.6912 217.447 26.7951 217.37 26.8731C216.06 28.64 213.364 29.3676 210 28.8998C209.846 28.8739 209.692 28.8479 209.537 28.8219C207.663 28.4321 205.506 27.7306 203.092 26.6132C201.782 25.9376 200.473 25.1061 199.214 24.1447C197.853 23.1054 196.621 21.988 195.568 20.7928C193 16.5054 193.539 11.1786 195.08 9.48961C196.954 7.41087 201.243 6.94315 207.945 11.4904C213.852 15.492 218.089 23.2613 217.55 26.6132Z\"\n        fill=\"black\"\n        fill-opacity=\"0.15\"\n      />\n      <path\n        d=\"M214.442 22.2479C214.442 22.7416 214.34 23.1833 214.16 23.5731C214.108 23.703 214.031 23.8329 213.929 23.9628C213.518 24.5345 212.85 24.8983 211.951 25.0801C211.053 25.262 209.974 25.2101 208.767 24.9762C206.353 24.5085 203.58 23.2353 201.14 21.4164C201.115 21.3904 201.063 21.3644 201.037 21.3384C198.675 19.5195 196.877 17.3109 195.876 15.2581C194.849 13.1534 194.772 11.3085 195.619 10.1652C196.441 9.02188 198.213 8.68409 200.498 9.1518C202.784 9.61952 205.429 10.8927 207.843 12.7376C210.257 14.5825 212.26 16.8172 213.415 18.9219C214.108 20.1431 214.442 21.2864 214.442 22.2479Z\"\n        fill=\"#3EAE2B\"\n      />\n      <path\n        d=\"M214.16 23.5731C214.108 23.7031 214.031 23.833 213.929 23.9629C213.518 24.5346 212.85 24.8983 211.951 25.0802C211.053 25.2621 209.974 25.2102 208.767 24.9763C206.353 24.5086 203.58 23.2353 201.14 21.4165C201.114 21.3905 201.063 21.3645 201.037 21.3385C198.187 18.4542 198.059 13.855 199.214 12.5558C200.524 11.3865 202.835 11.4125 207.072 14.2708C210.616 16.6873 213.877 21.1826 214.16 23.5731Z\"\n        fill=\"black\"\n        fill-opacity=\"0.15\"\n      />\n      <path\n        d=\"M210.616 21.4944C210.436 21.7282 210.128 21.8841 209.666 21.9621C209.204 22.0141 208.613 21.9881 207.92 21.8062C206.559 21.4684 204.915 20.6889 203.374 19.5196C201.834 18.3503 200.652 17.0251 199.985 15.8038C199.651 15.2062 199.471 14.6605 199.394 14.1928C199.343 13.7251 199.42 13.4133 199.599 13.1794C199.779 12.9456 200.062 12.7637 200.524 12.7117C200.96 12.6597 201.525 12.6857 202.193 12.8416C202.835 12.9975 203.58 13.2834 204.324 13.6731C205.069 14.0629 205.865 14.5566 206.61 15.1542C208.151 16.3235 209.383 17.6487 210.102 18.844C210.462 19.4416 210.667 19.9873 210.744 20.455C210.847 20.9487 210.77 21.2865 210.616 21.4944Z\"\n        fill=\"#3EAE2B\"\n      />\n      <path\n        d=\"M211.309 21.8061C211.078 22.4038 210.847 22.8455 210.462 23.3912C208.151 26.5093 203.323 26.951 199.933 24.3786C196.543 21.8061 195.67 16.999 197.956 13.8809C198.418 13.3093 198.752 12.9195 199.291 12.4778C199.188 12.5557 199.111 12.6337 199.034 12.7376C198.701 13.1794 198.624 13.725 198.701 14.2967C198.778 14.8683 199.009 15.5179 199.368 16.1675C200.087 17.4668 201.346 18.8959 202.963 20.1172C204.581 21.3384 206.302 22.1699 207.791 22.5077C208.536 22.6896 209.229 22.7416 209.794 22.6636C210.385 22.5857 210.898 22.3518 211.232 21.9101C211.258 21.9101 211.284 21.8581 211.309 21.8061Z\"\n        fill=\"#0068C7\"\n      />\n      <path\n        d=\"M214.879 24.0148C214.571 24.9502 213.441 26.6652 212.747 27.4447C209.101 32.3558 201.448 33.2132 195.953 29.0558C190.483 24.9762 189.482 16.6873 193.128 11.7502C193.693 10.9967 194.643 9.80143 195.465 9.09985C195.285 9.25576 195.105 9.43765 194.951 9.64552C193.821 11.1786 194.078 13.4132 195.131 15.6219C196.21 17.8565 198.136 20.1951 200.627 22.092C201.885 23.0534 203.22 23.8589 204.581 24.4825C205.942 25.1062 207.303 25.5739 208.562 25.8077C209.846 26.0676 211.027 26.1195 212.054 25.9117C213.081 25.7038 213.954 25.2621 214.545 24.4825C214.699 24.3266 214.802 24.1707 214.879 24.0148Z\"\n        fill=\"#0068C7\"\n      />\n      <path\n        d=\"M218.577 26.4054C218.012 27.9385 216.959 29.8353 215.495 31.5503C209.589 38.3582 199.368 39.6314 192.024 34.0448C184.705 28.5101 182.985 18.3503 187.787 10.633C188.865 8.89203 190.945 6.83928 192.178 5.95581C192.152 5.98179 191.459 6.6314 191.176 7.02116C189.61 9.15187 189.738 12.296 191.099 15.466C192.46 18.6881 195.08 22.066 198.701 24.8204C200.524 26.1975 202.424 27.2889 204.324 28.1204C206.225 28.9519 208.125 29.4716 209.871 29.7314C213.364 30.1991 216.445 29.5235 218.012 27.3928C218.243 27.081 218.448 26.7432 218.577 26.4054Z\"\n        fill=\"#0068C7\"\n      />\n      <path\n        d=\"M217.832 18.9739C216.317 15.7779 213.544 12.4259 209.923 9.67158C206.328 6.91725 202.424 5.22828 199.06 4.70859C197.853 4.5267 196.672 4.50072 195.619 4.63064C195.568 4.63064 195.516 4.63064 195.491 4.65662C195.337 4.68261 195.157 4.70859 195.003 4.73458C194.977 4.73458 194.951 4.73458 194.9 4.76056C194.797 4.78654 194.695 4.81253 194.618 4.83851C194.515 4.8645 194.438 4.89048 194.361 4.91647C194.284 4.94245 194.207 4.96843 194.13 4.99442C193.385 5.22828 192.717 5.59206 192.127 6.05977C191.767 6.31962 191.459 6.63143 191.176 7.02119C189.61 9.1519 189.738 12.296 191.099 15.4661C192.46 18.6881 195.08 22.0661 198.701 24.8204C200.524 26.1976 202.424 27.2889 204.324 28.1204C206.225 28.9519 208.125 29.4716 209.871 29.7314C213.364 30.1991 216.445 29.5236 218.012 27.3928C218.243 27.107 218.423 26.7692 218.577 26.4314C219.527 24.3527 219.116 21.6763 217.832 18.9739ZM217.55 26.6133C217.498 26.6913 217.447 26.7952 217.37 26.8732C216.06 28.6401 213.364 29.3676 210 28.8999C209.846 28.8739 209.692 28.848 209.537 28.822C207.509 28.4842 205.3 27.7306 203.092 26.6133C201.782 25.9377 200.473 25.1062 199.214 24.1448C197.853 23.1054 196.621 21.9881 195.568 20.7928C193.899 18.948 192.666 16.9991 191.87 15.1283C190.56 12.0362 190.56 9.28182 191.844 7.48891C193.154 5.72198 195.722 5.04639 198.932 5.54009C200.524 5.77395 202.27 6.31962 204.068 7.12513C205.84 7.93064 207.663 8.99599 209.435 10.3472C212.979 13.0236 215.649 16.2716 217.087 19.3377C218.474 22.248 218.654 24.8464 217.55 26.6133Z\"\n        fill=\"white\"\n      />\n      <path\n        d=\"M214.16 18.5061C212.953 16.2975 210.873 13.9589 208.382 12.062C205.891 10.1652 203.143 8.84 200.704 8.3463C198.88 7.95654 197.16 8.03449 195.927 8.78803C195.901 8.78803 195.876 8.81402 195.876 8.81402C195.876 8.81402 195.85 8.81402 195.85 8.84C195.799 8.86599 195.747 8.89197 195.722 8.94394C195.645 8.99591 195.568 9.07386 195.491 9.12583C195.311 9.28173 195.131 9.46362 194.977 9.6715C193.847 11.2046 194.104 13.4392 195.157 15.6479C196.235 17.8825 198.161 20.2211 200.652 22.118C201.911 23.0794 203.246 23.8849 204.607 24.5085C205.968 25.1321 207.329 25.5998 208.587 25.8337C209.871 26.0935 211.053 26.1455 212.08 25.9376C213.107 25.7298 213.98 25.288 214.571 24.5085C214.673 24.3786 214.776 24.2227 214.853 24.0668C215.675 22.5077 215.238 20.4809 214.16 18.5061ZM213.929 23.9628C213.518 24.5345 212.85 24.8983 211.951 25.0802C211.053 25.262 209.974 25.2101 208.767 24.9762C206.353 24.5085 203.58 23.2353 201.14 21.4164C198.726 19.5975 196.877 17.3369 195.876 15.2581C194.849 13.1534 194.772 11.3085 195.619 10.1652C196.441 9.02189 198.213 8.6841 200.498 9.15181C202.784 9.61953 205.429 10.8928 207.843 12.7376C210.256 14.5825 212.259 16.8172 213.415 18.9219C214.108 20.1691 214.442 21.3124 214.442 22.2739C214.442 22.9235 214.288 23.4951 213.929 23.9628Z\"\n        fill=\"white\"\n      />\n      <path\n        fill-rule=\"evenodd\"\n        clip-rule=\"evenodd\"\n        d=\"M211.515 20.351C211.412 19.7793 211.155 19.1297 210.77 18.4801C210 17.1809 208.716 15.7778 207.098 14.5565C205.506 13.3352 203.837 12.4778 202.398 12.14C201.679 11.9581 201.012 11.9061 200.447 11.9841C200.01 12.036 199.599 12.2179 199.291 12.4778C199.189 12.5557 199.111 12.6337 199.034 12.7376C198.701 13.1793 198.624 13.725 198.701 14.2967C198.778 14.8683 199.009 15.5179 199.368 16.1675C200.087 17.4667 201.346 18.8959 202.963 20.1171C204.581 21.3384 206.302 22.1699 207.791 22.5077C208.536 22.6896 209.229 22.7415 209.794 22.6636C210.385 22.5856 210.899 22.3518 211.232 21.91C211.258 21.8581 211.284 21.8321 211.309 21.7801C211.54 21.3904 211.592 20.8707 211.515 20.351ZM210.616 21.4943C210.436 21.7281 210.128 21.8841 209.666 21.962C209.204 22.014 208.613 21.988 207.92 21.8061C206.559 21.4683 204.915 20.6888 203.374 19.5195C201.834 18.3502 200.652 17.025 199.985 15.8037C199.651 15.2061 199.471 14.6604 199.394 14.1927C199.343 13.725 199.42 13.4132 199.599 13.1793C199.779 12.9455 200.062 12.7636 200.524 12.7116C200.96 12.6596 201.525 12.6856 202.193 12.8415C202.835 12.9974 203.58 13.2833 204.324 13.673C205.069 14.0628 205.865 14.5565 206.61 15.1541C208.151 16.3234 209.383 17.6486 210.102 18.8439C210.462 19.4415 210.667 19.9872 210.744 20.4549C210.847 20.9486 210.77 21.2864 210.616 21.4943Z\"\n        fill=\"white\"\n      />\n    </g>\n    <path\n      d=\"M246.292 9.76333H243.172L235.252 31.1633L227.372 9.76333H224.252L233.692 35.0433H236.852L246.292 9.76333ZM261.251 25.4033C261.251 29.8033 260.131 32.6033 255.691 32.6033C251.251 32.6033 250.091 29.8033 250.091 25.4033C250.091 21.0033 251.251 18.2033 255.691 18.2033C260.131 18.2033 261.251 21.0033 261.251 25.4033ZM255.691 35.3633C261.771 35.3633 264.171 31.2833 264.171 25.4033C264.171 19.4033 261.891 15.4433 255.691 15.4433C249.571 15.4433 247.171 19.5233 247.171 25.4033C247.171 31.4033 249.451 35.3633 255.691 35.3633ZM268.747 29.6833C268.747 33.8433 270.827 35.2833 273.587 35.2833C274.627 35.2833 275.427 35.1233 275.947 34.8833L275.547 32.2433C275.107 32.4433 274.507 32.5233 273.827 32.5233C272.467 32.5233 271.667 31.8833 271.667 29.2433V7.76333H268.747V29.6833Z\"\n      fill=\"#3EAE2B\"\n    />\n    <path\n      d=\"M299.261 9.76333H296.141L288.221 31.1633L280.341 9.76333H277.221L286.661 35.0433H289.821L299.261 9.76333ZM302.505 35.0433H305.425V15.7633H302.505V35.0433ZM302.065 9.16333C302.065 10.2033 302.905 11.0433 303.985 11.0433C305.025 11.0433 305.865 10.2033 305.865 9.16333C305.865 8.12333 305.025 7.24333 303.985 7.24333C302.905 7.24333 302.065 8.08333 302.065 9.16333ZM326.615 23.8833C326.615 18.2833 323.615 15.4433 318.535 15.4433C312.215 15.4433 310.175 19.8833 310.175 25.4433C310.175 32.2833 313.295 35.3633 319.455 35.3633C321.815 35.3633 324.095 34.8833 325.975 34.0433L325.535 31.2833C324.095 32.0433 321.735 32.6033 319.495 32.6033C315.495 32.6033 313.135 30.8033 313.135 26.7233V26.5633H326.295C326.535 25.7233 326.615 24.6833 326.615 23.8833ZM313.135 23.8433C313.135 19.6833 315.215 18.0433 318.455 18.0433C321.735 18.0433 323.815 19.7233 323.815 23.8433V24.0833H313.135V23.8433ZM332.648 15.7633H329.648L336.368 35.0433H339.368L344.608 20.2833L349.848 35.0433H352.848L359.568 15.7633H356.568L351.328 31.0833L346.088 15.7633H343.128L337.888 31.0833L332.648 15.7633Z\"\n      fill=\"#0068C7\"\n    />\n    <path\n      d=\"M8.87229 5.59206L0.781128 14.7137L2.74742 16.9885L13.3699 5.00647H10.1831C9.68593 5.00647 9.2113 5.20917 8.87229 5.59206Z\"\n      fill=\"#3EAE2B\"\n    />\n    <path\n      d=\"M15.0876 5.59206L3.85486 18.2497L5.82115 20.5245L19.5852 5.00647H16.3984C15.9012 5.00647 15.404 5.20917 15.0876 5.59206Z\"\n      fill=\"#3EAE2B\"\n    />\n    <path\n      d=\"M25.7778 5.00647H22.6137C22.1165 5.00647 21.6193 5.23169 21.2802 5.59206L6.90601 21.8083L19.879 36.8308C20.218 37.2137 20.6926 37.4389 21.2124 37.4389H24.3314L10.8386 21.8308L25.7778 5.00647Z\"\n      fill=\"#3EAE2B\"\n    />\n    <path\n      d=\"M12.059 37.4389L0.781128 24.3983V28.9479L7.60663 36.8307C7.94565 37.2136 8.42027 37.4389 8.94009 37.4389H12.059Z\"\n      fill=\"#0068C7\"\n    />\n    <path\n      d=\"M18.2065 37.4389L0.781128 17.2812V21.8308L13.7541 36.8308C14.0931 37.2137 14.5677 37.4389 15.0876 37.4389H18.2065Z\"\n      fill=\"#0068C7\"\n    />\n    <path\n      d=\"M31.2925 7.37134H34.2532V35.029H31.2925V7.37134ZM43.2936 15.4794H47.068L38.9316 24.7137L47.8816 35.0065H44.1073L35.1573 24.7137L43.2936 15.4794Z\"\n      fill=\"#0068C7\"\n    />\n    <path\n      d=\"M51.6786 6.85327C52.7408 6.85327 53.5996 7.75417 53.5996 8.79021C53.5996 9.84877 52.7408 10.7046 51.6786 10.7046C50.5711 10.7046 49.7349 9.84877 49.7349 8.79021C49.7349 7.70913 50.5937 6.85327 51.6786 6.85327ZM50.1869 15.4794H53.1476V35.0289H50.1869V15.4794Z\"\n      fill=\"#0068C7\"\n    />\n    <path\n      d=\"M57.6453 10.2091H60.606V15.4794H68.4486V18.2722H60.606V28.1596C60.606 31.5154 62.1203 32.5289 64.3804 32.5289C66.0077 32.5289 67.7253 32.1235 68.8554 31.6055L69.3074 34.3983C67.9965 34.9614 66.2111 35.3217 64.3804 35.3217C60.4252 35.3217 57.6227 33.4974 57.6227 28.137V10.2091H57.6453Z\"\n      fill=\"#0068C7\"\n    />\n    <path\n      d=\"M79.0032 31.0199L84.337 15.4794H87.343L92.6768 30.9974L97.988 15.4794H101.039L94.2137 35.0289H91.1625L85.8287 20.074L80.4949 35.0289H77.4437L70.6182 15.4794H73.6694L79.0032 31.0199Z\"\n      fill=\"#0068C7\"\n    />\n    <path\n      d=\"M117.109 34.2182C115.278 34.8713 112.385 35.3443 109.673 35.3443C104.949 35.3443 101.83 33.7677 101.83 29.3533C101.83 24.9839 104.972 23.3173 110.283 23.3173H114.148V21.4029C114.148 18.7227 112.272 17.8668 109.176 17.8668C106.893 17.8668 105.017 18.2722 103.797 18.7227L103.345 15.9975C104.927 15.547 106.915 15.1416 109.289 15.1416C113.764 15.1416 117.109 16.7632 117.109 21.6281V34.2182ZM114.148 25.6596H110.328C106.712 25.6596 104.791 26.5605 104.791 29.3083C104.791 32.056 106.712 32.7993 109.582 32.7993C111.006 32.7993 112.882 32.6416 114.148 32.2362V25.6596Z\"\n      fill=\"#0068C7\"\n    />\n    <path\n      d=\"M121.651 16.2902C122.962 15.6821 125.403 15.1866 127.799 15.1866C129.336 15.1866 130.647 15.3443 131.709 15.6821L131.144 18.4299C130.534 18.1821 129.313 17.9794 127.889 17.9794C126.217 17.9794 125.335 18.1821 124.635 18.4975V35.0065H121.674V16.2902H121.651Z\"\n      fill=\"#0068C7\"\n    />\n    <path\n      d=\"M148.931 26.4253H135.528V26.583C135.528 30.7271 137.924 32.5515 141.992 32.5515C144.275 32.5515 146.671 31.9884 148.14 31.2226L148.592 34.0154C146.671 34.8713 144.365 35.3442 141.97 35.3442C135.709 35.3442 132.522 32.2136 132.522 25.2992C132.522 19.6686 134.602 15.1641 141.02 15.1641C146.196 15.1641 149.247 18.0469 149.247 23.7226C149.247 24.5334 149.157 25.5695 148.931 26.4253ZM135.528 23.9253H146.399V23.6776C146.399 19.5109 144.275 17.7992 140.953 17.7992C137.653 17.7992 135.551 19.4659 135.551 23.6776V23.9253H135.528Z\"\n      fill=\"#0068C7\"\n    />\n    <line\n      x1=\"170.559\"\n      y1=\"0.935669\"\n      x2=\"170.559\"\n      y2=\"42.4279\"\n      stroke=\"#CACACA\"\n    />\n    <defs>\n      <clipPath id=\"clip0_137_135\">\n        <rect\n          width=\"34\"\n          height=\"33\"\n          fill=\"white\"\n          transform=\"translate(185.09 4.55261)\"\n        />\n      </clipPath>\n    </defs>\n  </svg>\n</template>\n\n<script>\nexport default {\n  name: 'volview-full-logo',\n};\n</script>\n","import { ref } from 'vue';\nimport { defineStore } from 'pinia';\n\nexport const useKeyboardShortcutsStore = defineStore(\n  'keyboardShortcuts',\n  () => {\n    const settingsOpen = ref(false);\n\n    return {\n      settingsOpen,\n    };\n  }\n);\n","export default \"__VITE_ASSET__9d50cc74__\"","<template>\n  <v-card>\n    <v-card-title class=\"d-flex flex-row justify-center\">\n      <vol-view-full-logo />\n    </v-card-title>\n    <v-alert color=\"secondary\" variant=\"tonal\" class=\"notice\">\n      For investigational use only\n    </v-alert>\n    <v-card-text>\n      <v-btn\n        class=\"my-2\"\n        @click=\"openKeyboardShortcuts\"\n        prepend-icon=\"mdi-keyboard\"\n        color=\"secondary\"\n      >\n        Keyboard Shortcuts and View Controls\n      </v-btn>\n      <h2 class=\"mt-2\">About VolView</h2>\n      <v-divider class=\"mb-2\" />\n      <p class=\"float-right\">\n        <v-img\n          v-show=\"!mobile\"\n          src=\"../assets/KitwareHeadAndNeck.jpg\"\n          alt=\"Head and neck CT rendering\"\n          width=\"200px\"\n          class=\"ma-1\"\n          align=\"center\"\n        /><br />\n      </p>\n      <p>\n        <a\n          rel=\"noopener noreferrer\"\n          target=\"_blank\"\n          href=\"https://volview.kitware.com/\"\n        >\n          <span>VolView</span>\n        </a>\n        is an open-source web application developed at\n        <a\n          rel=\"noopener noreferrer\"\n          target=\"_blank\"\n          href=\"https://kitware.com/\"\n        >\n          <span>Kitware</span>\n        </a>\n        for visualizing and annotating medical images. It key features include:\n      </p>\n\n      <ul>\n        <li>Fast: Drag-and-drop DICOM files for quick viewing</li>\n        <li>\n          Flexible: Designed to be easily integrated into existing systems\n        </li>\n        <li>\n          Beautiful: Cinematic volume rendering to generate high-quality 3D\n          visualizations\n        </li>\n        <li>\n          Friendly: Familiar radiological image visualization and annotation\n          tools\n        </li>\n        <li>\n          Secure: Your data stays on your machine. No cloud services or data\n          servers are used.\n        </li>\n      </ul>\n      <br />\n      VolView is freely available for research, educational, and commercial\n      applications. It is built on a variety of open-source toolkits created by\n      Kitware, such as\n      <a\n        rel=\"noopener noreferrer\"\n        target=\"_blank\"\n        href=\"https://github.com/InsightSoftwareConsortium/itk-wasm/\"\n      >\n        <span>itk-wasm</span>\n      </a>\n      for DICOM I/O and image processing, and\n      <a\n        rel=\"noopener noreferrer\"\n        target=\"_blank\"\n        href=\"https://github.com/Kitware/vtk-js\"\n      >\n        <span>vtk.js</span>\n      </a>\n      for in-browser scientific visualization.\n      <br />\n      <br />\n      Want help customizing VolView or creating a new web-based visualization\n      application?\n      <a\n        rel-=\"noopener noreferrer\"\n        target=\"_blank\"\n        href=\"https://www.kitware.com/contact/project/\"\n        >Contact Kitware!</a\n      >\n      <h2 class=\"mt-2\">Useful Links</h2>\n      <v-divider class=\"mb-2\" />\n      <ul>\n        <li>\n          <span>VolView source code repo: </span>\n          <a\n            rel=\"noopener noreferrer\"\n            target=\"_blank\"\n            href=\"https://github.com/Kitware/VolView\"\n          >\n            https://github.com/Kitware/VolView\n          </a>\n        </li>\n        <li>\n          <span>Community support forum: </span>\n          <a\n            rel=\"noopener noreferrer\"\n            target=\"_blank\"\n            href=\"https://discourse.vtk.org/c/web/volview/14\"\n          >\n            https://discourse.vtk.org/c/web/volview/14\n          </a>\n        </li>\n        <li>\n          <span>File an bug report or feature request: </span>\n          <a\n            rel=\"noopener noreferrer\"\n            target=\"_blank\"\n            href=\"https://github.com/Kitware/VolView/issues\"\n          >\n            https://github.com/Kitware/VolView/issues\n          </a>\n        </li>\n      </ul>\n      <h2>Version Info</h2>\n      <v-divider class=\"mb-2\" />\n      <ul>\n        <li>\n          <div class=\"d-flex flex-flow align-center text-no-wrap\">\n            <span>VolView: </span>\n            <v-badge inline :content=\"versions.volview\" />\n          </div>\n        </li>\n        <li>\n          <div class=\"d-flex flex-flow align-center text-no-wrap\">\n            <span>vtk.js: </span>\n            <v-badge inline :content=\"versions['vtk.js']\" />\n          </div>\n        </li>\n        <li>\n          <div class=\"d-flex flex-flow align-center text-no-wrap\">\n            <span>itk-wasm: </span>\n            <v-badge inline :content=\"versions['itk-wasm']\" />\n          </div>\n        </li>\n      </ul>\n      <h2 class=\"mt-2\">Acknowledgments</h2>\n      <v-divider class=\"mb-2\" />\n      This work was funded, in part, by the NIH via NIBIB and NIGMS R01EB021396,\n      NIBIB R01EB014955, NCI R01CA220681, and NINDS R42NS086295\n      <br />\n      <br />\n      Sample data provided by the following sources:\n      <ul>\n        <li>\n          PROSTATEx Challenge Data: Geert Litjens, Oscar Debats, Jelle Barentsz,\n          Nico Karssemeijer, and Henkjan Huisman. \"ProstateX Challenge data\",\n          The Cancer Imaging Archive (2017). DOI: 10.7937/K9TCIA.2017.MURS5CL\n          (<a\n            rel=\"noopener noreferrer\"\n            target=\"_blank\"\n            href=\"https://wiki.cancerimagingarchive.net/pages/viewpage.action?pageId=23691656\"\n            >TCIA</a\n          >)\n        </li>\n        <li>\n          MRA Head and Neck: Test case 98890234 from the \"Patient Contributed\n          Image Repository\" (<a\n            rel=\"noopener noreferrer\"\n            target=\"_blank\"\n            href=\"http://www.pcir.org/researchers/98890234_20030505_MR.html\"\n            >PCIR.org</a\n          >)\n        </li>\n        <li>\n          3D ultrasound of a fetus: Sample data from\n          <a\n            rel=\"noopener noreferrer\"\n            target=\"_blank\"\n            href=\"http://tomovision.com\"\n            >tomovision.com</a\n          >\n        </li>\n      </ul>\n    </v-card-text>\n  </v-card>\n</template>\n\n<style scoped>\n.notice {\n  width: fit-content;\n  margin: 0 auto;\n  text-transform: uppercase;\n}\n</style>\n\n<script>\n/* global __VERSIONS__ */\n\nimport { defineComponent } from 'vue';\nimport { useDisplay } from 'vuetify';\nimport VolViewFullLogo from './icons/VolViewFullLogo.vue';\nimport { useKeyboardShortcutsStore } from '../store/keyboard-shortcuts';\n\nexport default defineComponent({\n  name: 'AboutBox',\n  components: {\n    VolViewFullLogo,\n  },\n  setup() {\n    const display = useDisplay();\n\n    const keyboardStore = useKeyboardShortcutsStore();\n    const openKeyboardShortcuts = () => {\n      keyboardStore.settingsOpen = true;\n    };\n\n    return {\n      openKeyboardShortcuts,\n      mobile: display.xs,\n      versions: {\n        volview: __VERSIONS__.volview,\n        'vtk.js': __VERSIONS__['vtk.js'],\n        'itk-wasm': __VERSIONS__['itk-wasm'],\n      },\n    };\n  },\n});\n</script>\n","<template svg>\n  <svg\n    width=\"178\"\n    height=\"41\"\n    viewBox=\"0 0 178 41\"\n    fill=\"none\"\n    xmlns=\"http://www.w3.org/2000/svg\"\n  >\n    <g clip-path=\"url(#clip0_137_151)\">\n      <path\n        d=\"M33.2403 22.3722C33.189 22.4501 33.1376 22.554 33.0606 22.632C31.7509 24.3989 29.0545 25.1265 25.6905 24.6588C25.5364 24.6328 25.3823 24.6068 25.2282 24.5808C23.1995 24.243 20.9911 23.4895 18.7826 22.3722C17.4729 21.6966 16.1633 20.8651 14.905 19.9037C13.5439 18.8643 12.3113 17.747 11.2584 16.5517C9.58926 14.7068 8.35663 12.758 7.56056 10.8871C6.25089 7.79499 6.25089 5.04066 7.53488 3.24774C8.84455 1.48082 11.4125 0.805225 14.6225 1.29893C16.2146 1.53278 17.9609 2.07845 19.7584 2.88396C21.5303 3.68948 23.3536 4.75483 25.1255 6.10601C28.6693 8.78239 31.34 12.0304 32.7781 15.0966C34.1648 18.0068 34.3445 20.6052 33.2403 22.3722Z\"\n        fill=\"#3EAE2B\"\n      />\n      <path\n        d=\"M33.2404 22.3721C33.189 22.4501 33.1377 22.554 33.0606 22.632C31.7509 24.3989 29.0546 25.1265 25.6905 24.6588C25.5364 24.6328 25.3824 24.6068 25.2283 24.5808C23.3537 24.191 21.1966 23.4895 18.7827 22.3721C17.473 21.6966 16.1633 20.8651 14.905 19.9036C13.544 18.8643 12.3114 17.7469 11.2585 16.5517C8.69052 12.2643 9.2298 6.9375 10.7706 5.24852C12.6452 3.16978 16.9337 2.70206 23.6361 7.24931C29.5425 11.2509 33.7796 19.0202 33.2404 22.3721Z\"\n        fill=\"black\"\n        fill-opacity=\"0.15\"\n      />\n      <path\n        d=\"M30.1331 18.0068C30.1331 18.5005 30.0304 18.9422 29.8506 19.332C29.7993 19.4619 29.7222 19.5918 29.6195 19.7217C29.2086 20.2934 28.541 20.6572 27.6422 20.8391C26.7434 21.021 25.6648 20.969 24.4579 20.7351C22.044 20.2674 19.2706 18.9942 16.831 17.1753C16.8053 17.1493 16.7539 17.1233 16.7283 17.0973C14.3657 15.2784 12.5681 13.0698 11.5666 11.017C10.5394 8.91229 10.4624 7.06741 11.3098 5.9241C12.1316 4.78079 13.9035 4.443 16.189 4.91071C18.4745 5.37843 21.1195 6.65166 23.5334 8.49654C25.9473 10.3414 27.9503 12.5761 29.1059 14.6808C29.7993 15.9021 30.1331 17.0454 30.1331 18.0068Z\"\n        fill=\"#3EAE2B\"\n      />\n      <path\n        d=\"M29.8506 19.3321C29.7992 19.462 29.7222 19.5919 29.6195 19.7218C29.2086 20.2935 28.5409 20.6573 27.6421 20.8391C26.7433 21.021 25.6648 20.9691 24.4578 20.7352C22.0439 20.2675 19.2705 18.9943 16.831 17.1754C16.8053 17.1494 16.7539 17.1234 16.7282 17.0974C13.8778 14.2132 13.7494 9.61394 14.905 8.31473C16.2146 7.14544 18.5258 7.17142 22.763 10.0297C26.3068 12.4462 29.5681 16.9415 29.8506 19.3321Z\"\n        fill=\"black\"\n        fill-opacity=\"0.15\"\n      />\n      <path\n        d=\"M26.3068 17.2533C26.1271 17.4871 25.8189 17.6431 25.3567 17.721C24.8944 17.773 24.3038 17.747 23.6105 17.5651C22.2494 17.2273 20.6059 16.4478 19.0651 15.2785C17.5243 14.1092 16.3431 12.784 15.6754 11.5627C15.3416 10.9651 15.1618 10.4194 15.0848 9.95171C15.0334 9.484 15.1105 9.17219 15.2902 8.93833C15.47 8.70447 15.7524 8.52258 16.2147 8.47061C16.6512 8.41864 17.2162 8.44463 17.8839 8.60053C18.5259 8.75644 19.2706 9.04227 20.0153 9.43203C20.76 9.82179 21.5561 10.3155 22.3008 10.9131C23.8416 12.0824 25.0742 13.4076 25.7932 14.6029C26.1528 15.2005 26.3582 15.7462 26.4352 16.2139C26.5379 16.7076 26.4609 17.0454 26.3068 17.2533Z\"\n        fill=\"#3EAE2B\"\n      />\n      <path\n        d=\"M27.0001 17.565C26.769 18.1627 26.5379 18.6044 26.1527 19.1501C23.8415 22.2682 19.0137 22.7099 15.624 20.1375C12.2343 17.565 11.3612 12.758 13.6467 9.63984C14.1089 9.06819 14.4427 8.67843 14.982 8.23669C14.8793 8.31465 14.8022 8.3926 14.7252 8.49654C14.3914 8.93827 14.3143 9.48394 14.3914 10.0556C14.4684 10.6272 14.6995 11.2769 15.059 11.9265C15.7781 13.2257 17.0364 14.6548 18.6542 15.8761C20.272 17.0973 21.9926 17.9288 23.482 18.2666C24.2267 18.4485 24.9201 18.5005 25.485 18.4225C26.0757 18.3446 26.5893 18.1107 26.9231 17.669C26.9488 17.669 26.9745 17.617 27.0001 17.565Z\"\n        fill=\"#0068C7\"\n      />\n      <path\n        d=\"M30.5696 19.7737C30.2615 20.7092 29.1316 22.4241 28.4382 23.2036C24.7917 28.1147 17.1391 28.9722 11.6436 24.8147C6.17386 20.7351 5.17235 12.4462 8.81888 7.50916C9.38383 6.75562 10.334 5.56034 11.1557 4.85876C10.976 5.01467 10.7962 5.19656 10.6421 5.40443C9.51223 6.93751 9.76903 9.17215 10.8219 11.3808C11.9004 13.6155 13.8264 15.954 16.3174 17.8509C17.5757 18.8123 18.911 19.6178 20.272 20.2414C21.6331 20.8651 22.9941 21.3328 24.2524 21.5666C25.5364 21.8265 26.7177 21.8784 27.7449 21.6706C28.7721 21.4627 29.6452 21.021 30.2358 20.2414C30.3899 20.0855 30.4926 19.9296 30.5696 19.7737Z\"\n        fill=\"#0068C7\"\n      />\n      <path\n        d=\"M34.2675 22.1643C33.7025 23.6974 32.6497 25.5942 31.1859 27.3092C25.2796 34.1171 15.059 35.3903 7.71463 29.8037C0.395901 24.2691 -1.32464 14.1092 3.47747 6.39189C4.55602 4.65094 6.63608 2.59819 7.86871 1.71472C7.84303 1.74071 7.14968 2.39031 6.8672 2.78008C5.30074 4.91078 5.42913 8.05488 6.79016 11.225C8.15119 14.447 10.7705 17.825 14.3914 20.5793C16.2146 21.9565 18.1149 23.0478 20.0152 23.8793C21.9155 24.7108 23.8158 25.2305 25.5621 25.4903C29.0545 25.958 32.1361 25.2824 33.7026 23.1517C33.9337 22.8399 34.1391 22.5021 34.2675 22.1643Z\"\n        fill=\"#0068C7\"\n      />\n      <path\n        d=\"M33.5228 14.7329C32.0077 11.5368 29.2343 8.18483 25.6135 5.4305C22.0183 2.67616 18.115 0.987188 14.7509 0.467503C13.544 0.285613 12.3627 0.259629 11.3098 0.38955C11.2585 0.38955 11.2071 0.38955 11.1814 0.415535C11.0274 0.441519 10.8476 0.467503 10.6935 0.493487C10.6679 0.493487 10.6422 0.493487 10.5908 0.519472C10.4881 0.545456 10.3854 0.57144 10.3083 0.597424C10.2056 0.623409 10.1286 0.649393 10.0515 0.675377C9.9745 0.701361 9.89746 0.727346 9.82042 0.75333C9.07571 0.987188 8.40803 1.35097 7.8174 1.81868C7.45788 2.07853 7.14973 2.39034 6.86725 2.7801C5.30078 4.91081 5.42918 8.0549 6.79021 11.225C8.15124 14.447 10.7706 17.825 14.3914 20.5793C16.2147 21.9565 18.115 23.0478 20.0153 23.8793C21.9156 24.7108 23.8159 25.2305 25.5621 25.4903C29.0546 25.9581 32.1361 25.2825 33.7026 23.1518C33.9337 22.8659 34.1135 22.5281 34.2675 22.1903C35.2177 20.1116 34.8068 17.4352 33.5228 14.7329ZM33.2404 22.3722C33.189 22.4502 33.1376 22.5541 33.0606 22.6321C31.7509 24.399 29.0546 25.1266 25.6905 24.6588C25.5364 24.6329 25.3824 24.6069 25.2283 24.5809C23.1996 24.2431 20.9911 23.4895 18.7827 22.3722C17.473 21.6966 16.1633 20.8651 14.905 19.9037C13.544 18.8644 12.3114 17.747 11.2585 16.5518C9.5893 14.7069 8.35667 12.7581 7.5606 10.8872C6.25093 7.79506 6.25093 5.04073 7.53492 3.24782C8.84459 1.48089 11.4126 0.805298 14.6225 1.299C16.2147 1.53286 17.9609 2.07853 19.7585 2.88404C21.5304 3.68955 23.3537 4.7549 25.1256 6.10609C28.6694 8.78246 31.3401 12.0305 32.7781 15.0966C34.1648 18.0069 34.3446 20.6053 33.2404 22.3722Z\"\n        fill=\"white\"\n      />\n      <path\n        d=\"M29.8506 14.2651C28.6436 12.0564 26.5636 9.71781 24.0726 7.82096C21.5817 5.92411 18.834 4.59891 16.3944 4.10521C14.5711 3.71545 12.8506 3.7934 11.618 4.54694C11.5923 4.54694 11.5666 4.57293 11.5666 4.57293C11.5666 4.57293 11.5409 4.57293 11.5409 4.59891C11.4896 4.6249 11.4382 4.65088 11.4125 4.70285C11.3355 4.75482 11.2584 4.83277 11.1814 4.88474C11.0016 5.04065 10.8219 5.22254 10.6678 5.43041C9.5379 6.96348 9.79469 9.19813 10.8476 11.4068C11.9261 13.6414 13.8521 15.98 16.343 17.8769C17.6013 18.8383 18.9367 19.6438 20.2977 20.2674C21.6587 20.891 23.0198 21.3588 24.2781 21.5926C25.5621 21.8525 26.7433 21.9044 27.7705 21.6966C28.7977 21.4887 29.6708 21.0469 30.2615 20.2674C30.3642 20.1375 30.4669 19.9816 30.5439 19.8257C31.3657 18.2666 30.9291 16.2399 29.8506 14.2651ZM29.6195 19.7217C29.2086 20.2934 28.5409 20.6572 27.6421 20.8391C26.7433 21.021 25.6648 20.969 24.4578 20.7351C22.0439 20.2674 19.2705 18.9942 16.8309 17.1753C14.4171 15.3564 12.5681 13.0958 11.5666 11.017C10.5394 8.9123 10.4624 7.06742 11.3098 5.92411C12.1316 4.7808 13.9035 4.44301 16.189 4.91072C18.4745 5.37844 21.1195 6.65167 23.5334 8.49655C25.9473 10.3414 27.9503 12.5761 29.1059 14.6808C29.7992 15.928 30.1331 17.0714 30.1331 18.0328C30.1331 18.6824 29.979 19.254 29.6195 19.7217Z\"\n        fill=\"white\"\n      />\n      <path\n        fill-rule=\"evenodd\"\n        clip-rule=\"evenodd\"\n        d=\"M27.2056 16.1099C27.1029 15.5382 26.8461 14.8886 26.4609 14.239C25.6905 12.9398 24.4065 11.5367 22.7887 10.3154C21.1965 9.09415 19.5274 8.23667 18.0893 7.89887C17.3703 7.71698 16.7026 7.66501 16.1376 7.74296C15.7011 7.79493 15.2902 7.97682 14.982 8.23667C14.8793 8.31462 14.8023 8.39257 14.7252 8.49651C14.3914 8.93824 14.3144 9.48391 14.3914 10.0556C14.4684 10.6272 14.6996 11.2768 15.0591 11.9264C15.7781 13.2256 17.0364 14.6548 18.6542 15.876C20.2721 17.0973 21.9926 17.9288 23.482 18.2666C24.2268 18.4485 24.9201 18.5004 25.4851 18.4225C26.0757 18.3445 26.5893 18.1107 26.9231 17.6689C26.9488 17.617 26.9745 17.591 27.0002 17.539C27.2313 17.1493 27.2826 16.6296 27.2056 16.1099ZM26.3068 17.2532C26.1271 17.4871 25.8189 17.643 25.3567 17.7209C24.8944 17.7729 24.3038 17.7469 23.6104 17.565C22.2494 17.2272 20.6059 16.4477 19.0651 15.2784C17.5243 14.1091 16.3431 12.7839 15.6754 11.5626C15.3416 10.965 15.1618 10.4193 15.0848 9.95163C15.0334 9.48391 15.1104 9.1721 15.2902 8.93824C15.47 8.70438 15.7524 8.52249 16.2147 8.47052C16.6512 8.41855 17.2162 8.44454 17.8839 8.60044C18.5259 8.75635 19.2706 9.04218 20.0153 9.43194C20.76 9.8217 21.5561 10.3154 22.3008 10.913C23.8416 12.0823 25.0742 13.4075 25.7932 14.6028C26.1527 15.2004 26.3582 15.7461 26.4352 16.2138C26.5379 16.7075 26.4609 17.0453 26.3068 17.2532Z\"\n        fill=\"white\"\n      />\n    </g>\n    <path\n      d=\"M61.9829 5.52224H58.8629L50.9429 26.9222L43.0629 5.52224H39.9429L49.3829 30.8022H52.5429L61.9829 5.52224ZM76.9417 21.1622C76.9417 25.5622 75.8217 28.3622 71.3817 28.3622C66.9417 28.3622 65.7817 25.5622 65.7817 21.1622C65.7817 16.7622 66.9417 13.9622 71.3817 13.9622C75.8217 13.9622 76.9417 16.7622 76.9417 21.1622ZM71.3817 31.1222C77.4617 31.1222 79.8617 27.0422 79.8617 21.1622C79.8617 15.1622 77.5817 11.2022 71.3817 11.2022C65.2617 11.2022 62.8617 15.2822 62.8617 21.1622C62.8617 27.1622 65.1417 31.1222 71.3817 31.1222ZM84.4373 25.4422C84.4373 29.6022 86.5173 31.0422 89.2773 31.0422C90.3173 31.0422 91.1173 30.8822 91.6373 30.6422L91.2373 28.0022C90.7973 28.2022 90.1973 28.2822 89.5173 28.2822C88.1573 28.2822 87.3573 27.6422 87.3573 25.0022V3.52224H84.4373V25.4422Z\"\n      fill=\"#3EAE2B\"\n    />\n    <path\n      d=\"M114.952 5.52224H111.832L103.912 26.9222L96.0317 5.52224H92.9117L102.352 30.8022H105.512L114.952 5.52224ZM118.196 30.8022H121.116V11.5222H118.196V30.8022ZM117.756 4.92225C117.756 5.96224 118.596 6.80225 119.676 6.80225C120.716 6.80225 121.556 5.96224 121.556 4.92225C121.556 3.88224 120.716 3.00224 119.676 3.00224C118.596 3.00224 117.756 3.84225 117.756 4.92225ZM142.306 19.6422C142.306 14.0422 139.306 11.2022 134.226 11.2022C127.906 11.2022 125.866 15.6422 125.866 21.2022C125.866 28.0422 128.986 31.1222 135.146 31.1222C137.506 31.1222 139.786 30.6422 141.666 29.8022L141.226 27.0422C139.786 27.8022 137.426 28.3622 135.186 28.3622C131.186 28.3622 128.826 26.5622 128.826 22.4822V22.3222H141.986C142.226 21.4822 142.306 20.4422 142.306 19.6422ZM128.826 19.6022C128.826 15.4422 130.906 13.8022 134.146 13.8022C137.426 13.8022 139.506 15.4822 139.506 19.6022V19.8422H128.826V19.6022ZM148.339 11.5222H145.339L152.059 30.8022H155.059L160.299 16.0422L165.539 30.8022H168.539L175.259 11.5222H172.259L167.019 26.8422L161.779 11.5222H158.819L153.579 26.8422L148.339 11.5222Z\"\n      fill=\"#0068C7\"\n    />\n    <defs>\n      <clipPath id=\"clip0_137_151\">\n        <rect\n          width=\"34\"\n          height=\"33\"\n          fill=\"white\"\n          transform=\"translate(0.781128 0.311523)\"\n        />\n      </clipPath>\n    </defs>\n  </svg>\n</template>\n","<script setup>\nimport { ref } from 'vue';\nimport { useDisplay } from 'vuetify';\nimport CloseableDialog from '@/src/components/CloseableDialog.vue';\nimport AboutBox from '@/src/components/AboutBox.vue';\nimport VolViewFullLogo from '@/src/components/icons/VolViewFullLogo.vue';\nimport VolViewLogo from '@/src/components/icons/VolViewLogo.vue';\n\nconst emit = defineEmits(['click:left-menu']);\n\nconst { mobile } = useDisplay();\nconst aboutBoxDialog = ref(false);\n</script>\n\n<template>\n  <v-app-bar app clipped-left :height=\"48\">\n    <v-btn icon=\"mdi-menu\" @click=\"emit('click:left-menu')\" />\n    <v-toolbar-title class=\"d-flex flex-row align-center mt-3\">\n      <vol-view-logo v-if=\"mobile\" />\n      <vol-view-full-logo v-else />\n    </v-toolbar-title>\n    <v-btn\n      variant=\"text\"\n      icon\n      :rounded=\"0\"\n      class=\"toolbar-button\"\n      href=\"https://volview.kitware.com/feedback/\"\n      target=\"_blank\"\n    >\n      <v-icon icon=\"mdi-comment-question-outline\"></v-icon>\n      <v-tooltip activator=\"parent\" location=\"bottom\">\n        Ask Question/Submit Feedback\n      </v-tooltip>\n    </v-btn>\n    <v-btn\n      variant=\"text\"\n      icon\n      :rounded=\"0\"\n      class=\"toolbar-button\"\n      @click=\"aboutBoxDialog = !aboutBoxDialog\"\n    >\n      <v-icon icon=\"mdi-information-outline\"></v-icon>\n      <v-tooltip activator=\"parent\" location=\"bottom\">About</v-tooltip>\n    </v-btn>\n  </v-app-bar>\n  <closeable-dialog v-model=\"aboutBoxDialog\">\n    <about-box />\n  </closeable-dialog>\n</template>\n\n<style src=\"@/src/components/styles/utils.css\"></style>\n<style scoped>\n.toolbar-button {\n  min-height: 100%; /* fill toolbar height */\n}\n</style>\n","import { Awaitable } from '@vueuse/core';\nimport { Maybe } from '@/src/types';\nimport { defer, partitionByType } from '../utils';\n\n/**\n * Represents a pipeline error.\n *\n * The inputDataStackTrace property provides the inputs that caused the error.\n * It is ordered by nested level, starting with the inner most execution context\n * input.\n *\n * The cause property refers to the original thrown object that resulted in the\n * error.\n */\nexport interface PipelineError<DataType> {\n  message: string;\n  inputDataStackTrace: DataType[];\n  cause: unknown;\n}\n\nexport interface PipelineResultSuccess<ResultType> {\n  ok: true;\n  data: ResultType[];\n}\n\nexport interface PipelineResultError<DataType> {\n  ok: false;\n  errors: PipelineError<DataType>[];\n}\n\n/**\n * Represents a pipeline's execution result.\n *\n * The data property holds any return values from handlers.\n *\n * The errors property holds any errors reported from (potentially nested)\n * executions.\n */\nexport type PipelineResult<DataType, ResultType> =\n  | PipelineResultSuccess<ResultType>\n  | PipelineResultError<DataType>;\n\nexport const partitionResults = <T, U>(arr: Array<PipelineResult<T, U>>) =>\n  partitionByType(\n    (r: PipelineResult<T, U>): r is PipelineResultSuccess<U> => r.ok,\n    arr\n  );\n\nfunction createPipelineError<DataType>(\n  message: string,\n  input: DataType,\n  cause: unknown\n) {\n  return {\n    message,\n    inputDataStackTrace: [input],\n    cause,\n  };\n}\n\nexport interface IPipeline<DataType, ResultType> {\n  /**\n   * Runs a given input through a middleware pipeline.\n   * @param input\n   */\n  execute(input: DataType): Promise<PipelineResult<DataType, ResultType>>;\n}\n\nconst DoneSentinel: symbol = Symbol('DoneSentinel');\ntype DoneSentinelType = symbol;\nexport type Done<Out> = (out?: Out) => DoneSentinelType;\n\nexport interface PipelineContext<DataType, ResultType, ExtraContext> {\n  /**\n   * Terminate the pipeline with an optional pipeline return value.\n   * @param pipelineReturn\n   */\n  done: Done<ResultType>;\n  /**\n   * Execute the pipeline with the given input.\n   * @param input\n   */\n  execute(\n    input: DataType,\n    extra?: ExtraContext\n  ): Promise<PipelineResult<DataType, ResultType>>;\n  /**\n   * Any extra user-supplied data.\n   */\n  extra?: ExtraContext;\n}\n\n/**\n * Represents an element/step of a pipeline.\n *\n * Handlers have three pipeline operations availble to them:\n * - process input and produce output for the rest of the pipeline\n * - terminate the pipeline and optionally produce a result\n * - start a nested execution of the pipeline with new data\n *\n * Handlers receive input data via the `input` parameter and pass data down the\n * pipeline by returning. Pipeline execution will await asynchronous handlers if\n * they return a Promise that resolves to the output data.\n *\n * The second argument to a handler is a context object containing an\n * `execute()` method and a `done()` method.\n *\n * A handler is free to start new pipeline executions by calling\n * `execute(input)`.  The handler does not need to await the `execute` call, as\n * the top-level pipeline will track all nested executions.\n *\n * If a handler wishes to terminate the pipeline, it must call `done()`. This\n * will signal the pipeline to terminate after the handler returns.  An optional\n * pipeline result value can be passed as the single argument to `done(output)`.\n * If `done()` is signalled, then the handler's return value is ignored.\n *\n * To facilitate typing and to avoid accidentally forgetting to return a value\n * in a handler, handlers are typed to return either the DataType or the return\n * value of done().\n */\nexport type Handler<\n  DataType,\n  ResultType = undefined,\n  ExtraContext = undefined\n> = (\n  input: DataType,\n  context: PipelineContext<DataType, ResultType, ExtraContext>\n) => Awaitable<DataType | DoneSentinelType>;\n\n/**\n * Represents an executable pipeline.\n *\n * Features supported:\n * - Execution of a pipeline in the given order of the provided handlers\n * - Handlers can run nested executions of the same pipeline\n * - Handlers can optionally transform data for downstream use\n * - Early termination\n * - Reporting errors. This includes un-nesting errors from nested executions.\n * - Reporting data returned from terminating handlers, if any.\n */\nexport default class Pipeline<\n  DataType,\n  ResultType = undefined,\n  ExtraContext = undefined\n> implements IPipeline<DataType, ResultType>\n{\n  private handlers: Handler<DataType, ResultType, ExtraContext>[];\n\n  constructor(handlers?: Handler<DataType, ResultType, ExtraContext>[]) {\n    this.handlers = Array.from(handlers ?? []);\n  }\n\n  /**\n   * Executes the pipeline with a given input.\n   *\n   * This method will resolve once this execution context and all\n   * nested execution contexts have finished, allowing for aggregate\n   * error reporting.\n   *\n   * Extra context data can be passed to all handlers via the `.extra` property.\n   * In nested execution scenarios, handlers may choose to pass their own extra\n   * context data into `execute(arg, extra)`. If none is supplied, the extra\n   * context data from the outermost `execute()` call is used.\n   *\n   * @param input\n   * @param extraContext\n   * @returns {PipelineResult}\n   */\n  async execute(input: DataType, extraContext?: ExtraContext) {\n    return this.startExecutionContext(input, extraContext);\n  }\n\n  private async startExecutionContext(\n    input: DataType,\n    extraContext?: ExtraContext\n  ) {\n    const handlers = [...this.handlers];\n    const nestedExecutions: Array<\n      Promise<PipelineResult<DataType, ResultType>>\n    > = [];\n    const execution = defer<Maybe<ResultType>>();\n\n    const terminate = (result: Maybe<ResultType>, error?: Error) => {\n      if (error) {\n        execution.reject(error);\n      } else {\n        execution.resolve(result);\n      }\n    };\n\n    const invokeHandler = async (data: DataType, index: number) => {\n      let doneInvoked = false;\n      // eslint-disable-next-line no-undef-init\n      let pipelineResult: ResultType | undefined = undefined;\n      const endOfPipeline = index >= handlers.length;\n\n      const context: PipelineContext<DataType, ResultType, ExtraContext> = {\n        done: (out?: ResultType): DoneSentinelType => {\n          if (doneInvoked) {\n            throw new Error('done() called twice!');\n          }\n\n          doneInvoked = true;\n          pipelineResult = out;\n          return DoneSentinel;\n        },\n        execute: async (arg: DataType, innerExtra?: ExtraContext) => {\n          const promise = this.execute(arg, innerExtra ?? extraContext);\n          nestedExecutions.push(promise);\n          return promise;\n        },\n        extra: extraContext,\n      };\n\n      let output: DataType | DoneSentinelType;\n\n      if (endOfPipeline) {\n        output = DoneSentinel;\n      }\n\n      try {\n        if (endOfPipeline) {\n          output = DoneSentinel;\n        } else {\n          const handler = handlers[index];\n          output = await handler(data, context);\n        }\n      } catch (thrown) {\n        const error =\n          thrown instanceof Error\n            ? thrown\n            : new Error(thrown ? String(thrown) : 'Unknown error occurred');\n        terminate(undefined, error);\n        return;\n      }\n\n      if (doneInvoked || endOfPipeline) {\n        terminate(pipelineResult);\n        return;\n      }\n\n      invokeHandler(output as DataType, index + 1);\n    };\n\n    const result: PipelineResult<DataType, ResultType> = await (async () => {\n      try {\n        await invokeHandler(input, 0);\n        const ret = await execution.promise;\n        if (ret != null) {\n          return {\n            ok: true as const,\n            data: [ret] as Array<ResultType>,\n          };\n        }\n        return { ok: true as const, data: [] };\n      } catch (err) {\n        const message = err instanceof Error ? err.message : String(err);\n        return {\n          ok: false as const,\n          errors: [createPipelineError(message, input, err)],\n        };\n      }\n    })();\n\n    const innerResults = await Promise.all(nestedExecutions);\n    const [succeededInner, failedInner] = partitionResults(innerResults);\n\n    if (failedInner.length > 0) {\n      const errors = failedInner.flatMap((failedResult) => {\n        const { errors: innerErrors } = failedResult;\n        // add current input to the input stack trace\n        innerErrors.forEach((err) => {\n          err.inputDataStackTrace.push(input);\n        });\n        return innerErrors;\n      });\n\n      return {\n        ok: false as const,\n        errors,\n      };\n    }\n\n    if (result.ok) {\n      succeededInner.forEach((okResult) => {\n        result.data.push(...okResult.data);\n      });\n    }\n\n    return result;\n  }\n}\n","import { FetchCache } from '@/src/utils/fetch';\nimport { DataSource, FileSource } from '@/src/io/import/dataSource';\nimport { Handler } from '@/src/core/pipeline';\nimport { ARCHIVE_FILE_TYPES } from '@/src/io/mimeTypes';\nimport { Awaitable } from '@vueuse/core';\nimport { Config } from '@/src/io/import/configJson';\n\ninterface DataResult {\n  dataSource: DataSource;\n}\n\nexport interface LoadableResult extends DataResult {\n  dataID: string;\n  dataType: 'image' | 'dicom' | 'model';\n}\n\nexport interface VolumeResult extends LoadableResult {\n  dataType: 'image' | 'dicom';\n}\n\nexport interface ConfigResult extends DataResult {\n  config: Config;\n}\n\nexport type ImportResult = LoadableResult | ConfigResult | DataResult;\n\nexport type ArchiveContents = Record<string, File>;\nexport type ArchiveCache = Map<File, Awaitable<ArchiveContents>>;\n\nexport interface ImportContext {\n  // Caches URL responses\n  fetchFileCache?: FetchCache<File>;\n  // Caches archives. ArchiveFile -> { [archivePath]: File }\n  archiveCache?: ArchiveCache;\n  // Records dicom files\n  dicomDataSources?: DataSource[];\n}\n\nexport type ImportHandler = Handler<DataSource, ImportResult, ImportContext>;\n\nexport function isArchive(\n  ds: DataSource\n): ds is DataSource & { fileSrc: FileSource } {\n  return !!ds.fileSrc && ARCHIVE_FILE_TYPES.has(ds.fileSrc.fileType);\n}\n\nexport function isLoadableResult(\n  importResult: ImportResult\n): importResult is LoadableResult {\n  return 'dataID' in importResult && 'dataType' in importResult;\n}\n\nexport function isVolumeResult(\n  importResult: ImportResult\n): importResult is VolumeResult {\n  return (\n    isLoadableResult(importResult) &&\n    (importResult.dataType === 'image' || importResult.dataType === 'dicom')\n  );\n}\n\nexport function isConfigResult(\n  importResult: ImportResult\n): importResult is ConfigResult {\n  return 'config' in importResult;\n}\n","import { ImportHandler } from '@/src/io/import/common';\n\n/**\n * Adds DICOM files to the extra context.\n * @param dataSource\n * @returns\n */\nconst handleDicomFile: ImportHandler = (dataSource, { extra, done }) => {\n  const { fileSrc } = dataSource;\n  if (extra?.dicomDataSources && fileSrc?.fileType === 'application/dicom') {\n    extra.dicomDataSources.push(dataSource);\n    return done();\n  }\n  return dataSource;\n};\n\nexport default handleDicomFile;\n","import { canFetchUrl, fetchFile } from '@/src/utils/fetch';\nimport { ImportHandler } from '@/src/io/import/common';\n\n/**\n * Downloads a URL to a file DataSource.\n *\n * Input: { uriSrc }\n * Output: { fileSrc, uriSrc }\n *\n * Provides optional caching if the execution context provides a cache.\n * @param dataSource\n * @returns\n */\nconst downloadUrl: ImportHandler = async (\n  dataSource,\n  { execute, done, extra }\n) => {\n  const { fileSrc, uriSrc } = dataSource;\n  if (!fileSrc && uriSrc && canFetchUrl(uriSrc.uri)) {\n    try {\n      const file = await fetchFile(uriSrc.uri, uriSrc.name, {\n        cache: extra?.fetchFileCache,\n      });\n      execute({\n        ...dataSource,\n        fileSrc: {\n          file,\n          fileType: '',\n        },\n      });\n      return done();\n    } catch (err) {\n      throw new Error(`Could not download URL ${uriSrc.uri}`, {\n        cause: err instanceof Error ? err : undefined,\n      });\n    }\n  }\n  return dataSource;\n};\n\nexport default downloadUrl;\n","import JSZip from 'jszip';\nimport { basename, dirname } from '@/src/utils/path';\nimport { FileEntry } from './types';\n\nexport async function extractFilesFromZip(zipFile: File): Promise<FileEntry[]> {\n  const zip = await JSZip.loadAsync(zipFile);\n  const promises: Promise<File>[] = [];\n  const paths: string[] = [];\n  zip.forEach((relPath, file) => {\n    if (!file.dir) {\n      const fileName = basename(file.name);\n      const path = dirname(file.name);\n      const fileEntry = zip.file(file.name);\n      if (fileEntry) {\n        promises.push(\n          fileEntry.async('blob').then((blob) => new File([blob], fileName))\n        );\n        paths.push(path);\n      }\n    }\n  });\n\n  return Promise.all(promises).then((files) => {\n    return files.map((file, index) => {\n      return {\n        file,\n        archivePath: paths[index],\n      };\n    });\n  });\n}\n","import { extractFilesFromZip } from '@/src/io/zip';\nimport { ImportHandler, isArchive } from '@/src/io/import/common';\n\n/**\n * Extracts all files from an archive.\n * @param dataSource\n */\nconst extractArchive: ImportHandler = async (dataSource, { execute, done }) => {\n  if (isArchive(dataSource)) {\n    const files = await extractFilesFromZip(dataSource.fileSrc.file);\n    files.forEach((entry) => {\n      execute({\n        fileSrc: {\n          file: entry.file,\n          fileType: '',\n        },\n        archiveSrc: {\n          path: `${entry.archivePath}/${entry.file.name}`,\n        },\n        parent: dataSource,\n      });\n    });\n    return done();\n  }\n  return dataSource;\n};\n\nexport default extractArchive;\n","import {\n  ArchiveCache,\n  ArchiveContents,\n  ImportHandler,\n  isArchive,\n} from '@/src/io/import/common';\nimport { extractFilesFromZip } from '@/src/io/zip';\nimport { Maybe } from '@/src/types';\nimport * as path from '@/src/utils/path';\nimport { Awaitable } from '@vueuse/core';\n\nasync function extractArchiveContents(archiveFile: File, cache?: ArchiveCache) {\n  let contentsPromise: Maybe<Awaitable<ArchiveContents>> =\n    cache?.get(archiveFile);\n  if (contentsPromise) {\n    return contentsPromise;\n  }\n\n  contentsPromise = extractFilesFromZip(archiveFile).then((files) => {\n    return files.reduce((mapping, fileEntry) => {\n      const fullPath = path.join(fileEntry.archivePath, fileEntry.file.name);\n      return Object.assign(mapping, {\n        [fullPath]: fileEntry.file,\n      });\n    }, {} as ArchiveContents);\n  });\n\n  if (cache) {\n    cache.set(archiveFile, contentsPromise);\n  }\n\n  return contentsPromise;\n}\n\n/**\n * Extracts a single target file from an archive.\n *\n * If the fileSrc already exists, nothing is done. Otherwise, attempt to\n * extract the file from the parent archive.\n *\n * Input data source must be of the following form:\n * { archiveSrc, parent: DataSource with a fileSrc }\n * @param dataSource\n * @returns\n */\nconst extractArchiveTarget: ImportHandler = async (\n  dataSource,\n  { extra, execute, done }\n) => {\n  const { fileSrc, archiveSrc, parent } = dataSource;\n  const { archiveCache } = extra ?? {};\n\n  if (!fileSrc && archiveSrc && parent) {\n    if (!parent?.fileSrc) {\n      throw new Error(\n        'Cannot extract an archive target with an unresolved parent'\n      );\n    }\n\n    if (!isArchive(parent)) {\n      throw new Error('Parent is not a supported archive file');\n    }\n\n    const archiveContents = await extractArchiveContents(\n      parent.fileSrc.file,\n      archiveCache\n    );\n\n    const targetName = path.normalize(archiveSrc.path);\n    const targetFile = archiveContents[targetName];\n    if (!targetFile) {\n      throw new Error(`Failed to find archive member ${targetName}`);\n    }\n\n    execute({\n      ...dataSource,\n      fileSrc: {\n        file: targetFile,\n        fileType: '',\n      },\n    });\n    return done();\n  }\n\n  return dataSource;\n};\n\nexport default extractArchiveTarget;\n","import { parseUrl } from '@/src/utils/url';\nimport { S3Client, ListObjectsV2Command } from '@aws-sdk/client-s3';\n\n/**\n * Detects `s3://` uri.\n * @param uri\n * @returns\n */\nexport const isAmazonS3Uri = (uri: string) =>\n  parseUrl(uri, window.location.origin).protocol === 's3:';\n\nexport type ObjectAvailableCallback = (url: string, name: string) => void;\n\nfunction getObjectPublicUrl(bucket: string, key: string) {\n  return `https://${bucket}.s3.amazonaws.com/${key}`;\n}\n\nasync function fetchObjectsWithPagination(\n  bucket: string,\n  prefix: string,\n  onObjectAvailable: ObjectAvailableCallback = () => {}\n) {\n  const client = new S3Client({\n    region: 'us-east-1',\n    // workaround for sdk's inability to specify anonymous credentials\n    signer: { sign: async (request) => request },\n  });\n\n  const paginate = async (continuationToken?: string) => {\n    const listObjectsCmd = new ListObjectsV2Command({\n      Bucket: bucket,\n      Prefix: prefix,\n      ContinuationToken: continuationToken,\n      MaxKeys: 1000,\n    });\n\n    let result;\n    try {\n      result = await client.send(listObjectsCmd);\n    } catch (err) {\n      console.error(err);\n      throw err;\n    }\n\n    if (!result.Contents) {\n      throw new Error('S3 returned no objects');\n    }\n\n    result.Contents.forEach((obj) => {\n      if (!obj.Key) return;\n      const name = obj.Key;\n      const url = getObjectPublicUrl(bucket, obj.Key);\n      onObjectAvailable(name, url);\n    });\n\n    if (result.IsTruncated && result.NextContinuationToken) {\n      await paginate(result.NextContinuationToken);\n    }\n  };\n\n  await paginate();\n}\n\n/**\n * Extracts bucket and prefix from `s3://` URIs\n * @param uri\n * @returns\n */\nexport const extractBucketAndPrefixFromS3Uri = (uri: string) => {\n  const { hostname: bucket, pathname } = parseUrl(uri);\n  // drop the leading forward slash\n  const objectName = pathname.replace(/^\\//, '');\n  return [bucket, objectName] as const;\n};\n\n/**\n * Gets all objects from an s3:// URI.\n *\n * Signed/credentialed requests are currently not supported.\n *\n * @param s3Uri\n */\nexport const getObjectsFromS3 = async (\n  s3Uri: string,\n  onObjectAvailable: ObjectAvailableCallback = () => {}\n) => {\n  const [bucket, objPrefix] = extractBucketAndPrefixFromS3Uri(s3Uri);\n  await fetchObjectsWithPagination(bucket, objPrefix, onObjectAvailable);\n};\n","import { getObjectsFromS3, isAmazonS3Uri } from '@/src/io/amazonS3';\nimport { ImportHandler } from '@/src/io/import/common';\n\nconst handleAmazonS3: ImportHandler = async (dataSource, { execute, done }) => {\n  const { uriSrc } = dataSource;\n  if (uriSrc && isAmazonS3Uri(uriSrc.uri)) {\n    try {\n      await getObjectsFromS3(uriSrc.uri, (name, url) => {\n        execute({\n          uriSrc: {\n            uri: url,\n            name,\n          },\n          parent: dataSource,\n        });\n      });\n      return done();\n    } catch (err) {\n      throw new Error(`Could not download S3 URI ${uriSrc.uri}`, {\n        cause: err instanceof Error ? err : undefined,\n      });\n    }\n  }\n  return dataSource;\n};\n\nexport default handleAmazonS3;\n","import { parseUrl } from '@/src/utils/url';\nimport { fetchJSON } from '../utils/fetch';\n\nexport interface GcsObject {\n  kind: string;\n  id: string;\n  selfLink: string;\n  mediaLink: string;\n  name: string;\n  bucket: string;\n  size: string;\n}\n\ninterface GcsObjectListResult {\n  kind: string;\n  nextPageToken?: string;\n  items: GcsObject[];\n}\n\n/**\n * Detects `gs://` uri.\n * @param uri\n * @returns\n */\nexport const isGoogleCloudStorageUri = (uri: string) =>\n  parseUrl(uri, window.location.origin).protocol === 'gs:';\n\n/**\n * Extracts bucket and prefix from `gs://` URIs\n * @param uri\n * @returns\n */\nexport const extractBucketAndPrefixFromGsUri = (uri: string) => {\n  const { hostname: bucket, pathname } = parseUrl(uri);\n  // drop the leading forward slash\n  const objectName = pathname.replace(/^\\//, '');\n  return [bucket, objectName] as const;\n};\n\nexport type ObjectAvailableCallback = (object: GcsObject) => void;\n\nconst getObjectEndpoint = (bucket: string) =>\n  `https://storage.googleapis.com/storage/v1/b/${bucket}/o`;\n\nasync function fetchObjectsWithPagination(\n  bucket: string,\n  prefix: string,\n  onObjectAvailable: ObjectAvailableCallback = () => {}\n) {\n  const objects: GcsObject[] = [];\n\n  const paginate = async (nextToken?: string) => {\n    const url = parseUrl(getObjectEndpoint(bucket));\n    url.searchParams.append('prefix', prefix);\n    url.searchParams.append('maxResults', '1000');\n    if (nextToken) {\n      url.searchParams.append('pageToken', nextToken);\n    }\n\n    const page = await fetchJSON<GcsObjectListResult>(url.toString());\n    if (page.kind !== 'storage#objects') {\n      throw new Error('GCS did not return a list of objects!');\n    }\n\n    objects.push(...page.items);\n    page.items.forEach((obj) => onObjectAvailable(obj));\n\n    if (page.nextPageToken) {\n      await paginate(page.nextPageToken);\n    }\n  };\n\n  await paginate();\n  return objects;\n}\n\n/**\n * Gets all objects from a given gs:// URI.\n *\n * Signed/credentialed requests are currently not supported.\n *\n * This is a simplified entrypoint for GCS. We're not using\n * @google-cloud/storage due to node dependencies. As such, this will most\n * definitely be incomplete (slight API missteps, no retries, etc.) For the\n * purpose of just downloading datasets, it should work just fine.\n *\n * @param gsUri\n * @param onObjectAvailable\n * @returns\n */\nexport const getObjectsFromGsUri = async (\n  gsUri: string,\n  onObjectAvailable: ObjectAvailableCallback = () => {}\n) => {\n  const [bucketName, objPrefix] = extractBucketAndPrefixFromGsUri(gsUri);\n  return fetchObjectsWithPagination(bucketName, objPrefix, onObjectAvailable);\n};\n","import {\n  getObjectsFromGsUri,\n  isGoogleCloudStorageUri,\n} from '@/src/io/googleCloudStorage';\nimport { ImportHandler } from '@/src/io/import/common';\n\nconst handleGoogleCloudStorage: ImportHandler = async (\n  dataSource,\n  { execute, done }\n) => {\n  const { uriSrc } = dataSource;\n  if (uriSrc && isGoogleCloudStorageUri(uriSrc.uri)) {\n    try {\n      await getObjectsFromGsUri(uriSrc.uri, (object) => {\n        execute({\n          uriSrc: {\n            uri: object.mediaLink,\n            name: object.name,\n          },\n          parent: dataSource,\n        });\n      });\n      return done();\n    } catch (err) {\n      throw new Error(`Could not download GCS URI ${uriSrc.uri}`, {\n        cause: err instanceof Error ? err : undefined,\n      });\n    }\n  }\n  return dataSource;\n};\n\nexport default handleGoogleCloudStorage;\n","import type { vtkObject } from '@kitware/vtk.js/interfaces';\n\nexport * from './io';\n\nexport type ReaderType = (file: File) => vtkObject | Promise<vtkObject>;\nexport type FileReaderMap = Map<string, ReaderType>;\n\n/**\n * A map of the currently registered file readers.\n *\n * Maps mime type to reader.\n */\nexport const FILE_READERS: FileReaderMap = new Map();\n","import vtkImageData from '@kitware/vtk.js/Common/DataModel/ImageData';\nimport vtkPolyData from '@kitware/vtk.js/Common/DataModel/PolyData';\nimport { useFileStore } from '@/src/store/datasets-files';\nimport { useImageStore } from '@/src/store/datasets-images';\nimport { useModelStore } from '@/src/store/datasets-models';\nimport { FILE_READERS } from '@/src/io';\nimport { ImportHandler } from '@/src/io/import/common';\nimport { DataSourceWithFile } from '@/src/io/import/dataSource';\nimport { useDatasetStore } from '@/src/store/datasets';\nimport { useMessageStore } from '@/src/store/messages';\nimport { useViewStore } from '@/src/store/views';\nimport { useViewSliceStore } from '@/src/store/view-configs/slicing';\nimport { getLPSAxisFromDir } from '@/src/utils/lps';\nimport { InitViewSpecs } from '@/src/config';\n\n/**\n * Reads and imports a file DataSource.\n * @param dataSource\n * @returns\n */\nconst importSingleFile: ImportHandler = async (dataSource, { done }) => {\n  if (!dataSource.fileSrc) {\n    return dataSource;\n  }\n\n  const { fileSrc } = dataSource;\n  if (!FILE_READERS.has(fileSrc.fileType)) {\n    return dataSource;\n  }\n\n  const reader = FILE_READERS.get(fileSrc.fileType)!;\n  const dataObject = await reader(fileSrc.file);\n\n  const fileStore = useFileStore();\n\n  if (dataObject.isA('vtkImageData')) {\n    const dataID = useImageStore().addVTKImageData(\n      fileSrc.file.name,\n      dataObject as vtkImageData\n    );\n    fileStore.add(dataID, [dataSource as DataSourceWithFile]);\n\n    // Create a default view for each viewID\n    useViewStore().viewIDs.forEach((viewID: string) => {\n      const { lpsOrientation, dimensions } = useImageStore().metadata[dataID];\n      const axisDir = InitViewSpecs[viewID].props.viewDirection;\n      const lpsFromDir = getLPSAxisFromDir(axisDir);\n      const lpsOrient = lpsOrientation[lpsFromDir];\n\n      const dimMax = dimensions[lpsOrient];\n\n      useViewSliceStore().updateConfig(viewID, dataID, {\n        axisDirection: axisDir,\n        max: dimMax - 1,\n      });\n      useViewSliceStore().resetSlice(viewID, dataID);\n    });\n\n    return done({\n      dataID,\n      dataSource,\n      dataType: 'image',\n    });\n  }\n\n  if (dataObject.isA('vtkPolyData')) {\n    if (!useDatasetStore().primarySelection) {\n      useMessageStore().addWarning(\n        'Load an image to see the mesh. Initializing viewports from mesh files is not implemented.'\n      );\n    }\n    const dataID = useModelStore().addVTKPolyData(\n      fileSrc.file.name,\n      dataObject as vtkPolyData\n    );\n    fileStore.add(dataID, [dataSource as DataSourceWithFile]);\n\n    return done({\n      dataID,\n      dataSource,\n      dataType: 'model',\n    });\n  }\n\n  throw new Error('Data reader did not produce a valid dataset');\n};\n\nexport default importSingleFile;\n","import { z } from 'zod';\n\nexport const RemoteResource = z.object({\n  url: z.string(),\n  name: z.optional(z.string()),\n});\n\nexport const RemoteDataManifest = z.object({\n  resources: z.array(RemoteResource),\n});\n\nexport async function readRemoteManifestFile(manifestFile: File) {\n  const decoder = new TextDecoder();\n  const ab = await manifestFile.arrayBuffer();\n  const text = decoder.decode(new Uint8Array(ab));\n  const manifest = RemoteDataManifest.parse(JSON.parse(text));\n  return manifest;\n}\n","import { DataSource } from '@/src/io/import/dataSource';\nimport { ImportHandler } from '@/src/io/import/common';\nimport { readRemoteManifestFile } from '@/src/io/manifest';\n\n/**\n * Reads a JSON file that conforms to the remote manifest spec.\n * @param dataSource\n * @returns\n */\nconst handleRemoteManifest: ImportHandler = async (\n  dataSource,\n  { done, execute }\n) => {\n  const { fileSrc } = dataSource;\n  if (fileSrc?.fileType === 'application/json') {\n    const remotes: DataSource[] = [];\n    try {\n      const manifest = await readRemoteManifestFile(fileSrc.file);\n      manifest.resources.forEach((res) => {\n        remotes.push({\n          uriSrc: {\n            uri: res.url,\n            name: res.name ?? new URL(res.url, window.location.origin).pathname,\n          },\n          parent: dataSource,\n        });\n      });\n    } catch (err) {\n      return dataSource;\n    }\n\n    remotes.forEach((remote) => {\n      execute(remote);\n    });\n    return done();\n  }\n  return dataSource;\n};\n\nexport default handleRemoteManifest;\n","type FlowFunction<T> = (o: T) => T;\n\nexport function flow<T>(...fns: Array<FlowFunction<T>>) {\n  return (input: T) => fns.reduce((result, fn) => fn(result), input);\n}\n\n// Pipe code from\n// https://dev.to/ecyrbe/how-to-use-advanced-typescript-to-define-a-pipe-function-381h\n// Changed second parameter to rest/spread argument.\ntype AnyFunc = (...arg: any) => any;\n\ntype LastFnReturnType<F extends Array<AnyFunc>, Else = never> = F extends [\n  ...any[],\n  (...arg: any) => infer R\n]\n  ? R\n  : Else;\n\ntype PipeArgs<F extends AnyFunc[], Acc extends AnyFunc[] = []> = F extends [\n  (...args: infer A) => infer B\n]\n  ? [...Acc, (...args: A) => B]\n  : F extends [(...args: infer A) => any, ...infer Tail]\n  ? Tail extends [(arg: infer B) => any, ...any[]]\n    ? PipeArgs<Tail, [...Acc, (...args: A) => B]>\n    : Acc\n  : Acc;\n\n// Example:\n// const myNumber = pipe(\n//   \"1\",\n//   (a: string) => Number(a),\n//   (c: number) => c + 1,\n//   (d: number) => `${d}`,\n//   (e: string) => Number(e)\n// );\nexport function pipe<F extends AnyFunc[]>(\n  arg: Parameters<F[0]>[0],\n  ...fns: PipeArgs<F> extends F ? F : PipeArgs<F>\n): LastFnReturnType<F, ReturnType<F[0]>> {\n  return (fns.slice(1) as AnyFunc[]).reduce((acc, fn) => fn(acc), fns[0](arg));\n}\n","import { ImportHandler } from '@/src/io/import/common';\n\n/**\n * Ends a pipeline execution, returning the final data source.\n * @param dataSource\n * @returns\n */\nconst doneWithDataSource: ImportHandler = (dataSource, { done }) => {\n  return done({ dataSource });\n};\n\nexport default doneWithDataSource;\n","import { getFileMimeType } from '@/src/io';\nimport { ImportHandler } from '@/src/io/import/common';\n\n/**\n * Transforms a file data source to have a mime type\n * @param dataSource\n */\nconst updateFileMimeType: ImportHandler = async (dataSource) => {\n  let src = dataSource;\n  const { fileSrc } = src;\n  if (fileSrc) {\n    const mime = await getFileMimeType(fileSrc.file);\n    if (mime) {\n      src = {\n        ...src,\n        fileSrc: {\n          ...fileSrc,\n          fileType: mime,\n        },\n      };\n    }\n  }\n  return src;\n};\n\nexport default updateFileMimeType;\n","import { Dataset, Manifest, ManifestSchema } from '@/src/io/state-file/schema';\nimport { FileEntry } from '@/src/io/types';\nimport * as path from '@/src/utils/path';\nimport {\n  ArchiveContents,\n  ImportContext,\n  ImportHandler,\n  ImportResult,\n  isLoadableResult,\n} from '@/src/io/import/common';\nimport {\n  DataSource,\n  DataSourceWithFile,\n  fileToDataSource,\n} from '@/src/io/import/dataSource';\nimport { MANIFEST, isStateFile } from '@/src/io/state-file';\nimport { ensureError, partition } from '@/src/utils';\nimport { pipe } from '@/src/utils/functional';\nimport Pipeline, { PipelineContext } from '@/src/core/pipeline';\nimport { Awaitable } from '@vueuse/core';\nimport doneWithDataSource from '@/src/io/import/processors/doneWithDataSource';\nimport { useDICOMStore } from '@/src/store/datasets-dicom';\nimport { useViewStore } from '@/src/store/views';\nimport { useDatasetStore } from '@/src/store/datasets';\nimport {\n  makeDefaultSegmentGroupName,\n  useSegmentGroupStore,\n} from '@/src/store/segmentGroups';\nimport { useToolStore } from '@/src/store/tools';\nimport { useLayersStore } from '@/src/store/datasets-layers';\nimport { extractFilesFromZip } from '@/src/io/zip';\nimport downloadUrl from '@/src/io/import/processors/downloadUrl';\nimport updateFileMimeType from '@/src/io/import/processors/updateFileMimeType';\nimport extractArchiveTarget from '@/src/io/import/processors/extractArchiveTarget';\n\nconst LABELMAP_PALETTE_2_1_0 = {\n  '1': {\n    value: 1,\n    name: 'Segment 1',\n    color: [153, 153, 0, 255],\n  },\n  '2': {\n    value: 2,\n    name: 'Segment 2',\n    color: [76, 76, 0, 255],\n  },\n  '3': {\n    value: 3,\n    name: 'Segment 3',\n    color: [255, 255, 0, 255],\n  },\n  '4': {\n    value: 4,\n    name: 'Segment 4',\n    color: [0, 76, 0, 255],\n  },\n  '5': {\n    value: 5,\n    name: 'Segment 5',\n    color: [0, 153, 0, 255],\n  },\n  '6': {\n    value: 6,\n    name: 'Segment 6',\n    color: [0, 255, 0, 255],\n  },\n  '7': {\n    value: 7,\n    name: 'Segment 7',\n    color: [76, 0, 0, 255],\n  },\n  '8': {\n    value: 8,\n    name: 'Segment 8',\n    color: [153, 0, 0, 255],\n  },\n  '9': {\n    value: 9,\n    name: 'Segment 9',\n    color: [255, 0, 0, 255],\n  },\n  '10': {\n    value: 10,\n    name: 'Segment 10',\n    color: [0, 76, 76, 255],\n  },\n  '11': {\n    value: 11,\n    name: 'Segment 11',\n    color: [0, 153, 153, 255],\n  },\n  '12': {\n    value: 12,\n    name: 'Segment 12',\n    color: [0, 255, 255, 255],\n  },\n  '13': {\n    value: 13,\n    name: 'Segment 13',\n    color: [0, 0, 76, 255],\n  },\n  '14': {\n    value: 14,\n    name: 'Segment 14',\n    color: [0, 0, 153, 255],\n  },\n};\n\nconst migrateOrPass =\n  (versions: Array<string>, migrationFunc: (manifest: any) => any) =>\n  (inputManifest: any) => {\n    if (versions.includes(inputManifest.version)) {\n      return migrationFunc(inputManifest);\n    }\n    return inputManifest;\n  };\n\nconst migrateBefore210 = (inputManifest: any) => {\n  const manifest = JSON.parse(JSON.stringify(inputManifest));\n  manifest.version = '2.1.0';\n  return manifest;\n};\n\nconst migrate210To300 = (inputManifest: any) => {\n  const manifest = JSON.parse(JSON.stringify(inputManifest));\n  manifest.tools.paint.activeSegmentGroupID =\n    inputManifest.tools.paint.activeLabelmapID;\n  delete manifest.tools.paint.activeLabelmapID;\n\n  const order = Object.keys(LABELMAP_PALETTE_2_1_0).map((key) => Number(key));\n  manifest.labelMaps = inputManifest.labelMaps.map(\n    (labelMap: any, index: number) => ({\n      id: labelMap.id,\n      path: labelMap.path,\n      metadata: {\n        parentImage: labelMap.parent,\n        name: makeDefaultSegmentGroupName('My Image', index),\n        segments: {\n          order,\n          byValue: LABELMAP_PALETTE_2_1_0,\n        },\n      },\n    })\n  );\n\n  manifest.version = '3.0.0';\n  return manifest;\n};\n\nconst migrateManifest = (manifestString: string) => {\n  const inputManifest = JSON.parse(manifestString);\n  return pipe(\n    inputManifest,\n    migrateOrPass(['1.1.0', '1.0.0', '0.5.0'], migrateBefore210),\n    migrateOrPass(['2.1.0'], migrate210To300)\n  );\n};\n\nconst resolveUriSource: ImportHandler = async (dataSource, { extra, done }) => {\n  const { uriSrc } = dataSource;\n\n  if (uriSrc) {\n    const result = await new Pipeline([\n      downloadUrl,\n      updateFileMimeType,\n      doneWithDataSource,\n    ]).execute(dataSource, extra);\n    if (!result.ok) {\n      throw result.errors[0].cause;\n    }\n    // downloadUrl returns the fully resolved data source.\n    // We call done here since we've resolved the UriSource\n    // and no more processing is needed.\n    return done({\n      dataSource: result.data[0].dataSource,\n    });\n  }\n\n  return dataSource;\n};\n\nconst processParentIfNoFile: ImportHandler = async (\n  dataSource,\n  { execute }\n) => {\n  const { fileSrc, parent } = dataSource;\n  if (!fileSrc && parent) {\n    const result = await execute(parent);\n    if (!result.ok) {\n      throw new Error('Could not process parent', {\n        cause: ensureError(result.errors[0].cause),\n      });\n    }\n    // update the parent\n    return {\n      ...dataSource,\n      parent: result.data[0].dataSource,\n    };\n  }\n  return dataSource;\n};\n\nconst resolveArchiveMember: ImportHandler = async (\n  dataSource,\n  { extra, done }\n) => {\n  if (dataSource.archiveSrc) {\n    const pipeline = new Pipeline([\n      extractArchiveTarget,\n      updateFileMimeType,\n      doneWithDataSource,\n    ]);\n    const result = await pipeline.execute(dataSource, extra);\n    if (!result.ok) {\n      throw result.errors[0].cause;\n    }\n    // extractArchiveTarget returns the fully resolved data source.\n    return done({\n      dataSource: result.data[0].dataSource,\n    });\n  }\n  return dataSource;\n};\n\nfunction getDataSourcesForDataset(\n  dataset: Dataset,\n  manifest: Manifest,\n  stateFileContents: FileEntry[]\n) {\n  const inStateFile = stateFileContents\n    .filter(\n      (entry) =>\n        path.normalize(entry.archivePath) === path.normalize(dataset.path)\n    )\n    .map((entry) => fileToDataSource(entry.file));\n  const remotes = manifest.remoteFiles[dataset.id] ?? [];\n  return [...inStateFile, ...remotes];\n}\n\nasync function restoreDatasets(\n  manifest: Manifest,\n  datasetFiles: FileEntry[],\n  { extra, execute }: PipelineContext<DataSource, ImportResult, ImportContext>\n) {\n  const archiveCache = new Map<File, Awaitable<ArchiveContents>>();\n\n  // normalize archive paths for comparison\n  const stateDatasetFiles = datasetFiles.map((datasetFile) => {\n    return {\n      ...datasetFile,\n      archivePath: path.normalize(datasetFile.archivePath),\n    };\n  });\n\n  const { datasets } = manifest;\n  // Mapping of the state file ID => new store ID\n  const stateIDToStoreID: Record<string, string> = {};\n\n  // This pipeline resolves data sources that have remote provenance.\n  const resolvePipeline = new Pipeline([\n    updateFileMimeType,\n    resolveUriSource,\n    // process parent after resolving the uri source, so we don't\n    // unnecessarily download ancestor UriSources.\n    processParentIfNoFile,\n    resolveArchiveMember,\n    doneWithDataSource,\n  ]);\n\n  await Promise.all(\n    datasets.map(async (dataset) => {\n      let datasetDataSources = getDataSourcesForDataset(\n        dataset,\n        manifest,\n        stateDatasetFiles\n      );\n\n      // resolve any remote data sources or archive members\n      datasetDataSources = await Promise.all(\n        datasetDataSources.map(async (source) => {\n          const result = await resolvePipeline.execute(source, {\n            ...extra,\n            archiveCache,\n          });\n          if (!result.ok) {\n            throw result.errors[0].cause;\n          }\n          return result.data[0].dataSource;\n        })\n      );\n\n      // do the import\n      const dicomSources: DataSourceWithFile[] = [];\n      const importResults = await Promise.all(\n        datasetDataSources.map((source) =>\n          execute(source, {\n            ...extra,\n            archiveCache,\n            dicomDataSources: dicomSources,\n          })\n        )\n      );\n\n      if (dicomSources.length) {\n        const dicomStore = useDICOMStore();\n        const volumeKeys = await dicomStore.importFiles(dicomSources);\n        if (volumeKeys.length !== 1) {\n          throw new Error('Obtained more than one volume from DICOM import');\n        }\n\n        const [key] = volumeKeys;\n        // generate imageID so rulers and labelmaps can use stateIDToStoreID to setup there internal imageStore imageID references\n        await dicomStore.buildVolume(key);\n        stateIDToStoreID[dataset.id] = key;\n      } else if (importResults.length === 1) {\n        if (!importResults[0].ok) {\n          throw importResults[0].errors[0].cause;\n        }\n\n        const [result] = importResults;\n        if (result.data.length !== 1) {\n          throw new Error(\n            'Import encountered multiple volumes for a single dataset'\n          );\n        }\n\n        const importResult = result.data[0];\n        if (!isLoadableResult(importResult)) {\n          throw new Error('Failed to import dataset');\n        }\n\n        stateIDToStoreID[dataset.id] = importResult.dataID;\n      } else {\n        throw new Error('Could not load any data from the session');\n      }\n    })\n  );\n\n  return stateIDToStoreID;\n}\n\nconst restoreStateFile: ImportHandler = async (dataSource, pipelineContext) => {\n  const { fileSrc } = dataSource;\n  if (fileSrc && (await isStateFile(fileSrc.file))) {\n    const stateFileContents = await extractFilesFromZip(fileSrc.file);\n\n    const [manifests, restOfStateFile] = partition(\n      (dataFile) => dataFile.file.name === MANIFEST,\n      stateFileContents\n    );\n\n    if (manifests.length !== 1) {\n      throw new Error('State file does not have exactly 1 manifest');\n    }\n\n    const manifestString = await manifests[0].file.text();\n    const migrated = migrateManifest(manifestString);\n    const manifest = ManifestSchema.parse(migrated);\n\n    // We restore the view first, so that the appropriate watchers are triggered\n    // in the views as the data is loaded\n    useViewStore().setLayout(manifest.layout);\n\n    const stateIDToStoreID = await restoreDatasets(\n      manifest,\n      restOfStateFile,\n      pipelineContext\n    );\n\n    // Restore the primary selection\n    if (manifest.primarySelection !== undefined) {\n      const selectedID = stateIDToStoreID[manifest.primarySelection];\n\n      useDatasetStore().setPrimarySelection(selectedID);\n    }\n\n    // Restore the views\n    useViewStore().deserialize(manifest.views, stateIDToStoreID);\n\n    // Restore the labelmaps\n    const segmentGroupIDMap = await useSegmentGroupStore().deserialize(\n      manifest,\n      restOfStateFile,\n      stateIDToStoreID\n    );\n\n    // Restore the tools\n    useToolStore().deserialize(manifest, segmentGroupIDMap, stateIDToStoreID);\n\n    useLayersStore().deserialize(manifest, stateIDToStoreID);\n\n    return pipelineContext.done();\n  }\n  return dataSource;\n};\n\nexport default restoreStateFile;\n","import { defineStore } from 'pinia';\nimport { ref } from 'vue';\n\nexport const useDataBrowserStore = defineStore('data-browser', () => {\n  const hideSampleData = ref(false);\n  return {\n    hideSampleData,\n  };\n});\n","import useViewSliceStore, {\n  defaultSliceConfig,\n} from '@/src/store/view-configs/slicing';\nimport { Maybe } from '@/src/types';\nimport type { Vector2 } from '@kitware/vtk.js/types';\nimport { unref, MaybeRef, computed } from 'vue';\n\nexport function useSliceConfig(\n  viewID: MaybeRef<string>,\n  imageID: MaybeRef<Maybe<string>>\n) {\n  const store = useViewSliceStore();\n  const configDefaults = defaultSliceConfig();\n  const config = computed(() => store.getConfig(unref(viewID), unref(imageID)));\n\n  const slice = computed({\n    get: () => config.value?.slice ?? configDefaults.slice,\n    set: (val) => {\n      const imageIdVal = unref(imageID);\n      if (!imageIdVal || val == null) return;\n      store.updateConfig(unref(viewID), imageIdVal, { slice: val });\n\n      // Update other synchronized views if any\n      if (config.value?.syncState) {\n        store.updateSyncConfigs();\n      }\n    },\n  });\n  const range = computed((): Vector2 => {\n    const { min, max } = config.value ?? {};\n    if (min == null || max == null)\n      return [configDefaults.min, configDefaults.max];\n    return [min, max];\n  });\n\n  return { config, slice, range };\n}\n","import { useToolStore } from '../store/tools';\nimport { Tools } from '../store/tools/types';\nimport { useRectangleStore } from '../store/tools/rectangles';\nimport { useRulerStore } from '../store/tools/rulers';\nimport { usePolygonStore } from '../store/tools/polygons';\nimport { useViewStore } from '../store/views';\nimport { Action } from '../constants';\nimport { useKeyboardShortcutsStore } from '../store/keyboard-shortcuts';\nimport { useCurrentImage } from './useCurrentImage';\nimport { useSliceConfig } from './useSliceConfig';\nimport { useDatasetStore } from '../store/datasets';\n\nconst applyLabelOffset = (offset: number) => () => {\n  const toolToStore = {\n    [Tools.Rectangle]: useRectangleStore(),\n    [Tools.Ruler]: useRulerStore(),\n    [Tools.Polygon]: usePolygonStore(),\n  };\n  const toolStore = useToolStore();\n\n  // @ts-ignore - toolToStore may not have keys of all tools\n  const activeToolStore = toolToStore[toolStore.currentTool];\n  if (!activeToolStore) return;\n\n  const labels = Object.entries(activeToolStore.labels);\n  const activeLabelIndex = labels.findIndex(\n    ([name]) => name === activeToolStore.activeLabel\n  );\n\n  const [nextLabel] = labels.at((activeLabelIndex + offset) % labels.length)!;\n  activeToolStore.setActiveLabel(nextLabel);\n};\n\nconst setTool = (tool: Tools) => () => {\n  useToolStore().setCurrentTool(tool);\n};\n\nconst showKeyboardShortcuts = () => {\n  const keyboardStore = useKeyboardShortcutsStore();\n  keyboardStore.settingsOpen = !keyboardStore.settingsOpen;\n};\n\nconst changeSlice = (offset: number) => () => {\n  const { currentImageID } = useCurrentImage();\n  const { activeViewID } = useViewStore();\n\n  const { slice: currentSlice } = useSliceConfig(activeViewID, currentImageID);\n  currentSlice.value += offset;\n};\n\nconst clearScene = () => () => {\n  const datasetStore = useDatasetStore();\n  datasetStore.removeAll();\n};\n\nconst deleteCurrentImage = () => () => {\n  const datasetStore = useDatasetStore();\n  datasetStore.remove(datasetStore.primaryImageID);\n\n  // Automatically select next image\n  datasetStore.setPrimarySelection(datasetStore.idsAsSelections[0]);\n};\n\nexport const ACTION_TO_FUNC = {\n  windowLevel: setTool(Tools.WindowLevel),\n  pan: setTool(Tools.Pan),\n  zoom: setTool(Tools.Zoom),\n  ruler: setTool(Tools.Ruler),\n  paint: setTool(Tools.Paint),\n  rectangle: setTool(Tools.Rectangle),\n  crosshairs: setTool(Tools.Crosshairs),\n  crop: setTool(Tools.Crop),\n  polygon: setTool(Tools.Polygon),\n  select: setTool(Tools.Select),\n\n  nextSlice: changeSlice(1),\n  previousSlice: changeSlice(-1),\n\n  decrementLabel: applyLabelOffset(-1),\n  incrementLabel: applyLabelOffset(1),\n\n  deleteCurrentImage: deleteCurrentImage(),\n  clearScene: clearScene(),\n\n  mergeNewPolygon: () => {}, // acts as a modifier key rather than immediate effect, so no-op\n\n  showKeyboardShortcuts,\n} as const satisfies Record<Action, () => void>;\n","import { ref, watch } from 'vue';\nimport { useMagicKeys, whenever } from '@vueuse/core';\n\nimport { getEntries } from '../utils';\nimport { ACTION_TO_KEY } from '../config';\nimport { ACTION_TO_FUNC } from './actions';\n\nexport const actionToKey = ref(ACTION_TO_KEY);\n\nexport function useKeyboardShortcuts() {\n  const keys = useMagicKeys();\n  let unwatchFuncs = [] as Array<ReturnType<typeof whenever>>;\n\n  watch(\n    actionToKey,\n    (actionMap) => {\n      unwatchFuncs.forEach((unwatch) => unwatch());\n\n      unwatchFuncs = getEntries(actionMap).map(([action, key]) => {\n        const individualKeys = key.split('+');\n        const lastKey = individualKeys[individualKeys.length - 1];\n\n        return whenever(keys[key], () => {\n          const shiftPressed = keys.current.has('shift');\n          const lastPressedKey = Array.from(keys.current).pop();\n          const currentKeyWithCase = shiftPressed\n            ? lastPressedKey?.toUpperCase() ?? lastPressedKey\n            : lastPressedKey;\n\n          // keyCountMatches checks for exact modifier match\n          const keyCountMatches = keys.current.size === individualKeys.length;\n          const lastKeyMatches = lastKey === currentKeyWithCase;\n          const shiftCaseMatches =\n            shiftPressed &&\n            keys.current.size - 1 === individualKeys.length &&\n            lastKeyMatches;\n\n          if ((keyCountMatches && lastKeyMatches) || shiftCaseMatches) {\n            ACTION_TO_FUNC[action]();\n          }\n        });\n      });\n    },\n    { immediate: true, deep: true }\n  );\n}\n","import { z } from 'zod';\nimport { zodEnumFromObjKeys } from '@/src/utils';\nimport { ACTIONS } from '@/src/constants';\nimport { Layouts } from '@/src/config';\n\n// for applyConfig\nimport { useRectangleStore } from '@/src/store/tools/rectangles';\nimport { useRulerStore } from '@/src/store/tools/rulers';\nimport { useDataBrowserStore } from '@/src/store/data-browser';\nimport { usePolygonStore } from '@/src/store/tools/polygons';\nimport { useViewStore } from '@/src/store/views';\nimport { useWindowingStore } from '@/src/store/view-configs/windowing';\nimport { actionToKey } from '@/src/composables/useKeyboardShortcuts';\nimport { useSegmentGroupStore } from '@/src/store/segmentGroups';\nimport { AnnotationToolStore } from '@/src/store/tools/useAnnotationTool';\nimport useLoadDataStore from '@/src/store/load-data';\n\n// --------------------------------------------------------------------------\n// Interface\n\nconst layout = z\n  .object({\n    activeLayout: zodEnumFromObjKeys(Layouts).optional(),\n  })\n  .optional();\n\nconst dataBrowser = z\n  .object({\n    hideSampleData: z.boolean().optional(),\n  })\n  .optional();\n\nconst shortcuts = z.record(zodEnumFromObjKeys(ACTIONS), z.string()).optional();\n\n// --------------------------------------------------------------------------\n// Labels\n\nconst color = z.string();\n\nconst label = z.object({\n  color,\n  strokeWidth: z.number().optional(),\n});\n\nconst rulerLabel = label;\nconst polygonLabel = label;\n\nconst rectangleLabel = z.intersection(\n  label,\n  z.object({\n    fillColor: color,\n  })\n);\n\nconst labels = z\n  .object({\n    defaultLabels: z.record(label).or(z.null()).optional(),\n    rulerLabels: z.record(rulerLabel).or(z.null()).optional(),\n    rectangleLabels: z.record(rectangleLabel).or(z.null()).optional(),\n    polygonLabels: z.record(polygonLabel).or(z.null()).optional(),\n  })\n  .optional();\n\n// --------------------------------------------------------------------------\n// IO\n\nconst io = z\n  .object({\n    segmentGroupSaveFormat: z.string().optional(),\n    segmentGroupExtension: z.string().default(''),\n  })\n  .optional();\n\n// --------------------------------------------------------------------------\n// Window Level\n\nconst windowing = z\n  .object({\n    level: z.number(),\n    width: z.number(),\n  })\n  .optional();\n\nexport const config = z.object({\n  layout,\n  dataBrowser,\n  labels,\n  shortcuts,\n  io,\n  windowing,\n});\n\nexport type Config = z.infer<typeof config>;\n\nexport const readConfigFile = async (configFile: File) => {\n  const decoder = new TextDecoder();\n  const ab = await configFile.arrayBuffer();\n  const text = decoder.decode(new Uint8Array(ab));\n  return config.parse(JSON.parse(text));\n};\n\nconst applyLabels = (manifest: Config) => {\n  if (!manifest.labels) return;\n\n  // pass through null labels, use fallback labels if undefined\n  const defaultLabelsIfUndefined = <T>(toolLabels: T) => {\n    if (toolLabels === undefined) return manifest.labels?.defaultLabels;\n    return toolLabels;\n  };\n\n  const applyLabelsToStore = (\n    store: AnnotationToolStore,\n    maybeLabels: (typeof manifest.labels)[keyof typeof manifest.labels]\n  ) => {\n    const labelsOrFallback = defaultLabelsIfUndefined(maybeLabels);\n    if (!labelsOrFallback) return;\n    store.clearDefaultLabels();\n    store.mergeLabels(labelsOrFallback);\n  };\n\n  const { rulerLabels, rectangleLabels, polygonLabels } = manifest.labels;\n  applyLabelsToStore(useRulerStore(), rulerLabels);\n  applyLabelsToStore(useRectangleStore(), rectangleLabels);\n  applyLabelsToStore(usePolygonStore(), polygonLabels);\n};\n\nconst applySampleData = (manifest: Config) => {\n  useDataBrowserStore().hideSampleData = !!manifest.dataBrowser?.hideSampleData;\n};\n\nconst applyLayout = (manifest: Config) => {\n  if (manifest.layout?.activeLayout) {\n    const startingLayout = Layouts[manifest.layout.activeLayout];\n    useViewStore().setLayout(startingLayout);\n  }\n};\n\nconst applyShortcuts = (manifest: Config) => {\n  if (!manifest.shortcuts) return;\n\n  actionToKey.value = {\n    ...actionToKey.value,\n    ...manifest.shortcuts,\n  };\n};\n\nconst applyIo = (manifest: Config) => {\n  if (!manifest.io) return;\n\n  if (manifest.io.segmentGroupSaveFormat)\n    useSegmentGroupStore().saveFormat = manifest.io.segmentGroupSaveFormat;\n  useLoadDataStore().segmentGroupExtension = manifest.io.segmentGroupExtension;\n};\n\nconst applyWindowing = (manifest: Config) => {\n  if (!manifest.windowing) return;\n\n  useWindowingStore().runtimeConfigWindowLevel = manifest.windowing;\n};\n\nexport const applyConfig = (manifest: Config) => {\n  applyLayout(manifest);\n  applyLabels(manifest);\n  applySampleData(manifest);\n  applyShortcuts(manifest);\n  applyIo(manifest);\n  applyWindowing(manifest);\n};\n","import { ImportHandler } from '@/src/io/import/common';\nimport { ensureError } from '@/src/utils';\nimport { readConfigFile } from '@/src/io/import/configJson';\n\n/**\n * Reads a JSON file with label config and updates stores.\n * @param dataSource\n * @returns\n */\nconst handleConfig: ImportHandler = async (dataSource, { done }) => {\n  const { fileSrc } = dataSource;\n  if (fileSrc?.fileType === 'application/json') {\n    try {\n      const manifest = await readConfigFile(fileSrc.file);\n      // Don't consume JSON if it has no known key\n      if (Object.keys(manifest).length === 0) {\n        return dataSource;\n      }\n      return done({ dataSource, config: manifest });\n    } catch (err) {\n      throw new Error('Failed to parse config file', {\n        cause: ensureError(err),\n      });\n    }\n  }\n  return dataSource;\n};\n\nexport default handleConfig;\n","import Pipeline, {\n  PipelineResult,\n  PipelineResultSuccess,\n} from '@/src/core/pipeline';\nimport {\n  isConfigResult,\n  ImportHandler,\n  ImportResult,\n  isLoadableResult,\n  VolumeResult,\n} from '@/src/io/import/common';\nimport { DataSource, DataSourceWithFile } from '@/src/io/import/dataSource';\nimport handleDicomFile from '@/src/io/import/processors/handleDicomFile';\nimport downloadUrl from '@/src/io/import/processors/downloadUrl';\nimport extractArchive from '@/src/io/import/processors/extractArchive';\nimport extractArchiveTargetFromCache from '@/src/io/import/processors/extractArchiveTarget';\nimport handleAmazonS3 from '@/src/io/import/processors/handleAmazonS3';\nimport handleGoogleCloudStorage from '@/src/io/import/processors/handleGoogleCloudStorage';\nimport importSingleFile from '@/src/io/import/processors/importSingleFile';\nimport handleRemoteManifest from '@/src/io/import/processors/remoteManifest';\nimport restoreStateFile from '@/src/io/import/processors/restoreStateFile';\nimport updateFileMimeType from '@/src/io/import/processors/updateFileMimeType';\nimport handleConfig from '@/src/io/import/processors/handleConfig';\nimport { useDICOMStore } from '@/src/store/datasets-dicom';\nimport { applyConfig } from '@/src/io/import/configJson';\n\n/**\n * Tries to turn a thrown object into a meaningful error string.\n * @param error\n * @returns\n */\nfunction toMeaningfulErrorString(thrown: unknown) {\n  const strThrown = String(thrown);\n  if (!strThrown || strThrown === '[object Object]') {\n    return 'Unknown error. More details in the dev console.';\n  }\n  return strThrown;\n}\n\nconst unhandledResource: ImportHandler = () => {\n  throw new Error('Failed to handle resource');\n};\n\nfunction isSelectable(\n  result: PipelineResult<DataSource, ImportResult>\n): result is PipelineResultSuccess<VolumeResult> {\n  if (!result.ok) return false;\n  if (result.data.length === 0) {\n    return false;\n  }\n  const importResult = result.data[0];\n  if (!isLoadableResult(importResult)) {\n    return false;\n  }\n  if (importResult.dataType === 'model') {\n    return false;\n  }\n\n  return true;\n}\n\nconst importConfigs = async (\n  results: Array<PipelineResult<DataSource, ImportResult>>\n) => {\n  try {\n    results\n      .flatMap((pipelineResult) =>\n        pipelineResult.ok ? pipelineResult.data : []\n      )\n      .filter(isConfigResult)\n      .map(({ config }) => config)\n      .forEach(applyConfig);\n    return {\n      ok: true as const,\n      data: [],\n    };\n  } catch (err) {\n    return {\n      ok: false as const,\n      errors: [\n        {\n          message: toMeaningfulErrorString(err),\n          cause: err,\n          inputDataStackTrace: [],\n        },\n      ],\n    };\n  }\n};\n\nconst importDicomFiles = async (\n  dicomDataSources: Array<DataSourceWithFile>\n) => {\n  const resultSources: DataSource = {\n    dicomSrc: {\n      sources: dicomDataSources,\n    },\n  };\n  try {\n    if (!dicomDataSources.length) {\n      return {\n        ok: true as const,\n        data: [],\n      };\n    }\n    const volumeKeys = await useDICOMStore().importFiles(dicomDataSources);\n    return {\n      ok: true as const,\n      data: volumeKeys.map((key) => ({\n        dataID: key,\n        dataType: 'dicom' as const,\n        dataSource: resultSources,\n      })),\n    };\n  } catch (err) {\n    return {\n      ok: false as const,\n      errors: [\n        {\n          message: toMeaningfulErrorString(err),\n          cause: err,\n          inputDataStackTrace: [resultSources],\n        },\n      ],\n    };\n  }\n};\n\nexport async function importDataSources(dataSources: DataSource[]) {\n  const importContext = {\n    fetchFileCache: new Map<string, File>(),\n    dicomDataSources: [] as DataSourceWithFile[],\n  };\n\n  const middleware = [\n    // updating the file type should be first in the pipeline\n    updateFileMimeType,\n    // before extractArchive as .zip extension is part of state file check\n    restoreStateFile,\n    handleRemoteManifest,\n    handleGoogleCloudStorage,\n    handleAmazonS3,\n    downloadUrl,\n    extractArchiveTargetFromCache,\n    extractArchive,\n    handleConfig, // collect config files to apply later\n    // should be before importSingleFile, since DICOM is more specific\n    handleDicomFile, // collect DICOM files to import later\n    importSingleFile,\n    // catch any unhandled resource\n    unhandledResource,\n  ];\n  const loader = new Pipeline(middleware);\n\n  const results = await Promise.all(\n    dataSources.map((r) => loader.execute(r, importContext))\n  );\n\n  const configResult = await importConfigs(results);\n  const dicomResult = await importDicomFiles(importContext.dicomDataSources);\n\n  return [\n    ...results,\n    dicomResult,\n    configResult,\n    // Consuming code expects only errors and image import results.\n    // Remove ok results that don't result in something to load (like config.JSON files)\n  ].filter((result) => !result.ok || isSelectable(result));\n}\n\nexport type ImportDataSourcesResult = Awaited<\n  ReturnType<typeof importDataSources>\n>[number];\n\nexport function toDataSelection(loadable: VolumeResult) {\n  const { dataID } = loadable;\n  return dataID;\n}\n\nexport function convertSuccessResultToDataSelection(\n  result: ImportDataSourcesResult\n) {\n  if (!isSelectable(result)) return null;\n  const importResult = result.data[0];\n  return toDataSelection(importResult);\n}\n","import { UrlParams } from '@vueuse/core';\nimport {\n  fileToDataSource,\n  uriToDataSource,\n  DataSource,\n  getDataSourceName,\n} from '@/src/io/import/dataSource';\nimport useLoadDataStore from '@/src/store/load-data';\nimport { useDatasetStore } from '@/src/store/datasets';\nimport { useDICOMStore } from '@/src/store/datasets-dicom';\nimport { useLayersStore } from '@/src/store/datasets-layers';\nimport { useSegmentGroupStore } from '@/src/store/segmentGroups';\nimport { wrapInArray, nonNullable } from '@/src/utils';\nimport { basename } from '@/src/utils/path';\nimport { parseUrl } from '@/src/utils/url';\nimport { logError } from '@/src/utils/loggers';\nimport { PipelineResultSuccess, partitionResults } from '@/src/core/pipeline';\nimport {\n  ImportDataSourcesResult,\n  importDataSources,\n  toDataSelection,\n} from '@/src/io/import/importDataSources';\nimport {\n  ImportResult,\n  LoadableResult,\n  VolumeResult,\n  isLoadableResult,\n  isVolumeResult,\n} from '@/src/io/import/common';\n\n// higher value priority is preferred for picking a primary selection\nconst BASE_MODALITY_TYPES = {\n  CT: { priority: 3 },\n  MR: { priority: 3 },\n  US: { priority: 2 },\n  DX: { priority: 1 },\n} as const;\n\nfunction findBaseDicom(loadableDataSources: Array<LoadableResult>) {\n  // find dicom dataset for primary selection if available\n  const dicoms = loadableDataSources.filter(\n    ({ dataType }) => dataType === 'dicom'\n  );\n  // prefer some modalities as base\n  const dicomStore = useDICOMStore();\n  const baseDicomVolumes = dicoms\n    .map((dicomSource) => {\n      const volumeInfo = dicomStore.volumeInfo[dicomSource.dataID];\n      const modality = volumeInfo?.Modality as keyof typeof BASE_MODALITY_TYPES;\n      if (modality in BASE_MODALITY_TYPES)\n        return {\n          dicomSource,\n          priority: BASE_MODALITY_TYPES[modality]?.priority,\n          volumeInfo,\n        };\n      return undefined;\n    })\n    .filter(nonNullable)\n    .sort(\n      (\n        { priority: a, volumeInfo: infoA },\n        { priority: b, volumeInfo: infoB }\n      ) => {\n        const priorityDiff = a - b;\n        if (priorityDiff !== 0) return priorityDiff;\n        // same modality, then more slices preferred\n        if (!infoA.NumberOfSlices) return 1;\n        if (!infoB.NumberOfSlices) return -1;\n        return infoB.NumberOfSlices - infoA.NumberOfSlices;\n      }\n    );\n  if (baseDicomVolumes.length) return baseDicomVolumes[0].dicomSource;\n  return undefined;\n}\n\nfunction isSegmentation(extension: string, name: string) {\n  if (!extension) return false; // avoid 'foo..bar' if extension is ''\n  const extensions = name.split('.').slice(1);\n  return extensions.includes(extension);\n}\n\n// does not pick segmentation images\nfunction findBaseImage(\n  loadableDataSources: Array<LoadableResult>,\n  segmentGroupExtension: string\n) {\n  const baseImages = loadableDataSources\n    .filter(({ dataType }) => dataType === 'image')\n    .filter((importResult) => {\n      const name = getDataSourceName(importResult.dataSource);\n      if (!name) return false;\n      return !isSegmentation(segmentGroupExtension, name);\n    });\n\n  if (baseImages.length) return baseImages[0];\n  return undefined;\n}\n\n// returns image and dicom sources, no config files\nfunction filterLoadableDataSources(\n  succeeded: Array<PipelineResultSuccess<ImportResult>>\n) {\n  return succeeded.flatMap((result) => {\n    return result.data.filter(isLoadableResult);\n  });\n}\n\n// Returns list of dataSources with file names where the name has the extension argument\n// and the start of the file name matches the primary file name.\nfunction filterMatchingNames(\n  primaryDataSource: VolumeResult,\n  succeeded: Array<PipelineResultSuccess<ImportResult>>,\n  extension: string\n) {\n  const dicomStore = useDICOMStore();\n  const primaryName =\n    primaryDataSource.dataType === 'dicom'\n      ? dicomStore.volumeInfo[primaryDataSource.dataID].SeriesNumber\n      : getDataSourceName(primaryDataSource.dataSource);\n  if (!primaryName) return [];\n  const primaryNamePrefix = primaryName.split('.').slice(0, 1).join();\n  return filterLoadableDataSources(succeeded)\n    .filter((ds) => ds !== primaryDataSource)\n    .map((importResult) => ({\n      importResult,\n      name: getDataSourceName(importResult.dataSource),\n    }))\n    .filter(({ name }) => {\n      if (!name) return false;\n      const hasExtension = isSegmentation(extension, name);\n      const nameMatchesPrimary = name.startsWith(primaryNamePrefix);\n      return hasExtension && nameMatchesPrimary;\n    })\n    .map(({ importResult }) => importResult);\n}\n\nfunction getStudyUID(volumeID: string) {\n  const dicomStore = useDICOMStore();\n  const studyKey = dicomStore.volumeStudy[volumeID];\n  return dicomStore.studyInfo[studyKey]?.StudyInstanceUID;\n}\n\nfunction findBaseDataSource(\n  succeeded: Array<PipelineResultSuccess<ImportResult>>,\n  segmentGroupExtension: string\n) {\n  const loadableDataSources = filterLoadableDataSources(succeeded);\n  const baseDicom = findBaseDicom(loadableDataSources);\n  if (baseDicom) return baseDicom;\n\n  const baseImage = findBaseImage(loadableDataSources, segmentGroupExtension);\n  if (baseImage) return baseImage;\n  return loadableDataSources[0];\n}\n\nfunction filterOtherVolumesInStudy(\n  volumeID: string,\n  succeeded: Array<PipelineResultSuccess<ImportResult>>\n) {\n  const targetStudyUID = getStudyUID(volumeID);\n  const dicomDataSources = filterLoadableDataSources(succeeded).filter(\n    ({ dataType }) => dataType === 'dicom'\n  );\n  return dicomDataSources.filter((ds) => {\n    const sourceStudyUID = getStudyUID(ds.dataID);\n    return sourceStudyUID === targetStudyUID && ds.dataID !== volumeID;\n  }) as Array<VolumeResult>;\n}\n\n// Layers a DICOM PET on a CT if found\nfunction loadLayers(\n  primaryDataSource: VolumeResult,\n  succeeded: Array<PipelineResultSuccess<ImportResult>>\n) {\n  if (primaryDataSource.dataType !== 'dicom') return;\n  const otherVolumesInStudy = filterOtherVolumesInStudy(\n    primaryDataSource.dataID,\n    succeeded\n  );\n  const dicomStore = useDICOMStore();\n  const primaryModality =\n    dicomStore.volumeInfo[primaryDataSource.dataID].Modality;\n  if (primaryModality !== 'CT') return;\n  // Look for one PET volume to layer with CT.  Only one as there are often multiple \"White Balance\" corrected PET volumes.\n  const toLayer = otherVolumesInStudy.find((ds) => {\n    const otherModality = dicomStore.volumeInfo[ds.dataID].Modality;\n    return otherModality === 'PT';\n  });\n  if (!toLayer) return;\n\n  const primarySelection = toDataSelection(primaryDataSource);\n  const layersStore = useLayersStore();\n  const layerSelection = toDataSelection(toLayer);\n  layersStore.addLayer(primarySelection, layerSelection);\n}\n\n// Loads other DataSources as Segment Groups:\n// - DICOM SEG modalities with matching StudyUIDs.\n// - DataSources that have a name like foo.segmentation.bar and the primary DataSource is named foo.baz\nfunction loadSegmentations(\n  primaryDataSource: VolumeResult,\n  succeeded: Array<PipelineResultSuccess<ImportResult>>,\n  segmentGroupExtension: string\n) {\n  const matchingNames = filterMatchingNames(\n    primaryDataSource,\n    succeeded,\n    segmentGroupExtension\n  ).filter(\n    isVolumeResult // filter out models\n  );\n\n  const dicomStore = useDICOMStore();\n  const otherSegVolumesInStudy = filterOtherVolumesInStudy(\n    primaryDataSource.dataID,\n    succeeded\n  ).filter((ds) => {\n    const modality = dicomStore.volumeInfo[ds.dataID].Modality;\n    if (!modality) return false;\n    return modality.trim() === 'SEG';\n  });\n\n  const segmentGroupStore = useSegmentGroupStore();\n  [...otherSegVolumesInStudy, ...matchingNames].forEach((ds) => {\n    const loadable = toDataSelection(ds);\n    segmentGroupStore.convertImageToLabelmap(\n      loadable,\n      toDataSelection(primaryDataSource)\n    );\n  });\n}\n\nfunction loadDataSources(sources: DataSource[]) {\n  const load = async () => {\n    const loadDataStore = useLoadDataStore();\n    const dataStore = useDatasetStore();\n\n    let results: ImportDataSourcesResult[];\n    try {\n      results = await importDataSources(sources);\n    } catch (error) {\n      loadDataStore.setError(error as Error);\n      return;\n    }\n\n    const [succeeded, errored] = partitionResults(results);\n\n    if (!dataStore.primarySelection && succeeded.length) {\n      const primaryDataSource = findBaseDataSource(\n        succeeded,\n        loadDataStore.segmentGroupExtension\n      );\n\n      if (isVolumeResult(primaryDataSource)) {\n        const selection = toDataSelection(primaryDataSource);\n        dataStore.setPrimarySelection(selection);\n        loadLayers(primaryDataSource, succeeded);\n        loadSegmentations(\n          primaryDataSource,\n          succeeded,\n          loadDataStore.segmentGroupExtension\n        );\n      } // then must be primaryDataSource.type === 'model'\n    }\n\n    if (errored.length) {\n      const errorMessages = errored.map((errResult) => {\n        // pick first error\n        const [firstError] = errResult.errors;\n        // pick innermost dataset that errored\n        const name = getDataSourceName(firstError.inputDataStackTrace[0]);\n        // log error for debugging\n        logError(firstError.cause);\n        return `- ${name}: ${firstError.message}`;\n      });\n      const failedError = new Error(\n        `These files failed to load:\\n${errorMessages.join('\\n')}`\n      );\n\n      loadDataStore.setError(failedError);\n    }\n  };\n\n  const wrapWithLoading = <T extends (...args: any[]) => void>(fn: T) => {\n    const { startLoading, stopLoading } = useLoadDataStore();\n    return async function wrapper(...args: any[]) {\n      try {\n        startLoading();\n        await fn(...args);\n      } finally {\n        stopLoading();\n      }\n    };\n  };\n\n  return wrapWithLoading(load)();\n}\n\nexport function openFileDialog() {\n  return new Promise<File[]>((resolve) => {\n    const fileEl = document.createElement('input');\n    fileEl.setAttribute('type', 'file');\n    fileEl.setAttribute('multiple', 'multiple');\n    fileEl.setAttribute('accept', '*');\n    fileEl.addEventListener('change', () => {\n      const files = [...(fileEl.files ?? [])];\n      resolve(files);\n    });\n    fileEl.click();\n  });\n}\n\nexport async function loadFiles(files: File[]) {\n  const dataSources = files.map(fileToDataSource);\n  return loadDataSources(dataSources);\n}\n\nexport async function loadUserPromptedFiles() {\n  const files = await openFileDialog();\n  return loadFiles(files);\n}\n\nexport async function loadUrls(params: UrlParams) {\n  const urls = wrapInArray(params.urls);\n  const names = wrapInArray(params.names ?? []); // optional names should resolve to [] if params.names === undefined\n  const sources = urls.map((url, idx) =>\n    uriToDataSource(\n      url,\n      names[idx] ||\n        basename(parseUrl(url, window.location.href).pathname) ||\n        url\n    )\n  );\n\n  return loadDataSources(sources);\n}\n","<template>\n  <v-card>\n    <v-card-title class=\"d-flex flex-row align-center\">\n      Saving Session State\n    </v-card-title>\n    <v-card-text>\n      <v-form v-model=\"valid\" @submit.prevent=\"saveSession\">\n        <v-text-field\n          v-model=\"fileName\"\n          hint=\"The filename to use for the session state file.\"\n          label=\"Session State Filename\"\n          :rules=\"[validFileName]\"\n          required\n          id=\"session-state-filename\"\n        />\n      </v-form>\n    </v-card-text>\n    <v-card-actions>\n      <v-spacer />\n      <v-btn\n        :loading=\"saving\"\n        color=\"secondary\"\n        @click=\"saveSession\"\n        :disabled=\"!valid\"\n      >\n        <v-icon class=\"mr-2\">mdi-content-save-all</v-icon>\n        <span data-testid=\"save-session-confirm-button\">Save</span>\n      </v-btn>\n    </v-card-actions>\n  </v-card>\n</template>\n\n<script lang=\"ts\">\nimport { defineComponent, onMounted, ref } from 'vue';\nimport { saveAs } from 'file-saver';\nimport { onKeyDown } from '@vueuse/core';\n\nimport { serialize } from '../io/state-file';\n\nconst DEFAULT_FILENAME = 'session.volview.zip';\n\nexport default defineComponent({\n  props: {\n    close: {\n      type: Function,\n      required: true,\n    },\n  },\n  setup(props) {\n    const fileName = ref('');\n    const valid = ref(true);\n    const saving = ref(false);\n\n    async function saveSession() {\n      if (fileName.value.trim().length >= 0) {\n        saving.value = true;\n        try {\n          const blob = await serialize();\n          saveAs(blob, fileName.value);\n          props.close();\n        } finally {\n          saving.value = false;\n        }\n      }\n    }\n\n    onMounted(() => {\n      // triggers form validation check so can immediately save with default value\n      fileName.value = DEFAULT_FILENAME;\n    });\n\n    onKeyDown('Enter', () => {\n      saveSession();\n    });\n\n    function validFileName(name: string) {\n      return name.trim().length > 0 || 'Required';\n    }\n\n    return {\n      saving,\n      saveSession,\n      fileName,\n      validFileName,\n      valid,\n    };\n  },\n});\n</script>\n","<template>\n  <v-btn\n    variant=\"text\"\n    :rounded=\"0\"\n    dark\n    :height=\"sizeV\"\n    :width=\"sizeV\"\n    :min-width=\"sizeV\"\n    :max-width=\"sizeV\"\n    :class=\"classV\"\n    v-bind=\"$attrs\"\n  >\n    <v-icon :size=\"iconSize\">{{ icon }}</v-icon>\n    <v-tooltip\n      :location=\"tooltipLocation\"\n      activator=\"parent\"\n      transition=\"slide-x-transition\"\n    >\n      <span>{{ name }}</span>\n    </v-tooltip>\n    <slot />\n  </v-btn>\n</template>\n\n<script>\nexport default {\n  name: 'ControlButton',\n  props: {\n    icon: { type: String, required: true },\n    name: { type: String, required: true },\n    size: { type: [Number, String], default: 40 },\n    buttonClass: [String, Array, Object],\n    tooltipLocation: { type: String, default: 'right' },\n  },\n\n  computed: {\n    sizeV() {\n      return Number(this.size);\n    },\n    iconSize() {\n      return Math.floor(0.6 * this.sizeV);\n    },\n    classV() {\n      const classSpec = this.buttonClass;\n      if (typeof classSpec === 'string') {\n        return classSpec;\n      }\n      if (Array.isArray(classSpec)) {\n        return classSpec.join(' ');\n      }\n      if (classSpec && Object.keys(classSpec).length) {\n        return Object.keys(this.buttonClass)\n          .filter((key) => this.buttonClass[key])\n          .join(' ');\n      }\n      return '';\n    },\n  },\n};\n</script>\n","<template>\n  <div>\n    <span>{{ message }}</span>\n    &nbsp;\n    <button v-if=\"detailsButton\" class=\"button\">details</button>\n  </div>\n</template>\n\n<script lang=\"ts\">\nimport { defineComponent } from 'vue';\n\nexport default defineComponent({\n  props: {\n    message: String,\n    detailsButton: Boolean,\n  },\n});\n</script>\n\n<style scoped>\n.button {\n  background: rgba(0, 0, 0, 0.2);\n  padding: 4px 8px;\n  border-radius: 3px;\n  text-transform: capitalize;\n}\n</style>\n","<script lang=\"ts\">\nimport { defineComponent, watch } from 'vue';\nimport { useToast } from '@/src/composables/useToast';\nimport { storeToRefs } from 'pinia';\nimport type { ToastID } from 'vue-toastification/dist/types/types';\nimport { Message, MessageType, useMessageStore } from '../store/messages';\nimport MessageNotificationContent from './MessageNotificationContent.vue';\n\nconst TIMEOUT = 5000;\n\nexport default defineComponent({\n  setup(props, { emit }) {\n    const messageStore = useMessageStore();\n    const { byID } = storeToRefs(messageStore);\n\n    const toasts = {} as Record<string, ToastID>;\n\n    const toast = useToast();\n    type ToastMethod =\n      | typeof toast.info\n      | typeof toast.success\n      | typeof toast.warning\n      | typeof toast.error;\n\n    const makeToastOptions = (msgID: string) => ({\n      timeout: byID.value[msgID].options.persist ? (false as const) : TIMEOUT,\n      closeOnClick: !byID.value[msgID].options.persist,\n      onClick: () => emit('open-notifications'),\n      onClose: () => {\n        delete toasts[msgID];\n      },\n    });\n\n    // remove toasts if the message is gone\n    watch(byID, (msgLookup) => {\n      Object.keys(toasts).forEach((msgID) => {\n        if (!(msgID in msgLookup)) {\n          toast.dismiss(toasts[msgID]);\n          delete toasts[msgID];\n        }\n      });\n    });\n\n    messageStore.$onAction(({ name, args, after }) => {\n      if (name === '_addMessage') {\n        const message = args[0] as Omit<Message, 'id'>;\n        after((msgID) => {\n          if (!msgID) {\n            return;\n          }\n\n          let toastMethod: ToastMethod = toast.info;\n          let showDetailsButton = false;\n\n          if (message.type === MessageType.Error) {\n            toastMethod = toast.error;\n            showDetailsButton = true;\n          } else if (message.type === MessageType.Warning) {\n            toastMethod = toast.warning;\n            showDetailsButton = true;\n          } else if (message.type === MessageType.Info) {\n            toastMethod = toast.info;\n          } else if (message.type === MessageType.Success) {\n            toastMethod = toast.success;\n          }\n\n          toasts[msgID] = toastMethod(\n            {\n              component: MessageNotificationContent,\n              props: {\n                message: message.title,\n                detailsButton: showDetailsButton,\n              },\n            },\n            makeToastOptions(msgID)\n          );\n        });\n      }\n    });\n\n    return () => null;\n  },\n});\n</script>\n","import { defineStore } from 'pinia';\nimport {\n  ANONYMOUS_PATIENT,\n  ANONYMOUS_PATIENT_ID,\n  PatientInfo,\n  StudyInfo,\n  VolumeInfo,\n} from '../datasets-dicom';\nimport { pick, removeFromArray } from '../../utils';\nimport { Instance } from '../../core/dicom-web-api';\n\ninterface InstanceInfo {\n  SopInstanceUID: string;\n  InstanceNumber: string;\n  Rows: number;\n  Columns: number;\n}\n\ntype VolumeInfoForUi = Omit<VolumeInfo, 'layers'>;\n\ninterface State {\n  // volume invalidation information\n  needsRebuild: Record<string, boolean>;\n\n  // patientKey -> patient info\n  patientInfo: Record<string, PatientInfo>;\n  // patientKey -> array of studyKeys\n  patientStudies: Record<string, string[]>;\n\n  // studyKey -> study info\n  studyInfo: Record<string, StudyInfo>;\n  // studyKey -> array of volumeKeys\n  studyVolumes: Record<string, string[]>;\n\n  // volumeKey -> volume info\n  volumeInfo: Record<string, VolumeInfoForUi>;\n  // volumeKey -> array of instanceKeys\n  volumeInstances: Record<string, string[]>;\n\n  // instanceKey -> instance info\n  instanceInfo: Record<string, InstanceInfo>;\n\n  // parent pointers\n  // instanceKey -> volumeKey\n  instanceVolume: Record<string, string>;\n  // volumeKey -> studyKey\n  volumeStudy: Record<string, string>;\n  // studyKey -> patientKey\n  studyPatient: Record<string, string>;\n}\n\nexport const useDicomMetaStore = defineStore('dicom-meta', {\n  state: (): State => ({\n    patientInfo: {},\n    patientStudies: {},\n    studyInfo: {},\n    studyVolumes: {},\n    volumeInfo: {},\n    volumeInstances: {},\n    instanceInfo: {},\n    instanceVolume: {},\n    volumeStudy: {},\n    studyPatient: {},\n    needsRebuild: {},\n  }),\n  actions: {\n    async importMeta(info: Instance) {\n      const patient = {\n        PatientID: info.PatientID || ANONYMOUS_PATIENT_ID,\n        PatientName: info.PatientName || ANONYMOUS_PATIENT,\n        PatientBirthDate: info.PatientBirthDate || '',\n        PatientSex: info.PatientSex || '',\n      };\n\n      const study = pick(\n        info,\n        'StudyID',\n        'StudyInstanceUID',\n        'StudyDate',\n        'StudyTime',\n        'AccessionNumber',\n        'StudyDescription'\n      );\n\n      const volumeInfo = {\n        ...pick(\n          info,\n          'Modality',\n          'SeriesInstanceUID',\n          'SeriesNumber',\n          'SeriesDescription',\n          'WindowLevel',\n          'WindowWidth'\n        ),\n        NumberOfSlices: 0, // incremented later\n        VolumeID: info.SeriesInstanceUID,\n      };\n\n      const instanceInfo = {\n        ...pick(info, 'SopInstanceUID', 'InstanceNumber'),\n        Rows: Number.parseInt(info.Rows, 10),\n        Columns: Number.parseInt(info.Columns, 10),\n      };\n\n      this._updateDatabase(patient, study, volumeInfo, instanceInfo);\n    },\n\n    deleteVolume(volumeKey: string) {\n      if (volumeKey in this.volumeInfo) {\n        const studyKey = this.volumeStudy[volumeKey];\n        delete this.volumeInfo[volumeKey];\n        delete this.volumeStudy[volumeKey];\n\n        removeFromArray(this.studyVolumes[studyKey], volumeKey);\n        if (this.studyVolumes[studyKey].length === 0) {\n          this.deleteStudy(studyKey);\n        }\n      }\n    },\n\n    deleteStudy(studyKey: string) {\n      if (studyKey in this.studyInfo) {\n        const patientKey = this.studyPatient[studyKey];\n        delete this.studyInfo[studyKey];\n        delete this.studyPatient[studyKey];\n\n        delete this.studyVolumes[studyKey];\n\n        removeFromArray(this.patientStudies[patientKey], studyKey);\n        if (this.patientStudies[patientKey].length === 0) {\n          this.deletePatient(patientKey);\n        }\n      }\n    },\n\n    deletePatient(patientKey: string) {\n      if (patientKey in this.patientInfo) {\n        delete this.patientInfo[patientKey];\n\n        [...this.patientStudies[patientKey]].forEach((studyKey) =>\n          this.deleteStudy(studyKey)\n        );\n        delete this.patientStudies[patientKey];\n      }\n    },\n\n    _updateDatabase(\n      patient: PatientInfo,\n      study: StudyInfo,\n      volume: VolumeInfoForUi,\n      instance: InstanceInfo\n    ) {\n      const patientKey = patient.PatientID;\n      if (patientKey && !(patientKey in this.patientInfo)) {\n        this.patientInfo[patientKey] = patient;\n        this.patientStudies[patientKey] = [];\n      }\n\n      const studyKey = study.StudyInstanceUID;\n      if (studyKey && !(studyKey in this.studyInfo)) {\n        this.studyInfo[studyKey] = study;\n        this.studyVolumes[studyKey] = [];\n        this.studyPatient[studyKey] = patientKey;\n        this.patientStudies[patientKey].push(studyKey);\n      }\n\n      const volumeKey = volume.VolumeID;\n      if (volumeKey && !(volumeKey in this.volumeInfo)) {\n        this.volumeInfo[volumeKey] = volume;\n        this.volumeInstances[volumeKey] = [];\n        this.volumeStudy[volumeKey] = studyKey;\n        this.studyVolumes[studyKey].push(volumeKey);\n      }\n\n      const instanceKey = instance.SopInstanceUID;\n      if (instanceKey && !(instanceKey in this.instanceInfo)) {\n        this.instanceInfo[instanceKey] = instance;\n        this.instanceVolume[instanceKey] = volumeKey;\n        this.volumeInstances[volumeKey].push(instanceKey);\n\n        this.volumeInfo[volumeKey].NumberOfSlices += 1;\n      }\n\n      // Clean orphaned patients. Anonymous Patient loses its only study\n      // when slices are loaded with full DICOM tags. Study was anonymous\n      // because url deep linked into a study\n      Object.entries(this.patientStudies).forEach(([key, studies]) => {\n        if (studies.length === 0) {\n          this.deletePatient(key);\n        }\n      });\n    },\n  },\n});\n","import { cleanUndefined } from '@/src/utils';\nimport { api } from 'dicomweb-client-typed';\nimport { globalHeaders } from '@/src/utils/fetch';\n\nexport interface FetchStudyOptions {\n  studyInstanceUID: string;\n}\n\nexport interface FetchSeriesOptions extends FetchStudyOptions {\n  seriesInstanceUID: string;\n}\n\nexport interface FetchInstanceOptions extends FetchSeriesOptions {\n  sopInstanceUID: string;\n}\n\nconst tags = {\n  PatientID: '00100020',\n  PatientName: '00100010',\n  PatientBirthDate: '00100030',\n  PatientSex: '00100040',\n\n  StudyID: '00200010',\n  StudyInstanceUID: '0020000D',\n  StudyName: '00100010',\n  StudyDate: '00080020',\n  StudyTime: '00080030',\n  AccessionNumber: '00080050',\n  StudyDescription: '00081030',\n\n  SeriesInstanceUID: '0020000E',\n  SeriesNumber: '00200011',\n  SeriesDescription: '0008103E',\n  Modality: '00080060',\n  WindowLevel: '00281050',\n  WindowWidth: '00281051',\n\n  SopInstanceUID: '00080018',\n  InstanceNumber: '00200013',\n\n  Rows: '00280010',\n  Columns: '00280011',\n};\n\nexport type Instance = typeof tags;\n\nfunction parseTag(value: any) {\n  const v = value?.Value?.[0];\n  const alpha = v?.Alphabetic;\n  if (alpha) return alpha;\n  return v;\n}\n\nfunction parseInstance(instance: any) {\n  const withNamedTags = Object.entries(tags).reduce(\n    (info, [key, tag]) => ({ ...info, [key]: parseTag(instance[tag]) }),\n    {}\n  );\n  return cleanUndefined(withNamedTags) as Instance;\n}\n\n// Create unique file names so loader utils work\nlet fileCounter = 0;\nfunction toFile(instance: ArrayBuffer) {\n  fileCounter++;\n  return new File([new Blob([instance])], `dicom-web.${fileCounter}.dcm`);\n}\n\nfunction makeClient(dicomWebRoot: string) {\n  const headers = Object.fromEntries(globalHeaders.entries());\n  return new api.DICOMwebClient({\n    url: dicomWebRoot,\n    headers,\n  });\n}\n\nexport async function searchForStudies(dicomWebRoot: string) {\n  const client = makeClient(dicomWebRoot);\n  const instances = await client.searchForStudies();\n  return instances.map(parseInstance);\n}\n\nexport async function retrieveStudyMetadata(\n  dicomWebRoot: string,\n  options: FetchStudyOptions\n) {\n  const client = makeClient(dicomWebRoot);\n  const instances = await client.searchForSeries(options);\n  return instances.map(parseInstance);\n}\n\nexport async function retrieveSeriesMetadata(\n  dicomWebRoot: string,\n  options: FetchSeriesOptions\n) {\n  const client = makeClient(dicomWebRoot);\n  const instances = await client.retrieveSeriesMetadata(options);\n  return instances.map(parseInstance);\n}\n\nexport async function fetchSeries(\n  dicomWebRoot: string,\n  options: FetchSeriesOptions,\n  progressCallback: (n: ProgressEvent) => void\n): Promise<File[]> {\n  const client = makeClient(dicomWebRoot);\n  const series = (await client.retrieveSeries({\n    ...options,\n    progressCallback,\n  })) as ArrayBuffer[];\n  return series.map(toFile);\n}\n\nexport async function fetchInstanceThumbnail(\n  dicomWebRoot: string,\n  instance: FetchInstanceOptions\n) {\n  const client = makeClient(dicomWebRoot);\n  const thumbnail = await client.retrieveInstanceRendered({\n    ...instance,\n    mediaTypes: [{ mediaType: 'image/jpeg' }],\n  });\n  const arrayBufferView = new Uint8Array(thumbnail);\n  const blob = new Blob([arrayBufferView], { type: 'image/jpeg' });\n  return URL.createObjectURL(blob);\n}\n\nconst LEVELS = ['series', 'studies'] as const;\n\n// takes a url like http://localhost:3000/dicom-web/studies/someid/series/anotherid\n// returns { host: 'http://localhost:3000/dicom-web', studies: 'someid', series: 'anotherid' }\nexport function parseUrl(deepDicomWebUrl: string) {\n  // remove trailing slash\n  const sansSlash = deepDicomWebUrl.replace(/\\/$/, '');\n\n  let paths = sansSlash.split('/');\n  const parentIDs = LEVELS.reduce((idObj, dicomLevel) => {\n    const [urlLevel, dicomID] = paths.slice(-2);\n    if (urlLevel === dicomLevel) {\n      paths = paths.slice(0, -2);\n      return { [dicomLevel]: dicomID, ...idObj };\n    }\n    return idObj;\n  }, {});\n\n  const pathsToSlice = Object.keys(parentIDs).length * 2;\n  const allPaths = sansSlash.split('/');\n  const host = allPaths.slice(0, allPaths.length - pathsToSlice).join('/');\n\n  return { host, ...parentIDs };\n}\n","import { computed, ref, watch } from 'vue';\nimport { useLocalStorage, UrlParams } from '@vueuse/core';\nimport { defineStore } from 'pinia';\nimport vtkURLExtract from '@kitware/vtk.js/Common/Core/URLExtract';\n\nimport { omit, remapKeys } from '@/src/utils';\nimport { fileToDataSource } from '@/src/io/import/dataSource';\nimport {\n  convertSuccessResultToDataSelection,\n  importDataSources,\n} from '@/src/io/import/importDataSources';\nimport { useDatasetStore } from '../datasets';\nimport { useDICOMStore } from '../datasets-dicom';\nimport { useMessageStore } from '../messages';\nimport { useDicomMetaStore } from './dicom-meta-store';\nimport {\n  searchForStudies,\n  fetchSeries,\n  fetchInstanceThumbnail,\n  retrieveStudyMetadata,\n  retrieveSeriesMetadata,\n  parseUrl,\n} from '../../core/dicom-web-api';\n\nconst DICOM_WEB_URL_PARAM = 'dicomweb';\n\nexport type ProgressState = 'Remote' | 'Pending' | 'Error' | 'Done';\n\nexport interface VolumeProgress {\n  state: ProgressState;\n  loaded: number;\n  total: number;\n}\n\ninterface Progress {\n  [name: string]: VolumeProgress;\n}\n\nexport const isDownloadable = (progress?: VolumeProgress) =>\n  !progress || ['Pending', 'Done'].every((state) => state !== progress.state);\n\nconst fetchFunctions = {\n  host: searchForStudies,\n  studies: retrieveStudyMetadata,\n  series: retrieveSeriesMetadata,\n};\n\nconst levelToFetchKey = {\n  studies: 'studyInstanceUID',\n  series: 'seriesInstanceUID',\n};\n\nconst levelToMetaKey = {\n  studies: 'StudyInstanceUID',\n  series: 'SeriesInstanceUID',\n};\n\ntype InitialDicomListFetchProgress = 'Idle' | 'Pending' | 'Done';\n\n/**\n * Collect DICOM data from DICOMWeb\n */\nexport const useDicomWebStore = defineStore('dicom-web', () => {\n  const { VITE_DICOM_WEB_NAME, VITE_DICOM_WEB_URL } = import.meta.env;\n  // GUI display name\n  const hostName = VITE_DICOM_WEB_NAME\n    ? ref(VITE_DICOM_WEB_NAME)\n    : useLocalStorage<string>('dicomWebHostName', '');\n\n  // URL param overrides env var, which overrides local storage\n  const urlParams = vtkURLExtract.extractURLParameters() as UrlParams;\n  const dicomWebFromURLParam = urlParams[DICOM_WEB_URL_PARAM] as\n    | string\n    | undefined;\n  const hostConfig = dicomWebFromURLParam ?? VITE_DICOM_WEB_URL;\n\n  // Don't save URL param or env var to local storage. Only save user input.\n  const savedHost = useLocalStorage<string | null>('dicomWebHost', ''); // null if cleared by vuetify text input\n\n  const host = ref<string | null>(hostConfig ?? savedHost.value);\n\n  watch(savedHost, () => {\n    host.value = savedHost.value;\n  });\n\n  // Remove trailing slash and pull study/series IDs from URL\n  const parsedURL = computed(() => parseUrl(host.value ?? ''));\n\n  const cleanHost = computed(() => parsedURL.value.host);\n  const isConfigured = computed(() => !!cleanHost.value);\n\n  const fetchVolumeThumbnail = async (volumeKey: string) => {\n    const dicoms = useDicomMetaStore();\n    const volumeInfo = dicoms.volumeInfo[volumeKey];\n    const middleSlice = Math.floor(volumeInfo.NumberOfSlices / 2);\n    const middleInstance = dicoms.volumeInstances[volumeKey]\n      .map((instanceKey) => dicoms.instanceInfo[instanceKey])\n      .sort(\n        ({ InstanceNumber: a }, { InstanceNumber: b }) => Number(a) - Number(b)\n      )[middleSlice];\n\n    const studyKey = dicoms.volumeStudy[volumeKey];\n    const studyInfo = dicoms.studyInfo[studyKey];\n    const instance = {\n      studyInstanceUID: studyInfo.StudyInstanceUID,\n      seriesInstanceUID: volumeInfo.SeriesInstanceUID,\n      sopInstanceUID: middleInstance.SopInstanceUID,\n    };\n    return fetchInstanceThumbnail(cleanHost.value, instance);\n  };\n\n  const fetchPatientMeta = async (patientKey: string) => {\n    const dicoms = useDicomMetaStore();\n    const series = await Promise.all(\n      dicoms.patientStudies[patientKey]\n        .map((studyKey) => dicoms.studyInfo[studyKey])\n        .map(async (studyMeta) => {\n          const seriesMetas = await retrieveStudyMetadata(cleanHost.value, {\n            studyInstanceUID: studyMeta.StudyInstanceUID,\n          });\n          return seriesMetas.map((seriesMeta) => ({\n            ...studyMeta,\n            ...seriesMeta,\n          }));\n        })\n    );\n    series.flat().forEach((instance) => dicoms.importMeta(instance));\n  };\n\n  const fetchVolumesMeta = async (volumeKeys: string[]) => {\n    const dicoms = useDicomMetaStore();\n    const series = await Promise.all(\n      volumeKeys.map(async (volumeKey) => {\n        const volumeMeta = dicoms.volumeInfo[volumeKey];\n        const studyMeta = dicoms.studyInfo[dicoms.volumeStudy[volumeKey]];\n        const instanceMetas = await retrieveSeriesMetadata(cleanHost.value, {\n          studyInstanceUID: studyMeta.StudyInstanceUID,\n          seriesInstanceUID: volumeMeta.SeriesInstanceUID,\n        });\n        return instanceMetas.map((instanceMeta) => ({\n          ...studyMeta,\n          ...volumeMeta,\n          ...instanceMeta,\n        }));\n      })\n    );\n    series.flat().forEach((instance) => dicoms.importMeta(instance));\n  };\n\n  const volumes = ref({} as Progress);\n\n  const downloadVolume = async (volumeKey: string) => {\n    const datasets = useDatasetStore();\n    const dicoms = useDicomMetaStore();\n\n    if (!isDownloadable(volumes.value[volumeKey])) return;\n\n    volumes.value[volumeKey] = {\n      ...volumes.value[volumeKey],\n      state: 'Pending',\n      loaded: 0,\n      total: 0,\n    };\n\n    const { SeriesInstanceUID: seriesInstanceUID } =\n      dicoms.volumeInfo[volumeKey];\n    const studyKey = dicoms.volumeStudy[volumeKey];\n    const { StudyInstanceUID: studyInstanceUID } = dicoms.studyInfo[studyKey];\n    const seriesInfo = { studyInstanceUID, seriesInstanceUID };\n\n    const progressCallback = ({ loaded, total }: ProgressEvent) => {\n      volumes.value[volumeKey] = {\n        ...volumes.value[volumeKey],\n        loaded,\n        total,\n      };\n    };\n\n    try {\n      const files = await fetchSeries(\n        cleanHost.value,\n        seriesInfo,\n        progressCallback\n      );\n\n      if (!files) {\n        throw new Error('Could not fetch series');\n      }\n\n      const [loadResult] = await importDataSources(files.map(fileToDataSource));\n      if (!loadResult) {\n        throw new Error('Did not receive a load result');\n      }\n\n      if (!loadResult.ok) {\n        throw loadResult.errors[0].cause;\n      }\n\n      const selection = convertSuccessResultToDataSelection(loadResult);\n      datasets.setPrimarySelection(selection);\n      volumes.value[volumeKey] = {\n        ...volumes.value[volumeKey],\n        state: 'Done',\n      };\n    } catch (error) {\n      console.error(error);\n      const messageStore = useMessageStore();\n      messageStore.addError('Failed to load DICOM', error as Error);\n      volumes.value[volumeKey] = {\n        ...volumes.value[volumeKey],\n        state: 'Error',\n        loaded: 0,\n      };\n    }\n  };\n\n  const fetchDicomsProgress = ref<InitialDicomListFetchProgress>('Idle');\n  const fetchError = ref<undefined | unknown>(undefined);\n  // DICOMWeb DataBrowser components automatically expands panels if true\n  const linkedToStudyOrSeries = ref(false);\n  const fetchDicoms = async () => {\n    fetchDicomsProgress.value = 'Pending';\n    fetchError.value = undefined;\n    linkedToStudyOrSeries.value = false;\n\n    const dicoms = useDicomMetaStore();\n    dicoms.$reset();\n    if (!cleanHost.value) return;\n\n    const deepestLevel = Object.keys(\n      parsedURL.value\n    ).pop() as keyof typeof fetchFunctions; // at least host key guaranteed to exist\n\n    linkedToStudyOrSeries.value =\n      deepestLevel === 'studies' || deepestLevel === 'series';\n\n    const fetchFunc = fetchFunctions[deepestLevel];\n    const urlIDs = omit(parsedURL.value, 'host');\n    const fetchOptions = remapKeys(urlIDs, levelToFetchKey);\n    try {\n      const fetchedMetas = await fetchFunc(\n        cleanHost.value,\n        fetchOptions as any\n      );\n\n      const urlMetaIDs = remapKeys(urlIDs, levelToMetaKey);\n\n      const fullMeta = fetchedMetas.map((fetchedMeta) => ({\n        ...urlMetaIDs,\n        ...fetchedMeta,\n      }));\n      fullMeta.forEach((instance) => dicoms.importMeta(instance));\n    } catch (error) {\n      fetchError.value = error;\n      console.error(error);\n    }\n\n    if (deepestLevel === 'series') {\n      const seriesID = Object.values(parsedURL.value).pop() as string;\n      downloadVolume(seriesID);\n    }\n\n    fetchDicomsProgress.value = 'Done';\n  };\n\n  const message = computed(() => {\n    if (fetchError.value)\n      return `Error fetching DICOMWeb data: ${fetchError.value}`;\n\n    const dicoms = useDicomMetaStore();\n    if (\n      fetchDicomsProgress.value === 'Done' &&\n      Object.values(dicoms.patientInfo).length === 0\n    )\n      return 'Found zero dicoms.';\n\n    return '';\n  });\n\n  // Safe to call in components' setup()\n  let lastFetchedHostUrl: string | null = '';\n  const fetchDicomsOnce = () => {\n    if (lastFetchedHostUrl !== host.value || message.value) {\n      lastFetchedHostUrl = host.value;\n      fetchDicoms();\n    }\n  };\n\n  const loadedDicoms = useDICOMStore();\n  loadedDicoms.$onAction(({ name, args, after }) => {\n    if (name !== 'deleteVolume') return;\n\n    after(() => {\n      const [loadedVolumeKey] = args;\n      const volumeKey = Object.keys(volumes.value).find((key) =>\n        loadedVolumeKey.startsWith(key)\n      );\n      if (volumeKey)\n        volumes.value[volumeKey] = {\n          ...volumes.value[volumeKey],\n          state: 'Remote',\n          loaded: 0,\n        };\n    });\n  });\n\n  return {\n    host,\n    savedHost,\n    isConfigured,\n    hostName,\n    message,\n    volumes,\n    linkedToStudyOrSeries,\n    fetchDicomsOnce,\n    fetchPatientMeta,\n    fetchVolumesMeta,\n    fetchVolumeThumbnail,\n    downloadVolume,\n  };\n});\n","<script lang=\"ts\">\nimport { defineComponent, onUnmounted } from 'vue';\nimport { useDicomWebStore } from '../../store/dicom-web/dicom-web-store';\n\nexport default defineComponent({\n  setup() {\n    const dicomWeb = useDicomWebStore();\n\n    onUnmounted(() => {\n      dicomWeb.fetchDicomsOnce();\n    });\n\n    return {\n      dicomWeb,\n    };\n  },\n});\n</script>\n\n<template>\n  <div>\n    <h3 class=\"mb-4\">DICOMWeb</h3>\n    <v-text-field\n      v-model=\"dicomWeb.hostName\"\n      class=\"server-param\"\n      label=\"Host Display Name\"\n      clearable\n    />\n    <v-text-field\n      v-model=\"dicomWeb.savedHost\"\n      class=\"server-param\"\n      label=\"Host Address\"\n      clearable\n    />\n  </div>\n</template>\n","import vtk from '@kitware/vtk.js/vtk';\nimport { TypedArrayConstructorName } from '@/src/types';\nimport { TypedArrayConstructorNames } from '@/src/utils';\nimport vtkImageData from '@kitware/vtk.js/Common/DataModel/ImageData';\n\nconst AllowedTypedArrays = new Set(TypedArrayConstructorNames);\n\nfunction isTypedArrayName(name: string): name is TypedArrayConstructorName {\n  return AllowedTypedArrays.has(name);\n}\n\nfunction isImageData(obj: any): obj is vtkImageData {\n  return obj?.isA?.('vtkImageData');\n}\n\nfunction wrapValuesInTypedArray(serializedImageData: any) {\n  // convert data values to a typed array for smaller packets.\n  const { arrays } = serializedImageData.pointData;\n  arrays.forEach((da: any) => {\n    const { data } = da;\n    if (isTypedArrayName(data.dataType)) {\n      data.values = new globalThis[data.dataType as TypedArrayConstructorName](\n        data.values\n      );\n    }\n  });\n  return serializedImageData;\n}\n\nexport function serializeVtkImageData(obj: any): any {\n  if (!isImageData(obj)) {\n    return obj;\n  }\n\n  const serialized = obj.toJSON() as any;\n  return wrapValuesInTypedArray(serialized);\n}\n\nexport function deserializeVtkImageData(obj: any) {\n  if (obj?.vtkClass !== 'vtkImageData') {\n    return obj;\n  }\n\n  try {\n    return vtk(wrapValuesInTypedArray(obj));\n  } catch (e) {\n    return obj;\n  }\n}\n","import {\n  serializeVtkImageData,\n  deserializeVtkImageData,\n} from '@/src/core/remote/transformers/vtkImageData';\n\nexport const DefaultSerializeTransformers = [serializeVtkImageData];\nexport const DefaultDeserializeTransformers = [deserializeVtkImageData];\n\ntype ObjectTransformer = (obj: any) => any;\n\nexport function transformObject(input: any, transform: ObjectTransformer): any {\n  const output = transform(input);\n\n  if (!output || typeof output !== 'object') {\n    return output;\n  }\n\n  if (Array.isArray(output)) {\n    return output.map((o) => transformObject(o, transform));\n  }\n\n  return Object.entries(output).reduce(\n    (obj, [key, value]) => ({ ...obj, [key]: value }),\n    {}\n  );\n}\n\nexport function transformObjects(\n  args: any[],\n  transform: ObjectTransformer\n): any[] {\n  return args.map((arg) => transformObject(arg, transform));\n}\n","/* eslint-disable max-classes-per-file */\n/* eslint-disable class-methods-use-this */\nimport { Maybe } from '@/src/types';\nimport { ensureError } from '@/src/utils';\nimport * as BaseParser from 'socket.io-parser';\n\nimport type { Packet } from 'socket.io-parser';\n\nexport const CHUNK_SIZE = 1 * 1024 * 1024;\nexport const CHUNKED_PACKET_TYPE = 'C';\n\nfunction isBinary(obj: any) {\n  return (\n    obj instanceof ArrayBuffer ||\n    ArrayBuffer.isView(obj) ||\n    obj instanceof Blob ||\n    obj instanceof File\n  );\n}\n\nfunction getLength(obj: any): number {\n  if (Number.isInteger(obj?.byteLength)) return obj.byteLength;\n  if (Number.isInteger(obj?.length)) return obj.length;\n  throw new Error('Cannot get obj length');\n}\n\nfunction allStringChunks(chunks: any[]): chunks is string[] {\n  return chunks.every((chunk) => typeof chunk === 'string');\n}\n\nfunction allArrayBufferChunks(chunks: any[]): chunks is ArrayBuffer[] {\n  return chunks.every((chunk) => chunk instanceof ArrayBuffer);\n}\n\n/**\n * Encodes a binary packet into fixed-sized chunk messages.\n *\n * The chunked encoder extends the default socket.io-parser protocol to support\n * chunked binary attachments. It should work with any protocol version, but has\n * only been tested with v5.\n *\n * This encoding adds an optional first message indicating that all subsequent\n * messages are chunked.\n *\n * [<chunking message>]\n * <socket.io string message>\n * [<binary attachments>...]\n *\n * The chunking message is a string message that starts with the char 'C' and\n * has the following format:\n *\n * `C<chunking info>`\n *\n * The format of <chunking info> is a flat array of integers:\n * [N1, N2, N3, ...]\n *\n * There are a total of M integers, for M messages. The ith integer tells\n * us how many messages should be concatenated together to re-form the ith\n * message.\n *\n * Chunking works on both string and binary messages.\n */\nclass ChunkedEncoder extends BaseParser.Encoder {\n  encode(packet: Packet) {\n    const messages = super.encode(packet);\n\n    // All messages are smaller than the chunk size.\n    // Skip wrapping the socket.io message with chunking.\n    if (messages.every((m) => getLength(m) <= CHUNK_SIZE)) {\n      return messages;\n    }\n\n    const output: any[] = [];\n    const chunkedSizes: number[] = [];\n\n    for (let i = 0; i < messages.length; i++) {\n      const msg = messages[i];\n      const chunks = this.chunkMessage(msg);\n      chunkedSizes.push(chunks.length);\n      output.push(...chunks);\n    }\n\n    return [`${CHUNKED_PACKET_TYPE}${JSON.stringify(chunkedSizes)}`, ...output];\n  }\n\n  protected chunkMessage(msg: any) {\n    if (typeof msg === 'string') {\n      return this.chunkString(msg);\n    }\n    if (isBinary(msg)) {\n      return this.chunkBinary(msg);\n    }\n    throw new TypeError('Cannot handle invalid message type');\n  }\n\n  protected chunkString(str: string) {\n    const chunks: string[] = [];\n    let offset = 0;\n    while (offset < str.length) {\n      const chunkEnd = Math.min(offset + CHUNK_SIZE, str.length);\n      chunks.push(str.substring(offset, chunkEnd));\n      offset = chunkEnd;\n    }\n    return chunks;\n  }\n\n  protected chunkBinary(binary: ArrayBufferView | ArrayBuffer | Blob | File) {\n    if (ArrayBuffer.isView(binary) || binary instanceof ArrayBuffer) {\n      const view =\n        binary instanceof ArrayBuffer ? new Uint8Array(binary) : binary;\n      const chunks: Uint8Array[] = [];\n      const { buffer } = view;\n      const end = view.byteOffset + view.byteLength;\n      let offset = view.byteOffset;\n      while (offset < end) {\n        const chunkEnd = Math.min(offset + CHUNK_SIZE, end);\n        chunks.push(new Uint8Array(buffer, offset, chunkEnd - offset));\n        offset = chunkEnd;\n      }\n      return chunks;\n    }\n\n    // Blob | File\n    const chunks: Blob[] = [];\n    let offset = 0;\n    while (offset < binary.size) {\n      const chunkEnd = Math.min(offset + CHUNK_SIZE, binary.size);\n      chunks.push(binary.slice(offset, chunkEnd));\n      offset += chunkEnd;\n    }\n    return chunks;\n  }\n}\n\nclass ChunkedDecoder extends BaseParser.Decoder {\n  protected chunkingInfo: Maybe<number[]>;\n  protected chunks: Array<string | Uint8Array> = [];\n\n  add(obj: any): void {\n    if (this.chunkingInfo?.length) {\n      // process chunk\n      this.chunks.push(obj);\n\n      if (this.chunks.length === this.chunkingInfo[0]) {\n        super.add(this.reconstructChunks(this.chunks));\n        this.chunks.length = 0;\n        this.chunkingInfo.shift();\n      }\n\n      if (this.chunkingInfo.length === 0) {\n        // reset chunking state\n        this.chunkingInfo = null;\n      }\n    } else if (\n      typeof obj === 'string' &&\n      obj.charAt(0) === CHUNKED_PACKET_TYPE\n    ) {\n      // chunking message\n      if (obj.charAt(1) !== '[') {\n        throw new Error('Failed to parse start of chunking info.');\n      }\n      this.chunkingInfo = this.parseChunkingInfo(obj.substring(1));\n      this.chunks = [];\n    } else {\n      // let the parent take care of it.\n      super.add(obj);\n    }\n  }\n\n  protected parseChunkingInfo(serialized: string): number[] {\n    try {\n      const result = JSON.parse(serialized);\n      if (!Array.isArray(result)) {\n        throw new TypeError('Chunking info is not an array');\n      }\n      if (!result.every((item) => Number.isInteger(item))) {\n        throw new TypeError('Chunking info is invalid');\n      }\n      return result as number[];\n    } catch (err) {\n      throw new Error('Failed to parse chunking info', {\n        cause: ensureError(err),\n      });\n    }\n  }\n\n  protected reconstructChunks(chunks: Array<string | ArrayBuffer>) {\n    if (!chunks.length) {\n      throw new Error('Cannot reconstruct an empty chunk');\n    }\n\n    if (allStringChunks(chunks)) {\n      return this.reconstructString(chunks);\n    }\n    if (allArrayBufferChunks(chunks)) {\n      return this.reconstructBinary(chunks);\n    }\n\n    throw new TypeError('Received a set of unknown chunks');\n  }\n\n  protected reconstructString(chunks: string[]) {\n    return chunks.join('');\n  }\n\n  protected reconstructBinary(chunks: ArrayBuffer[]) {\n    const byteLength = chunks.reduce((sum, chunk) => sum + chunk.byteLength, 0);\n    const reconstructed = new Uint8Array(byteLength);\n    let offset = 0;\n    chunks.forEach((chunk) => {\n      reconstructed.set(new Uint8Array(chunk), offset);\n      offset += chunk.byteLength;\n    });\n    return reconstructed.buffer;\n  }\n}\n\nexport const Encoder = ChunkedEncoder;\nexport const Decoder = ChunkedDecoder;\n","import {\n  DefaultDeserializeTransformers,\n  DefaultSerializeTransformers,\n  transformObject,\n  transformObjects,\n} from '@/src/core/remote/transformers';\nimport { Maybe } from '@/src/types';\nimport { Deferred, defer } from '@/src/utils';\nimport { debug } from '@/src/utils/loggers';\nimport { flow } from '@/src/utils/functional';\nimport { nanoid } from 'nanoid';\nimport { Socket, io } from 'socket.io-client';\nimport { z } from 'zod';\nimport * as ChunkedParser from '@/src/core/remote/chunkedParser';\nimport { parseUrl } from '@/src/utils/url';\n\nconst CLIENT_ID_SIZE = 24;\nconst RPC_ID_SIZE = 24;\nconst RPC_CALL_EVENT = 'rpc:call';\nconst RPC_RESULT_EVENT = 'rpc:result';\nconst STREAM_CALL_EVENT = 'stream:call';\nconst STREAM_RESULT_EVENT = 'stream:result';\n\ninterface RpcOkResult<R> {\n  rpcId: string;\n  ok: true;\n  data: R;\n}\n\nconst RpcOkResultSchema = z.object({\n  rpcId: z.string(),\n  ok: z.literal(true),\n  data: z.unknown(),\n});\n\nexport function makeRpcOkResult<T = unknown>(data: T): RpcOkResult<T> {\n  return { rpcId: '', ok: true, data };\n}\n\ninterface RpcErrorResult {\n  rpcId: string;\n  ok: false;\n  error: string;\n}\n\nconst RpcErrorResultSchema = z.object({\n  rpcId: z.string(),\n  ok: z.literal(false),\n  error: z.string(),\n});\n\nexport function makeRpcErrorResult(error: string): RpcErrorResult {\n  return { rpcId: '', ok: false, error };\n}\n\ntype RpcResult<R> = RpcOkResult<R> | RpcErrorResult;\n\nconst RpcResultSchema = z.union([RpcOkResultSchema, RpcErrorResultSchema]);\n\nfunction validateRpcResult<T>(result: unknown): result is RpcResult<T> {\n  return RpcResultSchema.safeParse(result).success;\n}\n\ninterface StreamDataResult<R> extends RpcOkResult<R> {\n  done: boolean;\n}\n\nconst StreamDataResultSchema = RpcOkResultSchema.extend({\n  done: z.boolean(),\n});\n\ntype StreamResult<R> = StreamDataResult<R> | RpcErrorResult;\n\nconst StreamResultSchema = z.union([\n  StreamDataResultSchema,\n  RpcErrorResultSchema,\n]);\n\nfunction validateStreamResult<T>(result: unknown): result is StreamResult<T> {\n  return StreamResultSchema.safeParse(result).success;\n}\n\ntype StreamCallback<D> = (data: D) => void;\n\nexport interface RpcCall {\n  rpcId: string;\n  name: string;\n  args?: unknown[];\n}\n\nconst RpcCallSchema = z.object({\n  rpcId: z.string(),\n  name: z.string(),\n  args: z.array(z.unknown()).optional(),\n});\n\nexport function validateRpcCall(data: unknown): data is RpcCall {\n  return RpcCallSchema.safeParse(data).success;\n}\n\nexport interface RpcApi {\n  [name: string]: (...args: any[]) => any;\n}\n\nexport interface RpcClientOptions {\n  serializers?: Array<(input: any) => any>;\n  deserializers?: Array<(input: any) => any>;\n  path?: string;\n}\n\nfunction justHostUrl(url: string) {\n  const parts = parseUrl(url);\n  parts.pathname = '';\n  return String(parts);\n}\n\nfunction getSocketIoPath(url: string) {\n  const parts = new URL(url);\n  return parts.pathname.replace(/^\\/+$/, '').length === 0\n    ? '/socket.io/'\n    : parts.pathname;\n}\n\n/**\n * Represents a bidirectional socket.io RPC client.\n */\nexport default class RpcClient {\n  public readonly clientId: string;\n  public readonly socket: Socket;\n  public readonly api: RpcApi;\n\n  public serializers = DefaultSerializeTransformers;\n  public deserializers = DefaultDeserializeTransformers;\n\n  private waiting: Map<string, Promise<unknown>>;\n  private pendingRpcs: Map<string, Deferred<any>>;\n  private activeStreams: Map<string, StreamCallback<any>>;\n\n  constructor(api: RpcApi, options?: RpcClientOptions) {\n    this.clientId = `cid_${nanoid(CLIENT_ID_SIZE)}`;\n    this.api = api;\n    this.serializers = options?.serializers ?? DefaultSerializeTransformers;\n    this.deserializers =\n      options?.deserializers ?? DefaultDeserializeTransformers;\n\n    this.waiting = new Map();\n    this.pendingRpcs = new Map();\n    this.activeStreams = new Map();\n\n    this.socket = io('', {\n      query: {\n        clientId: this.clientId,\n      },\n      autoConnect: false,\n      parser: ChunkedParser,\n    });\n\n    this.socket.on(RPC_CALL_EVENT, this.onRpcCallEvent);\n    this.socket.on(RPC_RESULT_EVENT, this.onRpcResultEvent);\n    this.socket.on(STREAM_RESULT_EVENT, this.onStreamResultEvent);\n  }\n\n  protected serialize = flow(...this.serializers);\n  protected deserialize = flow(...this.deserializers);\n\n  async connect(uri: string) {\n    await this.disconnect();\n    // @ts-ignore reset socket.io URI\n    this.socket.io.uri = justHostUrl(uri);\n    this.socket.io.opts.path = getSocketIoPath(uri);\n\n    let promise = this.waiting.get('connect');\n    if (!promise) {\n      promise = this.connectHelper();\n      this.waiting.set('connect', promise);\n      promise.finally(() => {\n        this.waiting.delete('connect');\n      });\n    }\n    return promise;\n  }\n\n  private connectHelper() {\n    let resolve: () => void;\n    let reject: (reason?: any) => void;\n\n    const cleanup = () => {\n      this.socket.off('connect', resolve);\n      this.socket.off('connect_error', reject);\n    };\n\n    const promise = new Promise<void>((res, rej) => {\n      resolve = res;\n      reject = rej;\n      this.socket.once('connect', resolve);\n      this.socket.once('connect_error', reject);\n\n      this.socket.connect();\n    });\n    promise.finally(cleanup);\n\n    return promise;\n  }\n\n  async disconnect() {\n    if (!this.socket.connected) {\n      return Promise.resolve();\n    }\n\n    let promise = this.waiting.get('disconnect');\n    if (!promise) {\n      promise = new Promise<string>((resolve) => {\n        this.socket.once('disconnect', resolve);\n        this.socket.disconnect();\n      });\n      this.waiting.set('disconnect', promise);\n      promise.finally(() => {\n        this.waiting.delete('disconnect');\n      });\n    }\n    return promise;\n  }\n\n  /**\n   * Calls a remote RPC given some arguments.\n   * @param rpcName\n   * @param args\n   */\n  async call<R = unknown>(rpcName: string, args?: unknown[]) {\n    if (!this.socket.connected) {\n      throw new Error('Not connected to server');\n    }\n\n    const rpcId = `rpcid_${nanoid(RPC_ID_SIZE)}`;\n\n    const pending = defer<R>();\n    this.pendingRpcs.set(rpcId, pending);\n\n    this.sendRpcCall(RPC_CALL_EVENT, {\n      rpcId,\n      name: rpcName,\n      args: transformObjects(args ?? [], this.serialize),\n    });\n\n    return pending.promise;\n  }\n\n  private onRpcResultEvent = (result: RpcResult<unknown>) => {\n    if (!validateRpcResult(result)) {\n      // ignore invalid RPC responses\n      debug.warn('Received invalid RPC result:', result);\n      return;\n    }\n\n    const deferred = this.pendingRpcs.get(result.rpcId);\n    if (!deferred) {\n      // ignore untracked RPCs\n      debug.warn('Received unknown RPC ID:', result.rpcId);\n      return;\n    }\n\n    this.pendingRpcs.delete(result.rpcId);\n\n    if (result.ok) {\n      deferred.resolve(transformObject(result.data, this.deserialize));\n    } else {\n      deferred.reject(new Error(result.error));\n    }\n  };\n\n  /**\n   * Calls a remote streaming method.\n   * @param methodName\n   * @param callback\n   */\n  async stream<D>(\n    methodName: string,\n    callback: StreamCallback<D>\n  ): Promise<void>;\n\n  /**\n   * Calls a remote streaming method.\n   * @param methodName\n   * @param args\n   * @param callback\n   */\n  async stream<D>(\n    methodName: string,\n    args: unknown[],\n    callback: StreamCallback<D>\n  ): Promise<void>;\n\n  async stream<D>(\n    methodName: string,\n    argsOrCallback: unknown[] | StreamCallback<D>,\n    maybeCallback?: StreamCallback<D>\n  ) {\n    if (!this.socket.connected) {\n      throw new Error('Not connected to server');\n    }\n\n    const args = Array.isArray(argsOrCallback) ? argsOrCallback : [];\n    const callback = Array.isArray(argsOrCallback)\n      ? maybeCallback!\n      : argsOrCallback;\n\n    const rpcId = `rpcid_${nanoid(RPC_ID_SIZE)}`;\n    const deferred = defer<void>();\n\n    this.pendingRpcs.set(rpcId, deferred);\n    this.activeStreams.set(rpcId, callback);\n\n    this.sendRpcCall(STREAM_CALL_EVENT, {\n      rpcId,\n      name: methodName,\n      args: transformObjects(args ?? [], this.serialize),\n    });\n\n    return deferred.promise;\n  }\n\n  private onStreamResultEvent = (result: StreamResult<unknown>) => {\n    if (!validateStreamResult(result)) {\n      throw new Error('Failed to validate RPC stream result');\n    }\n\n    const deferred: Maybe<Deferred<void>> = this.pendingRpcs.get(result.rpcId);\n    const callback = this.activeStreams.get(result.rpcId);\n    if (!deferred || !callback) {\n      // ignore untracked RPCs\n      debug.warn('Received unknown RPC ID:', result.rpcId);\n      return;\n    }\n\n    const clearListeners = () => {\n      this.pendingRpcs.delete(result.rpcId);\n      this.activeStreams.delete(result.rpcId);\n    };\n\n    if (result.ok) {\n      if (result.done) {\n        clearListeners();\n        deferred.resolve();\n      } else {\n        callback(transformObject(result.data, this.deserialize));\n      }\n    } else {\n      clearListeners();\n      deferred.reject(new Error(result.error));\n    }\n  };\n\n  protected sendRpcCall(eventType: string, payload: RpcCall) {\n    this.socket.emit(eventType, payload);\n  }\n\n  protected onRpcCallEvent = async (rpcInfo: unknown) => {\n    if (!validateRpcCall(rpcInfo)) {\n      debug.warn('Received invalid RPC call:', rpcInfo);\n      return;\n    }\n\n    const { rpcId, name, args } = rpcInfo;\n    const result = await this.tryRpcCall(name, args ?? []);\n    result.rpcId = rpcId;\n    this.socket.emit(RPC_RESULT_EVENT, result);\n  };\n\n  protected async tryRpcCall(\n    name: string,\n    args: unknown[]\n  ): Promise<RpcResult<unknown>> {\n    if (!(name in this.api)) {\n      return makeRpcErrorResult(\n        `${name} is not a registered client RPC endpoint`\n      );\n    }\n\n    try {\n      const deserializedArgs = transformObjects(args, this.deserialize);\n      type RpcMethod = (...args: unknown[]) => unknown;\n      const data = await (this.api[name] as RpcMethod)(...deserializedArgs);\n      return makeRpcOkResult(transformObject(data, this.serialize));\n    } catch (err) {\n      return makeRpcErrorResult(String(err));\n    }\n  }\n}\n","import { PiniaPluginContext, StoreGeneric } from 'pinia';\n\nconst stores = new Map<string, StoreGeneric>();\n\n/**\n * Gets a pinia store by it's ID.\n *\n * Assumes the store has already been initialized via useStore.\n * @param id\n * @returns\n */\nexport function getPiniaStore(id: string) {\n  return stores.get(id);\n}\n\nexport function StoreRegistry(context: PiniaPluginContext) {\n  const { store } = context;\n  stores.set(store.$id, store);\n}\n","import { getPiniaStore } from '@/src/plugins/storeRegistry';\n\ntype PropKey = number | string;\n\ntype RestrictHook = (storeName: string, propPath: PropKey[]) => boolean;\n\nconst restrictServerStore: RestrictHook = (storeName) => {\n  return storeName === 'server';\n};\n\nconst restrictPiniaProperties: RestrictHook = (storeName, propPath) => {\n  return propPath.includes('_p');\n};\n\nconst RestrictHooks: RestrictHook[] = [\n  restrictServerStore,\n  restrictPiniaProperties,\n];\n\nfunction getStoreProperty<T = unknown>(\n  storeName: string,\n  propPath: PropKey[]\n): T {\n  if (RestrictHooks.some((hook) => hook(storeName, propPath))) {\n    throw new Error('Cannot access the requested store and property');\n  }\n\n  const store = getPiniaStore(storeName);\n  if (!store) {\n    throw new Error(`${storeName} does not exist or is not initialized`);\n  }\n\n  let value: any = store;\n  while (propPath.length) {\n    const prop = propPath.shift()! as string;\n    value = value[prop];\n  }\n  return value as T;\n}\n\nasync function callStoreMethod(\n  storeName: string,\n  propPath: PropKey[],\n  args: unknown[]\n) {\n  const method = getStoreProperty<(...args: any[]) => any>(storeName, propPath);\n  return method(...args);\n}\n\nexport const StoreApi = {\n  getStoreProperty,\n  callStoreMethod,\n};\n","import RpcClient from '@/src/core/remote/client';\nimport { StoreApi } from '@/src/core/remote/storeApi';\nimport { defineStore } from 'pinia';\nimport { markRaw, ref } from 'vue';\n\nconst { VITE_REMOTE_SERVER_URL } = import.meta.env;\n\nexport enum ConnectionState {\n  Disconnected,\n  Pending,\n  Connected,\n}\n\nexport const useServerStore = defineStore('server', () => {\n  const url = ref(VITE_REMOTE_SERVER_URL ?? '');\n  const connState = ref<ConnectionState>(ConnectionState.Disconnected);\n\n  const client = new RpcClient(StoreApi);\n\n  client.socket.on('disconnect', () => {\n    connState.value = ConnectionState.Disconnected;\n  });\n\n  async function connect() {\n    if (!url.value) {\n      return;\n    }\n\n    connState.value = ConnectionState.Pending;\n    try {\n      await client.connect(url.value);\n      connState.value = ConnectionState.Connected;\n    } catch (err) {\n      connState.value = ConnectionState.Disconnected;\n    }\n  }\n\n  async function disconnect() {\n    await client.disconnect();\n  }\n\n  function setUrl(newUrl: string) {\n    url.value = newUrl;\n    disconnect();\n  }\n\n  return {\n    url,\n    client: markRaw(client),\n    connState,\n    connect,\n    disconnect,\n    setUrl,\n  };\n});\n","<script setup lang=\"ts\">\nimport { computed } from 'vue';\nimport { ConnectionState, useServerStore } from '@/src/store/server';\nimport { storeToRefs } from 'pinia';\n\nconst serverStore = useServerStore();\nconst { connState } = storeToRefs(serverStore);\n\nconst serverUrl = computed({\n  get() {\n    return serverStore.url;\n  },\n  set(url: string) {\n    serverStore.setUrl(url);\n  },\n});\n\nconst StatusToText: Record<ConnectionState, string> = {\n  [ConnectionState.Connected]: 'Connected',\n  [ConnectionState.Disconnected]: 'Disconnected',\n  [ConnectionState.Pending]: 'Connecting...',\n};\n\nconst connStatus = computed(() => StatusToText[connState.value]);\n\nfunction toggleConnection() {\n  if (connState.value === ConnectionState.Connected) {\n    serverStore.disconnect();\n  } else if (connState.value === ConnectionState.Disconnected) {\n    serverStore.connect();\n  }\n}\n\nconst connectBtnText = computed(() => {\n  return connState.value === ConnectionState.Connected\n    ? 'Disconnect'\n    : 'Connect';\n});\n</script>\n\n<template>\n  <div class=\"ma-2\">\n    <h3>\n      <span>Remote Server</span>\n      <v-btn\n        icon=\"mdi-help-circle\"\n        variant=\"flat\"\n        size=\"x-small\"\n        href=\"https://kitware.github.io/VolView/doc/server.html\"\n        target=\"_blank\"\n        class=\"ml-1\"\n        style=\"color: #777\"\n        title=\"Server Documentation\"\n      ></v-btn>\n    </h3>\n    <div class=\"mt-4\">\n      <v-text-field\n        v-model=\"serverUrl\"\n        label=\"Server URL\"\n        clearable\n        persistent-hint\n        hint=\"Make sure you trust the remote server!\"\n      />\n    </div>\n    <div class=\"mt-4\">\n      <v-btn\n        color=\"secondary\"\n        @click=\"toggleConnection\"\n        :loading=\"connState === ConnectionState.Pending\"\n      >\n        {{ connectBtnText }}\n      </v-btn>\n      <span class=\"ml-5\">Status: {{ connStatus }}</span>\n    </div>\n  </div>\n</template>\n","function getContextFromOffscreenCanvas() {\n  if (typeof OffscreenCanvas === 'undefined') return null;\n  const canvas = new OffscreenCanvas(1, 1);\n  return canvas.getContext('webgl2') as WebGL2RenderingContext | null;\n}\n\nfunction getContextFromHTMLCanvas() {\n  if (typeof document === 'undefined') return null;\n  const canvas = document.createElement('canvas');\n  return canvas.getContext('webgl2') as WebGL2RenderingContext | null;\n}\n\n/**\n * Retrieves the GPU renderer and vendor info.\n * @returns\n */\nexport function getGPUInfo() {\n  // try offscreencanvas to support usage in webworkers\n  const gl = getContextFromOffscreenCanvas() ?? getContextFromHTMLCanvas();\n  if (!gl) {\n    throw new Error('Cannot get a webgl2 context');\n  }\n\n  const info = {\n    renderer: '',\n    vendor: '',\n  };\n\n  const dbg = gl.getExtension('WEBGL_debug_renderer_info');\n  if (dbg) {\n    info.renderer = gl.getParameter(dbg.UNMASKED_RENDERER_WEBGL);\n    info.vendor = gl.getParameter(dbg.UNMASKED_VENDOR_WEBGL);\n  } else {\n    info.renderer = gl.getParameter(gl.RENDERER);\n    info.vendor = gl.getParameter(gl.VENDOR);\n  }\n\n  return info;\n}\n","import { getGPUInfo } from '@/src/utils/gpuInfo';\nimport * as Sentry from '@sentry/vue';\nimport { useLocalStorage } from '@vueuse/core';\nimport { defineStore } from 'pinia';\nimport { App, ref, watch } from 'vue';\n\nconst { VITE_SENTRY_DSN } = import.meta.env;\n\nexport const LOCAL_STORAGE_KEY = 'error-reporting-off';\n\nexport const errorReportingConfigured = !!VITE_SENTRY_DSN;\n\nexport const init = (app: App<Element>) => {\n  const sentryOff = localStorage.getItem(LOCAL_STORAGE_KEY);\n  if (sentryOff !== 'true' && errorReportingConfigured)\n    Sentry.init({\n      app,\n      dsn: VITE_SENTRY_DSN,\n    });\n\n  try {\n    Sentry.setContext('gpu', getGPUInfo());\n  } catch (err) {\n    Sentry.captureException(err);\n  }\n};\n\nconst setEnabled = (enabled: boolean) => {\n  const options = Sentry.getCurrentHub().getClient()?.getOptions();\n  if (!options) return;\n  options.enabled = enabled;\n};\n\nexport const useErrorReporting = defineStore('error-reporting', () => {\n  const disableReportingStorage = useLocalStorage(LOCAL_STORAGE_KEY, 'false');\n\n  const disableReporting = ref(disableReportingStorage.value === 'true');\n\n  // sync boolean to local storage\n  watch(disableReporting, () => {\n    disableReportingStorage.value = String(disableReporting.value);\n    setEnabled(!disableReporting.value);\n  });\n\n  return { disableReporting };\n});\n","<template>\n  <v-card>\n    <v-card-title class=\"d-flex flex-row align-center\">Settings</v-card-title>\n    <v-card-text>\n      <v-btn\n        class=\"my-2\"\n        @click=\"openKeyboardShortcuts\"\n        prepend-icon=\"mdi-keyboard\"\n        color=\"secondary\"\n      >\n        Keyboard Shortcuts and View Controls\n      </v-btn>\n      <v-switch\n        :label=\"`Dark Theme (${dark ? 'On' : 'Off'})`\"\n        v-model=\"dark\"\n        color=\"secondary\"\n        density=\"compact\"\n        hide-details\n      ></v-switch>\n\n      <v-switch\n        :label=\"`Camera Auto Reset (${disableCameraAutoReset ? 'On' : 'Off'})`\"\n        v-model=\"disableCameraAutoReset\"\n        color=\"secondary\"\n        density=\"compact\"\n        hide-details\n      ></v-switch>\n\n      <v-switch\n        v-if=\"errorReportingConfigured\"\n        :label=\"`Error Reporting (${reportingEnabled ? 'On' : 'Off'})`\"\n        v-model=\"reportingEnabled\"\n        color=\"secondary\"\n        density=\"compact\"\n        hide-details\n      ></v-switch>\n\n      <v-divider class=\"mt-2 mb-6\"></v-divider>\n      <dicom-web-settings />\n\n      <v-divider class=\"mt-2 mb-6\"></v-divider>\n      <server-settings />\n    </v-card-text>\n  </v-card>\n</template>\n\n<script lang=\"ts\">\nimport { defineComponent, ref, watch } from 'vue';\nimport { storeToRefs } from 'pinia';\nimport { useTheme } from 'vuetify';\nimport { useLocalStorage } from '@vueuse/core';\n\nimport { useKeyboardShortcutsStore } from '@/src/store/keyboard-shortcuts';\nimport { useViewCameraStore } from '@/src/store/view-configs/camera';\nimport DicomWebSettings from './dicom-web/DicomWebSettings.vue';\nimport ServerSettings from './ServerSettings.vue';\nimport { DarkTheme, LightTheme, ThemeStorageKey } from '../constants';\nimport {\n  useErrorReporting,\n  errorReportingConfigured,\n} from '../utils/errorReporting';\n\nexport default defineComponent({\n  setup() {\n    const theme = useTheme();\n    const store = useLocalStorage(ThemeStorageKey, theme.global.name.value);\n    const dark = ref(theme.global.name.value === DarkTheme);\n\n    watch(dark, (isDark) => {\n      theme.global.name.value = isDark ? DarkTheme : LightTheme;\n      store.value = theme.global.name.value;\n    });\n\n    const errorReportingStore = useErrorReporting();\n    const reportingEnabled = ref(!errorReportingStore.disableReporting);\n    watch(reportingEnabled, (enabled) => {\n      errorReportingStore.disableReporting = !enabled;\n    });\n\n    const { disableCameraAutoReset } = storeToRefs(useViewCameraStore());\n\n    const keyboardStore = useKeyboardShortcutsStore();\n    const openKeyboardShortcuts = () => {\n      keyboardStore.settingsOpen = true;\n    };\n\n    return {\n      dark,\n      reportingEnabled,\n      errorReportingConfigured,\n      openKeyboardShortcuts,\n      disableCameraAutoReset,\n    };\n  },\n  components: {\n    DicomWebSettings,\n    ServerSettings,\n  },\n});\n</script>\n","<script lang=\"ts\">\nimport {\n  defineComponent,\n  onMounted,\n  PropType,\n  provide,\n  ref,\n  toRefs,\n  watch,\n} from 'vue';\n\ntype EqualsTestFunc<T> = (a: T, b: T) => boolean;\n\nexport const ItemGroupProvider = Symbol('ItemGroup');\n\nexport interface ItemGroupProviderValue {\n  selectItem: (item: unknown) => void;\n  isSelected: (item: unknown) => boolean;\n}\n\nexport default defineComponent({\n  props: {\n    modelValue: null,\n    mandatory: Boolean,\n    equalsTest: Function as PropType<EqualsTestFunc<any>>,\n  },\n  setup(props, { emit, slots }) {\n    const { modelValue, mandatory, equalsTest } = toRefs(props);\n    const internalValue = ref<unknown>();\n\n    watch(modelValue, (v) => {\n      if (v !== internalValue.value) {\n        internalValue.value = v;\n      }\n    });\n\n    onMounted(() => {\n      internalValue.value = modelValue.value;\n    });\n\n    const selectItem = (item: unknown) => {\n      if (mandatory.value && !item) {\n        return;\n      }\n      internalValue.value = item;\n      emit('update:modelValue', internalValue.value);\n    };\n\n    const isSelected = (item: unknown) => {\n      if (internalValue.value == null) {\n        return false;\n      }\n\n      return equalsTest.value\n        ? equalsTest.value(item, internalValue.value)\n        : item === internalValue.value;\n    };\n\n    provide<ItemGroupProviderValue>(ItemGroupProvider, {\n      selectItem,\n      isSelected,\n    });\n\n    return () => slots.default?.();\n  },\n});\n</script>\n","<script lang=\"ts\">\nimport { inject, defineComponent, toRefs } from 'vue';\nimport { ItemGroupProvider, ItemGroupProviderValue } from './ItemGroup.vue';\n\nexport default defineComponent({\n  props: {\n    value: {\n      type: null,\n      required: true,\n    },\n  },\n  setup(props, { slots }) {\n    const { value } = toRefs(props);\n    const itemGroup = inject<ItemGroupProviderValue>(ItemGroupProvider);\n\n    if (!itemGroup) {\n      throw new Error('GroupableItem needs ItemGroup!');\n    }\n\n    const select = () => {\n      itemGroup.selectItem(value.value);\n    };\n\n    const toggle = () => {\n      if (!itemGroup) {\n        return;\n      }\n\n      itemGroup.selectItem(\n        itemGroup.isSelected(value.value) ? undefined : value.value\n      );\n    };\n\n    return () =>\n      slots.default?.({\n        active: itemGroup.isSelected(value.value),\n        select,\n        toggle,\n      });\n  },\n});\n</script>\n","<script lang=\"ts\">\nimport { watch, ref, computed, defineComponent } from 'vue';\nimport { useDisplay } from 'vuetify';\nimport ControlButton from './ControlButton.vue';\n\nexport default defineComponent({\n  name: 'MenuControlButton',\n  props: {\n    icon: { type: String, required: true },\n    name: { type: String, required: true },\n    size: { type: [Number, String], default: 40 },\n    active: Boolean,\n    disabled: Boolean,\n    mobileOnlyMenu: Boolean,\n  },\n  components: {\n    ControlButton,\n  },\n  setup(props) {\n    const display = useDisplay();\n\n    const showLeft = computed(() => !display.mobile.value);\n\n    const menuOn = ref(false);\n\n    const enableMenu = computed(\n      () => !props.mobileOnlyMenu || display.mobile.value\n    );\n\n    // Disable menu if mobile only\n    watch(menuOn, (on) => {\n      menuOn.value = on && enableMenu.value;\n    });\n\n    // Turn off menu if tool deselected\n    const active = computed(() => props.active);\n    watch(active, (on) => {\n      if (!on) {\n        menuOn.value = false;\n      }\n    });\n\n    return { showLeft, menuOn, enableMenu };\n  },\n});\n</script>\n\n<template>\n  <v-menu\n    no-click-animation\n    :close-on-content-click=\"false\"\n    v-model=\"menuOn\"\n    :location=\"showLeft ? 'left' : 'right'\"\n    class=\"overflow-auto\"\n  >\n    <template #activator=\"{ props }\">\n      <control-button\n        :icon=\"icon\"\n        :name=\"name\"\n        :buttonClass=\"['tool-btn', active ? 'tool-btn-selected' : '']\"\n        :disabled=\"disabled\"\n        :size=\"size\"\n        @click=\"$emit('click')\"\n        v-bind=\"props\"\n      >\n        <v-icon\n          v-if=\"active && enableMenu\"\n          :class=\"[showLeft ? 'menu-more-left' : 'menu-more-right']\"\n          size=\"18\"\n        >\n          {{ showLeft ? 'mdi-menu-left' : 'mdi-menu-right' }}\n        </v-icon>\n      </control-button>\n    </template>\n\n    <div class=\"menu-content elevation-24\">\n      <slot />\n    </div>\n  </v-menu>\n</template>\n\n<style scoped>\n.menu-more-left {\n  position: absolute;\n  left: -12%;\n}\n.menu-more-right {\n  position: absolute;\n  right: -12%;\n}\n\n.menu-content {\n  /* Show on top of button tooltip */\n  z-index: 1;\n}\n</style>\n","<script lang=\"ts\">\nimport { defineComponent } from 'vue';\nimport ControlButton from '@/src/components/ControlButton.vue';\nimport { useCurrentImage } from '@/src/composables/useCurrentImage';\nimport { useCropStore } from '@/src/store/tools/crop';\n\nexport default defineComponent({\n  components: {\n    ControlButton,\n  },\n  setup() {\n    const { currentImageID } = useCurrentImage();\n    const cropStore = useCropStore();\n\n    const resetCrop = () => {\n      const imageID = currentImageID.value;\n      if (imageID) {\n        cropStore.resetCropping(imageID);\n      }\n    };\n\n    return {\n      resetCrop,\n    };\n  },\n});\n</script>\n\n<template>\n  <v-card dark>\n    <control-button\n      size=\"40\"\n      icon=\"mdi-restore\"\n      name=\"Reset Crop\"\n      @click=\"resetCrop\"\n    />\n  </v-card>\n</template>\n","<script lang=\"ts\">\nimport { defineComponent } from 'vue';\nimport ControlButton from '@/src/components/ControlButton.vue';\nimport { createEventHook } from '@vueuse/core';\n\nconst clickEvent = createEventHook<void>();\nexport function useResetViewsEvents() {\n  return { onClick: clickEvent.on };\n}\n\nexport default defineComponent({\n  components: {\n    ControlButton,\n  },\n  // setup() {\n  // },\n  methods: {\n    onClick() {\n      clickEvent.trigger();\n    },\n  },\n});\n</script>\n\n<template>\n  <control-button\n    size=\"40\"\n    icon=\"mdi-camera-flip-outline\"\n    name=\"Reset Views\"\n    @click=\"onClick\"\n  />\n</template>\n","<script\n  setup\n  lang=\"ts\"\n  generic=\"T, KeyProp extends keyof T, TitleProp extends keyof T\"\n>\n/* global T, KeyProp, TitleProp */\n\nimport { computed } from 'vue';\nimport { Maybe } from '@/src/types';\n\ndefineEmits(['select', 'edit', 'create', 'update:model-value']);\n\nconst props = withDefaults(\n  defineProps<{\n    items: Array<T>;\n    itemKey: T[KeyProp] extends string | number | symbol ? KeyProp : never;\n    itemTitle: T[TitleProp] extends string ? TitleProp : never;\n    createLabelText?: string;\n    modelValue: Maybe<T[KeyProp]>;\n  }>(),\n  {\n    createLabelText: 'Create Label',\n  }\n);\n\nconst itemsToRender = computed(() =>\n  props.items.map((item) => ({\n    key: item[props.itemKey] as string | number | symbol,\n    title: item[props.itemTitle] as string | undefined,\n  }))\n);\n</script>\n\n<template>\n  <v-item-group\n    :model-value=\"modelValue\"\n    @update:model-value=\"$emit('update:model-value', $event)\"\n    selected-class=\"selected\"\n    mandatory\n  >\n    <v-row dense>\n      <v-col cols=\"6\" v-for=\"({ key, title }, idx) in itemsToRender\" :key=\"key\">\n        <v-item v-slot=\"{ selectedClass, toggle }\" :value=\"key\">\n          <v-chip\n            variant=\"tonal\"\n            :class=\"['w-100 d-flex', selectedClass]\"\n            @click=\"toggle\"\n          >\n            <slot name=\"item-prepend\" :key=\"key\" :item=\"items[idx]\"></slot>\n            <v-tooltip :text=\"title\" location=\"end\">\n              <template #activator=\"{ props }\">\n                <span v-bind=\"props\" class=\"text-truncate\">{{ title }}</span>\n              </template>\n            </v-tooltip>\n            <v-spacer />\n            <slot name=\"item-append\" :key=\"key\" :item=\"items[idx]\"></slot>\n          </v-chip>\n        </v-item>\n      </v-col>\n\n      <!-- Add Label button -->\n      <v-col cols=\"6\">\n        <v-chip variant=\"outlined\" class=\"w-100\" @click=\"$emit('create')\">\n          <v-icon class=\"mr-2\">mdi-plus</v-icon>\n          {{ createLabelText }}\n        </v-chip>\n      </v-col>\n    </v-row>\n  </v-item-group>\n</template>\n\n<style scoped>\n.selected {\n  background-color: rgb(var(--v-theme-selection-bg-color));\n  border-color: rgb(var(--v-theme-selection-border-color));\n}\n</style>\n","<script setup lang=\"ts\">\nimport { computed, toRefs } from 'vue';\n\nconst emit = defineEmits(['done', 'cancel', 'delete', 'update:color']);\nconst props = defineProps<{ color: string; valid: boolean }>();\nconst { color, valid } = toRefs(props);\nconst doneDisabled = computed(() => {\n  return !valid.value;\n});\n\nconst done = () => {\n  emit('done');\n};\n\nconst cancel = () => {\n  emit('cancel');\n};\n\nconst onDelete = () => {\n  emit('delete');\n  emit('done');\n};\n</script>\n\n<template>\n  <v-card>\n    <slot name=\"title\"></slot>\n    <v-card-item>\n      <div class=\"d-flex flex-row\">\n        <div class=\"flex-grow-1 d-flex flex-column justify-space-between mr-4\">\n          <slot name=\"fields\" :done=\"done\"></slot>\n          <v-card-actions class=\"mb-2 px-0\">\n            <v-btn color=\"error\" variant=\"elevated\" @click=\"onDelete\">\n              Delete\n            </v-btn>\n            <v-spacer />\n            <v-btn color=\"cancel\" variant=\"tonal\" @click=\"cancel\">\n              Cancel\n            </v-btn>\n            <v-btn\n              color=\"secondary\"\n              variant=\"elevated\"\n              @click=\"done\"\n              :disabled=\"doneDisabled\"\n              data-testid=\"edit-label-done-button\"\n            >\n              Done\n            </v-btn>\n          </v-card-actions>\n        </div>\n        <v-color-picker\n          :model-value=\"color\"\n          @update:model-value=\"$emit('update:color', $event)\"\n          mode=\"rgb\"\n          label=\"Color\"\n        />\n      </div>\n    </v-card-item>\n  </v-card>\n</template>\n","<script setup lang=\"ts\">\nimport { computed } from 'vue';\nimport LabelEditor from '@/src/components/LabelEditor.vue';\n\ndefineEmits([\n  'done',\n  'cancel',\n  'delete',\n  'update:name',\n  'update:strokeWidth',\n  'update:color',\n]);\n\nconst props = defineProps<{\n  name: string;\n  strokeWidth: number;\n  color: string;\n  invalidNames: Set<string>;\n}>();\n\nfunction isUniqueEditingName(name: string) {\n  return !props.invalidNames.has(name.trim());\n}\n\nfunction uniqueNameRule(name: string) {\n  return isUniqueEditingName(name) || 'Name is not unique';\n}\n\nconst valid = computed(() => {\n  return isUniqueEditingName(props.name);\n});\n</script>\n\n<template>\n  <label-editor\n    :color=\"color\"\n    :valid=\"valid\"\n    @update:color=\"$emit('update:color', $event)\"\n    @cancel=\"$emit('cancel')\"\n    @done=\"$emit('done')\"\n    @delete=\"$emit('delete')\"\n  >\n    <template #title>\n      <v-card-title class=\"d-flex flex-row align-center\">\n        Edit Label\n      </v-card-title>\n    </template>\n    <template #fields=\"{ done }\">\n      <v-text-field\n        label=\"Name\"\n        class=\"flex-grow-0\"\n        :model-value=\"props.name\"\n        @update:model-value=\"$emit('update:name', $event)\"\n        @keydown.stop.enter=\"done\"\n        :rules=\"[uniqueNameRule]\"\n      />\n      <v-text-field\n        label=\"Stroke Width\"\n        type=\"number\"\n        class=\"flex-grow-0 label-stroke-width-input\"\n        :model-value=\"strokeWidth\"\n        @update:model-value=\"$emit('update:strokeWidth', +$event)\"\n        @keydown.stop.enter=\"done\"\n      />\n    </template>\n  </label-editor>\n</template>\n","<script setup lang=\"ts\">\nimport { computed, ref, reactive } from 'vue';\nimport EditableChipList from '@/src/components/EditableChipList.vue';\nimport { LabelsStore } from '@/src/store/tools/useLabels';\nimport type { AnnotationTool } from '@/src/types/annotation-tool';\nimport { Maybe } from '@/src/types';\nimport ToolLabelEditor from '@/src/components/ToolLabelEditor.vue';\nimport IsolatedDialog from '@/src/components/IsolatedDialog.vue';\nimport { nonNullable } from '@/src/utils';\n\nconst props = defineProps<{\n  labelsStore: LabelsStore<Pick<AnnotationTool, 'strokeWidth'>>;\n}>();\n\nconst labels = computed(() =>\n  Object.entries(props.labelsStore.labels).map(([id, label]) => ({\n    id,\n    name: label.labelName ?? '(no name)',\n    color: label.color,\n  }))\n);\n\nconst selectedLabel = computed({\n  get: () => props.labelsStore.activeLabel,\n  set: (id) => {\n    if (id != null) props.labelsStore.setActiveLabel(id);\n  },\n});\n\n// --- editing state --- //\n\ntype LabelID = keyof typeof props.labelsStore.labels;\nconst editingLabelID = ref<Maybe<LabelID>>(undefined);\nconst editDialog = ref(false);\nconst editState = reactive({\n  labelName: '',\n  strokeWidth: 1,\n  color: '',\n});\n\nconst editingLabel = computed(() => {\n  if (!editingLabelID.value) return null;\n  return props.labelsStore.labels[editingLabelID.value];\n});\n\nconst invalidNames = computed(() => {\n  const names = new Set(\n    Object.values(props.labelsStore.labels)\n      .map(({ labelName }) => labelName)\n      .filter(nonNullable)\n  );\n  const currentName = editingLabel.value?.labelName;\n  if (currentName) names.delete(currentName); // allow current name\n  return names;\n});\n\nconst makeUniqueName = (name: string) => {\n  const existingNames = new Set(\n    Object.values(props.labelsStore.labels).map((label) => label.labelName)\n  );\n  let uniqueName = name;\n  let i = 1;\n  while (existingNames.has(uniqueName)) {\n    uniqueName = `${name} (${i})`;\n    i++;\n  }\n  return uniqueName;\n};\n\nconst createLabel = () => {\n  const labelName = makeUniqueName('New Label');\n  editingLabelID.value = props.labelsStore.addLabel({ labelName });\n};\n\nfunction startEditing(label: LabelID) {\n  editDialog.value = true;\n  editingLabelID.value = label;\n  if (editingLabel.value) {\n    editState.labelName = editingLabel.value.labelName ?? '';\n    editState.strokeWidth = editingLabel.value.strokeWidth ?? 0;\n    editState.color = editingLabel.value.color ?? '';\n  }\n}\n\nfunction stopEditing(commit: boolean) {\n  if (editingLabelID.value && commit) {\n    props.labelsStore.updateLabel(editingLabelID.value, editState);\n  }\n  editDialog.value = false;\n  editingLabelID.value = null;\n}\n\nfunction deleteEditingLabel() {\n  if (editingLabelID.value) {\n    props.labelsStore.deleteLabel(editingLabelID.value);\n  }\n  stopEditing(false);\n}\n</script>\n\n<template>\n  <v-card class=\"pt-2\">\n    <v-card-subtitle>Labels</v-card-subtitle>\n    <v-container>\n      <editable-chip-list\n        v-model=\"selectedLabel\"\n        :items=\"labels\"\n        item-key=\"id\"\n        item-title=\"name\"\n        create-label-text=\"New label\"\n        @create=\"createLabel\"\n      >\n        <template #item-prepend=\"{ item }\">\n          <!-- dot-container class keeps overflowing name from squishing dot width  -->\n          <div class=\"dot-container mr-3\">\n            <div class=\"color-dot\" :style=\"{ background: item.color }\" />\n          </div>\n        </template>\n        <template #item-append=\"{ key }\">\n          <v-btn\n            icon=\"mdi-pencil\"\n            size=\"small\"\n            density=\"compact\"\n            class=\"ml-auto mr-1\"\n            variant=\"plain\"\n            @click.stop=\"startEditing(key as string)\"\n            data-testid=\"edit-label-button\"\n          />\n        </template>\n      </editable-chip-list>\n    </v-container>\n  </v-card>\n\n  <isolated-dialog v-model=\"editDialog\" max-width=\"800px\">\n    <tool-label-editor\n      v-if=\"editingLabelID\"\n      v-model:name=\"editState.labelName\"\n      v-model:stroke-width=\"editState.strokeWidth\"\n      v-model:color=\"editState.color\"\n      @delete=\"deleteEditingLabel\"\n      @cancel=\"stopEditing(false)\"\n      @done=\"stopEditing(true)\"\n      :invalidNames=\"invalidNames\"\n    />\n  </isolated-dialog>\n</template>\n\n<style scoped>\n.color-dot {\n  width: 18px;\n  height: 18px;\n  border-radius: 16px;\n}\n.dot-container {\n  width: 18px;\n}\n</style>\n","<script setup lang=\"ts\">\nimport { useRulerStore } from '@/src/store/tools/rulers';\nimport LabelControls from '@/src/components/LabelControls.vue';\n\nconst activeToolStore = useRulerStore();\n</script>\n\n<template>\n  <label-controls :labels-store=\"activeToolStore\" />\n</template>\n","<script setup lang=\"ts\">\nimport { useRectangleStore } from '@/src/store/tools/rectangles';\nimport LabelControls from '@/src/components/LabelControls.vue';\n\nconst activeToolStore = useRectangleStore();\n</script>\n\n<template>\n  <label-controls :labels-store=\"activeToolStore\" />\n</template>\n","<script setup lang=\"ts\">\nimport { usePolygonStore } from '@/src/store/tools/polygons';\nimport LabelControls from '@/src/components/LabelControls.vue';\n\nconst activeToolStore = usePolygonStore();\n</script>\n\n<template>\n  <label-controls :labels-store=\"activeToolStore\" />\n</template>\n","<script lang=\"ts\">\nimport { computed, defineComponent, ref } from 'vue';\nimport { useCurrentImage } from '@/src/composables/useCurrentImage';\nimport useWindowingStore, {\n  defaultWindowLevelConfig,\n} from '@/src/store/view-configs/windowing';\nimport { useViewStore } from '@/src/store/views';\nimport { WLAutoRanges, WLPresetsCT, WL_AUTO_DEFAULT } from '@/src/constants';\nimport { getWindowLevels, useDICOMStore } from '@/src/store/datasets-dicom';\nimport { isDicomImage } from '@/src/utils/dataSelection';\n\nexport default defineComponent({\n  setup() {\n    const { currentImageID } = useCurrentImage();\n    const windowingStore = useWindowingStore();\n    const viewStore = useViewStore();\n    const dicomStore = useDICOMStore();\n    const panel = ref(['tags', 'presets', 'auto']);\n    const windowingDefaults = defaultWindowLevelConfig();\n\n    // Get the relevant view ids\n    const viewIDs = computed(() =>\n      viewStore.viewIDs.filter(\n        (viewID) => !!windowingStore.getConfig(viewID, currentImageID.value)\n      )\n    );\n\n    function parseLabel(text: string) {\n      return text.replace(/([A-Z])/g, ' $1').trim();\n    }\n\n    // --- CT Preset Options --- //\n\n    const modality = computed(() => {\n      if (currentImageID.value && isDicomImage(currentImageID.value)) {\n        const volKey = currentImageID.value;\n        const { Modality } = dicomStore.volumeInfo[volKey];\n        return Modality;\n      }\n      return '';\n    });\n\n    const ctTags = ['ct', 'ctprotocol'];\n    const showCtPresets = computed(() => {\n      if (currentImageID.value && !isDicomImage(currentImageID.value)) {\n        return true;\n      }\n      return modality.value && ctTags.includes(modality.value.toLowerCase());\n    });\n\n    const wlDefaults = computed(() => {\n      return { width: windowingDefaults.width, level: windowingDefaults.level };\n    });\n\n    // --- UI Selection Management --- //\n\n    type AutoRangeKey = keyof typeof WLAutoRanges;\n    type PresetValue = { width: number; level: number };\n\n    const wlConfig = computed(() => {\n      // All views will have the same settings, just grab the first\n      const viewID = viewIDs.value[0];\n      const imageID = currentImageID.value;\n      if (!imageID || !viewID) return windowingDefaults;\n      return windowingStore.getConfig(viewID, imageID);\n    });\n\n    const wlWidth = computed(\n      () => wlConfig.value?.width ?? wlDefaults.value.width\n    );\n    const wlLevel = computed(\n      () => wlConfig.value?.level ?? wlDefaults.value.level\n    );\n\n    const wlOptions = computed({\n      get() {\n        const config = wlConfig.value;\n        const { width, level } = config?.preset || wlDefaults.value;\n        const { width: defaultWidth, level: defaultLevel } = wlDefaults.value;\n        if (width !== defaultWidth && level !== defaultLevel) {\n          return { width: wlWidth.value, level: wlLevel.value };\n        }\n        return config?.auto || WL_AUTO_DEFAULT;\n      },\n      set(selection: AutoRangeKey | PresetValue) {\n        const imageID = currentImageID.value;\n        // All views will be synchronized, just set the first\n        const viewID = viewIDs.value[0];\n        if (imageID && viewID) {\n          const useAuto = typeof selection !== 'object';\n          const newValue = {\n            preset: useAuto ? wlDefaults.value : selection,\n            auto: useAuto ? selection : WL_AUTO_DEFAULT,\n          };\n          windowingStore.updateConfig(viewID, imageID, newValue);\n          windowingStore.resetWindowLevel(viewID, imageID);\n        }\n      },\n    });\n\n    // --- Tag WL Options --- //\n    const tags = computed(() => {\n      if (currentImageID.value && isDicomImage(currentImageID.value)) {\n        const volKey = currentImageID.value;\n        return getWindowLevels(dicomStore.volumeInfo[volKey]);\n      }\n      return [];\n    });\n\n    return {\n      parseLabel,\n      wlOptions,\n      WLPresetsCT,\n      showCtPresets,\n      tags,\n      panel,\n      WLAutoRanges,\n    };\n  },\n});\n</script>\n\n<template>\n  <v-card dark>\n    <v-card-text>\n      <v-expansion-panels v-model=\"panel\" multiple>\n        <v-expansion-panel value=\"tags\" v-if=\"tags.length\">\n          <v-expansion-panel-title>\n            File Specific Presets\n          </v-expansion-panel-title>\n          <v-expansion-panel-text>\n            <v-radio-group v-model=\"wlOptions\" hide-details>\n              <v-radio\n                v-for=\"(value, idx) in tags\"\n                :key=\"idx\"\n                :label=\"`Tag ${idx + 1} [W:${value.width},L:${value.level}]`\"\n                :value=\"value\"\n                density=\"compact\"\n              />\n            </v-radio-group>\n          </v-expansion-panel-text>\n        </v-expansion-panel>\n        <v-expansion-panel v-if=\"showCtPresets\" value=\"presets\">\n          <v-expansion-panel-title>CT Presets</v-expansion-panel-title>\n          <v-expansion-panel-text>\n            <v-radio-group v-model=\"wlOptions\" hide-details>\n              <div v-for=\"(wl, name) in WLPresetsCT\" :key=\"name\">\n                <v-radio\n                  :key=\"name\"\n                  :label=\"parseLabel(name)\"\n                  :value=\"wl\"\n                  density=\"compact\"\n                  class=\"ml-3\"\n                />\n              </div>\n            </v-radio-group>\n          </v-expansion-panel-text>\n        </v-expansion-panel>\n        <v-expansion-panel value=\"auto\">\n          <v-expansion-panel-title>Auto Window/Level</v-expansion-panel-title>\n          <v-expansion-panel-text>\n            <v-radio-group v-model=\"wlOptions\" hide-details>\n              <v-radio\n                v-for=\"(value, key) in WLAutoRanges\"\n                :key=\"key\"\n                :label=\"parseLabel(key)\"\n                :value=\"key\"\n                density=\"compact\"\n              >\n                <v-tooltip activator=\"parent\" location=\"bottom\">\n                  {{\n                    value\n                      ? `Remove the top and bottom ${value} percent of data`\n                      : 'Use the full data range'\n                  }}\n                </v-tooltip>\n              </v-radio>\n            </v-radio-group>\n          </v-expansion-panel-text>\n        </v-expansion-panel>\n      </v-expansion-panels>\n    </v-card-text>\n  </v-card>\n</template>\n\n<style scoped>\n.v-card {\n  max-width: 300px;\n}\n.v-expansion-panel-title {\n  min-height: auto;\n}\n.v-expansion-panel-text:deep() .v-expansion-panel-text__wrapper {\n  padding: 4px 6px 8px;\n}\n\n.v-selection-control:deep() .v-selection-control__input > .v-icon {\n  font-size: 18px;\n  align-self: center;\n}\n</style>\n","<template>\n  <item-group\n    mandatory\n    :model-value=\"currentTool\"\n    @update:model-value=\"setCurrentTool($event)\"\n  >\n    <div class=\"my-1 tool-separator\" />\n    <groupable-item\n      v-slot:default=\"{ active, toggle }\"\n      :value=\"Tools.WindowLevel\"\n    >\n      <menu-control-button\n        icon=\"mdi-circle-half-full\"\n        :name=\"`Window & Level [${nameToShortcut['Window & Level']}]`\"\n        :active=\"active\"\n        :disabled=\"noCurrentImage\"\n        @click=\"toggle\"\n      >\n        <window-level-controls />\n      </menu-control-button>\n    </groupable-item>\n    <groupable-item v-slot:default=\"{ active, toggle }\" :value=\"Tools.Pan\">\n      <control-button\n        icon=\"mdi-cursor-move\"\n        :name=\"`Pan [${nameToShortcut['Pan']}]`\"\n        :buttonClass=\"['tool-btn', active ? 'tool-btn-selected' : '']\"\n        :disabled=\"noCurrentImage\"\n        @click=\"toggle\"\n      />\n    </groupable-item>\n    <groupable-item v-slot:default=\"{ active, toggle }\" :value=\"Tools.Zoom\">\n      <control-button\n        icon=\"mdi-magnify-plus-outline\"\n        :name=\"`Zoom [${nameToShortcut['Zoom']}]`\"\n        :buttonClass=\"['tool-btn', active ? 'tool-btn-selected' : '']\"\n        :disabled=\"noCurrentImage\"\n        @click=\"toggle\"\n      />\n    </groupable-item>\n    <groupable-item\n      v-slot:default=\"{ active, toggle }\"\n      :value=\"Tools.Crosshairs\"\n    >\n      <control-button\n        icon=\"mdi-crosshairs\"\n        :name=\"`Crosshairs [${nameToShortcut['Crosshairs']}]`\"\n        :buttonClass=\"['tool-btn', active ? 'tool-btn-selected' : '']\"\n        :disabled=\"noCurrentImage || isObliqueLayout\"\n        @click=\"toggle\"\n      />\n    </groupable-item>\n    <div class=\"my-1 tool-separator\" />\n    <groupable-item v-slot:default=\"{ active, toggle }\" :value=\"Tools.Select\">\n      <control-button\n        icon=\"mdi-cursor-default\"\n        :name=\"`Select [${nameToShortcut['Select']}]`\"\n        :buttonClass=\"['tool-btn', active ? 'tool-btn-selected' : '']\"\n        :disabled=\"noCurrentImage\"\n        @click=\"toggle\"\n      />\n    </groupable-item>\n    <groupable-item v-slot:default=\"{ active, toggle }\" :value=\"Tools.Paint\">\n      <control-button\n        icon=\"mdi-brush\"\n        :name=\"`Paint [${nameToShortcut['Paint']}]`\"\n        :buttonClass=\"['tool-btn', active ? 'tool-btn-selected' : '']\"\n        :disabled=\"noCurrentImage || isObliqueLayout\"\n        @click=\"toggle\"\n      ></control-button>\n    </groupable-item>\n    <groupable-item\n      v-slot:default=\"{ active, toggle }\"\n      :value=\"Tools.Rectangle\"\n    >\n      <menu-control-button\n        icon=\"mdi-vector-square\"\n        :name=\"`Rectangle [${nameToShortcut['Rectangle']}]`\"\n        :mobileOnlyMenu=\"true\"\n        :active=\"active\"\n        :disabled=\"noCurrentImage || isObliqueLayout\"\n        @click=\"toggle\"\n      >\n        <rectangle-controls />\n      </menu-control-button>\n    </groupable-item>\n    <groupable-item v-slot:default=\"{ active, toggle }\" :value=\"Tools.Polygon\">\n      <menu-control-button\n        icon=\"mdi-pentagon-outline\"\n        :name=\"`Polygon [${nameToShortcut['Polygon']}]`\"\n        :mobileOnlyMenu=\"true\"\n        :active=\"active\"\n        :disabled=\"noCurrentImage || isObliqueLayout\"\n        @click=\"toggle\"\n      >\n        <polygon-controls />\n      </menu-control-button>\n    </groupable-item>\n    <groupable-item v-slot:default=\"{ active, toggle }\" :value=\"Tools.Ruler\">\n      <menu-control-button\n        icon=\"mdi-ruler\"\n        :name=\"`Ruler [${nameToShortcut['Ruler']}]`\"\n        :mobileOnlyMenu=\"true\"\n        :active=\"active\"\n        :disabled=\"noCurrentImage || isObliqueLayout\"\n        @click=\"toggle\"\n      >\n        <ruler-controls />\n      </menu-control-button>\n    </groupable-item>\n\n    <div class=\"my-1 tool-separator\" />\n    <groupable-item v-slot:default=\"{ active, toggle }\" :value=\"Tools.Crop\">\n      <menu-control-button\n        icon=\"mdi-crop\"\n        :name=\"`Crop [${nameToShortcut['Crop']}]`\"\n        :active=\"active\"\n        :disabled=\"noCurrentImage || isObliqueLayout\"\n        @click=\"toggle\"\n      >\n        <crop-controls />\n      </menu-control-button>\n    </groupable-item>\n    <div class=\"my-1 tool-separator\" />\n    <reset-views />\n  </item-group>\n</template>\n\n<script lang=\"ts\">\nimport { computed, defineComponent, ref } from 'vue';\nimport { storeToRefs } from 'pinia';\nimport { onKeyDown } from '@vueuse/core';\nimport { Tools } from '@/src/store/tools/types';\nimport ControlButton from '@/src/components/ControlButton.vue';\nimport ItemGroup from '@/src/components/ItemGroup.vue';\nimport GroupableItem from '@/src/components/GroupableItem.vue';\nimport { useDatasetStore } from '@/src/store/datasets';\nimport { useToolStore } from '@/src/store/tools';\nimport { useViewStore } from '@/src/store/views';\nimport MenuControlButton from '@/src/components/MenuControlButton.vue';\nimport CropControls from '@/src/components/tools/crop/CropControls.vue';\nimport ResetViews from '@/src/components/tools/ResetViews.vue';\nimport RulerControls from '@/src/components/RulerControls.vue';\nimport RectangleControls from '@/src/components/RectangleControls.vue';\nimport PolygonControls from '@/src/components/PolygonControls.vue';\nimport WindowLevelControls from '@/src/components/tools/windowing/WindowLevelControls.vue';\nimport { actionToKey } from '@/src/composables/useKeyboardShortcuts';\n\nexport default defineComponent({\n  components: {\n    ControlButton,\n    MenuControlButton,\n    ItemGroup,\n    GroupableItem,\n    CropControls,\n    ResetViews,\n    RulerControls,\n    RectangleControls,\n    PolygonControls,\n    WindowLevelControls,\n  },\n  setup() {\n    const dataStore = useDatasetStore();\n    const toolStore = useToolStore();\n    const viewStore = useViewStore();\n\n    const noCurrentImage = computed(() => !dataStore.primaryDataset);\n    const currentTool = computed(() => toolStore.currentTool);\n    const { layout: currentLayout } = storeToRefs(viewStore);\n    const isObliqueLayout = computed(\n      () => currentLayout.value?.name === 'Oblique View'\n    );\n\n    const paintMenu = ref(false);\n    const cropMenu = ref(false);\n    const windowingMenu = ref(false);\n\n    onKeyDown('Escape', () => {\n      paintMenu.value = false;\n      cropMenu.value = false;\n      windowingMenu.value = false;\n    });\n\n    // Rename the computed property to map tool names to their keyboard shortcuts\n    const nameToShortcut = computed(() => {\n      const keyMap = actionToKey.value;\n      return {\n        'Window & Level': keyMap.windowLevel,\n        Pan: keyMap.pan,\n        Zoom: keyMap.zoom,\n        Crosshairs: keyMap.crosshairs,\n        Select: keyMap.select,\n        Paint: keyMap.paint,\n        Rectangle: keyMap.rectangle,\n        Polygon: keyMap.polygon,\n        Ruler: keyMap.ruler,\n        Crop: keyMap.crop,\n      };\n    });\n\n    return {\n      currentTool,\n      setCurrentTool: toolStore.setCurrentTool,\n      noCurrentImage,\n      isObliqueLayout,\n      Tools,\n      paintMenu,\n      cropMenu,\n      windowingMenu,\n      nameToShortcut,\n    };\n  },\n});\n</script>\n\n<style>\n.tool-btn-selected {\n  background-color: rgb(var(--v-theme-selection-bg-color));\n}\n</style>\n\n<style scoped>\n.menu-more {\n  position: absolute;\n  right: -10%;\n}\n\n.tool-separator {\n  width: 75%;\n  height: 1px;\n  border: none;\n  border-top: 1px solid rgb(112, 112, 112);\n}\n\n.popup-menu {\n  max-width: 400px; /* a little less than v-navigation-drawer in App.vue */\n}\n</style>\n","<script lang=\"ts\">\nimport { computed, defineComponent, PropType, toRefs } from 'vue';\nimport { Message, MessageType } from '../store/messages';\n\nconst MessageTypeClass: Record<MessageType, string> = {\n  [MessageType.Error]: 'error',\n  [MessageType.Warning]: 'warn',\n  [MessageType.Info]: 'info',\n  [MessageType.Success]: '',\n};\n\nexport default defineComponent({\n  props: {\n    message: {\n      type: Object as PropType<Message>,\n      required: true,\n    },\n  },\n  setup(props) {\n    const { message } = toRefs(props);\n\n    const headerClass = computed(() => {\n      const type = MessageTypeClass[message.value.type];\n      if (type?.length) {\n        return `${type}-message`;\n      }\n      return '';\n    });\n\n    return {\n      headerClass,\n    };\n  },\n});\n</script>\n\n<template>\n  <v-expansion-panel>\n    <v-expansion-panel-title :class=\"headerClass\">\n      <div class=\"header\">\n        <span>{{ message.title }}</span>\n        <v-btn\n          icon=\"mdi-delete\"\n          variant=\"text\"\n          size=\"small\"\n          class=\"mr-3\"\n          @click.stop=\"$emit('delete')\"\n        />\n      </div>\n    </v-expansion-panel-title>\n    <v-expansion-panel-text v-if=\"message.options.details\">\n      <div class=\"mt-4\">\n        <pre class=\"details\">{{ message.options.details }}</pre>\n      </div>\n    </v-expansion-panel-text>\n  </v-expansion-panel>\n</template>\n\n<style scoped>\n.error-message {\n  background-color: #ef5350;\n}\n\n.warn-message {\n  background-color: #ffa726;\n}\n\n.info-message {\n  background-color: #26c6da;\n}\n\n.header {\n  width: 100%;\n  display: flex;\n  flex-flow: row;\n  justify-content: space-between;\n  align-items: center;\n  user-select: text;\n}\n\n.details {\n  white-space: break-spaces;\n  user-select: text;\n}\n</style>\n","<script lang=\"ts\">\nimport { computed, defineComponent, ref } from 'vue';\nimport { storeToRefs } from 'pinia';\nimport { MessageType, useMessageStore } from '../store/messages';\nimport MessageItem from './MessageItem.vue';\n\nexport default defineComponent({\n  components: {\n    MessageItem,\n  },\n  setup() {\n    const messageStore = useMessageStore();\n    const { messages } = storeToRefs(messageStore);\n\n    const showErrors = ref(true);\n    const showWarnings = ref(true);\n    const showInfo = ref(true);\n\n    const filteredMessages = computed(() => {\n      const show = {\n        errors: showErrors.value,\n        warnings: showWarnings.value,\n        info: showInfo.value,\n      };\n      return messages.value.filter(\n        (msg) =>\n          (msg.type === MessageType.Error && show.errors) ||\n          (msg.type === MessageType.Warning && show.warnings) ||\n          (msg.type === MessageType.Info && show.info)\n      );\n    });\n\n    function deleteItem(messageID: string) {\n      messageStore.clearOne(messageID);\n    }\n\n    return {\n      deleteItem,\n      clearAll: () => {\n        messageStore.clearAll();\n      },\n      showErrors,\n      showWarnings,\n      showInfo,\n      filteredMessages,\n    };\n  },\n});\n</script>\n\n<template>\n  <v-card class=\"fill-height message-center\">\n    <v-card-title class=\"d-flex flex-row align-center\">\n      <span>Notifications</span>\n    </v-card-title>\n    <v-card-text class=\"content-container pt-4\">\n      <div class=\"action-bar ma-2\">\n        <div class=\"filter-bar\">\n          <v-checkbox\n            v-model=\"showErrors\"\n            class=\"px-2\"\n            hide-details\n            label=\"Error\"\n          />\n          <v-checkbox\n            v-model=\"showWarnings\"\n            class=\"px-2\"\n            hide-details\n            label=\"Warning\"\n          />\n          <v-checkbox\n            v-model=\"showInfo\"\n            class=\"px-2\"\n            hide-details\n            label=\"Info\"\n          />\n        </div>\n        <v-btn color=\"secondary\" @click=\"clearAll\">\n          <v-icon class=\"mr-2\">mdi-delete</v-icon>\n          <span>Clear All</span>\n        </v-btn>\n      </div>\n      <div class=\"message-list ma-2\">\n        <v-expansion-panels variant=\"accordion\" multiple>\n          <message-item\n            v-for=\"msg in filteredMessages\"\n            :key=\"msg.id\"\n            :message=\"msg\"\n            @delete=\"deleteItem(msg.id)\"\n          />\n        </v-expansion-panels>\n        <template v-if=\"filteredMessages.length === 0\">\n          <div class=\"empty\">No notifications to display</div>\n        </template>\n      </div>\n    </v-card-text>\n  </v-card>\n</template>\n\n<style scoped>\n.message-center {\n  display: flex;\n  flex-flow: column;\n}\n\n.content-container {\n  display: flex;\n  flex-flow: column;\n  overflow: hidden;\n}\n\n.message-list {\n  overflow-y: auto;\n  scroll-behavior: smooth;\n}\n\n.action-bar {\n  display: flex;\n  flex-flow: row;\n  justify-content: space-between;\n  align-items: center;\n}\n\n.filter-bar {\n  display: flex;\n  flex-flow: row;\n  justify-content: space-between;\n}\n\n.empty {\n  text-align: center;\n  font-size: 1.4rem;\n  margin-top: 36px;\n  padding: 16px;\n}\n</style>\n","<script setup lang=\"ts\">\nimport { storeToRefs } from 'pinia';\nimport { ref, computed, watch } from 'vue';\nimport { loadUserPromptedFiles } from '@/src/actions/loadUserFiles';\nimport useRemoteSaveStateStore from '@/src/store/remote-save-state';\nimport CloseableDialog from '@/src/components/CloseableDialog.vue';\nimport SaveSession from '@/src/components/SaveSession.vue';\nimport ControlButton from '@/src/components/ControlButton.vue';\nimport MessageNotifications from '@/src/components/MessageNotifications.vue';\nimport Settings from '@/src/components/Settings.vue';\nimport ControlsStripTools from '@/src/components/ControlsStripTools.vue';\nimport MessageCenter from '@/src/components/MessageCenter.vue';\nimport { MessageType, useMessageStore } from '@/src/store/messages';\nimport { ConnectionState, useServerStore } from '@/src/store/server';\nimport { useViewStore } from '@/src/store/views';\nimport { Layouts, DefaultLayoutName } from '@/src/config';\n\ninterface Props {\n  hasData: boolean;\n}\n\ndefineProps<Props>();\n\nfunction useViewLayout() {\n  const viewStore = useViewStore();\n  const layoutName = ref(DefaultLayoutName);\n  const { layout: currentLayout } = storeToRefs(viewStore);\n\n  watch(\n    layoutName,\n    () => {\n      const layout = Layouts[layoutName.value] || [];\n      viewStore.setLayout(layout);\n    },\n    {\n      immediate: true,\n    }\n  );\n\n  watch(currentLayout, () => {\n    if (\n      currentLayout.value?.name &&\n      currentLayout.value.name !== layoutName.value\n    ) {\n      layoutName.value = currentLayout.value.name;\n    }\n  });\n\n  return layoutName;\n}\n\nfunction useSaveControls() {\n  const remoteSaveStateStore = useRemoteSaveStateStore();\n  const { isSaving, saveUrl } = storeToRefs(remoteSaveStateStore);\n\n  const saveDialog = ref(false);\n\n  const handleSave = () => {\n    if (saveUrl.value !== '') {\n      remoteSaveStateStore.saveState();\n    } else {\n      saveDialog.value = true;\n    }\n  };\n\n  return { handleSave, isSaving, saveDialog };\n}\n\nfunction useMessageBubble() {\n  const messageStore = useMessageStore();\n  const count = computed(() => messageStore.importantMessages.length);\n  const badgeColor = computed(() => {\n    if (\n      messageStore.importantMessages.find(\n        (msg) => msg.type === MessageType.Error\n      )\n    ) {\n      return 'error';\n    }\n    if (\n      messageStore.importantMessages.find(\n        (msg) => msg.type === MessageType.Warning\n      )\n    ) {\n      return 'warning';\n    }\n    return 'primary';\n  });\n\n  return { count, badgeColor };\n}\n\nfunction useServerConnection() {\n  const serverStore = useServerStore();\n\n  const icon = computed(() => {\n    switch (serverStore.connState) {\n      case ConnectionState.Connected:\n        return 'mdi-lan-check';\n      case ConnectionState.Disconnected:\n        return 'mdi-lan-disconnect';\n      case ConnectionState.Pending:\n        return 'mdi-lan-pending';\n      default:\n        throw new Error('Invalid connection state');\n    }\n  });\n\n  const { url } = storeToRefs(serverStore);\n\n  return { icon, url };\n}\n\nconst settingsDialog = ref(false);\nconst messageDialog = ref(false);\nconst { icon: connIcon, url: serverUrl } = useServerConnection();\nconst layoutName = useViewLayout();\nconst { handleSave, saveDialog, isSaving } = useSaveControls();\nconst { count: msgCount, badgeColor: msgBadgeColor } = useMessageBubble();\n</script>\n\n<template>\n  <div\n    id=\"tools-strip\"\n    class=\"bg-grey-darken-4 d-flex flex-column align-center\"\n  >\n    <control-button\n      size=\"40\"\n      icon=\"mdi-folder-open\"\n      name=\"Open files\"\n      @click=\"loadUserPromptedFiles\"\n    />\n    <control-button\n      size=\"40\"\n      icon=\"mdi-content-save-all\"\n      name=\"Save session\"\n      :loading=\"isSaving\"\n      @click=\"handleSave\"\n    />\n    <div class=\"my-1 tool-separator\" />\n    <v-menu location=\"right\" :close-on-content-click=\"true\">\n      <template v-slot:activator=\"{ props }\">\n        <div>\n          <control-button\n            v-bind=\"props\"\n            size=\"40\"\n            icon=\"mdi-view-dashboard\"\n            name=\"Layouts\"\n          />\n        </div>\n      </template>\n      <v-card>\n        <v-card-text>\n          <v-radio-group v-model=\"layoutName\" class=\"mt-0\" hide-details>\n            <v-radio\n              v-for=\"(value, key) in Layouts\"\n              :key=\"key\"\n              :label=\"value.name\"\n              :value=\"key\"\n            />\n          </v-radio-group>\n        </v-card-text>\n      </v-card>\n    </v-menu>\n    <controls-strip-tools v-if=\"hasData\" />\n    <v-spacer />\n    <control-button\n      v-if=\"serverUrl\"\n      size=\"40\"\n      :icon=\"connIcon\"\n      name=\"Open Server Settings\"\n      @click=\"settingsDialog = true\"\n    />\n    <v-badge\n      offset-x=\"10\"\n      offset-y=\"10\"\n      :content=\"msgCount\"\n      :color=\"msgBadgeColor\"\n      :model-value=\"msgCount > 0\"\n      id=\"notifications\"\n    >\n      <control-button\n        size=\"40\"\n        icon=\"mdi-bell-outline\"\n        name=\"Notifications\"\n        @click=\"messageDialog = true\"\n      />\n    </v-badge>\n    <control-button\n      size=\"40\"\n      icon=\"mdi-cog\"\n      name=\"Settings\"\n      @click=\"settingsDialog = true\"\n    />\n  </div>\n  <closeable-dialog v-model=\"saveDialog\" max-width=\"30%\">\n    <template v-slot=\"{ close }\">\n      <save-session :close=\"close\" />\n    </template>\n  </closeable-dialog>\n  <closeable-dialog v-model=\"messageDialog\" content-class=\"fill-height\">\n    <message-center />\n  </closeable-dialog>\n\n  <message-notifications @open-notifications=\"messageDialog = true\" />\n\n  <closeable-dialog v-model=\"settingsDialog\">\n    <settings />\n  </closeable-dialog>\n</template>\n\n<style src=\"@/src/components/styles/utils.css\"></style>\n<style scoped>\n#tools-strip {\n  border-left: 1px solid #212121;\n  flex: 0 0 40px;\n}\n\n.tool-separator {\n  width: 75%;\n  height: 1px;\n  border: none;\n  border-top: 1px solid rgb(112, 112, 112);\n}\n</style>\n","<script setup lang=\"ts\">\nimport {\n  errorReportingConfigured,\n  useErrorReporting,\n} from '@/src/utils/errorReporting';\nimport { computed } from 'vue';\n\nconst errorStore = useErrorReporting();\nconst reportingEnabled = computed({\n  get: () => !errorStore.disableReporting,\n  set: (enabled) => {\n    errorStore.disableReporting = !enabled;\n  },\n});\n</script>\n\n<template>\n  <v-card class=\"text-grey-lighten-1\">\n    <v-card-title>Data Privacy and Security Notice</v-card-title>\n    <v-card-text>\n      <p class=\"mb-4\">\n        VolView takes data privacy and security seriously. Here is how we keep\n        your data safe.\n      </p>\n      <ul class=\"bullet-points\">\n        <li>\n          <span class=\"font-weight-bold\">Data Loading</span>: Your image data\n          never leaves your computer. Images are loaded into your browser and\n          are never sent to any remote server or cloud service.\n        </li>\n        <li>\n          <span class=\"font-weight-bold\">Error Reporting</span>: We collect\n          error reports in the event that VolView encounters issues. These\n          reports help us improve VolView's stability and only consist of code\n          stack traces where applicable. We do not collect your data, nor any\n          other identifiable information.\n        </li>\n      </ul>\n      <p>\n        If you would like to opt-out of error reporting, you may turn it off\n        using the following setting. Your choice will be respected for future\n        VolView sessions on this machine.\n      </p>\n      <p class=\"mt-4 ml-4\">\n        <v-switch\n          v-if=\"errorReportingConfigured\"\n          v-model=\"reportingEnabled\"\n          :label=\"`Error Reporting: ${reportingEnabled ? 'On' : 'Off'}`\"\n          color=\"secondary\"\n          hide-details\n        />\n        <v-alert v-else type=\"info\" variant=\"text\">\n          <span>Error reporting has been turned off at build time.</span>\n        </v-alert>\n      </p>\n    </v-card-text>\n  </v-card>\n</template>\n\n<style scoped>\n.bullet-points {\n  padding-left: 20px;\n  margin-bottom: 16px;\n}\n\n.bullet-points > li:not(:last-child) {\n  margin-bottom: 8px;\n}\n</style>\n","<script setup lang=\"ts\">\nimport { ref, computed } from 'vue';\nimport CloseableDialog from '@/src/components/CloseableDialog.vue';\nimport DataSecurityBox from '@/src/components/DataSecurityBox.vue';\nimport useRemoteSaveStateStore from '@/src/store/remote-save-state';\n\nwithDefaults(\n  defineProps<{\n    loading?: boolean;\n  }>(),\n  {\n    loading: false,\n  }\n);\n\nconst isRemoteSaveDisabled = computed(\n  () => useRemoteSaveStateStore().saveUrl === ''\n);\nconst dataSecurityDialog = ref(false);\n</script>\n\n<template>\n  <v-container class=\"page-container bg-grey-darken-3\" v-bind=\"$attrs\">\n    <v-col>\n      <v-row justify=\"center\">\n        <v-card\n          flat\n          dark\n          rounded=\"0\"\n          color=\"transparent\"\n          class=\"text-center headline\"\n        >\n          <template v-if=\"!loading\">\n            <div>\n              <v-icon size=\"64\">mdi-folder-open</v-icon>\n            </div>\n            <div>Click to open local files.</div>\n            <div class=\"mt-8\">\n              <v-icon size=\"64\">mdi-arrow-down-bold</v-icon>\n            </div>\n            <div>Drag &amp; drop your DICOM files.</div>\n\n            <div class=\"vertical-offset-margin\">\n              <div v-if=\"isRemoteSaveDisabled\" class=\"vertical-offset-margin\">\n                <v-icon size=\"64\">mdi-cloud-off-outline</v-icon>\n              </div>\n              <div v-if=\"isRemoteSaveDisabled\">\n                Secure: Image data never leaves your machine.\n              </div>\n              <v-btn\n                class=\"mt-2\"\n                variant=\"tonal\"\n                color=\"secondary\"\n                @click.stop=\"dataSecurityDialog = true\"\n              >\n                Learn More\n              </v-btn>\n            </div>\n          </template>\n          <template v-else>\n            <div class=\"text-h6 my-4\">Loading data...</div>\n            <v-progress-linear indeterminate />\n          </template>\n        </v-card>\n      </v-row>\n    </v-col>\n  </v-container>\n  <closeable-dialog v-model=\"dataSecurityDialog\">\n    <data-security-box />\n  </closeable-dialog>\n</template>\n\n<style scoped>\n.page-container {\n  flex: 1 1 auto;\n  display: flex;\n  flex-flow: row;\n  align-items: center;\n  max-width: 100%;\n}\n\n.vertical-offset-margin {\n  margin-top: 128px;\n}\n</style>\n","import { Maybe } from '@/src/types';\nimport { vtkObject, vtkSubscription } from '@kitware/vtk.js/interfaces';\nimport { MaybeRef, computed, onScopeDispose, unref, watch } from 'vue';\n\nexport type VTKEventHandler = (ev?: any) => any;\nexport type VTKEventListener = (\n  handler: VTKEventHandler,\n  priority?: number\n) => vtkSubscription;\nexport type OnVTKEventOptions = {\n  priority?: number;\n};\n\nexport function onVTKEvent<T extends vtkObject, K extends keyof T>(\n  vtkObj: MaybeRef<Maybe<T>>,\n  eventHookName: T[K] extends VTKEventListener ? K : never,\n  callback: VTKEventHandler,\n  options?: OnVTKEventOptions\n) {\n  const listenerRef = computed(() => {\n    const obj = unref(vtkObj);\n    return obj ? (obj[eventHookName] as VTKEventListener) : null;\n  });\n\n  let subscription: Maybe<vtkSubscription> = null;\n\n  const cleanup = () => {\n    subscription?.unsubscribe();\n    subscription = null;\n  };\n\n  const stop = watch(\n    listenerRef,\n    (listener) => {\n      cleanup();\n      if (listener) {\n        subscription = listener(callback, options?.priority ?? 0);\n      }\n    },\n    { immediate: true }\n  );\n\n  onScopeDispose(() => {\n    cleanup();\n  });\n\n  return {\n    stop: () => {\n      cleanup();\n      stop();\n    },\n  };\n}\n","/**\n * Batches a function for the next JS task.\n *\n * Returns a function that wraps the given callback.\n * @param fn\n * @returns\n */\nexport function batchForNextTask<T extends (...args: any[]) => void>(fn: T) {\n  let timeout: NodeJS.Timeout | null = null;\n  const wrapper = ((...args: any[]) => {\n    if (timeout != null) return;\n    timeout = setTimeout(() => {\n      timeout = null;\n      fn(...args);\n    }, 0);\n  }) as T;\n  return wrapper;\n}\n","import { onVTKEvent } from '@/src/composables/onVTKEvent';\nimport { View } from '@/src/core/vtk/types';\nimport { Maybe } from '@/src/types';\nimport { batchForNextTask } from '@/src/utils/batchForNextTask';\nimport vtkRenderWindow from '@kitware/vtk.js/Rendering/Core/RenderWindow';\nimport vtkRenderWindowInteractor from '@kitware/vtk.js/Rendering/Core/RenderWindowInteractor';\nimport vtkRenderer from '@kitware/vtk.js/Rendering/Core/Renderer';\nimport vtkOpenGLRenderWindow from '@kitware/vtk.js/Rendering/OpenGL/RenderWindow';\nimport vtkWidgetManager from '@kitware/vtk.js/Widgets/Core/WidgetManager';\nimport { useElementSize } from '@vueuse/core';\nimport {\n  MaybeRef,\n  onScopeDispose,\n  unref,\n  watchEffect,\n  watchPostEffect,\n} from 'vue';\n\nexport function useWebGLRenderWindow(container: MaybeRef<Maybe<HTMLElement>>) {\n  const renderWindowView = vtkOpenGLRenderWindow.newInstance();\n\n  watchPostEffect((onCleanup) => {\n    const el = unref(container);\n    if (!el) return;\n\n    renderWindowView.setContainer(el);\n    onCleanup(() => {\n      renderWindowView.setContainer(null as unknown as HTMLElement);\n    });\n  });\n\n  onScopeDispose(() => {\n    renderWindowView.delete();\n  });\n\n  return renderWindowView;\n}\n\nexport function useWidgetManager(renderer: vtkRenderer) {\n  const manager = vtkWidgetManager.newInstance();\n  manager.setRenderer(renderer);\n\n  const updatePickingState = () => {\n    const enabled = manager.getPickingEnabled();\n    const widgetCount = manager.getWidgets().length;\n    if (!enabled && widgetCount) {\n      manager.enablePicking();\n    } else if (enabled && !widgetCount) {\n      manager.disablePicking();\n    }\n  };\n\n  onVTKEvent(manager, 'onModified', updatePickingState);\n  updatePickingState();\n\n  return manager;\n}\n\nexport function useVtkView(container: MaybeRef<Maybe<HTMLElement>>): View {\n  const renderer = vtkRenderer.newInstance();\n  const renderWindow = vtkRenderWindow.newInstance();\n  renderWindow.addRenderer(renderer);\n\n  // the render window view\n  const renderWindowView = useWebGLRenderWindow(container);\n  renderWindow.addView(renderWindowView);\n\n  onScopeDispose(() => {\n    renderWindow.removeView(renderWindowView);\n  });\n\n  // interactor\n  const interactor = vtkRenderWindowInteractor.newInstance();\n  renderWindow.setInteractor(interactor);\n  interactor.setView(renderWindowView);\n\n  watchPostEffect((onCleanup) => {\n    const el = unref(container);\n    if (!el) return;\n\n    interactor.initialize();\n    interactor.bindEvents(el);\n    onCleanup(() => {\n      if (interactor.getContainer()) interactor.unbindEvents();\n    });\n  });\n\n  // widget manager\n  const widgetManager = useWidgetManager(renderer);\n\n  // render API\n  const deferredRender = batchForNextTask(() => {\n    // don't need to re-render during animation\n    if (interactor.isAnimating()) return;\n    widgetManager.renderWidgets();\n    renderWindow.render();\n  });\n\n  const immediateRender = () => {\n    if (interactor.isAnimating()) return;\n    renderWindow.render();\n  };\n\n  const requestRender = ({ immediate } = { immediate: false }) => {\n    if (immediate) {\n      immediateRender();\n    }\n    deferredRender();\n  };\n\n  onVTKEvent(renderer, 'onModified', () => {\n    requestRender();\n  });\n\n  // set size\n  const setSize = (width: number, height: number) => {\n    // ensure we have a non-zero size, otherwise\n    // the framebuffers might not be populated correctly\n    const scaledWidth = Math.max(1, width * globalThis.devicePixelRatio);\n    const scaledHeight = Math.max(1, height * globalThis.devicePixelRatio);\n    renderWindowView.setSize(scaledWidth, scaledHeight);\n    requestRender({ immediate: true });\n  };\n\n  const { width, height } = useElementSize(container);\n  watchEffect(() => {\n    setSize(width.value, height.value);\n  });\n\n  // cleanup\n  onScopeDispose(() => {\n    renderWindow.removeRenderer(renderer);\n\n    renderer.delete();\n    renderWindow.delete();\n    interactor.delete();\n  });\n\n  return {\n    renderer,\n    renderWindow,\n    interactor,\n    renderWindowView,\n    widgetManager,\n    requestRender,\n  };\n}\n","import { VtkObjectConstructor } from '@/src/core/vtk/types';\nimport vtkInteractorStyle from '@kitware/vtk.js/Rendering/Core/InteractorStyle';\nimport { vtkWarningMacro } from '@kitware/vtk.js/macros';\nimport { onScopeDispose } from 'vue';\nimport type { View } from '@/src/core/vtk/types';\n\nexport function useVtkInteractorStyle<T extends vtkInteractorStyle>(\n  vtkCtor: VtkObjectConstructor<T>,\n  view: View\n) {\n  const style = vtkCtor.newInstance();\n\n  if (view.interactor.getInteractorStyle()) {\n    vtkWarningMacro('Overwriting an already set interactor style');\n  }\n  view.interactor.setInteractorStyle(style);\n\n  onScopeDispose(() => {\n    if (view.interactor.getInteractorStyle() === style)\n      view.interactor.setInteractorStyle(null);\n    style.delete();\n  });\n\n  return { interactorStyle: style };\n}\n","import {\n  WatchCallback,\n  WatchOptions,\n  WatchSource,\n  WatchStopHandle,\n  watch,\n} from 'vue';\n\nexport interface WatchCompareOptions<Immediate>\n  extends WatchOptions<Immediate> {\n  compare: (a: any, b: any) => boolean;\n}\n\n// Internal Types from vue\nexport type MultiWatchSources = (WatchSource<unknown> | object)[];\n\nexport type MapSources<T> = {\n  [K in keyof T]: T[K] extends WatchSource<infer V> ? V : never;\n};\nexport type MapOldSources<T, Immediate> = {\n  [K in keyof T]: T[K] extends WatchSource<infer V>\n    ? Immediate extends true\n      ? V | undefined\n      : V\n    : never;\n};\n\n// overloads\nexport function watchCompare<\n  T extends Readonly<WatchSource<unknown>[]>,\n  Immediate extends Readonly<boolean> = false\n>(\n  sources: [...T],\n  cb: WatchCallback<MapSources<T>, MapOldSources<T, Immediate>>,\n  options?: WatchCompareOptions<Immediate>\n): WatchStopHandle;\nexport function watchCompare<T, Immediate extends Readonly<boolean> = false>(\n  source: WatchSource<T>,\n  cb: WatchCallback<T, Immediate extends true ? T | undefined : T>,\n  options?: WatchCompareOptions<Immediate>\n): WatchStopHandle;\nexport function watchCompare<\n  T extends object,\n  Immediate extends Readonly<boolean> = false\n>(\n  source: T,\n  cb: WatchCallback<T, Immediate extends true ? T | undefined : T>,\n  options?: WatchCompareOptions<Immediate>\n): WatchStopHandle;\n\nexport function watchCompare<Immediate extends Readonly<boolean> = false>(\n  sources: any,\n  callback: any,\n  options?: WatchCompareOptions<Immediate>\n): WatchStopHandle {\n  return watch(\n    sources,\n    (newData, oldData, onCleanup) => {\n      let cleanupFn: (() => void) | null = null;\n      const innerOnCleanup = (fn: () => void) => {\n        cleanupFn = fn;\n      };\n      const changed = options?.compare(newData, oldData);\n\n      onCleanup(() => {\n        if (!changed) return;\n        cleanupFn?.();\n      });\n\n      if (changed) return;\n      callback(newData, oldData, innerOnCleanup);\n    },\n    options\n  );\n}\n","import { Ref, computed, ref } from 'vue';\nimport { watchCompare } from '@/src/utils/watchCompare';\nimport deepEqual from 'fast-deep-equal';\n\n/**\n * Ensures that a Ref holds a stable reference by deep comparison.\n * @param sourceRef\n * @returns\n */\nexport function stableDeepRef<T>(sourceRef: Ref<T>) {\n  const stableRef = ref<T>(sourceRef.value) as Ref<T>;\n  watchCompare(\n    sourceRef,\n    (result) => {\n      stableRef.value = result;\n    },\n    { compare: deepEqual }\n  );\n\n  return computed({\n    get: () => stableRef.value,\n    set: (v) => {\n      // eslint-disable-next-line no-param-reassign\n      sourceRef.value = v;\n    },\n  });\n}\n","import { MaybeRef, computed, ref, toRef, unref, watch, watchEffect } from 'vue';\nimport vtkInteractorStyleManipulator from '@kitware/vtk.js/Interaction/Style/InteractorStyleManipulator';\nimport { VtkObjectConstructor } from '@/src/core/vtk/types';\nimport { FirstParam } from '@/src/types';\nimport { stableDeepRef } from '@/src/composables/stableDeepRef';\n\nfunction addManipulator(style: vtkInteractorStyleManipulator, manip: any) {\n  if (manip.isA('vtkCompositeMouseManipulator')) {\n    style.addMouseManipulator(manip);\n  } else if (manip.isA('vtkCompositeGestureManipulator')) {\n    style.addGestureManipulator(manip);\n  } else if (manip.isA('vtkCompositeKeyboardManipulator')) {\n    style.addKeyboardManipulator(manip);\n  }\n}\n\nfunction removeManipulator(style: vtkInteractorStyleManipulator, manip: any) {\n  if (manip.isA('vtkCompositeMouseManipulator')) {\n    style.removeMouseManipulator(manip);\n  } else if (manip.isA('vtkCompositeGestureManipulator')) {\n    style.removeGestureManipulator(manip);\n  } else if (manip.isA('vtkCompositeKeyboardManipulator')) {\n    style.removeKeyboardManipulator(manip);\n  }\n}\n\nexport function useVtkInteractionManipulator<\n  T extends VtkObjectConstructor<any>\n>(\n  style: vtkInteractorStyleManipulator,\n  vtkCtor: MaybeRef<T>,\n  props: MaybeRef<FirstParam<T['newInstance']>>\n) {\n  const stableProps = stableDeepRef(toRef(props));\n  const manipulator = computed(() => {\n    return unref(vtkCtor).newInstance(stableProps.value);\n  });\n\n  const enabled = ref(true);\n\n  watch(manipulator, (_, oldManipulator) => {\n    oldManipulator?.delete();\n  });\n\n  watchEffect((onCleanup) => {\n    if (!enabled.value) return;\n\n    const manip = manipulator.value;\n    addManipulator(style, manip);\n    onCleanup(() => {\n      if (!style.isDeleted()) removeManipulator(style, manip);\n    });\n  });\n\n  return {\n    instance: manipulator,\n    enabled,\n  };\n}\n","import { View } from '@/src/core/vtk/types';\nimport { ImageMetadata } from '@/src/types/image';\nimport { LPSAxisDir } from '@/src/types/lps';\nimport { getLPSAxisFromDir, getLPSDirections } from '@/src/utils/lps';\nimport vtkBoundingBox from '@kitware/vtk.js/Common/DataModel/BoundingBox';\nimport vtkCamera from '@kitware/vtk.js/Rendering/Core/Camera';\nimport { Vector2, Vector3 } from '@kitware/vtk.js/types';\nimport { vec3 } from 'gl-matrix';\n\n/**\n * Given an eye frame, return the dimension indices corresponding to the horizontal and vertical dimensions.\n * @param lookAxis\n * @param eyeUpAxis\n * @returns\n */\nfunction eyeFrameDimIndices(lookAxis: 0 | 1 | 2, eyeUpAxis: 0 | 1 | 2) {\n  if (lookAxis === 0 && eyeUpAxis === 1) return [2, 1] as Vector2;\n  if (lookAxis === 0 && eyeUpAxis === 2) return [1, 2] as Vector2;\n  if (lookAxis === 1 && eyeUpAxis === 0) return [2, 0] as Vector2;\n  if (lookAxis === 1 && eyeUpAxis === 2) return [0, 2] as Vector2;\n  if (lookAxis === 2 && eyeUpAxis === 0) return [1, 0] as Vector2;\n  if (lookAxis === 2 && eyeUpAxis === 1) return [0, 1] as Vector2;\n  throw new Error(`Invalid lookAxis and eyeUpAxis: ${lookAxis}, ${eyeUpAxis}`);\n}\n\nfunction computeParallelScale(\n  lookAxis: 0 | 1 | 2,\n  viewUpAxis: 0 | 1 | 2,\n  dimensions: Vector3 | vec3,\n  viewSize: Vector2\n) {\n  const [widthIndex, heightIndex] = eyeFrameDimIndices(lookAxis, viewUpAxis);\n  const width = dimensions[widthIndex];\n  const height = dimensions[heightIndex];\n  const dimAspect = width / height;\n\n  const [viewWidth, viewHeight] = viewSize;\n  const viewAspect = viewWidth / viewHeight;\n\n  let scale = height / 2;\n  if (viewAspect < dimAspect) {\n    scale = width / 2 / viewAspect;\n  }\n\n  return scale;\n}\n\nexport function resizeToFit(\n  view: View,\n  lookAxis: 0 | 1 | 2,\n  upAxis: 0 | 1 | 2,\n  dimensions: Vector3 | vec3\n) {\n  const camera = view.renderer.getActiveCamera();\n  camera.setParallelScale(\n    computeParallelScale(\n      lookAxis,\n      upAxis,\n      dimensions,\n      view.renderWindowView.getSize()\n    )\n  );\n}\n\nexport function positionCamera(\n  camera: vtkCamera,\n  directionOfProjection: Vector3,\n  viewUp: Vector3,\n  focalPoint: Vector3\n) {\n  const position = vec3.clone(focalPoint) as Vector3;\n  vec3.sub(position, position, directionOfProjection);\n  camera.setFocalPoint(...focalPoint);\n  camera.setPosition(...position);\n  camera.setDirectionOfProjection(...directionOfProjection);\n  camera.setViewUp(...viewUp);\n}\n\nexport function resetCameraToImage(\n  view: View,\n  metadata: ImageMetadata,\n  viewDirection: LPSAxisDir,\n  viewUp: LPSAxisDir\n) {\n  const { worldBounds, orientation } = metadata;\n  const lpsDirections = getLPSDirections(orientation);\n\n  const center = vtkBoundingBox.getCenter(worldBounds);\n  const camera = view.renderer.getActiveCamera();\n\n  const directionOfProjection = lpsDirections[viewDirection] as Vector3;\n  const camerViewUp = lpsDirections[viewUp] as Vector3;\n  positionCamera(camera, directionOfProjection, camerViewUp, center);\n\n  view.renderer.resetCamera(worldBounds);\n  view.requestRender();\n}\nexport function resizeToFitImage(\n  view: View,\n  metadata: ImageMetadata,\n  viewDirection: LPSAxisDir,\n  viewUp: LPSAxisDir\n) {\n  const { lpsOrientation, dimensions, spacing } = metadata;\n  const viewDirAxis = getLPSAxisFromDir(viewDirection);\n  const viewUpAxis = getLPSAxisFromDir(viewUp);\n  const lookAxis = lpsOrientation[viewDirAxis];\n  const upAxis = lpsOrientation[viewUpAxis];\n  const dimsWithSpacing: Vector3 = [\n    dimensions[0] * spacing[0],\n    dimensions[1] * spacing[1],\n    dimensions[2] * spacing[2],\n  ];\n\n  resizeToFit(view, lookAxis, upAxis, dimsWithSpacing);\n  view.requestRender();\n}\n","import { vtkObject } from '@kitware/vtk.js/interfaces';\nimport { MaybeRef } from 'vue';\nimport {\n  OnVTKEventOptions,\n  VTKEventHandler,\n  VTKEventListener,\n  onVTKEvent,\n} from './onVTKEvent';\n\nexport function onPausableVTKEvent<T extends vtkObject, K extends keyof T>(\n  vtkObj: MaybeRef<T | undefined | null>,\n  eventHookName: T[K] extends VTKEventListener ? K : never,\n  callback: VTKEventHandler,\n  options?: OnVTKEventOptions\n) {\n  let paused = false;\n\n  const pause = () => {\n    paused = true;\n  };\n\n  const resume = () => {\n    paused = false;\n  };\n\n  const withPaused = (fn: () => void) => {\n    pause();\n    try {\n      fn();\n    } finally {\n      resume();\n    }\n  };\n\n  const { stop } = onVTKEvent(\n    vtkObj,\n    eventHookName,\n    (obj) => {\n      if (!paused) callback(obj);\n    },\n    options\n  );\n\n  return {\n    stop,\n    pause,\n    resume,\n    withPaused,\n  };\n}\n","import { MaybeRef, Ref, computed, customRef, triggerRef, unref } from 'vue';\nimport { vtkObject } from '@kitware/vtk.js/interfaces';\nimport { capitalize } from '@kitware/vtk.js/macros';\nimport { onPausableVTKEvent } from '@/src/composables/onPausableVTKEvent';\nimport { batchForNextTask } from '@/src/utils/batchForNextTask';\nimport { Maybe } from '@/src/types';\n\ntype NonEmptyString<T extends string> = T extends '' ? never : T;\n\ntype FilterGetters<T extends string> = T extends `get${infer R}`\n  ? NonEmptyString<Uncapitalize<R>>\n  : never;\n\ntype GettableFields<T> = FilterGetters<string & keyof T>;\n\ntype NameToGetter<T extends string> = `get${Capitalize<T>}`;\n\ntype Just<T> = Exclude<T, null | undefined>;\n\ntype GetterReturnType<T, F extends string> = T extends null | undefined\n  ? undefined\n  : NameToGetter<F> extends keyof T\n  ? T[NameToGetter<F>] extends (...args: any[]) => infer R\n    ? R\n    : never\n  : never;\n\ntype ArraySetter = (...args: any[]) => boolean;\n\nexport type GetterSetterFactory<T> = {\n  get(): T;\n  set(v: T): boolean | undefined;\n};\n\n/**\n * A custom set/get vtk object ref that operates based on the given field name.\n * @param obj\n * @param fieldName\n */\nexport function vtkFieldRef<\n  T extends Maybe<vtkObject>,\n  F extends GettableFields<Just<T>>\n>(obj: MaybeRef<T>, fieldName: F): Ref<GetterReturnType<T, F>>;\n\n/**\n * A customRef wrapper that triggers the ref based on a vtk object modification event.\n * @param obj\n * @param factory\n */\nexport function vtkFieldRef<T extends Maybe<vtkObject>, R>(\n  obj: MaybeRef<T>,\n  factory: GetterSetterFactory<R>\n): Ref<R>;\n\nexport function vtkFieldRef<T extends Maybe<vtkObject>>(\n  obj: MaybeRef<T>,\n  fieldNameOrFactory: string | GetterSetterFactory<any>\n): any {\n  let getter: () => any;\n  let setter: (v: any) => boolean | undefined;\n\n  if (typeof fieldNameOrFactory === 'string') {\n    const getterName = `get${capitalize(fieldNameOrFactory)}` as keyof T;\n    const setterName = `set${capitalize(fieldNameOrFactory)}` as keyof T;\n\n    const _getter = computed(\n      () => unref(obj)?.[getterName] as (() => any) | undefined\n    );\n    const _setter = computed(\n      () =>\n        unref(obj)?.[setterName] as ((...args: any[]) => boolean) | undefined\n    );\n\n    const notNull = computed(() => !!unref(obj));\n    const hasSetter = computed(() => {\n      const val = unref(obj);\n      return val ? setterName in val : false;\n    });\n\n    getter = () => _getter.value?.();\n    setter = (v: any) => {\n      const set = _setter.value;\n      if (!notNull.value) return false;\n      if (!hasSetter.value || !set)\n        throw new Error(`No setter for field '${fieldNameOrFactory}'`);\n\n      // handle certain array setters not accepting an array as input\n      if (Array.isArray(v) && set.length === v.length) {\n        return (set as ArraySetter)(...v);\n      }\n      return set(v);\n    };\n  } else {\n    getter = fieldNameOrFactory.get;\n    setter = fieldNameOrFactory.set;\n  }\n\n  let pause: () => void;\n  let resume: () => void;\n\n  const ref = customRef<any>((track, trigger) => {\n    return {\n      get: () => {\n        track();\n        return getter();\n      },\n      set: (v) => {\n        let changed = false;\n        pause();\n\n        try {\n          const ret = setter(v);\n          // in the event a setter returns undefined, assume something changed.\n          changed = ret === undefined ? true : ret;\n        } finally {\n          resume();\n        }\n\n        if (changed) {\n          trigger();\n        }\n      },\n    };\n  });\n\n  const onModified = batchForNextTask(() => {\n    if (unref(obj)?.isDeleted()) return;\n    triggerRef(ref);\n  });\n\n  ({ pause, resume } = onPausableVTKEvent(\n    obj as vtkObject,\n    'onModified',\n    onModified\n  ));\n\n  return ref;\n}\n","import { Ref, computed } from 'vue';\n\nexport function guardedWritableRef<T>(\n  obj: Ref<T>,\n  accept: (incoming: T, current: T) => boolean\n) {\n  return computed({\n    get: () => obj.value,\n    set: (v) => {\n      if (accept(v, obj.value)) {\n        // eslint-disable-next-line no-param-reassign\n        obj.value = v;\n      }\n    },\n  });\n}\n","import { MaybeRef, Ref, computed, unref } from 'vue';\nimport { Maybe } from '@/src/types';\nimport useViewCameraStore from '@/src/store/view-configs/camera';\nimport vtkCamera from '@kitware/vtk.js/Rendering/Core/Camera';\nimport { vtkFieldRef } from '@/src/core/vtk/vtkFieldRef';\nimport { syncRef } from '@vueuse/core';\nimport { guardedWritableRef } from '@/src/utils/guardedWritableRef';\n\nexport function usePersistCameraConfig(\n  viewID: MaybeRef<string>,\n  dataID: MaybeRef<Maybe<string>>,\n  camera: MaybeRef<vtkCamera>\n) {\n  const viewCameraStore = useViewCameraStore();\n\n  const keys = [\n    'position',\n    'focalPoint',\n    'viewUp',\n    'parallelScale',\n    'directionOfProjection',\n  ] as const;\n  type KeyType = (typeof keys)[number];\n\n  const cameraRefs = keys.reduce(\n    (refs, key) => ({\n      ...refs,\n      [key]: guardedWritableRef(\n        vtkFieldRef(camera, key),\n        (incoming) => !!incoming\n      ),\n    }),\n    {} as Record<KeyType, Ref<any>>\n  );\n\n  const config = computed(() =>\n    viewCameraStore.getConfig(unref(viewID), unref(dataID))\n  );\n\n  const configRefs = keys.reduce(\n    (refs, key) => ({\n      ...refs,\n      [key]: computed({\n        get: () => config.value?.[key],\n        set: (v) => {\n          const viewIDVal = unref(viewID);\n          const dataIDVal = unref(dataID);\n          if (!viewIDVal || !dataIDVal) return;\n          viewCameraStore.updateConfig(viewIDVal, dataIDVal, {\n            [key]: v,\n          });\n          if (viewCameraStore.isSync()) {\n            viewCameraStore.updateSyncConfigs();\n          }\n        },\n      }),\n    }),\n    {} as Record<KeyType, Ref<any>>\n  );\n\n  keys.forEach((key) => {\n    syncRef(configRefs[key], cameraRefs[key]);\n  });\n}\n","import { VtkViewApi } from '@/src/types/vtk-types';\nimport { InjectionKey } from 'vue';\n\nexport const VtkViewContext: InjectionKey<VtkViewApi> = Symbol('VtkView');\n","<script setup lang=\"ts\">\nimport {\n  ref,\n  toRefs,\n  provide,\n  watchEffect,\n  markRaw,\n  effectScope,\n  onUnmounted,\n} from 'vue';\nimport { storeToRefs } from 'pinia';\nimport vtkInteractorStyleManipulator from '@kitware/vtk.js/Interaction/Style/InteractorStyleManipulator';\nimport vtkMouseCameraTrackballPanManipulator from '@kitware/vtk.js/Interaction/Manipulators/MouseCameraTrackballPanManipulator';\nimport vtkMouseCameraTrackballZoomManipulator from '@kitware/vtk.js/Interaction/Manipulators/MouseCameraTrackballZoomManipulator';\nimport { useVtkView } from '@/src/core/vtk/useVtkView';\nimport { useImage } from '@/src/composables/useCurrentImage';\nimport { useViewCameraStore } from '@/src/store/view-configs/camera';\nimport { useVtkInteractorStyle } from '@/src/core/vtk/useVtkInteractorStyle';\nimport { useVtkInteractionManipulator } from '@/src/core/vtk/useVtkInteractionManipulator';\nimport { LPSAxisDir } from '@/src/types/lps';\nimport { watchImmediate } from '@vueuse/core';\nimport { resetCameraToImage } from '@/src/utils/camera';\nimport { usePersistCameraConfig } from '@/src/composables/usePersistCameraConfig';\nimport { Maybe } from '@/src/types';\nimport { VtkViewApi } from '@/src/types/vtk-types';\nimport { VtkViewContext } from '@/src/components/vtk/context';\nimport vtkMouseCameraTrackballRotateManipulator from '@kitware/vtk.js/Interaction/Manipulators/MouseCameraTrackballRotateManipulator';\nimport vtkBoundingBox from '@kitware/vtk.js/Common/DataModel/BoundingBox';\n\ninterface Props {\n  viewId: string;\n  imageId: Maybe<string>;\n  viewDirection: LPSAxisDir;\n  viewUp: LPSAxisDir;\n}\n\nconst props = defineProps<Props>();\nconst {\n  viewId: viewID,\n  imageId: imageID,\n  viewDirection,\n  viewUp,\n} = toRefs(props);\n\nconst vtkContainerRef = ref<HTMLElement>();\n\nconst { disableCameraAutoReset } = storeToRefs(useViewCameraStore());\n\nconst { metadata: imageMetadata } = useImage(imageID);\n\n// use a detached scope so that actors can be removed from\n// the renderer before the renderer is deleted.\nconst scope = effectScope(true);\nconst view = scope.run(() => useVtkView(vtkContainerRef))!;\nonUnmounted(() => {\n  scope.stop();\n});\n\nview.renderer.setBackground(0, 0, 0);\n\n// setup interactor style\nconst { interactorStyle } = useVtkInteractorStyle(\n  vtkInteractorStyleManipulator,\n  view\n);\n\nuseVtkInteractionManipulator(\n  interactorStyle,\n  vtkMouseCameraTrackballPanManipulator,\n  { button: 1, shift: true }\n);\nuseVtkInteractionManipulator(\n  interactorStyle,\n  vtkMouseCameraTrackballPanManipulator,\n  { button: 2 }\n);\nuseVtkInteractionManipulator(\n  interactorStyle,\n  vtkMouseCameraTrackballZoomManipulator,\n  { button: 3, scrollEnabled: true }\n);\nuseVtkInteractionManipulator(\n  interactorStyle,\n  vtkMouseCameraTrackballRotateManipulator,\n  { button: 1 }\n);\n\n// set center of rotation\nwatchEffect(() => {\n  const center = vtkBoundingBox.getCenter(imageMetadata.value.worldBounds);\n  interactorStyle.setCenterOfRotation(...center);\n});\n\nfunction resetCamera() {\n  resetCameraToImage(\n    view,\n    imageMetadata.value,\n    viewDirection.value,\n    viewUp.value\n  );\n}\n\nwatchImmediate([disableCameraAutoReset, viewID, imageID], ([noAutoReset]) => {\n  if (noAutoReset) return;\n  resetCamera();\n});\n\n// persistent camera config\nusePersistCameraConfig(viewID, imageID, view.renderer.getActiveCamera());\n\n// exposed API\nconst api: VtkViewApi = markRaw({\n  ...view,\n  interactorStyle,\n  resetCamera,\n});\n\ndefineExpose(api);\nprovide(VtkViewContext, api);\n</script>\n\n<template>\n  <div ref=\"vtkContainerRef\"><slot></slot></div>\n</template>\n","import { MaybeRef, onScopeDispose, unref, watchEffect } from 'vue';\nimport { vtkObject } from '@kitware/vtk.js/interfaces';\nimport vtkAbstractMapper from '@kitware/vtk.js/Rendering/Core/AbstractMapper';\nimport type {\n  View,\n  VtkObjectConstructor,\n  vtkPropWithMapperProperty,\n} from '@/src/core/vtk/types';\nimport { Maybe } from '@/src/types';\nimport { onVTKEvent } from '@/src/composables/onVTKEvent';\n\nexport interface UseVtkRepresentationParameters<Actor, Mapper> {\n  view: View;\n  data: MaybeRef<Maybe<vtkObject>>;\n  vtkActorClass: VtkObjectConstructor<Actor>;\n  vtkMapperClass: VtkObjectConstructor<Mapper>;\n}\n\nexport function useVtkRepresentation<\n  Actor extends vtkPropWithMapperProperty,\n  Mapper extends vtkAbstractMapper,\n  Property extends ReturnType<Actor['getProperty']>\n>({\n  view,\n  data: dataObject,\n  vtkActorClass,\n  vtkMapperClass,\n}: UseVtkRepresentationParameters<Actor, Mapper>) {\n  const actor = vtkActorClass.newInstance();\n  const mapper = vtkMapperClass.newInstance();\n  const property = actor.getProperty() as Property;\n\n  actor.setMapper(mapper);\n\n  watchEffect((onCleanup) => {\n    const data = unref(dataObject);\n    if (!data) return;\n\n    const { renderer } = view;\n    mapper.setInputData(data, 0);\n    renderer.addActor(actor);\n    view.requestRender();\n\n    onCleanup(() => {\n      renderer.removeActor(actor);\n    });\n  });\n\n  [actor, mapper, property].forEach((obj: vtkObject) => {\n    onVTKEvent(obj, 'onModified', () => {\n      view.requestRender();\n    });\n  });\n\n  onScopeDispose(() => {\n    actor.delete();\n    mapper.delete();\n  });\n\n  return { actor, mapper, property };\n}\n","import { MaybeRef } from 'vue';\nimport vtkImageData from '@kitware/vtk.js/Common/DataModel/ImageData';\nimport vtkImageSlice from '@kitware/vtk.js/Rendering/Core/ImageSlice';\nimport { useVtkRepresentation } from '@/src/core/vtk/useVtkRepresentation';\nimport { Maybe } from '@/src/types';\nimport { View } from '@/src/core/vtk/types';\nimport vtkImageResliceMapper from '@kitware/vtk.js/Rendering/Core/ImageResliceMapper';\nimport { onVTKEvent } from '@/src/composables/onVTKEvent';\nimport { vtkFieldRef } from '@/src/core/vtk/vtkFieldRef';\n\nexport function useResliceRepresentation(\n  view: View,\n  imageData: MaybeRef<Maybe<vtkImageData>>\n) {\n  const sliceRep = useVtkRepresentation({\n    view,\n    data: imageData,\n    vtkActorClass: vtkImageSlice,\n    vtkMapperClass: vtkImageResliceMapper,\n  });\n\n  const plane = vtkFieldRef(sliceRep.mapper, 'slicePlane');\n  onVTKEvent(plane, 'onModified', () => {\n    view.requestRender();\n  });\n\n  return sliceRep;\n}\n","import useWindowingStore from '@/src/store/view-configs/windowing';\nimport { Maybe } from '@/src/types';\nimport type { Vector2 } from '@kitware/vtk.js/types';\nimport { MaybeRef, unref, computed } from 'vue';\n\nexport function useWindowingConfig(\n  viewID: MaybeRef<string>,\n  imageID: MaybeRef<Maybe<string>>\n) {\n  const store = useWindowingStore();\n  const config = computed(() => store.getConfig(unref(viewID), unref(imageID)));\n\n  const generateComputed = (prop: 'width' | 'level') => {\n    return computed({\n      get: () => config.value?.[prop] ?? 0,\n      set: (val) => {\n        const imageIdVal = unref(imageID);\n        if (!imageIdVal || val == null) return;\n        store.updateConfig(unref(viewID), imageIdVal, { [prop]: val });\n      },\n    });\n  };\n\n  const range = computed((): Vector2 => {\n    const { min, max } = config.value ?? {};\n    if (min == null || max == null) return [0, 1];\n    return [min, max];\n  });\n\n  return {\n    config,\n    width: generateComputed('width'),\n    level: generateComputed('level'),\n    range,\n  };\n}\n","<script setup lang=\"ts\">\nimport { toRefs, watchEffect, inject } from 'vue';\nimport { useImage } from '@/src/composables/useCurrentImage';\nimport { useResliceRepresentation } from '@/src/core/vtk/useResliceRepresentation';\nimport { useWindowingConfig } from '@/src/composables/useWindowingConfig';\nimport { Maybe } from '@/src/types';\nimport { VtkViewContext } from '@/src/components/vtk/context';\nimport { SlabTypes } from '@kitware/vtk.js/Rendering/Core/ImageResliceMapper/Constants';\nimport type { Vector3 } from '@kitware/vtk.js/types';\nimport { watchImmediate } from '@vueuse/core';\nimport vtkPlane from '@kitware/vtk.js/Common/DataModel/Plane';\n\ninterface Props {\n  viewId: string;\n  imageId: Maybe<string>;\n  planeNormal: Vector3;\n  planeOrigin: Vector3;\n}\n\nconst props = defineProps<Props>();\nconst {\n  viewId: viewID,\n  imageId: imageID,\n  planeNormal,\n  planeOrigin,\n} = toRefs(props);\n\nconst view = inject(VtkViewContext);\nif (!view) throw new Error('No VtkView');\n\nconst { imageData } = useImage(imageID);\n\n// bind window configs\nconst wlConfig = useWindowingConfig(viewID, imageID);\n\n// setup base image\nconst sliceRep = useResliceRepresentation(view, imageData);\n\n// set slice ordering to be in the back\nsliceRep.mapper.setResolveCoincidentTopologyToPolygonOffset();\nsliceRep.mapper.setResolveCoincidentTopologyPolygonOffsetParameters(1, 1);\n\n// create slicing plane\nconst slicePlane = vtkPlane.newInstance();\nsliceRep.mapper.setSlicePlane(slicePlane);\n\n// initialize visual properties\nsliceRep.mapper.setSlabType(SlabTypes.MAX);\nsliceRep.mapper.setSlabThickness(1);\n\n// set plane normal\nwatchImmediate([planeNormal, planeOrigin], ([normal, origin]) => {\n  const plane = sliceRep.mapper.getSlicePlane();\n  if (!plane) return;\n  plane.setNormal(normal);\n  plane.setOrigin(origin);\n});\n\n// sync windowing\nwatchEffect(() => {\n  sliceRep.property.setColorLevel(wlConfig.level.value);\n  sliceRep.property.setColorWindow(wlConfig.width.value);\n});\n\ndefineExpose(sliceRep);\n</script>\n\n<template>\n  <slot></slot>\n</template>\n","import { VtkObjectConstructor } from '@/src/core/vtk/types';\nimport { vtkFieldRef } from '@/src/core/vtk/vtkFieldRef';\nimport { Maybe } from '@/src/types';\nimport { vtkAlgorithm, vtkObject } from '@kitware/vtk.js/interfaces';\nimport { computedWithControl } from '@vueuse/core';\nimport { ComputedRef, MaybeRef, onScopeDispose, unref, watchEffect } from 'vue';\n\nexport function useVtkFilter<T extends vtkAlgorithm & vtkObject>(\n  filterClass: VtkObjectConstructor<T>,\n  ...inputData: MaybeRef<Maybe<vtkObject>>[]\n) {\n  const filter = filterClass.newInstance();\n  const mtime = vtkFieldRef(filter as vtkObject, 'mTime');\n\n  watchEffect(() => {\n    inputData\n      .map((input) => unref(input))\n      .forEach((input, port) => {\n        if (input) filter.setInputData(unref(input), port);\n      });\n  });\n\n  let cache: Record<number, ComputedRef<any>> = {};\n\n  const getOutputData = <D>(port = 0) => {\n    if (!(port in cache)) {\n      cache[port] = computedWithControl(mtime, () => {\n        if (!filter.getInputData(port)) return null;\n        return filter.getOutputData(port) as D;\n      });\n    }\n    return cache[port] as ComputedRef<D>;\n  };\n\n  onScopeDispose(() => {\n    cache = {};\n    filter.delete();\n  });\n\n  return { filter, getOutputData };\n}\n","<script setup lang=\"ts\">\nimport { VtkViewContext } from '@/src/components/vtk/context';\nimport { useImage } from '@/src/composables/useCurrentImage';\nimport { useVtkFilter } from '@/src/core/vtk/useVtkFilter';\nimport { useVtkRepresentation } from '@/src/core/vtk/useVtkRepresentation';\nimport { vtkFieldRef } from '@/src/core/vtk/vtkFieldRef';\nimport { Maybe } from '@/src/types';\nimport vtkPlane from '@kitware/vtk.js/Common/DataModel/Plane';\nimport vtkPolyData from '@kitware/vtk.js/Common/DataModel/PolyData';\nimport vtkCutter from '@kitware/vtk.js/Filters/Core/Cutter';\nimport vtkImageDataOutlineFilter from '@kitware/vtk.js/Filters/General/ImageDataOutlineFilter';\nimport vtkActor from '@kitware/vtk.js/Rendering/Core/Actor';\nimport vtkMapper from '@kitware/vtk.js/Rendering/Core/Mapper';\nimport type { Vector3 } from '@kitware/vtk.js/types';\nimport { syncRefs, watchImmediate } from '@vueuse/core';\nimport { inject, toRefs, watchEffect } from 'vue';\n\ninterface Props {\n  viewId: string;\n  imageId: Maybe<string>;\n  planeNormal: Vector3;\n  planeOrigin: Vector3;\n  color?: Vector3;\n  thickness?: number;\n}\n\nconst props = withDefaults(defineProps<Props>(), {\n  thickness: 1,\n  color: () => [1, 1, 1] as Vector3,\n});\nconst { imageId, planeNormal, planeOrigin, color, thickness } = toRefs(props);\n\nconst view = inject(VtkViewContext);\nif (!view) throw new Error('No VtkView');\n\n// outline filter\nconst { imageData } = useImage(imageId);\nconst outlineFilter = useVtkFilter(vtkImageDataOutlineFilter, imageData);\nconst outline = outlineFilter.getOutputData<vtkPolyData>(0);\n\n// slicing plane\nconst slicePlane = vtkPlane.newInstance();\nconst cutterFilter = useVtkFilter(vtkCutter, outline);\n(cutterFilter.filter as any).setCutFunction(slicePlane);\n\n// representation\nconst rep = useVtkRepresentation({\n  view,\n  data: cutterFilter.getOutputData(0),\n  vtkActorClass: vtkActor,\n  vtkMapperClass: vtkMapper,\n});\n\n// set representation properties\nwatchEffect(() => {\n  rep.property.setLineWidth(thickness.value);\n  rep.property.setColor(color.value);\n});\n\n// sync input plane to slice plane\nconst slicePlaneNormal = vtkFieldRef(slicePlane, 'normal');\nconst slicePlaneOrigin = vtkFieldRef(slicePlane, 'origin');\nsyncRefs(planeNormal, slicePlaneNormal);\nsyncRefs(planeOrigin, slicePlaneOrigin);\n\n// update filter\nwatchImmediate([slicePlaneNormal, slicePlaneOrigin], () => {\n  cutterFilter.filter.modified();\n});\n\ndefineExpose(rep);\n</script>\n\n<template><slot></slot></template>\n","import { defineStore } from 'pinia';\nimport { ref, shallowRef, triggerRef, computed } from 'vue';\n\nexport interface ViewFilterSpec {\n  byViewType?: string[];\n  byViewIds?: string[];\n}\n\nexport function matchesViewFilter(\n  viewID: string,\n  viewType: string,\n  filterSpec?: ViewFilterSpec\n) {\n  if (!filterSpec) return true;\n  const { byViewType, byViewIds } = filterSpec;\n  if (byViewType && !byViewType.includes(viewType)) return false;\n  if (byViewIds && !byViewIds.includes(viewID)) return false;\n  return true;\n}\n\nfunction mergeArrayFilters(arr1?: string[], arr2?: string[]) {\n  if (!arr1 || !arr2) return undefined;\n  return Array.from(new Set(arr1.concat(arr2)));\n}\n\n/**\n * Merges view filter specs.\n *\n * An undefined filter spec means no filter.\n * @param filterSpecs\n * @returns\n */\nexport function mergeViewFilters(\n  filterSpecs: Array<ViewFilterSpec | undefined>\n) {\n  if (filterSpecs.length === 0) return undefined;\n  return filterSpecs.reduce((result, spec) => {\n    if (result === undefined) return undefined;\n    const byViewIds = mergeArrayFilters(result?.byViewIds, spec?.byViewIds);\n    const byViewType = mergeArrayFilters(result?.byViewType, spec?.byViewType);\n    return { byViewIds, byViewType };\n  }, filterSpecs[0] as ViewFilterSpec | undefined);\n}\n\nconst useViewAnimationStore = defineStore('viewAnimation', () => {\n  const animating = ref(false);\n  const requestors = shallowRef(new Map<any, ViewFilterSpec | undefined>());\n  const viewFilter = computed(() => {\n    return mergeViewFilters(Array.from(requestors.value.values()));\n  });\n\n  const requestAnimation = (requestor: any, filter?: ViewFilterSpec) => {\n    if (requestors.value.has(requestor)) return;\n    requestors.value.set(requestor, filter);\n    animating.value = true;\n    triggerRef(requestors);\n  };\n\n  const cancelAnimation = (requestor: any) => {\n    requestors.value.delete(requestor);\n    if (requestors.value.size === 0) {\n      animating.value = false;\n    }\n    triggerRef(requestors);\n  };\n\n  return {\n    animating,\n    viewFilter,\n    requestAnimation,\n    cancelAnimation,\n  };\n});\n\nexport default useViewAnimationStore;\n","import { View } from '@/src/core/vtk/types';\nimport useViewAnimationStore, {\n  matchesViewFilter,\n} from '@/src/store/view-animation';\nimport { Maybe } from '@/src/types';\nimport { storeToRefs } from 'pinia';\nimport { MaybeRef, computed, unref, watchEffect } from 'vue';\n\nexport function useViewAnimationListener(\n  view: MaybeRef<Maybe<View>>,\n  viewId: MaybeRef<string>,\n  viewType: MaybeRef<string>\n) {\n  const store = useViewAnimationStore();\n  const { animating, viewFilter } = storeToRefs(store);\n  const canAnimate = computed(() =>\n    matchesViewFilter(unref(viewId), unref(viewType), viewFilter.value)\n  );\n\n  let requested = false;\n\n  watchEffect(() => {\n    const viewVal = unref(view);\n    if (!viewVal) return;\n\n    if (!animating.value) {\n      viewVal.interactor.cancelAnimation(store);\n      requested = false;\n    } else if (!requested && canAnimate.value) {\n      viewVal.interactor.requestAnimation(store);\n      requested = true;\n    }\n  });\n}\n","import { useCurrentImage } from '@/src/composables/useCurrentImage';\nimport { ImageMetadata } from '@/src/types/image';\nimport { LPSAxis } from '@/src/types/lps';\nimport { ViewTypes } from '@kitware/vtk.js/Widgets/Core/WidgetManager/Constants';\nimport vtkResliceCursorWidget, {\n  ResliceCursorWidgetState,\n} from '@kitware/vtk.js/Widgets/Widgets3D/ResliceCursorWidget';\nimport type { Vector3 } from '@kitware/vtk.js/types';\nimport { defineStore } from 'pinia';\nimport { toRaw, watchEffect } from 'vue';\n\nexport function mapAxisToViewType(axis: LPSAxis) {\n  switch (axis) {\n    case 'Coronal':\n      return ViewTypes.XZ_PLANE;\n    case 'Sagittal':\n      return ViewTypes.YZ_PLANE;\n    case 'Axial':\n      return ViewTypes.XY_PLANE;\n    default:\n      throw new Error(`Invalid view axis: ${axis}`);\n  }\n}\n\nfunction resetReslicePlanes(\n  resliceCursorState: ResliceCursorWidgetState,\n  imageMetadata: ImageMetadata\n) {\n  const { Inferior, Anterior, Superior, Left } = toRaw(\n    imageMetadata.lpsOrientation\n  );\n  const planes = {\n    [ViewTypes.YZ_PLANE]: {\n      normal: Left as Vector3,\n      viewUp: Superior as Vector3,\n    },\n    [ViewTypes.XZ_PLANE]: {\n      normal: Anterior as Vector3,\n      viewUp: Superior as Vector3,\n    },\n    [ViewTypes.XY_PLANE]: {\n      normal: Inferior as Vector3,\n      viewUp: Anterior as Vector3,\n    },\n  };\n\n  resliceCursorState.setPlanes(planes);\n}\n\nfunction useResliceInit(\n  resliceCursor: vtkResliceCursorWidget,\n  resliceCursorState: ResliceCursorWidgetState\n) {\n  const { currentImageData, currentImageMetadata } = useCurrentImage();\n\n  watchEffect(() => {\n    const image = currentImageData.value;\n    if (!image) return;\n    resliceCursor.setImage(image);\n    // Reset to default plane values before transforming based on current image-data.\n    resetReslicePlanes(resliceCursorState, currentImageMetadata.value);\n  });\n}\n\nconst useResliceCursorStore = defineStore('resliceCursor', () => {\n  const resliceCursor = vtkResliceCursorWidget.newInstance({\n    scaleInPixels: true,\n    rotationHandlePosition: 0.75,\n  }) as vtkResliceCursorWidget;\n\n  const widgetState =\n    resliceCursor.getWidgetState() as ResliceCursorWidgetState;\n\n  useResliceInit(resliceCursor, widgetState);\n\n  return {\n    resliceCursor,\n    resliceCursorState: widgetState,\n    resetReslicePlanes: (imageMetadata: ImageMetadata) => {\n      resetReslicePlanes(widgetState, imageMetadata);\n    },\n  };\n});\n\nexport default useResliceCursorStore;\n","<template>\n  <div class=\"vtk-container-wrapper\" tabindex=\"0\">\n    <div class=\"vtk-gutter\"></div>\n    <div class=\"vtk-container\">\n      <div class=\"vtk-sub-container\">\n        <vtk-volume-view\n          class=\"vtk-view\"\n          ref=\"vtkView\"\n          data-testid=\"vtk-view\"\n          :view-id=\"id\"\n          :image-id=\"currentImageID\"\n          :view-direction=\"viewDirection\"\n          :view-up=\"viewUp\"\n        >\n          <template v-for=\"(sliceProps, idx) in obliqueSliceProps\" :key=\"idx\">\n            <vtk-base-oblique-slice-representation\n              :view-id=\"sliceProps.viewId\"\n              :image-id=\"currentImageID\"\n              :plane-normal=\"sliceProps.planeNormal\"\n              :plane-origin=\"sliceProps.planeOrigin\"\n            ></vtk-base-oblique-slice-representation>\n            <vtk-image-outline-representation\n              :view-id=\"sliceProps.viewId\"\n              :image-id=\"currentImageID\"\n              :plane-normal=\"sliceProps.planeNormal\"\n              :plane-origin=\"sliceProps.planeOrigin\"\n              :thickness=\"4\"\n              :color=\"sliceProps.outlineColor\"\n            ></vtk-image-outline-representation>\n          </template>\n          <slot></slot>\n        </vtk-volume-view>\n      </div>\n    </div>\n  </div>\n</template>\n\n<script setup lang=\"ts\">\nimport { ref, toRefs, computed } from 'vue';\nimport { useCurrentImage } from '@/src/composables/useCurrentImage';\nimport { LPSAxis, LPSAxisDir } from '@/src/types/lps';\nimport VtkVolumeView from '@/src/components/vtk/VtkVolumeView.vue';\nimport { VtkViewApi } from '@/src/types/vtk-types';\nimport { LayoutViewProps } from '@/src/types';\nimport VtkBaseObliqueSliceRepresentation from '@/src/components/vtk/VtkBaseObliqueSliceRepresentation.vue';\nimport VtkImageOutlineRepresentation from '@/src/components/vtk/VtkImageOutlineRepresentation.vue';\nimport { useViewAnimationListener } from '@/src/composables/useViewAnimationListener';\nimport useResliceCursorStore, {\n  mapAxisToViewType,\n} from '@/src/store/reslice-cursor';\nimport { vtkFieldRef } from '@/src/core/vtk/vtkFieldRef';\nimport { useResetViewsEvents } from '@/src/components/tools/ResetViews.vue';\nimport { vec3 } from 'gl-matrix';\nimport { OBLIQUE_OUTLINE_COLORS } from '@/src/constants';\nimport type { RGBColor } from '@kitware/vtk.js/types';\n\ninterface SliceSpec {\n  viewID: string;\n  axis: LPSAxis;\n}\n\ninterface Props extends LayoutViewProps {\n  viewDirection: LPSAxisDir;\n  viewUp: LPSAxisDir;\n  slices: SliceSpec[];\n}\n\nconst vtkView = ref<VtkViewApi>();\n\nconst props = defineProps<Props>();\n\nconst {\n  id: viewId,\n  type: viewType,\n  viewDirection,\n  viewUp,\n  slices,\n} = toRefs(props);\n\nuseViewAnimationListener(vtkView, viewId, viewType);\n\n// base image\nconst { currentImageID } = useCurrentImage();\n\n// reslice cursor\nconst resliceStore = useResliceCursorStore();\nconst { resliceCursor, resliceCursorState } = resliceStore;\n\n// -----\n\nconst resliceCenter = vtkFieldRef(resliceCursorState, 'center');\nconst obliqueSliceProps = computed(() => {\n  return slices.value.map((sliceSpec) => {\n    const planeNormal = resliceCursor.getPlaneNormalFromViewType(\n      mapAxisToViewType(sliceSpec.axis)\n    );\n    const outlineColor = vec3.scale(\n      [0, 0, 0],\n      OBLIQUE_OUTLINE_COLORS[sliceSpec.viewID],\n      1 / 255\n    ) as RGBColor;\n    return {\n      viewId: sliceSpec.viewID,\n      planeNormal,\n      planeOrigin: resliceCenter.value,\n      outlineColor,\n    };\n  });\n});\n\n// reset camera logic\nfunction resetCamera() {\n  if (!vtkView.value) return;\n  vtkView.value.resetCamera();\n  vtkView.value.requestRender();\n}\n\nuseResetViewsEvents().onClick(resetCamera);\n</script>\n\n<style scoped src=\"@/src/components/styles/vtk-view.css\"></style>\n<style scoped src=\"@/src/components/styles/utils.css\"></style>\n","import { vtkFieldRef } from '@/src/core/vtk/vtkFieldRef';\nimport vtkOpenGLRenderWindow from '@kitware/vtk.js/Rendering/OpenGL/RenderWindow';\nimport { whenever } from '@vueuse/core';\nimport { computed, onUnmounted } from 'vue';\n\nfunction isViewMounted(renderWindowView: vtkOpenGLRenderWindow) {\n  const container = vtkFieldRef(renderWindowView, 'container');\n  return computed(() => !!container.value);\n}\n\nexport function onViewMounted(\n  renderWindowView: vtkOpenGLRenderWindow,\n  callback: () => void\n) {\n  const isMounted = isViewMounted(renderWindowView);\n  whenever(isMounted, () => {\n    callback();\n  });\n}\n\nexport function onViewUnmounted(\n  renderWindowView: vtkOpenGLRenderWindow,\n  callback: () => void\n) {\n  const isMounted = isViewMounted(renderWindowView);\n  whenever(\n    computed(() => !isMounted.value),\n    () => {\n      callback();\n    }\n  );\n\n  onUnmounted(() => {\n    callback();\n  });\n}\n","<script setup lang=\"ts\">\nimport { computed, inject, ref, toRefs } from 'vue';\nimport {\n  vtkResliceCursorViewWidget,\n  ResliceCursorWidgetState,\n} from '@kitware/vtk.js/Widgets/Widgets3D/ResliceCursorWidget';\nimport { OBLIQUE_OUTLINE_COLORS } from '@/src/constants';\nimport { getLPSAxisFromDir, getVTKViewTypeFromLPSAxis } from '@/src/utils/lps';\nimport { LPSAxisDir } from '@/src/types/lps';\nimport useResliceCursorStore from '@/src/store/reslice-cursor';\nimport { VtkViewContext } from '@/src/components/vtk/context';\nimport { onViewMounted, onViewUnmounted } from '@/src/core/vtk/onViewMounted';\nimport { InitViewIDs } from '@/src/config';\n\ninterface Props {\n  viewId: string;\n  viewDirection: LPSAxisDir;\n}\n\nconst props = defineProps<Props>();\nconst { viewDirection } = toRefs(props);\nconst viewAxis = computed(() => getLPSAxisFromDir(viewDirection.value));\n\nconst view = inject(VtkViewContext);\nif (!view) throw new Error('No vtk view');\n\nconst resliceCursorStore = useResliceCursorStore();\nconst { resliceCursor, resliceCursorState } = resliceCursorStore;\n\nconst widget = ref<vtkResliceCursorViewWidget>();\nconst vtkViewType = computed(() => getVTKViewTypeFromLPSAxis(viewAxis.value));\n\nonViewMounted(view.renderWindowView, () => {\n  widget.value = view.widgetManager.addWidget(\n    resliceCursor,\n    vtkViewType.value\n  ) as vtkResliceCursorViewWidget;\n\n  widget.value.setKeepOrthogonality(true);\n  // reset mouse cursor styles\n  widget.value.setCursorStyles({\n    translateCenter: 'default',\n    rotateLine: 'default',\n    translateAxis: 'default',\n  });\n\n  resliceCursorState.getStatesWithLabel('sphere').forEach((handle) => {\n    const h = handle as ResliceCursorWidgetState;\n    h.setScale1(10);\n    h.setOpacity(128);\n  });\n\n  resliceCursorState.getStatesWithLabel('line').forEach((handle) => {\n    const h = handle as ResliceCursorWidgetState;\n    h.setScale3(1, 1, 1);\n    h.setOpacity(100);\n  });\n\n  const xLines = [\n    ...resliceCursorState.getStatesWithLabel('XinZ'),\n    ...resliceCursorState.getStatesWithLabel('XinY'),\n  ];\n  xLines.forEach((handle) => {\n    const h = handle as ResliceCursorWidgetState;\n    h.setColor3(OBLIQUE_OUTLINE_COLORS[InitViewIDs.ObliqueSagittal]);\n  });\n\n  const yLines = [\n    ...resliceCursorState.getStatesWithLabel('YinZ'),\n    ...resliceCursorState.getStatesWithLabel('YinX'),\n  ];\n  yLines.forEach((handle) => {\n    const h = handle as ResliceCursorWidgetState;\n    h.setColor3(OBLIQUE_OUTLINE_COLORS[InitViewIDs.ObliqueCoronal]);\n  });\n\n  const zLines = [\n    ...resliceCursorState.getStatesWithLabel('ZinX'),\n    ...resliceCursorState.getStatesWithLabel('ZinY'),\n  ];\n  zLines.forEach((handle) => {\n    const h = handle as ResliceCursorWidgetState;\n    h.setColor3(OBLIQUE_OUTLINE_COLORS[InitViewIDs.ObliqueAxial]);\n  });\n\n  // update representation to not be as 3D\n  widget.value.getRepresentations().forEach((rep) => {\n    rep.getActors().forEach((actor) => {\n      actor.getProperty().setAmbient(1);\n    });\n  });\n\n  view.requestRender();\n});\n\nonViewUnmounted(view.renderWindowView, () => {\n  widget.value = undefined;\n  view.widgetManager.removeWidget(resliceCursor);\n});\n</script>\n\n<template>\n  <div></div>\n</template>\n","import { onPausableVTKEvent } from '@/src/composables/onPausableVTKEvent';\nimport vtkCamera from '@kitware/vtk.js/Rendering/Core/Camera';\nimport { MaybeRef, ref } from 'vue';\n\nexport function useAutoFitState(camera: MaybeRef<vtkCamera>) {\n  const autoFit = ref(true);\n\n  const { withPaused } = onPausableVTKEvent(camera, 'onModified', () => {\n    autoFit.value = false;\n  });\n\n  return { autoFit, withoutAutoFitEffect: withPaused };\n}\n","<script setup lang=\"ts\">\nimport { ref, toRefs, provide, markRaw, effectScope, onUnmounted } from 'vue';\nimport { storeToRefs } from 'pinia';\nimport vtkInteractorStyleManipulator from '@kitware/vtk.js/Interaction/Style/InteractorStyleManipulator';\nimport { useVtkView } from '@/src/core/vtk/useVtkView';\nimport { useImage } from '@/src/composables/useCurrentImage';\nimport { useVtkInteractorStyle } from '@/src/core/vtk/useVtkInteractorStyle';\nimport { LPSAxisDir } from '@/src/types/lps';\nimport { useResizeObserver, watchImmediate } from '@vueuse/core';\nimport { resetCameraToImage, resizeToFitImage } from '@/src/utils/camera';\nimport { usePersistCameraConfig } from '@/src/composables/usePersistCameraConfig';\nimport { useAutoFitState } from '@/src/composables/useAutoFitState';\nimport { Maybe } from '@/src/types';\nimport { VtkViewApi } from '@/src/types/vtk-types';\nimport { VtkViewContext } from '@/src/components/vtk/context';\nimport { useViewCameraStore } from '@/src/store/view-configs/camera';\n\ninterface Props {\n  viewId: string;\n  imageId: Maybe<string>;\n  viewDirection: LPSAxisDir;\n  viewUp: LPSAxisDir;\n  disableAutoResetCamera?: boolean;\n}\n\nconst props = defineProps<Props>();\nconst {\n  viewId: viewID,\n  imageId: imageID,\n  viewDirection,\n  viewUp,\n} = toRefs(props);\n\nconst vtkContainerRef = ref<HTMLElement>();\n\nconst { disableCameraAutoReset } = storeToRefs(useViewCameraStore());\n\nconst { metadata: imageMetadata } = useImage(imageID);\n\n// use a detached scope so that actors can be removed from\n// the renderer before the renderer is deleted.\nconst scope = effectScope(true);\nconst view = scope.run(() => useVtkView(vtkContainerRef))!;\nonUnmounted(() => {\n  scope.stop();\n});\n\nview.renderer.setBackground(0, 0, 0);\nview.renderer.getActiveCamera().setParallelProjection(true);\n\n// setup interactor style\nconst { interactorStyle } = useVtkInteractorStyle(\n  vtkInteractorStyleManipulator,\n  view\n);\n\n// bind slice and window configs\n// resizeToFit camera controls\nconst { autoFit, withoutAutoFitEffect } = useAutoFitState(\n  view.renderer.getActiveCamera()\n);\n\nfunction autoFitImage() {\n  if (!autoFit.value) return;\n  withoutAutoFitEffect(() => {\n    resizeToFitImage(\n      view,\n      imageMetadata.value,\n      viewDirection.value,\n      viewUp.value\n    );\n  });\n}\n\nuseResizeObserver(vtkContainerRef, () => {\n  if (disableCameraAutoReset.value) return;\n  autoFitImage();\n});\n\nfunction resetCamera() {\n  autoFit.value = true;\n  withoutAutoFitEffect(() => {\n    resetCameraToImage(\n      view,\n      imageMetadata.value,\n      viewDirection.value,\n      viewUp.value\n    );\n    autoFitImage();\n  });\n}\n\nwatchImmediate([disableCameraAutoReset, viewID, imageID], ([noAutoReset]) => {\n  if (noAutoReset) return;\n  resetCamera();\n});\n\n// persistent camera config\nusePersistCameraConfig(viewID, imageID, view.renderer.getActiveCamera());\n\n// exposed API\nconst api: VtkViewApi = markRaw({\n  ...view,\n  interactorStyle,\n  resetCamera,\n});\n\ndefineExpose(api);\nprovide(VtkViewContext, api);\n</script>\n\n<template>\n  <div ref=\"vtkContainerRef\"><slot></slot></div>\n</template>\n","import { captureMessage } from '@sentry/vue';\nimport { useEventListener, useThrottleFn } from '@vueuse/core';\nimport { Messages } from '@/src/constants';\nimport { useMessageStore } from '@/src/store/messages';\nimport { View } from '@/src/core/vtk/types';\nimport { vtkFieldRef } from '@/src/core/vtk/vtkFieldRef';\nimport { MaybeRef, computed, unref } from 'vue';\nimport { Maybe } from '@/src/types';\n\nconst THROTTLE_THRESHOLD = 250; // ms\n\n/**\n * Collects relevant context for debugging 3D crashes.\n * @returns\n */\nfunction getVolumeMapperContext(view: View) {\n  const ren = view.renderer;\n  const vol = ren.getVolumes()[0];\n  if (!vol) return null;\n\n  const mapper = vol.getMapper();\n  if (!mapper) return null;\n\n  return mapper.get(\n    'computeNormalFromOpacity',\n    'autoAdjustSampleDistances',\n    'maximumSamplesPerRay',\n    'sampleDistance',\n    'volumetricScatteringBlending'\n  );\n}\n\nexport function useWebGLWatchdog(view: MaybeRef<Maybe<View>>) {\n  const reportError = useThrottleFn(() => {\n    const messageStore = useMessageStore();\n    messageStore.addError(Messages.WebGLLost.title, Messages.WebGLLost.details);\n\n    const contexts: Record<string, any> = {};\n    const viewVal = unref(view);\n    if (viewVal) {\n      contexts.vtk = getVolumeMapperContext(viewVal);\n    }\n\n    captureMessage('WebGL2 context was lost', { contexts });\n  }, THROTTLE_THRESHOLD);\n\n  const renWinView = computed(() => unref(view)?.renderWindowView);\n  const canvas = vtkFieldRef(renWinView, 'canvas');\n  useEventListener(canvas, 'webglcontextlost', reportError);\n}\n","<template>\n  <div :class=\"$style.gridRoot\">\n    <div :class=\"[$style.top, $style.row]\">\n      <div :class=\"[$style.left, $style.cell]\">\n        <slot name=\"top-left\" />\n      </div>\n      <div :class=\"[$style.center, $style.cell]\">\n        <slot name=\"top-center\" />\n      </div>\n      <div :class=\"[$style.right, $style.cell]\">\n        <slot name=\"top-right\" />\n      </div>\n    </div>\n    <div :class=\"[$style.middle, $style.row]\">\n      <div :class=\"[$style.left, $style.cell]\">\n        <slot name=\"middle-left\" />\n      </div>\n      <div :class=\"[$style.center, $style.cell]\">\n        <slot name=\"middle-center\" />\n      </div>\n      <div :class=\"[$style.right, $style.cell]\">\n        <slot name=\"middle-right\" />\n      </div>\n    </div>\n    <div :class=\"[$style.bottom, $style.row]\">\n      <div :class=\"[$style.left, $style.cell]\">\n        <slot name=\"bottom-left\" />\n      </div>\n      <div :class=\"[$style.center, $style.cell]\">\n        <slot name=\"bottom-center\" />\n      </div>\n      <div :class=\"[$style.right, $style.cell]\">\n        <slot name=\"bottom-right\" />\n      </div>\n    </div>\n  </div>\n</template>\n\n<style module>\n.gridRoot {\n  height: 100%;\n  display: flex;\n  flex-direction: column;\n  align-items: stretch;\n}\n\n.row {\n  flex: 1;\n  display: flex;\n  flex-direction: row;\n  align-items: stretch;\n}\n\n.cell {\n  flex: 1;\n}\n\n.top,\n.left {\n  align-items: flex-start;\n}\n\n.center,\n.middle {\n  align-items: center;\n}\n\n.bottom,\n.right {\n  align-items: flex-end;\n}\n\n.left {\n  text-align: left;\n}\n\n.center {\n  text-align: center;\n}\n\n.right {\n  text-align: right;\n}\n</style>\n","import { computed, MaybeRef, ref, unref } from 'vue';\nimport { vec3 } from 'gl-matrix';\nimport type { Vector3 } from '@kitware/vtk.js/types';\nimport { onVTKEvent } from '@/src/composables/onVTKEvent';\nimport { EPSILON } from '@/src/constants';\nimport { View } from '@/src/core/vtk/types';\nimport { vtkFieldRef } from '@/src/core/vtk/vtkFieldRef';\n\nexport function toOrderedLabels(vec: Vector3) {\n  return (\n    vec\n      .map((v, i) => ({ value: v, axis: i }))\n      // remove components close to zero, since we won't show those labels\n      .filter(({ value }) => Math.abs(value) > EPSILON)\n      // sort from largest to smallest component\n      .sort((a, b) => Math.abs(b.value) - Math.abs(a.value))\n      // apply labels\n      .map(({ value, axis }) => (Math.sign(value) === 1 ? 'LPS' : 'RAI')[axis])\n      .join('')\n  );\n}\n\n/**\n * Computes orientation labels for a given view.\n *\n * Labels are with respect to the current camera orientation.\n *\n * vtk.js coordinate coordinate is implied to be LPS, so orientation labels\n * are determined solely from the camera' direction and view-up.\n */\nexport function useOrientationLabels(view: MaybeRef<View>) {\n  const renderer = computed(() => unref(view).renderer);\n  const camera = vtkFieldRef(renderer, 'activeCamera');\n\n  const top = ref('');\n  const left = ref('');\n  const bottom = ref('');\n  const right = ref('');\n\n  function updateAxes() {\n    const vup = camera.value.getViewUp();\n    const vdir = camera.value.getDirectionOfProjection();\n    const vright = [0, 0, 0] as Vector3;\n\n    // vup and vdir should not be parallel for cameras\n    vec3.cross(vright, vdir, vup);\n\n    const vbottom = vup.map((c) => c * -1) as Vector3;\n    const vleft = vright.map((c) => c * -1) as Vector3;\n\n    top.value = toOrderedLabels(vup);\n    right.value = toOrderedLabels(vright);\n    bottom.value = toOrderedLabels(vbottom);\n    left.value = toOrderedLabels(vleft);\n  }\n\n  onVTKEvent(camera, 'onModified', updateAxes);\n  updateAxes();\n\n  return { top, right, bottom, left };\n}\n","<script setup lang=\"ts\">\nimport { useDICOMStore } from '@/src/store/datasets-dicom';\nimport { Maybe } from '@/src/types';\nimport { isDicomImage } from '@/src/utils/dataSelection';\nimport { computed, toRef } from 'vue';\n\ninterface Props {\n  imageId: Maybe<string>;\n}\n\nconst props = defineProps<Props>();\nconst imageId = toRef(props, 'imageId');\n\nconst dicomStore = useDICOMStore();\nconst dicomInfo = computed(() => {\n  const volumeKey = imageId.value;\n  if (volumeKey && isDicomImage(volumeKey)) {\n    const volumeInfo = dicomStore.volumeInfo[volumeKey];\n    const studyKey = dicomStore.volumeStudy[volumeKey];\n    const studyInfo = dicomStore.studyInfo[studyKey];\n    const patientKey = dicomStore.studyPatient[studyKey];\n    const patientInfo = dicomStore.patientInfo[patientKey];\n\n    const patientID = patientInfo.PatientID;\n    const studyID = studyInfo.StudyID;\n    const studyDescription = studyInfo.StudyDescription;\n    const seriesNumber = volumeInfo.SeriesNumber;\n    const seriesDescription = volumeInfo.SeriesDescription;\n\n    return {\n      patientID,\n      studyID,\n      studyDescription,\n      seriesNumber,\n      seriesDescription,\n    };\n  }\n\n  return null;\n});\n</script>\n\n<template>\n  <v-menu\n    open-on-hover\n    location=\"bottom left\"\n    left\n    nudge-left=\"10\"\n    dark\n    v-if=\"dicomInfo !== null\"\n    max-width=\"300px\"\n  >\n    <template v-slot:activator=\"{ props }\">\n      <v-icon\n        v-bind=\"props\"\n        dark\n        size=\"x-large\"\n        class=\"pointer-events-all hover-info\"\n      >\n        mdi-information\n      </v-icon>\n    </template>\n    <v-list class=\"bg-grey-darken-3\">\n      <v-list-item>\n        <v-list-item-title class=\"font-weight-bold\">\n          PATIENT / CASE\n        </v-list-item-title>\n        <v-divider />\n        <v-list-item-title> ID: {{ dicomInfo.patientID }} </v-list-item-title>\n      </v-list-item>\n      <v-list-item>\n        <v-list-item-title class=\"font-weight-bold\"> STUDY </v-list-item-title>\n        <v-divider />\n        <v-list-item-title> ID: {{ dicomInfo.studyID }} </v-list-item-title>\n        <v-list-item-title>\n          {{ dicomInfo.studyDescription }}\n        </v-list-item-title>\n      </v-list-item>\n      <v-list-item>\n        <v-list-item-title class=\"font-weight-bold\"> SERIES </v-list-item-title>\n        <v-divider />\n        <v-list-item-title>\n          Series #: {{ dicomInfo.seriesNumber }}\n        </v-list-item-title>\n        <v-list-item-title>\n          {{ dicomInfo.seriesDescription }}\n        </v-list-item-title>\n      </v-list-item>\n    </v-list>\n  </v-menu>\n</template>\n\n<style scoped src=\"@/src/components/styles/utils.css\"></style>\n<style scoped>\n.hover-info {\n  width: 32px;\n  height: 32px;\n  cursor: pointer;\n}\n</style>\n","<script setup lang=\"ts\">\nimport { inject, toRefs } from 'vue';\nimport ViewOverlayGrid from '@/src/components/ViewOverlayGrid.vue';\nimport { useSliceConfig } from '@/src/composables/useSliceConfig';\nimport { Maybe } from '@/src/types';\nimport { VtkViewContext } from '@/src/components/vtk/context';\nimport { useWindowingConfig } from '@/src/composables/useWindowingConfig';\nimport { useOrientationLabels } from '@/src/composables/useOrientationLabels';\nimport DicomQuickInfoButton from '@/src/components/DicomQuickInfoButton.vue';\n\ninterface Props {\n  viewId: string;\n  imageId: Maybe<string>;\n}\n\nconst props = defineProps<Props>();\nconst { viewId, imageId } = toRefs(props);\n\nconst view = inject(VtkViewContext);\nif (!view) throw new Error('No VtkView');\n\nconst { top: topLabel, left: leftLabel } = useOrientationLabels(view);\n\nconst {\n  config: sliceConfig,\n  slice,\n  range: sliceRange,\n} = useSliceConfig(viewId, imageId);\nconst {\n  config: wlConfig,\n  width: windowWidth,\n  level: windowLevel,\n} = useWindowingConfig(viewId, imageId);\n</script>\n\n<template>\n  <view-overlay-grid class=\"overlay-no-events view-annotations\">\n    <template v-slot:top-center>\n      <div class=\"annotation-cell\">\n        <span>{{ topLabel }}</span>\n      </div>\n    </template>\n    <template v-slot:middle-left>\n      <div class=\"annotation-cell\">\n        <span>{{ leftLabel }}</span>\n      </div>\n    </template>\n    <template v-slot:bottom-left>\n      <div class=\"annotation-cell\">\n        <div v-if=\"sliceConfig\">\n          Slice: {{ slice + 1 }}/{{ sliceRange[1] + 1 }}\n        </div>\n        <div v-if=\"wlConfig\">\n          W/L: {{ windowWidth.toFixed(2) }} / {{ windowLevel.toFixed(2) }}\n        </div>\n      </div>\n    </template>\n    <template v-slot:top-right>\n      <div class=\"annotation-cell\">\n        <dicom-quick-info-button :image-id=\"imageId\"></dicom-quick-info-button>\n      </div>\n    </template>\n  </view-overlay-grid>\n</template>\n\n<style scoped src=\"@/src/components/styles/vtk-view.css\"></style>\n","import { MaybeRef, computed, unref, watch } from 'vue';\nimport type { TypedArray } from '@kitware/vtk.js/types';\nimport vtkDataArray from '@kitware/vtk.js/Common/Core/DataArray';\nimport { watchImmediate } from '@vueuse/core';\nimport { useImage } from '@/src/composables/useCurrentImage';\nimport { useWindowingConfig } from '@/src/composables/useWindowingConfig';\nimport { WLAutoRanges, WL_AUTO_DEFAULT, WL_HIST_BINS } from '@/src/constants';\nimport { getWindowLevels, useDICOMStore } from '@/src/store/datasets-dicom';\nimport useWindowingStore from '@/src/store/view-configs/windowing';\nimport { Maybe } from '@/src/types';\nimport { useResetViewsEvents } from '@/src/components/tools/ResetViews.vue';\nimport { isDicomImage } from '@/src/utils/dataSelection';\n\nfunction useAutoRangeValues(imageID: MaybeRef<Maybe<string>>) {\n  const { imageData } = useImage(imageID);\n\n  const histogram = (\n    data: number[] | TypedArray,\n    dataRange: number[],\n    numberOfBins: number\n  ) => {\n    const [min, max] = dataRange;\n    const width = (max - min + 1) / numberOfBins;\n    const hist = new Array(numberOfBins).fill(0);\n    data.forEach((value) => hist[Math.floor((value - min) / width)]++);\n    return hist;\n  };\n\n  const autoRangeValues = computed(() => {\n    if (!imageData.value) {\n      return {};\n    }\n\n    // Pre-compute the auto-range values\n    const scalarData = imageData.value.getPointData().getScalars();\n    // Assumes all data is one component\n    const { min, max } = vtkDataArray.fastComputeRange(\n      scalarData.getData() as number[],\n      0,\n      1\n    );\n    const hist = histogram(scalarData.getData(), [min, max], WL_HIST_BINS);\n    const cumm = hist.reduce((acc, val, idx) => {\n      const prev = idx !== 0 ? acc[idx - 1] : 0;\n      acc.push(val + prev);\n      return acc;\n    }, []);\n\n    const width = (max - min + 1) / WL_HIST_BINS;\n    return Object.fromEntries(\n      Object.entries(WLAutoRanges).map(([key, value]) => {\n        const startIdx = cumm.findIndex(\n          (v: number) => v >= value * 0.01 * scalarData.getData().length\n        );\n        const endIdx = cumm.findIndex(\n          (v: number) => v >= (1 - value * 0.01) * scalarData.getData().length\n        );\n        const start = Math.max(min, min + width * startIdx);\n        const end = Math.min(max, min + width * endIdx + width);\n        return [key, [start, end]];\n      })\n    );\n  });\n\n  return { autoRangeValues };\n}\n\nexport function useWindowingConfigInitializer(\n  viewID: MaybeRef<string>,\n  imageID: MaybeRef<Maybe<string>>\n) {\n  const { imageData } = useImage(imageID);\n  const dicomStore = useDICOMStore();\n\n  const store = useWindowingStore();\n  const { config: windowConfig } = useWindowingConfig(viewID, imageID);\n  const { autoRangeValues } = useAutoRangeValues(imageID);\n  const autoRange = computed<keyof typeof WLAutoRanges>(\n    () => windowConfig.value?.auto || WL_AUTO_DEFAULT\n  );\n\n  const firstTag = computed(() => {\n    const id = unref(imageID);\n    if (id && isDicomImage(id)) {\n      const volKey = id;\n      const windowLevels = getWindowLevels(dicomStore.volumeInfo[volKey]);\n      if (windowLevels.length) {\n        return windowLevels[0];\n      }\n    }\n    return undefined;\n  });\n\n  watchImmediate(windowConfig, (config) => {\n    const image = imageData.value;\n    const imageIdVal = unref(imageID);\n    const viewIdVal = unref(viewID);\n    if (config || !image || !imageIdVal) return;\n\n    const [min, max] = image.getPointData().getScalars().getRange();\n    store.updateConfig(viewIdVal, imageIdVal, { min, max });\n    store.resetWindowLevel(viewIdVal, imageIdVal);\n  });\n\n  watchImmediate(imageData, (image) => {\n    const imageIdVal = unref(imageID);\n    const config = unref(windowConfig);\n    const viewIdVal = unref(viewID);\n    if (imageIdVal == null || config != null || !image) {\n      return;\n    }\n\n    const [min, max] = autoRangeValues.value[autoRange.value];\n    store.updateConfig(viewIdVal, imageIdVal, {\n      min,\n      max,\n    });\n    const firstTagVal = unref(firstTag);\n    if (firstTagVal?.width) {\n      store.updateConfig(viewIdVal, imageIdVal, {\n        preset: {\n          width: firstTagVal.width,\n          level: firstTagVal.level,\n        },\n      });\n    }\n    const forcedWL = store.runtimeConfigWindowLevel;\n    if (forcedWL) {\n      store.updateConfig(viewIdVal, imageIdVal, {\n        preset: {\n          ...forcedWL,\n        },\n      });\n    }\n    store.resetWindowLevel(viewIdVal, imageIdVal);\n  });\n\n  watch(autoRange, (percentile) => {\n    const image = imageData.value;\n    const imageIdVal = unref(imageID);\n    const viewIdVal = unref(viewID);\n    if (imageIdVal == null || windowConfig.value == null || !image) {\n      return;\n    }\n    const range = autoRangeValues.value[percentile];\n    store.updateConfig(viewIdVal, imageIdVal, {\n      min: range[0],\n      max: range[1],\n    });\n    store.resetWindowLevel(viewIdVal, imageIdVal);\n  });\n\n  useResetViewsEvents().onClick(() => {\n    const imageIdVal = unref(imageID);\n    const viewIdVal = unref(viewID);\n    if (imageIdVal == null || windowConfig.value == null) {\n      return;\n    }\n    store.resetWindowLevel(viewIdVal, imageIdVal);\n  });\n}\n","import { Maybe } from '@/src/types';\nimport { watchCompare } from '@/src/utils/watchCompare';\nimport vtkMouseRangeManipulator from '@kitware/vtk.js/Interaction/Manipulators/MouseRangeManipulator';\nimport { capitalize } from '@kitware/vtk.js/macros';\nimport { MaybeRef, ref, toRef, unref } from 'vue';\nimport deepEqual from 'fast-deep-equal';\n\ntype ListenerType = 'vertical' | 'horizontal' | 'scroll';\n\nconst DEFAULT_STEP = 1;\n\nexport function useMouseRangeManipulatorListener(\n  manipulator: MaybeRef<Maybe<vtkMouseRangeManipulator>>,\n  type: ListenerType,\n  range: MaybeRef<Maybe<[number, number]>>,\n  step: MaybeRef<Maybe<number>>,\n  initialValue?: number\n) {\n  const internalValue = ref(initialValue ?? 0);\n\n  watchCompare(\n    [toRef(range), toRef(step), toRef(manipulator)],\n    ([newRange, , manip], _, onCleanup) => {\n      if (!newRange || !manip) return;\n\n      const setterName = `set${\n        capitalize(type) as Capitalize<ListenerType>\n      }Listener` as const;\n      const removerName = `remove${\n        capitalize(type) as Capitalize<ListenerType>\n      }Listener` as const;\n\n      manip[setterName](\n        newRange[0],\n        newRange[1],\n        unref(step) ?? DEFAULT_STEP,\n        () => internalValue.value,\n        (val) => {\n          internalValue.value = val;\n        }\n      );\n\n      onCleanup(() => {\n        manip[removerName]();\n      });\n    },\n    {\n      immediate: true,\n      compare: deepEqual,\n    }\n  );\n\n  return internalValue;\n}\n","<script setup lang=\"ts\">\nimport { VtkViewContext } from '@/src/components/vtk/context';\nimport { useWindowingConfig } from '@/src/composables/useWindowingConfig';\nimport { useWindowingConfigInitializer } from '@/src/composables/useWindowingConfigInitializer';\nimport { useMouseRangeManipulatorListener } from '@/src/core/vtk/useMouseRangeManipulatorListener';\nimport { useVtkInteractionManipulator } from '@/src/core/vtk/useVtkInteractionManipulator';\nimport { Maybe } from '@/src/types';\nimport vtkMouseRangeManipulator, {\n  IMouseRangeManipulatorInitialValues,\n} from '@kitware/vtk.js/Interaction/Manipulators/MouseRangeManipulator';\nimport vtkInteractorStyleManipulator from '@kitware/vtk.js/Interaction/Style/InteractorStyleManipulator';\nimport type { Vector2 } from '@kitware/vtk.js/types';\nimport { syncRef } from '@vueuse/core';\nimport { inject, toRefs, computed } from 'vue';\n\ninterface Props {\n  viewId: string;\n  imageId: Maybe<string>;\n  manipulatorConfig?: IMouseRangeManipulatorInitialValues;\n}\n\nconst props = defineProps<Props>();\nconst { viewId, imageId, manipulatorConfig } = toRefs(props);\n\nconst view = inject(VtkViewContext);\nif (!view) throw new Error('No VtkView');\n\nconst interactorStyle =\n  view.interactorStyle as Maybe<vtkInteractorStyleManipulator>;\nif (!interactorStyle?.isA('vtkInteractorStyleManipulator')) {\n  throw new Error('No vtkInteractorStyleManipulator');\n}\n\nconst config = computed(() => {\n  return {\n    button: 1,\n    dragEnabled: true,\n    scrollEnabled: false,\n    ...manipulatorConfig?.value,\n  };\n});\n\nconst { instance: rangeManipulator } = useVtkInteractionManipulator(\n  interactorStyle,\n  vtkMouseRangeManipulator,\n  config\n);\n\nconst wlConfig = useWindowingConfig(viewId, imageId);\nuseWindowingConfigInitializer(viewId, imageId);\n\nconst computeStep = (range: Vector2) => {\n  return Math.min(range[1] - range[0], 1) / 256;\n};\nconst wlStep = computed(() => computeStep(wlConfig.range.value));\n\nconst horiz = useMouseRangeManipulatorListener(\n  rangeManipulator,\n  'horizontal',\n  wlConfig.range,\n  wlStep,\n  wlConfig.level.value\n);\n\nconst vert = useMouseRangeManipulatorListener(\n  rangeManipulator,\n  'vertical',\n  computed(() => [1e-12, wlConfig.range.value[1] - wlConfig.range.value[0]]),\n  wlStep,\n  wlConfig.width.value\n);\n\nsyncRef(horiz, wlConfig.level, { immediate: true });\nsyncRef(vert, wlConfig.width, { immediate: true });\n</script>\n\n<template><slot></slot></template>\n","<script setup lang=\"ts\">\nimport vtkCompositeMouseManipulator, {\n  type ICompositeMouseManipulatorInitialValues,\n} from '@kitware/vtk.js/Interaction/Manipulators/CompositeMouseManipulator';\nimport { useVtkInteractionManipulator } from '@/src/core/vtk/useVtkInteractionManipulator';\nimport { toRefs, inject, computed } from 'vue';\nimport { VtkViewContext } from '@/src/components/vtk/context';\nimport vtkInteractorStyleManipulator from '@kitware/vtk.js/Interaction/Style/InteractorStyleManipulator';\nimport type { Maybe } from '@/src/types';\nimport type { VtkObjectConstructor } from '@/src/core/vtk/types';\n\ninterface Props {\n  manipulatorConstructor: VtkObjectConstructor<vtkCompositeMouseManipulator>;\n  manipulatorProps?: ICompositeMouseManipulatorInitialValues;\n}\n\nconst props = defineProps<Props>();\nconst { manipulatorConstructor, manipulatorProps } = toRefs(props);\n\nconst view = inject(VtkViewContext);\nif (!view) throw new Error('No VtkView');\n\nconst interactorStyle =\n  view.interactorStyle as Maybe<vtkInteractorStyleManipulator>;\nif (!interactorStyle?.isA('vtkInteractorStyleManipulator')) {\n  throw new Error('No vtkInteractorStyleManipulator');\n}\n\nconst draggableManipulatorProps = computed(() => ({\n  dragEnabled: true,\n  ...manipulatorProps?.value,\n}));\n\nconst { instance } = useVtkInteractionManipulator(\n  interactorStyle,\n  manipulatorConstructor,\n  draggableManipulatorProps\n);\n\ndefineExpose({\n  manipulator: instance,\n});\n</script>\n\n<template><slot></slot></template>\n","<template>\n  <div class=\"vtk-container-wrapper\" tabindex=\"0\">\n    <div class=\"vtk-gutter\"></div>\n    <div class=\"vtk-container\">\n      <div class=\"vtk-sub-container\">\n        <vtk-slice-view\n          class=\"vtk-view\"\n          ref=\"vtkView\"\n          data-testid=\"vtk-view\"\n          :view-id=\"id\"\n          :image-id=\"currentImageID\"\n          :view-direction=\"viewDirection\"\n          :view-up=\"viewUp\"\n          :slice-range=\"sliceDomain\"\n        >\n          <vtk-mouse-interaction-manipulator\n            v-if=\"currentTool === Tools.Pan\"\n            :manipulator-constructor=\"vtkMouseCameraTrackballPanManipulator\"\n            :manipulator-props=\"{ button: 1 }\"\n          ></vtk-mouse-interaction-manipulator>\n          <vtk-mouse-interaction-manipulator\n            :manipulator-constructor=\"vtkMouseCameraTrackballPanManipulator\"\n            :manipulator-props=\"{ button: 1, shift: true }\"\n          ></vtk-mouse-interaction-manipulator>\n          <vtk-mouse-interaction-manipulator\n            v-if=\"currentTool === Tools.Zoom\"\n            :manipulator-constructor=\"\n              vtkMouseCameraTrackballZoomToMouseManipulator\n            \"\n            :manipulator-props=\"{ button: 1 }\"\n          ></vtk-mouse-interaction-manipulator>\n          <vtk-mouse-interaction-manipulator\n            :manipulator-constructor=\"\n              vtkMouseCameraTrackballZoomToMouseManipulator\n            \"\n            :manipulator-props=\"{ button: 3 }\"\n          ></vtk-mouse-interaction-manipulator>\n          <vtk-slice-view-window-manipulator\n            :view-id=\"id\"\n            :image-id=\"currentImageID\"\n            :manipulator-config=\"windowingManipulatorProps\"\n          ></vtk-slice-view-window-manipulator>\n          <slice-viewer-overlay\n            :view-id=\"id\"\n            :image-id=\"currentImageID\"\n          ></slice-viewer-overlay>\n          <vtk-base-oblique-slice-representation\n            :view-id=\"id\"\n            :image-id=\"currentImageID\"\n            :plane-normal=\"planeNormal\"\n            :plane-origin=\"planeOrigin\"\n          ></vtk-base-oblique-slice-representation>\n          <vtk-image-outline-representation\n            :view-id=\"id\"\n            :image-id=\"currentImageID\"\n            :plane-normal=\"planeNormal\"\n            :plane-origin=\"planeOrigin\"\n            :thickness=\"4\"\n            :color=\"outlineColor\"\n          ></vtk-image-outline-representation>\n          <reslice-cursor-tool\n            :view-id=\"id\"\n            :view-direction=\"viewDirection\"\n          ></reslice-cursor-tool>\n          <slot></slot>\n        </vtk-slice-view>\n      </div>\n    </div>\n  </div>\n</template>\n\n<script setup lang=\"ts\">\nimport { useResetViewsEvents } from '@/src/components/tools/ResetViews.vue';\nimport ResliceCursorTool from '@/src/components/tools/ResliceCursorTool.vue';\nimport VtkBaseObliqueSliceRepresentation from '@/src/components/vtk/VtkBaseObliqueSliceRepresentation.vue';\nimport VtkImageOutlineRepresentation from '@/src/components/vtk/VtkImageOutlineRepresentation.vue';\nimport VtkSliceView from '@/src/components/vtk/VtkSliceView.vue';\nimport { onVTKEvent } from '@/src/composables/onVTKEvent';\nimport { useCurrentImage } from '@/src/composables/useCurrentImage';\nimport { useViewAnimationListener } from '@/src/composables/useViewAnimationListener';\nimport { useWebGLWatchdog } from '@/src/composables/useWebGLWatchdog';\nimport { OBLIQUE_OUTLINE_COLORS } from '@/src/constants';\nimport { vtkFieldRef } from '@/src/core/vtk/vtkFieldRef';\nimport useResliceCursorStore, {\n  mapAxisToViewType,\n} from '@/src/store/reslice-cursor';\nimport { LayoutViewProps } from '@/src/types';\nimport { LPSAxisDir } from '@/src/types/lps';\nimport { VtkViewApi } from '@/src/types/vtk-types';\nimport { batchForNextTask } from '@/src/utils/batchForNextTask';\nimport { getLPSAxisFromDir } from '@/src/utils/lps';\nimport vtkMatrixBuilder from '@kitware/vtk.js/Common/Core/MatrixBuilder';\nimport vtkBoundingBox from '@kitware/vtk.js/Common/DataModel/BoundingBox';\nimport type { RGBColor } from '@kitware/vtk.js/types';\nimport { watchImmediate } from '@vueuse/core';\nimport { vec3 } from 'gl-matrix';\nimport { computed, ref, toRefs, watchEffect } from 'vue';\nimport SliceViewerOverlay from '@/src/components/SliceViewerOverlay.vue';\nimport VtkSliceViewWindowManipulator from '@/src/components/vtk/VtkSliceViewWindowManipulator.vue';\nimport VtkMouseInteractionManipulator from '@/src/components/vtk/VtkMouseInteractionManipulator.vue';\nimport vtkMouseCameraTrackballPanManipulator from '@kitware/vtk.js/Interaction/Manipulators/MouseCameraTrackballPanManipulator';\nimport vtkMouseCameraTrackballZoomToMouseManipulator from '@kitware/vtk.js/Interaction/Manipulators/MouseCameraTrackballZoomToMouseManipulator';\nimport { storeToRefs } from 'pinia';\nimport { useToolStore } from '@/src/store/tools';\nimport { Tools } from '@/src/store/tools/types';\n\ninterface Props extends LayoutViewProps {\n  viewDirection: LPSAxisDir;\n  viewUp: LPSAxisDir;\n}\n\nconst vtkView = ref<VtkViewApi>();\n\nconst props = defineProps<Props>();\n\nconst { id: viewId, type: viewType, viewDirection, viewUp } = toRefs(props);\nconst viewAxis = computed(() => getLPSAxisFromDir(viewDirection.value));\n\nuseWebGLWatchdog(vtkView);\nuseViewAnimationListener(vtkView, viewId, viewType);\n\n// active tool\nconst { currentTool } = storeToRefs(useToolStore());\nconst windowingManipulatorProps = computed(() =>\n  currentTool.value === Tools.WindowLevel ? { button: 1 } : { button: -1 }\n);\n\n// base image\nconst { currentImageID, currentImageData, currentImageMetadata } =\n  useCurrentImage();\n\n// reslice cursor\nconst resliceStore = useResliceCursorStore();\nconst { resliceCursor, resliceCursorState } = resliceStore;\n\nconst widgetViewType = computed(() => mapAxisToViewType(viewAxis.value));\n\nwatchEffect(() => {\n  if (currentImageData.value) {\n    resliceCursor.setImage(currentImageData.value);\n  }\n});\n\n// setup plane origin/normal\nconst planeOrigin = vtkFieldRef(resliceCursorState, {\n  get: () => resliceCursorState.getCenter(),\n  set: (v) => resliceCursor.setCenter(v),\n});\nconst planes = vtkFieldRef(resliceCursorState, 'planes');\nconst planeNormal = computed(() => planes.value[widgetViewType.value].normal);\n\n// slicing domain/range\n\n// Function to compute float range of slicing for oblique slicing.\n// Range is calculated as distance along the plane normal (as originating from {0,0,0} ).\nfunction slicePlaneRange(\n  cornerPoints: number[][],\n  sliceNormal: number[]\n): [number, number] {\n  if (!cornerPoints || !sliceNormal) return [0, 1];\n\n  // Get rotation matrix from normal to +X (since bounds is aligned to XYZ)\n  const transform = vtkMatrixBuilder\n    .buildFromDegree()\n    .identity()\n    .rotateFromDirections(sliceNormal, [1, 0, 0]);\n\n  const corners = cornerPoints.map((x) => x.slice());\n  corners.forEach((pt) => transform.apply(pt));\n\n  // range is now maximum X distance\n  let minX = Infinity;\n  let maxX = -Infinity;\n  for (let i = 0; i < 8; i++) {\n    const x = corners[i][0];\n    if (x > maxX) {\n      maxX = x;\n    }\n    if (x < minX) {\n      minX = x;\n    }\n  }\n\n  return [minX, maxX];\n}\n\nconst imageCorners = computed(() => {\n  const image = currentImageData.value;\n  const [xmin, xmax, ymin, ymax, zmin, zmax] = image?.getExtent() ?? [\n    0, 1, 0, 1, 0, 1,\n  ];\n  const corners = [\n    [xmin, ymin, zmin],\n    [xmax, ymin, zmin],\n    [xmin, ymax, zmin],\n    [xmax, ymax, zmin],\n    [xmin, ymin, zmax],\n    [xmax, ymin, zmax],\n    [xmin, ymax, zmax],\n    [xmax, ymax, zmax],\n  ];\n  corners.forEach((p) => image?.indexToWorld(p as vec3, p as vec3));\n  return corners;\n});\n\nconst sliceDomain = computed(() => {\n  const [...sliceNormal] = planeNormal.value;\n  const range = slicePlaneRange(imageCorners?.value, sliceNormal);\n  return {\n    min: range[0],\n    max: range[1],\n  };\n});\n\n// the core update camera function\nconst updateResliceCamera = (resetFocalPoint: boolean) => {\n  if (!vtkView.value || !resliceCursorState.getImage()) return;\n  resliceCursor.updateCameraPoints(\n    vtkView.value.renderer,\n    widgetViewType.value,\n    resetFocalPoint,\n    false,\n    true\n  );\n};\n\n// reset camera logic\nfunction resetCamera() {\n  if (!vtkView.value) return;\n\n  const metadata = currentImageMetadata.value;\n  resliceStore.resetReslicePlanes(metadata);\n\n  const { worldBounds } = metadata;\n  planeOrigin.value = vtkBoundingBox.getCenter(worldBounds);\n  resliceCursorState.placeWidget(worldBounds);\n\n  vtkView.value.resetCamera();\n  updateResliceCamera(false);\n\n  vtkView.value.requestRender();\n}\n\nuseResetViewsEvents().onClick(resetCamera);\n\n// update the camera\nonVTKEvent(\n  resliceCursorState,\n  'onModified',\n  batchForNextTask(() => {\n    updateResliceCamera(false);\n  })\n);\n\nwatchImmediate(currentImageID, () => {\n  updateResliceCamera(true);\n});\n\n// slicing plane colors\nconst outlineColor = computed(\n  () =>\n    vec3.scale(\n      [0, 0, 0],\n      OBLIQUE_OUTLINE_COLORS[viewId.value],\n      1 / 255\n    ) as RGBColor\n);\n</script>\n\n<style scoped src=\"@/src/components/styles/vtk-view.css\"></style>\n<style scoped src=\"@/src/components/styles/utils.css\"></style>\n","import { MaybeRef } from 'vue';\nimport vtkImageData from '@kitware/vtk.js/Common/DataModel/ImageData';\nimport vtkImageMapper from '@kitware/vtk.js/Rendering/Core/ImageMapper';\nimport vtkImageSlice from '@kitware/vtk.js/Rendering/Core/ImageSlice';\nimport { useVtkRepresentation } from '@/src/core/vtk/useVtkRepresentation';\nimport { Maybe } from '@/src/types';\nimport { View } from '@/src/core/vtk/types';\n\nexport function useSliceRepresentation(\n  view: View,\n  imageData: MaybeRef<Maybe<vtkImageData>>\n) {\n  const sliceRep = useVtkRepresentation({\n    view,\n    data: imageData,\n    vtkActorClass: vtkImageSlice,\n    vtkMapperClass: vtkImageMapper,\n  });\n\n  return sliceRep;\n}\n","<script setup lang=\"ts\">\nimport { toRefs, watchEffect, inject } from 'vue';\nimport { useImage } from '@/src/composables/useCurrentImage';\nimport { useSliceRepresentation } from '@/src/core/vtk/useSliceRepresentation';\nimport { useSliceConfig } from '@/src/composables/useSliceConfig';\nimport { useWindowingConfig } from '@/src/composables/useWindowingConfig';\nimport { LPSAxis } from '@/src/types/lps';\nimport { syncRefs } from '@vueuse/core';\nimport { vtkFieldRef } from '@/src/core/vtk/vtkFieldRef';\nimport { SlicingMode } from '@kitware/vtk.js/Rendering/Core/ImageMapper/Constants';\nimport { Maybe } from '@/src/types';\nimport { VtkViewContext } from '@/src/components/vtk/context';\n\ninterface Props {\n  viewId: string;\n  imageId: Maybe<string>;\n  axis: LPSAxis;\n}\n\nconst props = defineProps<Props>();\nconst { viewId: viewID, imageId: imageID, axis } = toRefs(props);\n\nconst view = inject(VtkViewContext);\nif (!view) throw new Error('No VtkView');\n\nconst { metadata: imageMetadata, imageData } = useImage(imageID);\n\n// bind slice and window configs\nconst sliceConfig = useSliceConfig(viewID, imageID);\nconst wlConfig = useWindowingConfig(viewID, imageID);\n\n// setup base image\nconst sliceRep = useSliceRepresentation(view, imageData);\n\n// set slice ordering to be in the back\nsliceRep.mapper.setResolveCoincidentTopologyToPolygonOffset();\nsliceRep.mapper.setResolveCoincidentTopologyPolygonOffsetParameters(1, 1);\n\n// set slicing mode\nwatchEffect(() => {\n  const { lpsOrientation } = imageMetadata.value;\n  const ijkIndex = lpsOrientation[axis.value];\n  const mode = [SlicingMode.I, SlicingMode.J, SlicingMode.K][ijkIndex];\n  sliceRep.mapper.setSlicingMode(mode);\n});\n\n// sync slicing\nconst slice = vtkFieldRef(sliceRep.mapper, 'slice');\nsyncRefs(sliceConfig.slice, slice, { immediate: true });\n\n// sync windowing\nconst colorLevel = vtkFieldRef(sliceRep.property, 'colorLevel');\nconst colorWindow = vtkFieldRef(sliceRep.property, 'colorWindow');\nsyncRefs(wlConfig.level, colorLevel, { immediate: true });\nsyncRefs(wlConfig.width, colorWindow, { immediate: true });\n\ndefineExpose(sliceRep);\n</script>\n\n<template>\n  <slot></slot>\n</template>\n","import { reactive, computed, unref, MaybeRef } from 'vue';\nimport { defineStore } from 'pinia';\n\nimport {\n  DoubleKeyRecord,\n  deleteSecondKey,\n  getDoubleKeyRecord,\n  patchDoubleKeyRecord,\n} from '@/src/utils/doubleKeyRecord';\nimport { Maybe } from '@/src/types';\n\nimport { createViewConfigSerializer } from './common';\nimport { ViewConfig } from '../../io/state-file/schema';\nimport { SegmentGroupConfig } from './types';\n\ntype Config = SegmentGroupConfig;\nconst CONFIG_NAME = 'segmentGroup';\n\nexport const defaultConfig = () => ({\n  outlineOpacity: 1.0,\n  outlineThickness: 2,\n});\n\nexport const useSegmentGroupConfigStore = defineStore(\n  `${CONFIG_NAME}Config`,\n  () => {\n    const configs = reactive<DoubleKeyRecord<Config>>({});\n\n    const getConfig = (viewID: Maybe<string>, dataID: Maybe<string>) =>\n      getDoubleKeyRecord(configs, viewID, dataID);\n\n    const updateConfig = (\n      viewID: string,\n      dataID: string,\n      patch: Partial<Config>\n    ) => {\n      const config = {\n        ...defaultConfig(),\n        ...getConfig(viewID, dataID),\n        ...patch,\n      };\n\n      patchDoubleKeyRecord(configs, viewID, dataID, config);\n    };\n\n    const initConfig = (viewID: string, dataID: string) =>\n      updateConfig(viewID, dataID, defaultConfig());\n\n    const removeView = (viewID: string) => {\n      delete configs[viewID];\n    };\n\n    const removeData = (dataID: string, viewID?: string) => {\n      if (viewID) {\n        delete configs[viewID]?.[dataID];\n      } else {\n        deleteSecondKey(configs, dataID);\n      }\n    };\n\n    const serialize = createViewConfigSerializer(configs, CONFIG_NAME);\n\n    const deserialize = (\n      viewID: string,\n      config: Record<string, ViewConfig>\n    ) => {\n      Object.entries(config).forEach(([dataID, viewConfig]) => {\n        if (viewConfig.segmentGroup) {\n          updateConfig(viewID, dataID, viewConfig.segmentGroup);\n        }\n      });\n    };\n\n    // For updating all configs together //\n\n    const aConfig = computed(() => {\n      const viewIDs = Object.keys(configs);\n      if (viewIDs.length === 0) return null;\n      const firstViewID = viewIDs[0];\n      const dataIDs = Object.keys(configs[firstViewID]);\n      if (dataIDs.length === 0) return null;\n      const firstDataID = dataIDs[0];\n      return configs[firstViewID][firstDataID];\n    });\n\n    const updateAllConfigs = (dataID: string, patch: Partial<Config>) => {\n      Object.keys(configs).forEach((viewID) => {\n        updateConfig(viewID, dataID, patch);\n      });\n    };\n\n    return {\n      configs,\n      getConfig,\n      initConfig,\n      updateConfig,\n      removeView,\n      removeData,\n      serialize,\n      deserialize,\n      aConfig,\n      updateAllConfigs,\n    };\n  }\n);\n\nexport const useGlobalSegmentGroupConfig = (dataId: MaybeRef<string>) => {\n  const store = useSegmentGroupConfigStore();\n\n  const views = computed(() => Object.keys(store.configs));\n\n  const configs = computed(() =>\n    views.value.map((viewID) => ({\n      config: store.getConfig(viewID, unref(dataId)),\n      viewID,\n    }))\n  );\n\n  // get any one\n  const config = computed(() => configs.value.find(({ config: c }) => c));\n\n  // update all configs\n  const updateConfig = (patch: Partial<Config>) => {\n    configs.value.forEach(({ viewID }) =>\n      store.updateConfig(viewID, unref(dataId), patch)\n    );\n  };\n\n  return { config, updateConfig };\n};\n","import { watchImmediate } from '@vueuse/core';\nimport { MaybeRef, computed, unref } from 'vue';\nimport useLayerColoringStore from '@/src/store/view-configs/layers';\nimport { useSegmentGroupConfigStore } from '@/src/store/view-configs/segmentGroups';\n\nfunction useLayerConfigInitializerForSegmentGroups(\n  viewId: MaybeRef<string>,\n  layerId: MaybeRef<string>\n) {\n  const coloringStore = useLayerColoringStore();\n  const colorConfig = computed(() =>\n    coloringStore.getConfig(unref(viewId), unref(layerId))\n  );\n\n  watchImmediate(colorConfig, (config) => {\n    if (config) return;\n\n    const viewIdVal = unref(viewId);\n    const layerIdVal = unref(layerId);\n    coloringStore.initConfig(viewIdVal, layerIdVal); // initConfig instead of resetColorPreset for layers\n    coloringStore.updateBlendConfig(viewIdVal, layerIdVal, {\n      opacity: 0.3,\n    });\n  });\n}\n\nexport function useSegmentGroupConfigInitializer(\n  viewId: MaybeRef<string>,\n  segmentGroupId: MaybeRef<string>\n) {\n  useLayerConfigInitializerForSegmentGroups(viewId, segmentGroupId);\n\n  const configStore = useSegmentGroupConfigStore();\n  const config = computed(() =>\n    configStore.getConfig(unref(viewId), unref(segmentGroupId))\n  );\n\n  watchImmediate(config, (config_) => {\n    if (config_) return;\n    const viewIdVal = unref(viewId);\n    const layerIdVal = unref(segmentGroupId);\n    configStore.initConfig(viewIdVal, layerIdVal);\n  });\n}\n","<script setup lang=\"ts\">\nimport { toRefs, watchEffect, inject, computed, unref } from 'vue';\nimport { useImage } from '@/src/composables/useCurrentImage';\nimport { useSliceRepresentation } from '@/src/core/vtk/useSliceRepresentation';\nimport { LPSAxis } from '@/src/types/lps';\nimport { onVTKEvent } from '@/src/composables/onVTKEvent';\nimport { SlicingMode } from '@kitware/vtk.js/Rendering/Core/ImageMapper/Constants';\nimport { VtkViewContext } from '@/src/components/vtk/context';\nimport {\n  useSegmentGroupStore,\n  SegmentGroupMetadata,\n} from '@/src/store/segmentGroups';\nimport { InterpolationType } from '@kitware/vtk.js/Rendering/Core/ImageProperty/Constants';\nimport vtkColorTransferFunction from '@kitware/vtk.js/Rendering/Core/ColorTransferFunction';\nimport vtkPiecewiseFunction from '@kitware/vtk.js/Common/DataModel/PiecewiseFunction';\nimport { vtkFieldRef } from '@/src/core/vtk/vtkFieldRef';\nimport { syncRef } from '@vueuse/core';\nimport { useSliceConfig } from '@/src/composables/useSliceConfig';\nimport useLayerColoringStore from '@/src/store/view-configs/layers';\nimport { useSegmentGroupConfigStore } from '@/src/store/view-configs/segmentGroups';\nimport { useSegmentGroupConfigInitializer } from '@/src/composables/useSegmentGroupConfigInitializer';\n\ninterface Props {\n  viewId: string;\n  segmentationId: string;\n  axis: LPSAxis;\n}\n\nconst props = defineProps<Props>();\nconst { viewId, segmentationId, axis } = toRefs(props);\n\nconst view = inject(VtkViewContext);\nif (!view) throw new Error('No VtkView');\n\nconst segmentationStore = useSegmentGroupStore();\nconst metadata = computed<SegmentGroupMetadata | undefined>(\n  () => segmentationStore.metadataByID[segmentationId.value]\n);\nconst imageData = computed(\n  () => segmentationStore.dataIndex[segmentationId.value]\n);\n\n// redraw whenever the image changes\nonVTKEvent(imageData, 'onModified', () => {\n  view.requestRender();\n});\n\n// setup slice rep\nconst sliceRep = useSliceRepresentation(view, imageData);\n\nsliceRep.property.setRGBTransferFunction(\n  0,\n  vtkColorTransferFunction.newInstance()\n);\nsliceRep.property.setScalarOpacity(0, vtkPiecewiseFunction.newInstance());\nsliceRep.property.setInterpolationType(InterpolationType.NEAREST);\n// needed for vtk.js >= 23.0.0\nsliceRep.property.setUseLookupTableScalarRange(true);\n\n// set slice ordering to be in front of the base image\nsliceRep.mapper.setResolveCoincidentTopologyToPolygonOffset();\nsliceRep.mapper.setResolveCoincidentTopologyPolygonOffsetParameters(-2, -2);\n\nuseSegmentGroupConfigInitializer(viewId.value, segmentationId.value);\nconst coloringStore = useLayerColoringStore();\n\n// visibility\nconst visibility = computed(\n  () =>\n    coloringStore.getConfig(viewId.value, segmentationId.value)!.blendConfig\n      .visibility\n);\nwatchEffect(() => {\n  sliceRep.actor.setVisibility(visibility.value);\n});\n\n// opacity\nconst opacity = computed(\n  () =>\n    coloringStore.getConfig(viewId.value, segmentationId.value)!.blendConfig\n      .opacity\n);\nwatchEffect(() => {\n  sliceRep.property.setOpacity(opacity.value);\n});\n\n// set slicing mode\nconst parentImageId = computed(() => metadata.value?.parentImage);\nconst { metadata: parentMetadata } = useImage(parentImageId);\n\nwatchEffect(() => {\n  const { lpsOrientation } = parentMetadata.value;\n  const ijkIndex = lpsOrientation[axis.value];\n  const mode = [SlicingMode.I, SlicingMode.J, SlicingMode.K][ijkIndex];\n  sliceRep.mapper.setSlicingMode(mode);\n});\n\n// sync slicing\nconst slice = vtkFieldRef(sliceRep.mapper, 'slice');\nconst { slice: storedSlice } = useSliceConfig(viewId, parentImageId);\nsyncRef(storedSlice, slice, { immediate: true });\n\n// set coloring properties\nconst applySegmentColoring = () => {\n  const cfun = sliceRep.property.getRGBTransferFunction(0);\n  const ofun = sliceRep.property.getPiecewiseFunction(0);\n\n  if (!cfun || !ofun) throw new Error('Missing transfer functions');\n\n  cfun.removeAllPoints();\n  ofun.removeAllPoints();\n\n  let maxValue = 0;\n\n  if (!metadata.value) return; // segment group just deleted\n\n  const { segments } = metadata.value;\n  segments.order.forEach((segId) => {\n    const segment = segments.byValue[segId];\n    const r = segment.color[0] || 0;\n    const g = segment.color[1] || 0;\n    const b = segment.color[2] || 0;\n    const a = (segment.visible && segment.color[3]) || 0;\n    cfun.addRGBPoint(segment.value, r / 255, g / 255, b / 255);\n    ofun.addPoint(segment.value, a / 255);\n\n    maxValue = Math.max(maxValue, segment.value);\n  });\n\n  // add min/max values of the colormap range\n  cfun.addRGBPoint(0, 0, 0, 0);\n  ofun.addPoint(0, 0);\n  cfun.addRGBPoint(maxValue + 1, 0, 0, 0);\n  ofun.addPoint(maxValue + 1, 0);\n\n  sliceRep.property.modified();\n};\n\nwatchEffect(applySegmentColoring);\n\nconst configStore = useSegmentGroupConfigStore();\nconst config = computed(() =>\n  configStore.getConfig(unref(viewId), unref(segmentationId))\n);\n\nconst outlineThickness = computed(() => config.value?.outlineThickness ?? 2);\nsliceRep.property.setUseLabelOutline(true);\nsliceRep.property.setUseLookupTableScalarRange(true);\n\nwatchEffect(() => {\n  sliceRep.property.setLabelOutlineOpacity(config.value?.outlineOpacity ?? 1);\n});\n\nwatchEffect(() => {\n  if (!metadata.value) return; // segment group just deleted\n\n  const thickness = outlineThickness.value;\n  const { segments } = metadata.value;\n  const largestValue = Math.max(...segments.order);\n\n  const segThicknesses = Array.from({ length: largestValue }, (_, value) => {\n    const segment = segments.byValue[value + 1];\n    return ((!segment || segment.visible) && thickness) || 0;\n  });\n  sliceRep.property.setLabelOutlineThickness(segThicknesses);\n});\n\ndefineExpose(sliceRep);\n</script>\n\n<template>\n  <slot></slot>\n</template>\n","import useLayerColoringStore from '@/src/store/view-configs/layers';\nimport { watchImmediate } from '@vueuse/core';\nimport { MaybeRef, computed, unref } from 'vue';\n\nexport function useLayerConfigInitializer(\n  viewId: MaybeRef<string>,\n  layerId: MaybeRef<string>\n) {\n  const coloringStore = useLayerColoringStore();\n  const colorConfig = computed(() =>\n    coloringStore.getConfig(unref(viewId), unref(layerId))\n  );\n\n  watchImmediate(colorConfig, (config) => {\n    if (config) return;\n\n    const viewIdVal = unref(viewId);\n    const layerIdVal = unref(layerId);\n    coloringStore.resetColorPreset(viewIdVal, layerIdVal);\n  });\n}\n","import { Maybe } from '@/src/types';\nimport {\n  ColorTransferFunction,\n  ColoringConfig,\n  OpacityFunction,\n} from '@/src/types/views';\nimport { MaybeRef, computed, unref, watchEffect } from 'vue';\nimport vtkPiecewiseFunctionProxy from '@kitware/vtk.js/Proxy/Core/PiecewiseFunctionProxy';\nimport {\n  applyNodesToPiecewiseFunction,\n  applyPointsToPiecewiseFunction,\n  getShiftedOpacityFromPreset,\n} from '@/src/utils/vtk-helpers';\nimport vtkColorTransferFunction from '@kitware/vtk.js/Rendering/Core/ColorTransferFunction';\nimport vtkColorMaps from '@kitware/vtk.js/Rendering/Core/ColorTransferFunction/ColorMaps';\nimport vtkPiecewiseFunction from '@kitware/vtk.js/Common/DataModel/PiecewiseFunction';\nimport vtkPiecewiseGaussianWidget from '@kitware/vtk.js/Interaction/Widgets/PiecewiseGaussianWidget';\n\nexport interface ApplyColoringParams {\n  props: {\n    colorFunction: ColorTransferFunction;\n    opacityFunction: OpacityFunction;\n  };\n  cfun: vtkColorTransferFunction;\n  ofun: vtkPiecewiseFunction;\n  componentIndex?: number;\n}\n\nexport function applyColoring({\n  props: { colorFunction, opacityFunction },\n  cfun,\n  ofun,\n  componentIndex = -1,\n}: ApplyColoringParams) {\n  if (componentIndex === -1) {\n    cfun.setVectorModeToMagnitude();\n  } else {\n    cfun.setVectorModeToComponent();\n    cfun.setVectorComponent(componentIndex);\n  }\n\n  const preset = vtkColorMaps.getPresetByName(colorFunction.preset);\n  if (preset) {\n    cfun.applyColorMap(preset);\n  }\n  cfun.setMappingRange(...colorFunction.mappingRange);\n\n  const { mappingRange } = opacityFunction;\n  ofun.setRange(...opacityFunction.mappingRange);\n\n  switch (opacityFunction.mode) {\n    case vtkPiecewiseFunctionProxy.Mode.Gaussians:\n      vtkPiecewiseGaussianWidget.applyGaussianToPiecewiseFunction(\n        opacityFunction.gaussians,\n        256,\n        opacityFunction.mappingRange,\n        ofun\n      );\n      break;\n    case vtkPiecewiseFunctionProxy.Mode.Points: {\n      const opacityPoints = getShiftedOpacityFromPreset(\n        opacityFunction.preset,\n        opacityFunction.mappingRange,\n        opacityFunction.shift,\n        opacityFunction.shiftAlpha\n      );\n      if (opacityPoints) {\n        applyPointsToPiecewiseFunction(ofun, opacityPoints, mappingRange);\n      }\n      break;\n    }\n    case vtkPiecewiseFunctionProxy.Mode.Nodes: {\n      applyNodesToPiecewiseFunction(ofun, opacityFunction.nodes, mappingRange);\n      break;\n    }\n    default:\n      throw new Error('Invalid opacity function mode encountered');\n  }\n}\n\nexport function useColoringEffect(\n  config: MaybeRef<Maybe<ColoringConfig>>,\n  cfun: MaybeRef<vtkColorTransferFunction>,\n  ofun: MaybeRef<vtkPiecewiseFunction>\n) {\n  const colorTransferFunction = computed(() => unref(config)?.transferFunction);\n  const opacityFunction = computed(() => unref(config)?.opacityFunction);\n\n  watchEffect(() => {\n    const colorFunc = colorTransferFunction.value;\n    const opacityFunc = opacityFunction.value;\n    if (!colorFunc || !opacityFunc) return;\n\n    applyColoring({\n      props: {\n        colorFunction: colorFunc,\n        opacityFunction: opacityFunc,\n      },\n      cfun: unref(cfun),\n      ofun: unref(ofun),\n    });\n  });\n}\n","<script setup lang=\"ts\">\nimport { toRefs, watchEffect, inject, computed } from 'vue';\nimport { useImage } from '@/src/composables/useCurrentImage';\nimport { useSliceRepresentation } from '@/src/core/vtk/useSliceRepresentation';\nimport { LPSAxis } from '@/src/types/lps';\nimport { SlicingMode } from '@kitware/vtk.js/Rendering/Core/ImageMapper/Constants';\nimport { VtkViewContext } from '@/src/components/vtk/context';\nimport vtkColorTransferFunction from '@kitware/vtk.js/Rendering/Core/ColorTransferFunction';\nimport vtkPiecewiseFunction from '@kitware/vtk.js/Common/DataModel/PiecewiseFunction';\nimport { vtkFieldRef } from '@/src/core/vtk/vtkFieldRef';\nimport { syncRef } from '@vueuse/core';\nimport { useSliceConfig } from '@/src/composables/useSliceConfig';\nimport { useLayersStore } from '@/src/store/datasets-layers';\nimport useLayerColoringStore from '@/src/store/view-configs/layers';\nimport { useLayerConfigInitializer } from '@/src/composables/useLayerConfigInitializer';\nimport { applyColoring } from '@/src/composables/useColoringEffect';\n\ninterface Props {\n  viewId: string;\n  layerId: string;\n  parentId: string;\n  axis: LPSAxis;\n}\n\nconst props = defineProps<Props>();\nconst { viewId, layerId, parentId, axis } = toRefs(props);\n\nconst view = inject(VtkViewContext);\nif (!view) throw new Error('No VtkView');\n\nconst coloringStore = useLayerColoringStore();\nconst coloringConfig = computed(() =>\n  coloringStore.getConfig(viewId.value, layerId.value)\n);\n\n// setup slice rep\nconst layerStore = useLayersStore();\nconst imageData = computed(() => layerStore.layerImages[layerId.value]);\nconst sliceRep = useSliceRepresentation(view, imageData);\n\nsliceRep.property.setRGBTransferFunction(\n  0,\n  vtkColorTransferFunction.newInstance()\n);\nsliceRep.property.setScalarOpacity(0, vtkPiecewiseFunction.newInstance());\nsliceRep.property.setUseLookupTableScalarRange(false);\n\n// set slice ordering to be in front of the segmentations\nsliceRep.mapper.setResolveCoincidentTopologyToPolygonOffset();\nsliceRep.mapper.setResolveCoincidentTopologyPolygonOffsetParameters(-4, -4);\n\n// set slicing mode\nconst { metadata: parentMetadata } = useImage(parentId);\n\nwatchEffect(() => {\n  const { lpsOrientation } = parentMetadata.value;\n  const ijkIndex = lpsOrientation[axis.value];\n  const mode = [SlicingMode.I, SlicingMode.J, SlicingMode.K][ijkIndex];\n  sliceRep.mapper.setSlicingMode(mode);\n});\n\n// sync slicing\nconst slice = vtkFieldRef(sliceRep.mapper, 'slice');\nconst { slice: storedSlice } = useSliceConfig(viewId, parentId);\nsyncRef(storedSlice, slice, { immediate: true });\n\n// initialize layer coloring\nuseLayerConfigInitializer(viewId, layerId);\n\n// apply layer coloring\nconst applyLayerColoring = () => {\n  const config = coloringConfig.value;\n  if (!config) return;\n\n  const cfun = sliceRep.property.getRGBTransferFunction(0);\n  const ofun = sliceRep.property.getPiecewiseFunction(0);\n\n  if (!cfun || !ofun) throw new Error('Missing transfer functions');\n\n  applyColoring({\n    props: {\n      colorFunction: config.transferFunction,\n      opacityFunction: config.opacityFunction,\n    },\n    cfun,\n    ofun,\n  });\n\n  const { opacityFunction } = config;\n\n  const { mappingRange } = opacityFunction;\n  const width = mappingRange[1] - mappingRange[0];\n  const center = (mappingRange[1] + mappingRange[0]) / 2;\n\n  sliceRep.property.setColorWindow(width);\n  sliceRep.property.setColorLevel(center);\n  sliceRep.property.setOpacity(config.blendConfig.opacity);\n};\n\nwatchEffect(applyLayerColoring);\n\ndefineExpose(sliceRep);\n</script>\n\n<template>\n  <slot></slot>\n</template>\n","import { useImageStore } from '@/src/store/datasets-images';\nimport { Maybe } from '@/src/types';\nimport vtkImageData from '@kitware/vtk.js/Common/DataModel/ImageData';\nimport { whenever } from '@vueuse/core';\nimport { computed, Ref, WatchCallback } from 'vue';\n\nexport function wheneverImageLoaded(\n  imageId: Ref<Maybe<string>>,\n  cb: WatchCallback<{ id: string; imageData: vtkImageData }>\n) {\n  const imageStore = useImageStore();\n  const hasImageData = computed(() => {\n    const id = imageId.value;\n    if (!id) return false;\n    return !!imageStore.dataIndex[id];\n  });\n\n  return whenever(hasImageData, (newVal, oldVal, onCleanup) => {\n    cb(\n      { id: imageId.value!, imageData: imageStore.dataIndex[imageId.value!] },\n      undefined,\n      onCleanup\n    );\n  });\n}\n","import type { Vector3 } from '@kitware/vtk.js/types';\nimport { computed } from 'vue';\nimport { MaybeRef } from '@vueuse/core';\nimport { getLPSAxisFromDir } from '@/src/utils/lps';\nimport { useImage } from '@/src/composables/useCurrentImage';\nimport { Maybe } from '@/src/types';\nimport { useSliceConfig } from '@/src/composables/useSliceConfig';\n\n/**\n * Returns information about the current slice.\n *\n * axisName: the name of the axis\n * axisIndex: corresponding index in an LPS coordinate array\n * number: slice value\n * planeNormal: slice plane normal\n * planeOrigin: slice plane origin\n * @param viewID\n */\nexport function useSliceInfo(\n  viewID: MaybeRef<string>,\n  imageID: MaybeRef<Maybe<string>>\n) {\n  const { metadata: imageMetadata } = useImage(imageID);\n  const { slice, config } = useSliceConfig(viewID, imageID);\n  return computed(() => {\n    if (!config.value) return null;\n    const { lpsOrientation } = imageMetadata.value;\n    const { axisDirection } = config.value;\n    const axis = getLPSAxisFromDir(axisDirection);\n    const planeOrigin = [0, 0, 0] as Vector3;\n    planeOrigin[lpsOrientation[axis]] = slice.value;\n    return {\n      axisName: axis,\n      axisIndex: lpsOrientation[axis],\n      slice: slice.value,\n      planeNormal: lpsOrientation[axisDirection] as Vector3,\n      planeOrigin,\n    };\n  });\n}\n","import vtkOpenGLRenderWindow from '@kitware/vtk.js/Rendering/OpenGL/RenderWindow';\nimport vtkRenderer from '@kitware/vtk.js/Rendering/Core/Renderer';\nimport type { Vector2, Vector3 } from '@kitware/vtk.js/types';\nimport { computed, ref, unref, watchEffect } from 'vue';\nimport { MaybeRef, useResizeObserver } from '@vueuse/core';\nimport { vec3 } from 'gl-matrix';\nimport { onVTKEvent } from '@/src/composables/onVTKEvent';\nimport { Maybe } from '@/src/types';\nimport { computeWorldToDisplay } from '../utils/vtk-helpers';\n\ntype MaybeCoords = Maybe<Vector3 | vec3>;\ntype MaybeMultiCoords = Maybe<Vector3[] | vec3[]>;\ntype MaybeRenderer = Maybe<vtkRenderer>;\n\n/**\n * Returns a reactive vtkOpenGLRenderWindow container ref.\n *\n * @param view\n * @returns\n */\nexport function useVTKViewContainer(\n  view: MaybeRef<Maybe<vtkOpenGLRenderWindow>>\n) {\n  const container = ref<HTMLElement | null>(null);\n\n  const update = () => {\n    container.value = unref(view)?.getContainer() ?? null;\n  };\n\n  onVTKEvent(view, 'onModified', update);\n  update();\n\n  return container;\n}\n\n/**\n * Transforms a list of world coordinates into display coordinates.\n *\n * @param worldCoords\n * @param renderer\n * @returns\n */\nexport function useVTKMultiWorldToDisplay(\n  worldCoords: MaybeRef<MaybeMultiCoords>,\n  renderer: MaybeRef<MaybeRenderer>\n) {\n  const displayCoords = ref<Vector2[]>([]);\n  const view = computed(\n    () =>\n      unref(renderer)\n        ?.getRenderWindow()\n        ?.getViews()?.[0] as vtkOpenGLRenderWindow\n  );\n  const container = useVTKViewContainer(view);\n\n  const update = () => {\n    const coords = unref(worldCoords);\n    const ren = unref(renderer);\n\n    if (coords == null || !ren) {\n      return;\n    }\n\n    displayCoords.value = coords.map((xyz) => {\n      const disp = computeWorldToDisplay(xyz as Vector3, ren)!;\n      // convert from canvas space to display space\n      return [\n        disp[0] / devicePixelRatio,\n        disp[1] / devicePixelRatio,\n      ] as Vector2;\n    }) as Vector2[];\n  };\n\n  const camera = computed(() => unref(renderer)?.getActiveCamera());\n  useResizeObserver(container, update);\n  watchEffect(update);\n  onVTKEvent(camera, 'onModified', update);\n  update();\n\n  return displayCoords;\n}\n\n/**\n * Transforms a single world coordinate into a display coordinate.\n *\n * @param worldCoords\n * @param renderer\n * @returns\n */\nexport function useVTKWorldToDisplay(\n  worldCoords: MaybeRef<MaybeCoords>,\n  renderer: MaybeRef<MaybeRenderer>\n) {\n  const manyCoords = computed(() => {\n    const c = unref(worldCoords);\n    if (c != null) {\n      return [c];\n    }\n    return null;\n  });\n\n  const displayCoords = useVTKMultiWorldToDisplay(manyCoords, renderer);\n  return computed(() => {\n    if (displayCoords.value.length === 1) {\n      return displayCoords.value[0];\n    }\n    return null;\n  });\n}\n\n/**\n * Transforms a list of world coordinates into SVG coordinates.\n *\n * @param worldCoords\n * @param renderer\n * @returns\n */\nexport function useVTKMultiWorldToSVG(\n  worldCoords: MaybeRef<MaybeMultiCoords>,\n  renderer: MaybeRef<MaybeRenderer>\n) {\n  const displayCoords = useVTKMultiWorldToDisplay(worldCoords, renderer);\n  const svgCoords = computed(() => {\n    const disp = displayCoords.value;\n    const ren = unref(renderer);\n    const view = ren?.getRenderWindow()?.getViews()?.[0];\n    if (ren && view) {\n      const [, height] = view.getViewportSize(ren);\n      return disp.map((xy) => {\n        // flip Y axis\n        return [xy[0], height / devicePixelRatio - xy[1]];\n      });\n    }\n    return null;\n  });\n\n  return svgCoords;\n}\n","<script lang=\"ts\">\nimport { defineComponent, PropType, ref } from 'vue';\nimport { CropLine } from './types';\n\nexport default defineComponent({\n  props: {\n    line: {\n      required: true,\n      type: Object as PropType<CropLine<number[]>>,\n    },\n    clickWidth: {\n      default: 20,\n      type: Number,\n    },\n    outOfBounds: {\n      default: false,\n      type: Boolean,\n    },\n  },\n  setup() {\n    const cursor = ref('grab');\n    const grabLineEl = ref<Element | null>(null);\n    const focusWidth = ref(0);\n\n    const onPointer = (down: boolean, ev: PointerEvent) => {\n      if (down) {\n        grabLineEl.value?.setPointerCapture(ev.pointerId);\n      } else {\n        grabLineEl.value?.releasePointerCapture(ev.pointerId);\n      }\n      cursor.value = down ? 'grabbing' : 'grab';\n    };\n\n    const onHover = (hover: boolean) => {\n      focusWidth.value = hover ? 2 : 0;\n    };\n\n    return {\n      onPointer,\n      onHover,\n      cursor,\n      grabLineEl,\n      focusWidth,\n    };\n  },\n});\n</script>\n\n<template>\n  <g>\n    <line\n      :x1=\"line.startEdge[0]\"\n      :y1=\"line.startEdge[1]\"\n      :x2=\"line.startCrop[0]\"\n      :y2=\"line.startCrop[1]\"\n      :stroke-width=\"2 + focusWidth\"\n      stroke-dasharray=\"6\"\n      stroke-linecap=\"square\"\n      stroke=\"rgba(200, 255, 0, 0.5)\"\n    />\n    <line\n      :x1=\"line.startCrop[0]\"\n      :y1=\"line.startCrop[1]\"\n      :x2=\"line.endCrop[0]\"\n      :y2=\"line.endCrop[1]\"\n      :stroke-width=\"2 + focusWidth\"\n      :stroke-dasharray=\"outOfBounds ? 6 : 'none'\"\n      stroke-linecap=\"butt\"\n      stroke=\"rgb(200, 255, 0)\"\n    />\n    <line\n      :x1=\"line.endCrop[0]\"\n      :y1=\"line.endCrop[1]\"\n      :x2=\"line.endEdge[0]\"\n      :y2=\"line.endEdge[1]\"\n      :stroke-width=\"2 + focusWidth\"\n      stroke-dasharray=\"6\"\n      stroke-linecap=\"square\"\n      stroke=\"rgba(200, 255, 0, 0.5)\"\n    />\n    <!-- the listener hitbox -->\n    <line\n      ref=\"grabLineEl\"\n      class=\"pointer-events-all\"\n      :style=\"{ cursor }\"\n      @pointerenter=\"onHover(true)\"\n      @pointerleave=\"onHover(false)\"\n      @pointerdown=\"onPointer(true, $event)\"\n      @pointerup=\"onPointer(false, $event)\"\n      :x1=\"line.startEdge[0]\"\n      :y1=\"line.startEdge[1]\"\n      :x2=\"line.endEdge[0]\"\n      :y2=\"line.endEdge[1]\"\n      fill=\"none\"\n      stroke-opacity=\"0\"\n      stroke-dasharray=\"none\"\n      :stroke-width=\"Number($attrs['stroke-width'] || 0) + clickWidth || 0\"\n      v-bind=\"$attrs\"\n    />\n  </g>\n</template>\n\n<style scoped src=\"@/src/components/styles/utils.css\"></style>\n","<script lang=\"ts\">\nimport { useImage } from '@/src/composables/useCurrentImage';\nimport { useSliceInfo } from '@/src/composables/useSliceInfo';\nimport { useVTKMultiWorldToSVG } from '@/src/composables/useVTKWorldToDisplay';\nimport { ImageMetadata } from '@/src/types/image';\nimport { useCropStore } from '@/src/store/tools/crop';\nimport { LPSAxis, LPSBounds, LPSPoint } from '@/src/types/lps';\nimport { createLPSBounds, createLPSPoint, LPSAxes } from '@/src/utils/lps';\nimport { intersectMouseEventWithPlane } from '@/src/utils/vtk-helpers';\nimport vtkRenderer from '@kitware/vtk.js/Rendering/Core/Renderer';\nimport type { Vector2, Vector3 } from '@kitware/vtk.js/types';\nimport {\n  computed,\n  ComputedRef,\n  DeepReadonly,\n  defineComponent,\n  inject,\n  MaybeRef,\n  PropType,\n  ref,\n  Ref,\n  toRefs,\n  unref,\n} from 'vue';\nimport { vec3 } from 'gl-matrix';\nimport useViewAnimationStore from '@/src/store/view-animation';\nimport { Maybe } from '@/src/types';\nimport { VtkViewContext } from '@/src/components/vtk/context';\nimport Crop2DLineHandle from './Crop2DLineHandle.vue';\nimport { CropLines } from './types';\n\nfunction computeCropLines(\n  viewID: MaybeRef<string>,\n  imageID: MaybeRef<Maybe<string>>,\n  cropAxis: Ref<LPSAxis | null>,\n  cropPlanes: DeepReadonly<Ref<Record<LPSAxis, number[]>>>,\n  boundary: Ref<Record<LPSAxis, number[]>>\n): ComputedRef<CropLines<LPSPoint> | null> {\n  const currentSlice = useSliceInfo(viewID, imageID);\n\n  return computed(() => {\n    // pre-check reactivity\n    const viewIDVal = unref(viewID);\n    const cropAxisVal = cropAxis.value;\n    const cropPlanesVal = cropPlanes.value;\n    const boundaryVal = boundary.value;\n    const sliceInfo = currentSlice.value;\n\n    if (!viewIDVal || !cropAxisVal || !sliceInfo) {\n      return null;\n    }\n\n    const sliceAxis = sliceInfo.axisName;\n    const [perpAxis] = LPSAxes.filter(\n      (ax) => ax !== cropAxisVal && ax !== sliceAxis\n    );\n    const cropRange = cropPlanesVal[cropAxisVal];\n    const perpRange = cropPlanesVal[perpAxis];\n    const perpBoundary = boundaryVal[perpAxis];\n\n    const sliceCropRange = cropPlanesVal[sliceAxis];\n    const slice = sliceInfo.slice;\n    const outOfBounds = slice < sliceCropRange[0] || sliceCropRange[1] < slice;\n\n    const getLineSegments = (index: number) => {\n      const startEdge = createLPSPoint();\n      const startCrop = createLPSPoint();\n      const endCrop = createLPSPoint();\n      const endEdge = createLPSPoint();\n\n      startEdge[cropAxisVal] = cropRange[index];\n      startCrop[cropAxisVal] = cropRange[index];\n      endCrop[cropAxisVal] = cropRange[index];\n      endEdge[cropAxisVal] = cropRange[index];\n\n      [startEdge[perpAxis], endEdge[perpAxis]] = perpBoundary;\n      [startCrop[perpAxis], endCrop[perpAxis]] = perpRange;\n\n      return { startEdge, startCrop, endCrop, endEdge };\n    };\n\n    return {\n      lowerLine: getLineSegments(0),\n      upperLine: getLineSegments(1),\n      outOfBounds,\n    };\n  });\n}\n\nfunction cropLinesToSVGDisplay(\n  cropLines: Ref<CropLines<LPSPoint> | null>,\n  imageMetadata: Ref<ImageMetadata>,\n  renderer: vtkRenderer\n): ComputedRef<CropLines<number[]> | null> {\n  // gather points\n  const worldPoints = computed(() => {\n    const lines = cropLines.value;\n    const { lpsOrientation, indexToWorld } = imageMetadata.value;\n    if (!lines) {\n      return null;\n    }\n    return [\n      lines.lowerLine.startEdge,\n      lines.lowerLine.startCrop,\n      lines.lowerLine.endCrop,\n      lines.lowerLine.endEdge,\n      lines.upperLine.startEdge,\n      lines.upperLine.startCrop,\n      lines.upperLine.endCrop,\n      lines.upperLine.endEdge,\n    ].map((indexLPSPoint) => {\n      const indexPt = [0, 0, 0] as vec3;\n      indexPt[lpsOrientation.Sagittal] = indexLPSPoint.Sagittal;\n      indexPt[lpsOrientation.Coronal] = indexLPSPoint.Coronal;\n      indexPt[lpsOrientation.Axial] = indexLPSPoint.Axial;\n\n      const out = [0, 0, 0] as vec3;\n      vec3.transformMat4(out, indexPt, indexToWorld);\n      return out as Vector3;\n    });\n  });\n\n  // transform points to svg\n  const svgPoints = useVTKMultiWorldToSVG(worldPoints, renderer);\n\n  // create a new CropLines with SVG points\n  return computed(() => {\n    const lines = cropLines.value;\n    const points = svgPoints.value;\n    if (!lines || !points?.length) {\n      return null;\n    }\n\n    return {\n      lowerLine: {\n        startEdge: points[0],\n        startCrop: points[1],\n        endCrop: points[2],\n        endEdge: points[3],\n      },\n      upperLine: {\n        startEdge: points[4],\n        startCrop: points[5],\n        endCrop: points[6],\n        endEdge: points[7],\n      },\n      outOfBounds: lines.outOfBounds,\n    };\n  });\n}\n\nfunction useDragging({\n  mouseEventToLPSPoint,\n  getCropEdgePos,\n  setCropEdgePos,\n}: {\n  mouseEventToLPSPoint: (ev: PointerEvent) => LPSPoint | null;\n  getCropEdgePos: (axis: LPSAxis, lowerUpper: 0 | 1) => number;\n  setCropEdgePos: (axis: LPSAxis, lowerUpper: 0 | 1, pos: number) => void;\n}) {\n  const activeAxis = ref<LPSAxis | null>();\n  const activeEdge = ref<0 | 1 | null>();\n  const initialPointerIndex = ref<LPSPoint>(createLPSPoint());\n  const initialCrop = ref<number>(0);\n\n  const viewAnimationStore = useViewAnimationStore();\n  const requestor = Symbol('Crop2DRequestor');\n\n  const onPointerDown = (\n    ax: LPSAxis,\n    selectedCropEdge: 0 | 1,\n    ev: PointerEvent\n  ) => {\n    // ev -> world -> index -> LPSPoint -> save as starting index\n    // save the starting axis edge value\n    const initialPoint = mouseEventToLPSPoint(ev);\n    if (!initialPoint) return;\n\n    initialPointerIndex.value = initialPoint;\n    initialCrop.value = getCropEdgePos(ax, selectedCropEdge);\n    activeAxis.value = ax;\n    activeEdge.value = selectedCropEdge;\n\n    viewAnimationStore.requestAnimation(requestor, {\n      byViewType: ['3D'],\n    });\n  };\n\n  const onPointerMove = (ev: PointerEvent) => {\n    if (activeAxis.value == null || activeEdge.value == null) {\n      return;\n    }\n    const axis = activeAxis.value;\n\n    const point = mouseEventToLPSPoint(ev);\n    if (!point) return;\n\n    // calc delta along ax from starting pos via startingIndex\n    // apply delta to starting axis edge value\n    const delta = point[axis] - initialPointerIndex.value[axis];\n    setCropEdgePos(axis, activeEdge.value, initialCrop.value + delta);\n  };\n\n  const onPointerUp = () => {\n    activeAxis.value = null;\n    activeEdge.value = null;\n    viewAnimationStore.cancelAnimation(requestor);\n  };\n\n  return {\n    onPointerDown,\n    onPointerMove,\n    onPointerUp,\n  };\n}\n\nexport default defineComponent({\n  props: {\n    viewId: {\n      required: true,\n      type: String,\n    },\n    imageId: String as PropType<Maybe<string>>,\n  },\n  components: {\n    Crop2DLineHandle,\n  },\n  setup(props) {\n    const { viewId: viewID, imageId } = toRefs(props);\n\n    const view = inject(VtkViewContext);\n    if (!view) throw new Error('No VtkView');\n\n    const { extent: imageExtent, metadata: imageMetadata } = useImage(imageId);\n    const currentSlice = useSliceInfo(viewID, imageId);\n    const currentSlicingAxis = computed(\n      () => currentSlice.value?.axisName ?? null\n    );\n\n    const cropStore = useCropStore();\n    const cropPlanes = computed((): DeepReadonly<LPSBounds> => {\n      const id = imageId.value;\n      if (id && id in cropStore.croppingByImageID) {\n        return cropStore.croppingByImageID[id];\n      }\n      return createLPSBounds();\n    });\n\n    const inPlaneAxes = computed(() =>\n      LPSAxes.filter(\n        (ax) => currentSlicingAxis.value && ax !== currentSlicingAxis.value\n      )\n    );\n    const ax1 = computed(() => inPlaneAxes.value[0] ?? null);\n    const ax2 = computed(() => inPlaneAxes.value[1] ?? null);\n\n    // crop lines in image space\n    const ax1Lines = computeCropLines(\n      viewID,\n      imageId,\n      ax1,\n      cropPlanes,\n      imageExtent\n    );\n    const ax2Lines = computeCropLines(\n      viewID,\n      imageId,\n      ax2,\n      cropPlanes,\n      imageExtent\n    );\n\n    // crop lines in display space\n    const ax1SVGLines = cropLinesToSVGDisplay(\n      ax1Lines,\n      imageMetadata,\n      view.renderer\n    );\n    const ax2SVGLines = cropLinesToSVGDisplay(\n      ax2Lines,\n      imageMetadata,\n      view.renderer\n    );\n\n    const { onPointerDown, onPointerMove, onPointerUp } = useDragging({\n      mouseEventToLPSPoint(ev: PointerEvent) {\n        const sliceInfo = currentSlice.value;\n        if (!sliceInfo) return null;\n\n        const { lpsOrientation, worldToIndex } = imageMetadata.value;\n        const coord = intersectMouseEventWithPlane(\n          ev,\n          view.renderer,\n          sliceInfo.planeOrigin,\n          sliceInfo.planeNormal\n        );\n        if (!coord) return null;\n\n        // convert from world to index\n        vec3.transformMat4(coord, coord, worldToIndex);\n\n        const point = createLPSPoint();\n        point.Sagittal = coord[lpsOrientation.Sagittal];\n        point.Coronal = coord[lpsOrientation.Coronal];\n        point.Axial = coord[lpsOrientation.Axial];\n\n        return point;\n      },\n      getCropEdgePos(axis: LPSAxis, lowerUpper: 0 | 1) {\n        return cropPlanes.value[axis][lowerUpper];\n      },\n      setCropEdgePos(axis: LPSAxis, lowerUpper: 0 | 1, pos: number) {\n        if (!imageId.value) return;\n\n        // enforce cropping edge bounds\n        const planes = cropPlanes.value;\n        const [lower, upper] = planes[axis];\n        const [min, max] = imageExtent.value[axis];\n        const newPlanes: Vector2 = [lower, upper];\n        if (lowerUpper === 0) {\n          newPlanes[0] = Math.max(min, Math.min(pos, upper));\n        } else if (lowerUpper === 1) {\n          newPlanes[1] = Math.max(lower, Math.min(pos, max));\n        }\n\n        cropStore.setCroppingForAxis(imageId.value, axis, newPlanes);\n      },\n    });\n\n    return {\n      ax1: computed(() => ({\n        name: ax1.value,\n        lines: ax1SVGLines.value,\n      })),\n      ax2: computed(() => ({\n        name: ax2.value,\n        lines: ax2SVGLines.value,\n      })),\n      onPointerDown,\n      onPointerMove,\n      onPointerUp,\n    };\n  },\n});\n</script>\n\n<template>\n  <g>\n    <template v-if=\"ax1.lines != null\">\n      <crop-2D-line-handle\n        :line=\"ax1.lines.lowerLine\"\n        :out-of-bounds=\"ax1.lines.outOfBounds\"\n        @pointerdown.stop=\"onPointerDown(ax1.name, 0, $event)\"\n        @pointermove.stop=\"onPointerMove\"\n        @pointerup.stop=\"onPointerUp\"\n      />\n      <crop-2D-line-handle\n        :line=\"ax1.lines.upperLine\"\n        :out-of-bounds=\"ax1.lines.outOfBounds\"\n        @pointerdown.stop=\"onPointerDown(ax1.name, 1, $event)\"\n        @pointermove.stop=\"onPointerMove\"\n        @pointerup.stop=\"onPointerUp\"\n      />\n    </template>\n    <template v-if=\"ax2.lines != null\">\n      <crop-2D-line-handle\n        :line=\"ax2.lines.lowerLine\"\n        :out-of-bounds=\"ax2.lines.outOfBounds\"\n        @pointerdown.stop=\"onPointerDown(ax2.name, 0, $event)\"\n        @pointermove.stop=\"onPointerMove\"\n        @pointerup.stop=\"onPointerUp\"\n      />\n      <crop-2D-line-handle\n        :line=\"ax2.lines.upperLine\"\n        :out-of-bounds=\"ax2.lines.outOfBounds\"\n        @pointerdown.stop=\"onPointerDown(ax2.name, 1, $event)\"\n        @pointermove.stop=\"onPointerMove\"\n        @pointerup.stop=\"onPointerUp\"\n      />\n    </template>\n  </g>\n</template>\n\n<style scoped src=\"@/src/components/styles/vtk-view.css\"></style>\n@/src/composables/useSliceInfo\n","<script lang=\"ts\">\nimport { useImage } from '@/src/composables/useCurrentImage';\nimport { onVTKEvent } from '@/src/composables/onVTKEvent';\nimport { useCropStore } from '@/src/store/tools/crop';\nimport { LPSCroppingPlanes } from '@/src/types/crop';\nimport { arrayEquals } from '@/src/utils';\nimport { getAxisBounds, LPSAxes } from '@/src/utils/lps';\nimport type { Bounds } from '@kitware/vtk.js/types';\nimport vtkImageCroppingWidget, {\n  ImageCroppingWidgetState,\n  vtkImageCroppingViewWidget,\n} from '@kitware/vtk.js/Widgets/Widgets3D/ImageCroppingWidget';\nimport {\n  computed,\n  DeepReadonly,\n  defineComponent,\n  inject,\n  onBeforeUnmount,\n  PropType,\n  toRefs,\n} from 'vue';\nimport { VtkViewContext } from '@/src/components/vtk/context';\nimport { Maybe } from '@/src/types';\nimport { watchImmediate } from '@vueuse/core';\n\nfunction isValidCroppingPlanes(planes: LPSCroppingPlanes) {\n  return (\n    planes.Sagittal[0] <= planes.Sagittal[1] &&\n    planes.Coronal[0] <= planes.Coronal[1] &&\n    planes.Axial[0] <= planes.Axial[1]\n  );\n}\n\nfunction lpsPlanesEqual(a: LPSCroppingPlanes, b: LPSCroppingPlanes) {\n  return (\n    a.Axial[0] === b.Axial[0] &&\n    a.Axial[1] === b.Axial[1] &&\n    a.Sagittal[0] === b.Sagittal[0] &&\n    a.Sagittal[1] === b.Sagittal[1] &&\n    a.Coronal[0] === b.Coronal[0] &&\n    a.Coronal[1] === b.Coronal[1]\n  );\n}\n\nexport default defineComponent({\n  props: {\n    imageId: String as PropType<Maybe<string>>,\n  },\n  setup(props) {\n    const view = inject(VtkViewContext);\n    if (!view) throw new Error('No VtkView');\n\n    const { widgetManager } = view;\n\n    const { imageId } = toRefs(props);\n\n    const cropStore = useCropStore();\n    const croppingPlanes = computed(() => {\n      const id = imageId.value;\n      if (id && id in cropStore.croppingByImageID) {\n        return cropStore.croppingByImageID[id];\n      }\n      return null;\n    });\n\n    const factory = vtkImageCroppingWidget.newInstance();\n    const state = factory.getWidgetState() as ImageCroppingWidgetState;\n\n    factory.setEdgeHandlesEnabled(false);\n    factory.setFaceHandlesEnabled(true);\n    factory.setCornerHandlesEnabled(true);\n\n    const widget = widgetManager.addWidget(\n      factory\n    ) as vtkImageCroppingViewWidget;\n\n    // update representation to not be as 3D\n    widget.getRepresentations().forEach((rep) => {\n      rep.getActors().forEach((actor) => {\n        actor.getProperty().setAmbient(1);\n      });\n    });\n\n    onBeforeUnmount(() => {\n      widgetManager.removeWidget(factory);\n    });\n\n    const { metadata: imageMetadata } = useImage(imageId);\n    watchImmediate(imageMetadata, (metadata) => {\n      state.setWorldToIndexT(metadata.worldToIndex);\n      state.setIndexToWorldT(metadata.indexToWorld);\n      state.placeWidget(metadata.worldBounds);\n    });\n\n    const applyPlanes = (lpsPlanes: DeepReadonly<LPSCroppingPlanes>) => {\n      const { lpsOrientation: dirs } = imageMetadata.value;\n      // LPSCroppingPlanes -> Bounds\n      const planes = [0, 0, 0, 0, 0, 0] as Bounds;\n      LPSAxes.forEach((axis) => {\n        [planes[dirs[axis] * 2], planes[dirs[axis] * 2 + 1]] = lpsPlanes[axis];\n      });\n\n      // prevent infinite loops\n      if (!arrayEquals(planes, state.getCroppingPlanes().getPlanes())) {\n        state.getCroppingPlanes().setPlanes(planes);\n        view.requestRender();\n      }\n    };\n\n    watchImmediate(croppingPlanes, (lpsPlanes) => {\n      if (lpsPlanes) {\n        applyPlanes(lpsPlanes);\n      }\n    });\n\n    onVTKEvent(state.getCroppingPlanes(), 'onModified', () => {\n      const id = imageId.value;\n      if (!id) return;\n\n      // Bounds -> LPSCroppingPlanes\n      const planes = state.getCroppingPlanes().getPlanes();\n      const { lpsOrientation } = imageMetadata.value;\n      const lpsPlanes: LPSCroppingPlanes = {\n        Sagittal: getAxisBounds(planes, 'Sagittal', lpsOrientation),\n        Coronal: getAxisBounds(planes, 'Coronal', lpsOrientation),\n        Axial: getAxisBounds(planes, 'Axial', lpsOrientation),\n      };\n\n      // avoid updates if equal\n      const planesFromStore = croppingPlanes.value;\n      if (\n        planesFromStore &&\n        lpsPlanesEqual(lpsPlanes, planesFromStore as LPSCroppingPlanes)\n      ) {\n        return;\n      }\n\n      if (isValidCroppingPlanes(lpsPlanes)) {\n        cropStore.setCropping(id, lpsPlanes);\n      } else if (planesFromStore) {\n        applyPlanes(planesFromStore);\n      }\n    });\n\n    return () => null;\n  },\n});\n</script>\n","<script lang=\"ts\">\nimport { useViewStore } from '@/src/store/views';\nimport { PropType, computed, defineComponent, toRefs } from 'vue';\nimport { wheneverImageLoaded } from '@/src/composables/wheneverImageLoaded';\nimport { useCropStore } from '@/src/store/tools/crop';\nimport { useToolStore } from '@/src/store/tools';\nimport { Tools } from '@/src/store/tools/types';\nimport { Maybe } from '@/src/types';\nimport Crop2D from './Crop2D.vue';\nimport Crop3D from './Crop3D.vue';\n\nexport default defineComponent({\n  props: {\n    viewId: {\n      type: String,\n      required: true,\n    },\n    imageId: String as PropType<Maybe<string>>,\n  },\n  components: {\n    Crop2D,\n    Crop3D,\n  },\n  setup(props) {\n    const { viewId: viewID, imageId } = toRefs(props);\n\n    const cropStore = useCropStore();\n    const toolStore = useToolStore();\n\n    const active = computed(() => toolStore.currentTool === Tools.Crop);\n\n    wheneverImageLoaded(imageId, ({ id }) => {\n      if (id && !(id in cropStore.croppingByImageID)) {\n        cropStore.resetCropping(id);\n      }\n    });\n\n    const viewType = computed(() => {\n      const viewStore = useViewStore();\n      return viewStore.viewSpecs[viewID.value].viewType;\n    });\n\n    return {\n      active,\n      viewType,\n    };\n  },\n});\n</script>\n\n<template>\n  <svg class=\"overlay-no-events\">\n    <crop-2D\n      v-if=\"active && viewType === '2D'\"\n      :view-id=\"viewId\"\n      :image-id=\"imageId\"\n    />\n    <crop-3D\n      v-if=\"active && viewType === '3D'\"\n      :view-id=\"viewId\"\n      :image-id=\"imageId\"\n    />\n  </svg>\n</template>\n\n<style scoped src=\"@/src/components/styles/vtk-view.css\"></style>\n","import type { Vector3 } from '@kitware/vtk.js/types';\nimport vtkPlaneManipulator from '@kitware/vtk.js/Widgets/Manipulators/PlaneManipulator';\nimport { vec3 } from 'gl-matrix';\nimport { ImageMetadata } from '../types/image';\nimport { LPSAxisDir } from '../types/lps';\nimport { getLPSAxisFromDir } from './lps';\n\nexport function updatePlaneManipulatorFor2DView(\n  manipulator: vtkPlaneManipulator,\n  viewDir: LPSAxisDir,\n  slice: number,\n  imageMetadata: ImageMetadata\n) {\n  const { lpsOrientation } = imageMetadata;\n  const axis = lpsOrientation[getLPSAxisFromDir(viewDir)];\n\n  const normal: vec3 = lpsOrientation[viewDir];\n  const origin: vec3 = [0, 0, 0];\n  origin[axis] = slice;\n\n  vec3.transformMat4(origin, origin, imageMetadata.indexToWorld);\n\n  manipulator.setUserNormal(normal as Vector3);\n  manipulator.setUserOrigin(origin as Vector3);\n}\n\nexport function createPlaneManipulatorFor2DView(\n  viewDir: LPSAxisDir,\n  slice: number,\n  imageMetadata: ImageMetadata\n) {\n  const manipulator = vtkPlaneManipulator.newInstance();\n  updatePlaneManipulatorFor2DView(manipulator, viewDir, slice, imageMetadata);\n  return manipulator;\n}\n","<script lang=\"ts\">\nimport {\n  defineComponent,\n  PropType,\n  toRefs,\n  watchEffect,\n  computed,\n  inject,\n  onUnmounted,\n  onMounted,\n} from 'vue';\nimport vtkPlaneManipulator from '@kitware/vtk.js/Widgets/Manipulators/PlaneManipulator';\nimport { LPSAxisDir } from '@/src/types/lps';\nimport { useImage } from '@/src/composables/useCurrentImage';\nimport { updatePlaneManipulatorFor2DView } from '@/src/utils/manipulators';\nimport { vtkCrosshairsViewWidget } from '@/src/vtk/CrosshairsWidget';\nimport { useCrosshairsToolStore } from '@/src/store/tools/crosshairs';\nimport { Maybe } from '@/src/types';\nimport { VtkViewContext } from '@/src/components/vtk/context';\nimport { useSliceInfo } from '@/src/composables/useSliceInfo';\n\nexport default defineComponent({\n  name: 'CrosshairsWidget2D',\n  props: {\n    viewId: {\n      type: String,\n      required: true,\n    },\n    viewDirection: {\n      type: String as PropType<LPSAxisDir>,\n      required: true,\n    },\n    imageId: String as PropType<Maybe<string>>,\n  },\n  setup(props) {\n    const { viewDirection, imageId, viewId } = toRefs(props);\n\n    const view = inject(VtkViewContext);\n    if (!view) throw new Error('No VtkView');\n\n    const sliceInfo = useSliceInfo(viewId, imageId);\n    const slice = computed(() => {\n      return sliceInfo.value?.slice;\n    });\n\n    const crosshairsStore = useCrosshairsToolStore();\n    const factory = crosshairsStore.getWidgetFactory();\n    const widget = view.widgetManager.addWidget(\n      factory\n    ) as vtkCrosshairsViewWidget;\n\n    onUnmounted(() => {\n      view.widgetManager.removeWidget(factory);\n    });\n\n    // --- manipulator --- //\n\n    const manipulator = vtkPlaneManipulator.newInstance();\n    widget.setManipulator(manipulator);\n\n    const { metadata: imageMetadata } = useImage(imageId);\n    watchEffect(() => {\n      if (slice.value == null) return;\n      updatePlaneManipulatorFor2DView(\n        manipulator,\n        viewDirection.value,\n        slice.value,\n        imageMetadata.value\n      );\n    });\n\n    // --- visibility --- //\n\n    widget.setVisibility(true);\n\n    // --- focus and rendering --- //\n\n    onMounted(() => {\n      view.widgetManager.renderWidgets();\n    });\n\n    return () => null;\n  },\n});\n</script>\n","<template>\n  <g>\n    <line\n      v-if=\"x != null && y != null\"\n      :x1=\"x\"\n      y1=\"0%\"\n      :x2=\"x\"\n      :y2=\"y - 8\"\n      stroke=\"yellow\"\n      stroke-width=\"1\"\n    />\n    <line\n      v-if=\"x != null && y != null\"\n      :x1=\"x\"\n      :y1=\"y + 8\"\n      :x2=\"x\"\n      y2=\"100%\"\n      stroke=\"yellow\"\n      stroke-width=\"1\"\n    />\n    <line\n      v-if=\"x != null && y != null\"\n      x1=\"0%\"\n      :y1=\"y\"\n      :x2=\"x - 8\"\n      :y2=\"y\"\n      stroke=\"yellow\"\n      stroke-width=\"1\"\n    />\n    <line\n      v-if=\"x != null && y != null\"\n      :x1=\"x + 8\"\n      :y1=\"y\"\n      x2=\"100%\"\n      :y2=\"y\"\n      stroke=\"yellow\"\n      stroke-width=\"1\"\n    />\n  </g>\n</template>\n\n<script lang=\"ts\">\nimport { onVTKEvent } from '@/src/composables/onVTKEvent';\nimport { worldToSVG } from '@/src/utils/vtk-helpers';\nimport type { Vector3 } from '@kitware/vtk.js/types';\nimport {\n  PropType,\n  defineComponent,\n  toRefs,\n  unref,\n  ref,\n  watchEffect,\n  computed,\n  inject,\n} from 'vue';\nimport { VtkViewContext } from '@/src/components/vtk/context';\nimport { vtkFieldRef } from '@/src/core/vtk/vtkFieldRef';\nimport { useResizeObserver } from '@vueuse/core';\n\ntype SVGPoint = {\n  x: number;\n  y: number;\n};\n\nexport default defineComponent({\n  props: {\n    position: Array as PropType<Array<number>>,\n  },\n  setup(props) {\n    const { position } = toRefs(props);\n    const position2D = ref<SVGPoint>();\n\n    const view = inject(VtkViewContext);\n    if (!view) throw new Error('No VtkView');\n\n    const updatePoints = () => {\n      const viewRenderer = view.renderer;\n      const pt = unref(position) as Vector3 | undefined;\n      if (pt) {\n        const point2D = worldToSVG(pt, viewRenderer);\n        if (point2D) {\n          position2D.value = {\n            x: point2D[0],\n            y: point2D[1],\n          };\n        }\n      }\n    };\n\n    const camera = vtkFieldRef(view.renderer, 'activeCamera');\n    onVTKEvent(camera, 'onModified', updatePoints);\n\n    watchEffect(updatePoints);\n\n    // --- resize --- //\n\n    const container = vtkFieldRef(view.renderWindowView, 'container');\n    useResizeObserver(container, () => {\n      updatePoints();\n    });\n\n    return {\n      x: computed(() => position2D.value?.x),\n      y: computed(() => position2D.value?.y),\n    };\n  },\n});\n</script>\n\n<style scoped>\n.handle {\n  cursor: pointer;\n}\n</style>\n","<template>\n  <div v-if=\"active\" class=\"overlay-no-events\">\n    <svg class=\"overlay-no-events\">\n      <CrosshairSVG2D v-show=\"isVisible\" :position=\"position\" />\n    </svg>\n    <CrosshairsWidget2D\n      :image-id=\"imageId\"\n      :view-id=\"viewId\"\n      :view-direction=\"viewDirection\"\n    />\n  </div>\n</template>\n\n<script lang=\"ts\">\nimport { storeToRefs } from 'pinia';\nimport { computed, defineComponent, PropType, toRefs } from 'vue';\nimport { getLPSAxisFromDir } from '@/src/utils/lps';\nimport { LPSAxisDir } from '@/src/types/lps';\nimport { useToolStore } from '@/src/store/tools';\nimport { Tools } from '@/src/store/tools/types';\nimport { useCrosshairsToolStore } from '@/src/store/tools/crosshairs';\nimport { useCurrentImage } from '@/src/composables/useCurrentImage';\nimport { clampValue } from '@/src/utils';\nimport { Maybe } from '@/src/types';\nimport { useSliceInfo } from '@/src/composables/useSliceInfo';\nimport CrosshairsWidget2D from './CrosshairsWidget2D.vue';\nimport CrosshairSVG2D from './CrosshairSVG2D.vue';\n\nexport default defineComponent({\n  name: 'CrosshairsTool',\n  props: {\n    viewId: {\n      type: String,\n      required: true,\n    },\n    viewDirection: {\n      type: String as PropType<LPSAxisDir>,\n      required: true,\n    },\n    imageId: String as PropType<Maybe<string>>,\n  },\n  components: {\n    CrosshairsWidget2D,\n    CrosshairSVG2D,\n  },\n  setup(props) {\n    const { viewId, imageId, viewDirection } = toRefs(props);\n\n    const toolStore = useToolStore();\n    const { position, imagePosition } = storeToRefs(useCrosshairsToolStore());\n\n    const sliceInfo = useSliceInfo(viewId, imageId);\n\n    const { currentImageMetadata } = useCurrentImage();\n    const active = computed(() => toolStore.currentTool === Tools.Crosshairs);\n    const isVisible = computed(() => {\n      if (!sliceInfo.value) return false;\n\n      const { lpsOrientation, dimensions } = currentImageMetadata.value;\n      const axis = getLPSAxisFromDir(viewDirection.value);\n      const index = lpsOrientation[axis];\n      // Since the image rectangle is inflated by 0.5,\n      // clamp to the allowed range for the slice.\n      const crosshairsSlice = clampValue(\n        imagePosition.value[index],\n        0,\n        dimensions[index] - 1\n      );\n      return Math.round(crosshairsSlice) === sliceInfo.value.slice;\n    });\n\n    return {\n      active,\n      position,\n      isVisible,\n    };\n  },\n});\n</script>\n\n<style scoped src=\"@/src/components/styles/vtk-view.css\"></style>\n","<script lang=\"ts\">\nimport {\n  computed,\n  onMounted,\n  onUnmounted,\n  defineComponent,\n  PropType,\n  toRefs,\n  watchEffect,\n  inject,\n} from 'vue';\nimport vtkPlaneManipulator from '@kitware/vtk.js/Widgets/Manipulators/PlaneManipulator';\nimport { getLPSAxisFromDir } from '@/src/utils/lps';\nimport { useImage } from '@/src/composables/useCurrentImage';\nimport { updatePlaneManipulatorFor2DView } from '@/src/utils/manipulators';\nimport { usePaintToolStore } from '@/src/store/tools/paint';\nimport { vtkPaintViewWidget } from '@/src/vtk/PaintWidget';\nimport { vec3 } from 'gl-matrix';\nimport { LPSAxisDir } from '@/src/types/lps';\nimport { onVTKEvent } from '@/src/composables/onVTKEvent';\nimport { useSliceInfo } from '@/src/composables/useSliceInfo';\nimport { VtkViewContext } from '@/src/components/vtk/context';\nimport { Maybe } from '@/src/types';\n\nexport default defineComponent({\n  name: 'PaintWidget2D',\n  props: {\n    viewId: {\n      type: String,\n      required: true,\n    },\n    viewDirection: {\n      type: String as PropType<LPSAxisDir>,\n      required: true,\n    },\n    imageId: String as PropType<Maybe<string>>,\n  },\n  setup(props) {\n    const { viewDirection, viewId, imageId } = toRefs(props);\n\n    const view = inject(VtkViewContext);\n    if (!view) throw new Error('No VtkView');\n\n    const sliceInfo = useSliceInfo(viewId, imageId);\n    const slice = computed(() => sliceInfo.value?.slice);\n\n    const paintStore = usePaintToolStore();\n    const widgetFactory = paintStore.getWidgetFactory();\n    const widgetState = widgetFactory.getWidgetState();\n\n    const { metadata: imageMetadata } = useImage(imageId);\n    const viewAxis = computed(() => getLPSAxisFromDir(viewDirection.value));\n    const viewAxisIndex = computed(\n      () => imageMetadata.value.lpsOrientation[viewAxis.value]\n    );\n\n    const worldPointToIndex = (worldPoint: vec3) => {\n      const { worldToIndex } = imageMetadata.value;\n      const indexPoint = vec3.create();\n      vec3.transformMat4(indexPoint, worldPoint, worldToIndex);\n      return indexPoint;\n    };\n\n    const widget = view.widgetManager.addWidget(\n      widgetFactory\n    ) as vtkPaintViewWidget;\n\n    onMounted(() => {\n      view.widgetManager.renderWidgets();\n      view.widgetManager.grabFocus(widget);\n    });\n\n    onUnmounted(() => {\n      view.widgetManager.removeWidget(widgetFactory);\n    });\n\n    // --- widget representation config --- //\n\n    watchEffect(() => {\n      const metadata = imageMetadata.value;\n      const slicingIndex = metadata.lpsOrientation[viewAxis.value];\n      if (widget) {\n        widget.setSlicingIndex(slicingIndex);\n        widget.setIndexToWorld(metadata.indexToWorld);\n        widget.setWorldToIndex(metadata.worldToIndex);\n      }\n    });\n\n    // --- interaction --- //\n\n    onVTKEvent(widget, 'onStartInteractionEvent', () => {\n      // StartInteraction cannot occur if origin is null.\n      const indexPoint = worldPointToIndex(widgetState.getBrush().getOrigin()!);\n      paintStore.startStroke(indexPoint, viewAxisIndex.value);\n    });\n\n    onVTKEvent(widget, 'onInteractionEvent', () => {\n      const indexPoint = worldPointToIndex(widgetState.getBrush().getOrigin()!);\n      paintStore.placeStrokePoint(indexPoint, viewAxisIndex.value);\n    });\n\n    onVTKEvent(widget, 'onEndInteractionEvent', () => {\n      // end stroke\n      const indexPoint = worldPointToIndex(widgetState.getBrush().getOrigin()!);\n      paintStore.endStroke(indexPoint, viewAxisIndex.value);\n    });\n\n    // --- manipulator --- //\n\n    const manipulator = vtkPlaneManipulator.newInstance();\n    widget.setManipulator(manipulator);\n\n    watchEffect(() => {\n      if (slice.value == null) return;\n      updatePlaneManipulatorFor2DView(\n        manipulator,\n        viewDirection.value,\n        slice.value,\n        imageMetadata.value\n      );\n    });\n\n    // --- visibility --- //\n\n    let checkIfPointerInView = false;\n\n    onMounted(() => {\n      widget.setVisibility(false);\n      checkIfPointerInView = true;\n    });\n\n    // Turn on widget visibility and update stencil\n    // if mouse starts within view\n    onVTKEvent(view.interactor, 'onMouseMove', () => {\n      if (!checkIfPointerInView) {\n        return;\n      }\n      checkIfPointerInView = false;\n\n      widget.setVisibility(true);\n      paintStore.setSliceAxis(viewAxisIndex.value);\n    });\n\n    onVTKEvent(view.interactor, 'onMouseEnter', () => {\n      paintStore.setSliceAxis(viewAxisIndex.value);\n      widget.setVisibility(true);\n    });\n\n    onVTKEvent(view.interactor, 'onMouseLeave', () => {\n      widget.setVisibility(false);\n    });\n\n    return () => null;\n  },\n});\n</script>\n","<template>\n  <div class=\"overlay-no-events\">\n    <PaintWidget2D\n      v-if=\"active\"\n      :view-id=\"viewId\"\n      :image-id=\"imageId\"\n      :view-direction=\"viewDirection\"\n    />\n  </div>\n</template>\n\n<script lang=\"ts\">\nimport { computed, defineComponent, PropType } from 'vue';\nimport { usePaintToolStore } from '@/src/store/tools/paint';\nimport { LPSAxisDir } from '@/src/types/lps';\nimport { Maybe } from '@/src/types';\nimport PaintWidget2D from './PaintWidget2D.vue';\n\nexport default defineComponent({\n  name: 'PaintTool',\n  props: {\n    viewId: {\n      type: String,\n      required: true,\n    },\n    viewDirection: {\n      type: String as PropType<LPSAxisDir>,\n      required: true,\n    },\n    imageId: String as PropType<Maybe<string>>,\n  },\n  components: {\n    PaintWidget2D,\n  },\n  setup() {\n    const paintStore = usePaintToolStore();\n    const active = computed(() => paintStore.isActive);\n\n    return {\n      active,\n    };\n  },\n});\n</script>\n\n<style scoped src=\"@/src/components/styles/vtk-view.css\"></style>\n","import { useDebounceFn } from '@vueuse/core';\nimport { ref } from 'vue';\n\n// reset: isSet = false immediately. After delay, isSet = true\nexport const usePopperState = (delay: number) => {\n  const isSet = ref(true);\n\n  const delayedSet = useDebounceFn(() => {\n    isSet.value = true;\n  }, delay);\n\n  const reset = () => {\n    isSet.value = false;\n    delayedSet();\n  };\n\n  return { isSet, reset };\n};\n","import {\n  MaybeRef,\n  Ref,\n  UnwrapRef,\n  computed,\n  onMounted,\n  readonly,\n  ref,\n  unref,\n  watch,\n} from 'vue';\nimport type { Vector2 } from '@kitware/vtk.js/types';\nimport { useCurrentImage } from '@/src/composables/useCurrentImage';\nimport { frameOfReferenceToImageSliceAndAxis } from '@/src/utils/frameOfReference';\nimport { onVTKEvent } from '@/src/composables/onVTKEvent';\nimport { Maybe } from '@/src/types';\nimport { useToolStore } from '@/src/store/tools';\nimport { Tools } from '@/src/store/tools/types';\nimport { AnnotationToolStore } from '@/src/store/tools/useAnnotationTool';\nimport { getCSSCoordinatesFromEvent } from '@/src/utils/vtk-helpers';\nimport { LPSAxis } from '@/src/types/lps';\nimport { AnnotationTool, ToolID } from '@/src/types/annotation-tool';\nimport vtkAbstractWidget from '@kitware/vtk.js/Widgets/Core/AbstractWidget';\nimport { usePopperState } from '@/src/composables/usePopperState';\nimport {\n  ContextMenuEvent,\n  vtkAnnotationToolWidget,\n} from '@/src/vtk/ToolWidgetUtils/types';\nimport { ImageMetadata } from '@/src/types/image';\nimport { View } from '@/src/core/vtk/types';\nimport { watchImmediate } from '@vueuse/core';\n\nconst SHOW_OVERLAY_DELAY = 250; // milliseconds\n\n// does the tools's frame of reference match\n// the view's axis\nexport const doesToolFrameMatchViewAxis = <Tool extends AnnotationTool>(\n  viewAxis: MaybeRef<LPSAxis>,\n  tool: Partial<Tool>,\n  imageMetadata: MaybeRef<ImageMetadata>\n) => {\n  if (!tool.frameOfReference) return false;\n\n  const toolAxis = frameOfReferenceToImageSliceAndAxis(\n    tool.frameOfReference,\n    unref(imageMetadata),\n    {\n      allowOutOfBoundsSlice: true,\n    }\n  );\n  return !!toolAxis && toolAxis.axis === unref(viewAxis);\n};\n\nexport const useCurrentTools = <S extends AnnotationToolStore>(\n  toolStore: S,\n  viewAxis: Ref<LPSAxis>\n) => {\n  const { currentImageID, currentImageMetadata } = useCurrentImage();\n  return computed(() => {\n    const curImageID = currentImageID.value;\n\n    type ToolType = S['tools'][number];\n    return (toolStore.tools as Array<ToolType>).filter((tool) => {\n      // only show tools for the current image,\n      // current view axis and not hidden\n      return (\n        tool.imageID === curImageID &&\n        doesToolFrameMatchViewAxis(viewAxis, tool, currentImageMetadata) &&\n        !tool.hidden\n      );\n    });\n  });\n};\n\n// --- Context Menu --- //\n\nexport const useContextMenu = () => {\n  const contextMenu = ref<{\n    open: (id: ToolID, e: ContextMenuEvent) => void;\n  } | null>(null);\n  const openContextMenu = (toolID: ToolID, event: ContextMenuEvent) => {\n    if (!contextMenu.value)\n      throw new Error('contextMenu component does not exist');\n    contextMenu.value.open(toolID, event);\n  };\n\n  return { contextMenu, openContextMenu };\n};\n\nexport const useRightClickContextMenu = (\n  emit: (event: 'contextmenu', ...args: any[]) => void,\n  widget: MaybeRef<vtkAnnotationToolWidget | null>\n) => {\n  onVTKEvent(widget, 'onRightClickEvent', (eventData) => {\n    const displayXY = getCSSCoordinatesFromEvent(eventData);\n    if (displayXY) {\n      emit('contextmenu', {\n        displayXY,\n        widgetActions: eventData.widgetActions,\n      } satisfies ContextMenuEvent);\n    }\n  });\n};\n\n// --- Hover --- //\n\nexport const useHoverEvent = (\n  emit: (event: 'widgetHover', ...args: any[]) => void,\n  widget: MaybeRef<vtkAnnotationToolWidget | null>\n) => {\n  onVTKEvent(widget, 'onHoverEvent', (eventData: any) => {\n    const displayXY = getCSSCoordinatesFromEvent(eventData);\n    if (displayXY) {\n      emit('widgetHover', {\n        displayXY,\n        hovering: eventData.hovering,\n      });\n    }\n  });\n};\n\nexport type OverlayInfo =\n  | {\n      visible: false;\n    }\n  | {\n      visible: true;\n      toolID: ToolID;\n      displayXY: Vector2;\n    };\n\n// Maintains list of tools' hover states.\n// If one tool hovered, overlayInfo.visible === true with toolID and displayXY.\nexport const useHover = (\n  tools: Ref<Array<AnnotationTool>>,\n  currentSlice: Ref<number>\n) => {\n  type Info = OverlayInfo;\n  const toolHoverState = ref({}) as Ref<Record<ToolID, Info>>;\n\n  const toolsOnCurrentSlice = computed(() =>\n    tools.value.filter((tool) => tool.slice === currentSlice.value)\n  );\n\n  watch(toolsOnCurrentSlice, () => {\n    // keep old hover states, default to false for new tools\n    toolHoverState.value = toolsOnCurrentSlice.value.reduce(\n      (toolsHovers, { id }) => {\n        const state = toolHoverState.value[id] ?? {\n          visible: false,\n        };\n        return Object.assign(toolsHovers, {\n          [id]: state,\n        });\n      },\n      {} as Record<ToolID, Info>\n    );\n  });\n\n  const onHover = (id: ToolID, event: any) => {\n    toolHoverState.value[id] = event.hovering\n      ? {\n          visible: true,\n          toolID: id,\n          displayXY: event.displayXY,\n        }\n      : {\n          visible: false,\n        };\n  };\n\n  // If hovering true, debounce showing overlay.\n  // Immediately hide overlay if hovering false.\n  const synchronousOverlayInfo = computed(() => {\n    const visibleToolID = Object.keys(toolHoverState.value).find(\n      (toolID) => toolHoverState.value[toolID as ToolID].visible\n    ) as ToolID | undefined;\n\n    return visibleToolID\n      ? toolHoverState.value[visibleToolID]\n      : ({ visible: false } as Info);\n  });\n\n  const { isSet: showOverlay, reset: resetOverlay } =\n    usePopperState(SHOW_OVERLAY_DELAY);\n\n  watch(synchronousOverlayInfo, resetOverlay);\n\n  const overlayInfo = computed(() =>\n    showOverlay.value\n      ? synchronousOverlayInfo.value\n      : ({ visible: false } as Info)\n  );\n\n  const toolStore = useToolStore();\n  const noInfoWithoutSelect = computed(() => {\n    if (toolStore.currentTool !== Tools.Select)\n      return { visible: false } as Info;\n    return overlayInfo.value;\n  });\n\n  return { overlayInfo: noInfoWithoutSelect, onHover };\n};\n\nexport const usePlacingAnnotationTool = (\n  store: AnnotationToolStore,\n  metadata: Ref<Partial<AnnotationTool>>\n) => {\n  const id = ref<Maybe<ToolID>>(null);\n\n  const commit = () => {\n    const id_ = id.value as Maybe<ToolID>;\n    if (!id_) return;\n    store.updateTool(id_, { placing: false });\n    id.value = null;\n  };\n\n  const add = () => {\n    if (id.value) throw new Error('Placing tool already exists.');\n    id.value = store.addTool({\n      ...metadata.value,\n      placing: true,\n    }) as UnwrapRef<ToolID>;\n  };\n\n  const remove = () => {\n    const id_ = id.value as Maybe<ToolID>;\n    if (!id_) return;\n    store.removeTool(id_);\n    id.value = null;\n  };\n\n  watch(metadata, () => {\n    if (!id.value) return;\n    store.updateTool(id.value as ToolID, metadata.value);\n  });\n\n  return {\n    id: readonly(id),\n    commit,\n    add,\n    remove,\n  };\n};\n\nexport const useWidgetVisibility = <T extends vtkAbstractWidget>(\n  widget: T,\n  visible: Ref<boolean>,\n  view: View\n) => {\n  // toggles the pickability of the ruler handles,\n  // since the 3D ruler parts are visually hidden.\n  watchImmediate(\n    () => visible.value,\n    (visibility) => {\n      widget.setVisibility(visibility);\n    }\n  );\n\n  onMounted(() => {\n    // hide handle visibility, but not picking visibility\n    widget.setHandleVisibility(false);\n    view.widgetManager.renderWidgets();\n    view.requestRender();\n  });\n};\n","<script setup lang=\"ts\">\nimport { computed, shallowReactive } from 'vue';\nimport { AnnotationToolStore } from '@/src/store/tools/useAnnotationTool';\nimport {\n  ContextMenuEvent,\n  WidgetAction,\n} from '@/src/vtk/ToolWidgetUtils/types';\nimport { ToolID } from '@/src/types/annotation-tool';\n\nconst props = defineProps<{\n  toolStore: AnnotationToolStore;\n}>();\n\nconst contextMenu = shallowReactive({\n  show: false,\n  x: 0,\n  y: 0,\n  forToolID: '' as ToolID,\n  widgetActions: [] as Array<WidgetAction>,\n});\n\nconst open = (id: ToolID, event: ContextMenuEvent) => {\n  const { displayXY } = event;\n  [contextMenu.x, contextMenu.y] = displayXY;\n  contextMenu.forToolID = id;\n  contextMenu.show = true;\n  contextMenu.widgetActions = event.widgetActions;\n};\n\ndefineExpose({\n  open,\n});\n\nconst tool = computed(() => {\n  return props.toolStore.toolByID[contextMenu.forToolID];\n});\n\nconst deleteToolFromContextMenu = () => {\n  props.toolStore.removeTool(contextMenu.forToolID);\n};\n\nconst hideToolFromContextMenu = () => {\n  props.toolStore.updateTool(contextMenu.forToolID, {\n    hidden: true,\n  });\n};\n</script>\n\n<template>\n  <v-menu\n    v-if=\"tool\"\n    v-model=\"contextMenu.show\"\n    class=\"position-absolute\"\n    :style=\"{\n      top: `${contextMenu.y}px`,\n      left: `${contextMenu.x}px`,\n    }\"\n    close-on-click\n    close-on-content-click\n  >\n    <v-list density=\"compact\">\n      <v-list-item>\n        <template v-slot:prepend>\n          <div\n            class=\"color-dot v-icon\"\n            :style=\"{ backgroundColor: tool.color }\"\n          />\n        </template>\n        <v-list-item-title class=\"v-list-item--disabled\">\n          {{ tool.labelName }}\n        </v-list-item-title>\n      </v-list-item>\n\n      <!-- Separate informative items from interactive items -->\n      <v-divider></v-divider>\n\n      <v-list-item @click=\"hideToolFromContextMenu\">\n        <template v-slot:prepend>\n          <v-icon>mdi-eye</v-icon>\n        </template>\n        <v-list-item-title>Hide</v-list-item-title>\n      </v-list-item>\n\n      <v-list-item @click=\"deleteToolFromContextMenu\">\n        <template v-slot:prepend>\n          <v-icon>mdi-delete</v-icon>\n        </template>\n        <v-list-item-title>Delete Annotation</v-list-item-title>\n      </v-list-item>\n\n      <!-- Optional items below stable items for muscle memory  -->\n      <slot></slot>\n      <v-list-item\n        v-for=\"action in contextMenu.widgetActions\"\n        @click=\"action.func\"\n        :key=\"action.name\"\n      >\n        <template v-slot:prepend>\n          <v-icon></v-icon>\n        </template>\n        <v-list-item-title>{{ action.name }}</v-list-item-title>\n      </v-list-item>\n    </v-list>\n  </v-menu>\n</template>\n\n<style scoped>\n.color-dot {\n  width: 24px;\n  height: 24px;\n  background: yellow;\n  border-radius: 16px;\n  opacity: 1 !important;\n}\n</style>\n","<script setup lang=\"ts\">\nimport { computed, ref } from 'vue';\nimport { useElementSize } from '@vueuse/core';\nimport { AnnotationToolStore } from '@/src/store/tools/useAnnotationTool';\nimport { OverlayInfo } from '@/src/composables/annotationTool';\n\n// These seem to work \\_()_/\nconst TOOLTIP_PADDING_X = 30;\nconst TOOLTIP_PADDING_Y = 20;\n\nconst props = defineProps<{\n  info: OverlayInfo;\n  toolStore: AnnotationToolStore;\n}>();\n\nconst visible = computed(() => {\n  return props.info.visible;\n});\n\nconst label = computed(() => {\n  if (!props.info.visible) return '';\n  return props.toolStore.toolByID[props.info.toolID].labelName;\n});\n\nconst tooltip = ref();\nconst content = computed(() => {\n  return tooltip.value?.contentEl;\n});\n\nconst { width, height } = useElementSize(content);\nconst offset = computed(() => {\n  return {\n    // Tooltip location is above cursor and centered\n    // Don't know how to get ref to parent v-tooltip element, so adding fudge padding.\n    x: (width.value + TOOLTIP_PADDING_X) / 2,\n    y: height.value + TOOLTIP_PADDING_Y,\n  };\n});\n</script>\n\n<template>\n  <v-tooltip\n    ref=\"tooltip\"\n    v-if=\"info.visible\"\n    v-model=\"visible\"\n    :style=\"{\n      left: `${info.displayXY[0] - offset.x}px`,\n      top: `${info.displayXY[1] - offset.y}px`,\n      zIndex: 500, // stay under context menu\n    }\"\n    class=\"better-contrast\"\n  >\n    {{ label }}\n  </v-tooltip>\n</template>\n\n<style scoped>\n.better-contrast :deep(.v-overlay__content) {\n  opacity: 1 !important;\n  background: rgba(255, 255, 255, 0.9) !important;\n}\n</style>\n","import { ImageMetadata } from '@/src/types/image';\nimport { LPSAxisDir } from '@/src/types/lps';\nimport { FrameOfReference } from '@/src/utils/frameOfReference';\nimport { getLPSAxisFromDir } from '@/src/utils/lps';\nimport type { Vector3 } from '@kitware/vtk.js/types';\nimport { vec3 } from 'gl-matrix';\nimport { computed, unref } from 'vue';\nimport type { ComputedRef, MaybeRef } from 'vue';\n\nexport function useFrameOfReference(\n  viewDirection: MaybeRef<LPSAxisDir>,\n  slice: MaybeRef<number>,\n  imageMetadata: MaybeRef<ImageMetadata>\n): ComputedRef<FrameOfReference> {\n  const viewAxis = computed(() => getLPSAxisFromDir(unref(viewDirection)));\n\n  return computed(() => {\n    const { lpsOrientation, indexToWorld } = unref(imageMetadata);\n    const planeNormal = lpsOrientation[unref(viewDirection)] as Vector3;\n\n    const lpsIdx = lpsOrientation[viewAxis.value];\n    const planeOrigin: Vector3 = [0, 0, 0];\n    planeOrigin[lpsIdx] = unref(slice);\n    // convert index pt to world pt\n    vec3.transformMat4(planeOrigin, planeOrigin, indexToWorld);\n\n    return {\n      planeNormal,\n      planeOrigin,\n    };\n  });\n}\n","import macro from '@kitware/vtk.js/macros';\nimport * as vtkMath from '@kitware/vtk.js/Common/Core/Math';\nimport vtkGlyph3DMapper from '@kitware/vtk.js/Rendering/Core/Glyph3DMapper';\nimport vtkGlyphRepresentation from '@kitware/vtk.js/Widgets/Representations/GlyphRepresentation';\nimport { Behavior } from '@kitware/vtk.js/Widgets/Representations/WidgetRepresentation/Constants';\nimport { allocateArray } from '@kitware/vtk.js/Widgets/Representations/WidgetRepresentation';\nimport vtkCylinderSource from '@kitware/vtk.js/Filters/Sources/CylinderSource';\nimport { OrientationModes } from '@kitware/vtk.js/Rendering/Core/Glyph3DMapper/Constants';\nimport { getPixelWorldHeightAtCoord } from '@kitware/vtk.js/Widgets/Core/WidgetManager';\n\nfunction vtkLineGlyphRepresentation(publicAPI, model) {\n  model.classHierarchy.push('vtkLineGlyphRepresentation');\n\n  publicAPI.setGlyphResolution = macro.chain(\n    publicAPI.setGlyphResolution,\n    model._pipeline.glyph.setResolution\n  );\n}\n\nfunction cylinderScale(publicAPI, model) {\n  return (polyData, states) => {\n    model._pipeline.mapper.setScaleArray('scale');\n    model._pipeline.mapper.setScaleFactor(1);\n    model._pipeline.mapper.setScaling(true);\n    model._pipeline.mapper.setScaleMode(\n      vtkGlyph3DMapper.ScaleModes.SCALE_BY_COMPONENTS\n    );\n    const scales = allocateArray(\n      polyData,\n      'scale',\n      states.length,\n      'Float32Array',\n      3\n    ).getData();\n    let j = 0;\n    for (let i = 0; i < states.length; ++i) {\n      const state = states[i];\n      const origin = state.getOrigin();\n      const nextOrigin =\n        states[i === states.length - 1 ? 0 : i + 1].getOrigin();\n\n      const direction = vtkMath.subtract(nextOrigin, origin, []);\n      const length = vtkMath.normalize(direction);\n\n      let scaleFactor = state.getActive() ? model.activeScaleFactor : 1;\n      if (publicAPI.getScaleInPixels()) {\n        scaleFactor *= getPixelWorldHeightAtCoord(\n          state.getOrigin(),\n          model.displayScaleParams\n        );\n      }\n      if (!model.forceLineThickness) {\n        scaleFactor *= state.getScale1?.() ?? 1;\n      }\n      const scale = [1, model.lineThickness, model.lineThickness];\n      scales[j++] = length * scale[0];\n      scales[j++] = scaleFactor * scale[1];\n      scales[j++] = scaleFactor * scale[2];\n    }\n  };\n}\n\nfunction cylinderDirection(publicAPI, model) {\n  return (polyData, states) => {\n    model._pipeline.mapper.setOrientationArray('orientation');\n    model._pipeline.mapper.setOrientationMode(OrientationModes.MATRIX);\n    const orientation = allocateArray(\n      polyData,\n      'orientation',\n      states.length,\n      'Float32Array',\n      9\n    ).getData();\n    for (let i = 0; i < states.length; ++i) {\n      const state = states[i];\n      const origin = state.getOrigin();\n      const nextOrigin =\n        states[i === states.length - 1 ? 0 : i + 1].getOrigin();\n\n      const direction = vtkMath.subtract(nextOrigin, origin, []);\n      vtkMath.normalize(direction);\n      const right = [1, 0, 0];\n      const up = [0, 1, 0];\n      vtkMath.perpendiculars(direction, up, right, 0);\n\n      orientation.set(direction, 9 * i);\n      orientation.set(up, 9 * i + 3);\n      orientation.set(right, 9 * i + 6);\n    }\n  };\n}\n\n// ----------------------------------------------------------------------------\n// Object factory\n// ----------------------------------------------------------------------------\n\nfunction defaultValues(publicAPI, model, initialValues) {\n  return {\n    behavior: Behavior.CONTEXT,\n    glyphResolution: 32,\n    lineThickness: 0.5, // radius of the cylinder\n    forceLineThickness: false,\n    ...initialValues,\n    _pipeline: {\n      glyph:\n        initialValues?.pipeline?.glyph ??\n        vtkCylinderSource.newInstance({\n          direction: [1, 0, 0],\n          center: [0.5, 0, 0], // origin of cylinder at end, not center\n          capping: false,\n        }),\n      ...initialValues?.pipeline,\n    },\n    applyMixin: {\n      noScale: cylinderScale(publicAPI, model),\n      scale1: cylinderScale(publicAPI, model),\n      noOrientation: cylinderDirection(publicAPI, model),\n    },\n  };\n}\n\n// ----------------------------------------------------------------------------\n\nexport function extend(publicAPI, model, initialValues = {}) {\n  vtkGlyphRepresentation.extend(\n    publicAPI,\n    model,\n    defaultValues(publicAPI, model, initialValues)\n  );\n  macro.setGet(publicAPI, model, [\n    'glyphResolution',\n    'lineThickness',\n    'forceLineThickness',\n  ]);\n  macro.get(publicAPI, model._pipeline, ['glyph', 'mapper', 'actor']);\n\n  vtkLineGlyphRepresentation(publicAPI, model);\n}\n\n// ----------------------------------------------------------------------------\n\nexport const newInstance = macro.newInstance(\n  extend,\n  'vtkLineGlyphRepresentation'\n);\n\n// ----------------------------------------------------------------------------\n\nexport default { newInstance, extend };\n","import { distance2BetweenPoints } from '@kitware/vtk.js/Common/Core/Math';\nimport macro from '@kitware/vtk.js/macros';\nimport type { Vector3 } from '@kitware/vtk.js/types';\nimport vtkRenderer from '@kitware/vtk.js/Rendering/Core/Renderer';\n\nimport { WidgetAction } from '@/src/vtk/ToolWidgetUtils/types';\nimport { computeWorldCoords } from '@/src/vtk/ToolWidgetUtils/utils';\n\ntype Position3d = { x: number; y: number; z: number };\ntype vtkMouseEvent = {\n  position: Position3d;\n  pokedRenderer: vtkRenderer;\n};\n\nconst FINISHABLE_DISTANCE = 10;\nconst FINISHABLE_DISTANCE_SQUARED = FINISHABLE_DISTANCE ** 2;\n\nconst DOUBLE_CLICK_TIMEOUT = 300; // milliseconds\nconst DOUBLE_CLICK_SLIP_DISTANCE_MAX = 10; // pixels\nconst DOUBLE_CLICK_SLIP_DISTANCE_MAX_SQUARED =\n  DOUBLE_CLICK_SLIP_DISTANCE_MAX ** 2;\n\nexport default function widgetBehavior(publicAPI: any, model: any) {\n  model.classHierarchy.push('vtkPolygonWidgetBehavior');\n\n  const setDragging = (isDragging: boolean) => {\n    model._dragging = isDragging;\n    publicAPI.invokeDraggingEvent({\n      dragging: isDragging,\n    });\n  };\n\n  // overUnselectedHandle is true if mouse is over handle that was created before a mouse move event.\n  // That happens if creating new handle and immediately dragging.\n  // Then widgetManager.getSelections() still points to the last actor\n  // after the mouse button is released. In this widgets case, the last actor is part of the LineGlyphRepresentation.\n  // overUnselectedHandle tracks if the mouse is over the new handle so we\n  // don't create a another handle when clicking after without mouse move.\n  // A mouse move event sets overUnselectedHandle to false as we can then rely on widgetManager.getSelections().\n  let overUnselectedHandle = false;\n\n  let freeHanding = false;\n\n  // Check if mouse is over line segment between handles\n  const checkOverSegment = () => {\n    // overSegment guards against clicking anywhere in view\n    const selections = model._widgetManager.getSelections();\n    const overSegment =\n      selections?.[0]?.getProperties().prop ===\n      model.representations[1].getActors()[0]; // line representation is second representation\n    return overSegment && !overUnselectedHandle;\n  };\n\n  // support setting per-view widget manipulators\n  macro.setGet(publicAPI, model, ['manipulator']);\n\n  // events to emit\n  macro.event(publicAPI, model, 'RightClickEvent');\n  macro.event(publicAPI, model, 'PlacedEvent');\n  macro.event(publicAPI, model, 'HoverEvent');\n  macro.event(publicAPI, model, 'DraggingEvent');\n\n  publicAPI.resetInteractions = () => {\n    model._interactor.cancelAnimation(publicAPI, true);\n  };\n\n  // --------------------------------------------------------------------------\n  // Interactor events\n  // --------------------------------------------------------------------------\n\n  const reset = () => {\n    publicAPI.loseFocus();\n    model.widgetState.clearHandles();\n  };\n\n  const removeLastHandle = () => {\n    const handles = model.widgetState.getHandles();\n    if (handles.length > 0) {\n      model.widgetState.removeHandle(handles.length - 1);\n      if (handles.length === 0) {\n        reset();\n      }\n    }\n  };\n\n  const finishPlacing = () => {\n    model.widgetState.setPlacing(false);\n    publicAPI.loseFocus();\n    // Tool Component listens for 'placed' event\n    publicAPI.invokePlacedEvent();\n  };\n\n  function isFinishable() {\n    const handles = model.widgetState.getHandles();\n    const moveHandle = model.widgetState.getMoveHandle();\n\n    if (model.activeState === moveHandle && handles.length >= 3) {\n      // Check moveHandle distance to first handle\n      const moveCoords = model._apiSpecificRenderWindow.worldToDisplay(\n        ...moveHandle.getOrigin(),\n        model._renderer\n      );\n      const firstCoords = model._apiSpecificRenderWindow.worldToDisplay(\n        ...handles[0].getOrigin(),\n        model._renderer\n      );\n      if (!moveCoords || !firstCoords) return false;\n\n      const cssPixelDistance =\n        FINISHABLE_DISTANCE_SQUARED *\n        model._apiSpecificRenderWindow.getComputedDevicePixelRatio();\n      const distance = distance2BetweenPoints(firstCoords, moveCoords);\n      return distance < cssPixelDistance;\n    }\n\n    return false;\n  }\n\n  const getWorldCoords = computeWorldCoords(model);\n\n  // returns macro.EVENT_ABORT if dragging handle or finishing\n  // to indicate event should be consumed.\n  function updateActiveStateHandle(callData: any) {\n    const worldCoords = getWorldCoords(callData);\n\n    if (\n      worldCoords?.length &&\n      (model.activeState === model.widgetState.getMoveHandle() ||\n        model._dragging)\n    ) {\n      model.activeState.setOrigin(worldCoords);\n\n      model.widgetState.setFinishable(isFinishable());\n\n      if (model.widgetState.getFinishable())\n        // snap to first point\n        model.activeState.setOrigin(\n          model.widgetState.getHandles()[0].getOrigin()\n        );\n\n      publicAPI.invokeInteractionEvent();\n\n      return macro.EVENT_ABORT;\n    }\n    return macro.VOID;\n  }\n\n  function addHandle() {\n    const moveHandle = model.widgetState.getMoveHandle();\n    const newHandle = model.widgetState.addHandle();\n    newHandle.setOrigin(moveHandle.getOrigin());\n  }\n\n  // --------------------------------------------------------------------------\n  // Left press: Select handle to drag / Add new handle\n  // --------------------------------------------------------------------------\n\n  publicAPI.handleLeftButtonPress = (event: vtkMouseEvent) => {\n    const activeWidget = model._widgetManager.getActiveWidget();\n\n    if (\n      !model.manipulator ||\n      // If hovering over another widget, don't consume event.\n      (activeWidget && activeWidget !== publicAPI)\n    ) {\n      return macro.VOID;\n    }\n\n    if (checkOverSegment()) {\n      return macro.VOID;\n    }\n\n    // Drop point?\n    const manipulator =\n      model.activeState?.getManipulator?.() ?? model.manipulator;\n    if (model.widgetState.getPlacing() && manipulator) {\n      // Dropping first point?\n      if (model.widgetState.getHandles().length === 0) {\n        // update variables used by updateActiveStateHandle\n        model.activeState = model.widgetState.getMoveHandle();\n        model._widgetManager.grabFocus(publicAPI);\n      }\n      updateActiveStateHandle(event);\n\n      if (model.widgetState.getFinishable()) {\n        finishPlacing();\n        // Don't add another point, just return\n        return macro.EVENT_ABORT;\n      }\n\n      addHandle();\n      publicAPI.invokeStartInteractionEvent();\n      freeHanding = true;\n      return macro.EVENT_ABORT;\n    }\n\n    if (model.activeState?.getActive() && model.pickable && model.dragable) {\n      setDragging(true);\n      model._apiSpecificRenderWindow.setCursor('grabbing');\n      model._interactor.requestAnimation(publicAPI);\n      publicAPI.invokeStartInteractionEvent();\n      return macro.EVENT_ABORT;\n    }\n\n    return macro.VOID;\n  };\n\n  // --------------------------------------------------------------------------\n  // Mouse move: Drag selected handle / Handle follow the mouse\n  // --------------------------------------------------------------------------\n\n  publicAPI.handleMouseMove = (event: vtkMouseEvent) => {\n    if (\n      model.pickable &&\n      model.dragable &&\n      model.activeState &&\n      updateActiveStateHandle(event) === macro.EVENT_ABORT // side effect!\n    ) {\n      if (freeHanding) {\n        addHandle();\n      }\n      return macro.EVENT_ABORT; // consume event\n    }\n\n    // widgetManager.getSelections() updates on mouse move and not animating.\n    // (Widget triggers animation when dragging.)\n    // So we can rely on getSelections() to be up to date now\n    overUnselectedHandle = false;\n\n    if (model.hasFocus) {\n      model._widgetManager.disablePicking();\n    }\n\n    publicAPI.invokeHoverEvent({\n      ...event,\n      hovering: !!model.activeState,\n    });\n\n    return macro.VOID;\n  };\n\n  // --------------------------------------------------------------------------\n  // Left release: Finish drag\n  // --------------------------------------------------------------------------\n\n  // Detect double click by diffing these.\n  let lastReleaseTime = 0;\n  let lastReleasePosition: Vector3 | undefined;\n  function isDoubleClick(event: vtkMouseEvent) {\n    const currentTime = Date.now();\n    const currentDisplayPos = [\n      event.position.x,\n      event.position.y,\n      event.position.z,\n    ] as Vector3;\n    const elapsed = currentTime - lastReleaseTime;\n\n    const distance = lastReleasePosition\n      ? distance2BetweenPoints(\n          [event.position.x, event.position.y, event.position.z],\n          lastReleasePosition\n        )\n      : Number.POSITIVE_INFINITY;\n\n    const doubleClicked =\n      elapsed < DOUBLE_CLICK_TIMEOUT &&\n      distance < DOUBLE_CLICK_SLIP_DISTANCE_MAX_SQUARED;\n\n    lastReleaseTime = currentTime;\n    lastReleasePosition = currentDisplayPos;\n    return doubleClicked;\n  }\n\n  publicAPI.handleLeftButtonRelease = (event: vtkMouseEvent) => {\n    if (\n      !model.activeState ||\n      !model.activeState.getActive() ||\n      !model.pickable\n    ) {\n      return macro.VOID;\n    }\n\n    freeHanding = false;\n\n    if (model._dragging) {\n      model._apiSpecificRenderWindow.setCursor('pointer');\n      model._interactor.cancelAnimation(publicAPI);\n      setDragging(false);\n      model._widgetManager.enablePicking();\n      // So a following left click without moving the mouse can immediately grab the handle,\n      // we don't call model.widgetState.deactivate() here.\n      publicAPI.invokeEndInteractionEvent();\n      return macro.EVENT_ABORT;\n    }\n\n    // If not placing (and not dragging) don't consume event\n    // so camera control widgets can react.\n    if (!model.widgetState.getPlacing()) {\n      return macro.VOID;\n    }\n\n    if (model.widgetState.getFinishable()) {\n      finishPlacing();\n    } else if (isDoubleClick(event)) {\n      // try to finish placing\n      const handles = model.widgetState.getHandles();\n      // Need 3 handles to finish.  Double click created 2 handles, 1 extra.\n      if (handles.length >= 4) {\n        removeLastHandle();\n        finishPlacing();\n      }\n    }\n\n    if (\n      (model.hasFocus && !model.activeState) ||\n      (model.activeState && !model.activeState.getActive())\n    ) {\n      // update if mouse hovered over handle/activeState for next onDown\n      model._widgetManager.enablePicking();\n      model._interactor.render();\n    }\n\n    publicAPI.invokeEndInteractionEvent();\n    return macro.EVENT_ABORT;\n  };\n\n  // --------------------------------------------------------------------------\n  // Escape key: clear handles\n  // --------------------------------------------------------------------------\n\n  publicAPI.handleKeyDown = ({ key }: any) => {\n    if (model.widgetState.getPlacing() && key === 'Escape') {\n      reset();\n      return macro.EVENT_ABORT;\n    }\n\n    if (model.widgetState.getPlacing() && key === 'Enter') {\n      if (model.widgetState.getHandles().length >= 3) {\n        finishPlacing();\n      }\n      return macro.EVENT_ABORT;\n    }\n\n    return macro.VOID;\n  };\n\n  // Called when mouse moves off handle.\n  publicAPI.deactivateAllHandles = () => {\n    model.widgetState.deactivate();\n    // Context menu should only show if hovering over the tool.\n    // Stops right clicking anywhere showing context menu.\n    model.activeState = null;\n  };\n\n  // --------------------------------------------------------------------------\n  // Right press: Remove last handle / Pop context menu\n  // --------------------------------------------------------------------------\n\n  const makeWidgetActions = (eventData: any) => {\n    const widgetActions: Array<WidgetAction> = [];\n\n    const { activeState } = model;\n\n    const overSegment = checkOverSegment();\n\n    if (overSegment) {\n      // Allow inserting ponts when over a segment\n      widgetActions.push({\n        name: 'Add Point',\n        func: () => {\n          const insertIndex = activeState.getIndex() + 1;\n          const newHandle = model.widgetState.addHandle({ insertIndex });\n          const coords = getWorldCoords(eventData);\n          if (!coords) throw new Error('No world coords');\n          newHandle.setOrigin(coords);\n          // enable dragging immediately\n          publicAPI.activateHandle({\n            selectedState: newHandle,\n            representation: model.representations[0].getActors()[0], // first actor is GlyphMapper for handles\n          });\n        },\n      });\n    } else if (!overSegment && model.widgetState.getHandles().length > 2) {\n      // if hovering on handle and we will still have at least 2 points after removing handle\n      widgetActions.push({\n        name: 'Delete Point',\n        func: () => {\n          model.widgetState.removeHandle(activeState.getIndex());\n        },\n      });\n    }\n\n    return widgetActions;\n  };\n\n  publicAPI.handleRightButtonPress = (eventData: any) => {\n    if (!model.activeState) {\n      return macro.VOID;\n    }\n\n    if (model.widgetState.getPlacing()) {\n      removeLastHandle();\n      return macro.EVENT_ABORT;\n    }\n\n    const eventWithWidgetAction = {\n      ...eventData,\n      widgetActions: makeWidgetActions(eventData),\n    };\n\n    publicAPI.invokeRightClickEvent(eventWithWidgetAction);\n    return macro.EVENT_ABORT;\n  };\n\n  // --------------------------------------------------------------------------\n  // Focused means PolygonWidget is in initial drawing/placing mode.\n  // After first point dropped, make moveHandle follow mouse.\n  // --------------------------------------------------------------------------\n\n  publicAPI.grabFocus = () => {\n    if (!model.hasFocus) {\n      model.activeState = model.widgetState.getMoveHandle();\n      model.activeState.activate();\n      model.activeState.setVisible(true);\n      model._interactor.requestAnimation(publicAPI);\n      publicAPI.invokeStartInteractionEvent();\n    }\n    model.hasFocus = true;\n  };\n\n  // Called after we are finished/placed.\n  publicAPI.loseFocus = () => {\n    if (model.hasFocus) {\n      model._interactor.cancelAnimation(publicAPI);\n      publicAPI.invokeEndInteractionEvent();\n    }\n    model.widgetState.deactivate();\n    model.widgetState.getMoveHandle().deactivate();\n    model.widgetState.getMoveHandle().setVisible(false);\n    model.widgetState.getMoveHandle().setOrigin(null);\n    model.activeState = null;\n    model.hasFocus = false;\n    model._widgetManager.enablePicking();\n  };\n\n  publicAPI.delete = macro.chain(() => {\n    publicAPI.resetInteractions();\n  }, publicAPI.delete);\n}\n","import { useAnnotationToolStore } from '@/src/store/tools';\nimport { IAnnotationToolWidgetInitialValues } from '@/src/vtk/ToolWidgetUtils/types';\nimport vtkWidgetState from '@kitware/vtk.js/Widgets/Core/WidgetState';\nimport macro from '@kitware/vtk.js/macros';\n\nfunction extend(\n  publicAPI: any,\n  model: any,\n  initialValues: IAnnotationToolWidgetInitialValues\n) {\n  vtkWidgetState.extend(publicAPI, model, initialValues);\n  macro.get(publicAPI, model, ['id', 'toolType']);\n\n  publicAPI.getStore = () => useAnnotationToolStore(model.toolType);\n}\n\nexport declare const vtkAnnotationWidgetState: {\n  extend: typeof extend;\n};\n\nexport default { extend };\n","import macro from '@kitware/vtk.js/macros';\nimport vtkWidgetState from '@kitware/vtk.js/Widgets/Core/WidgetState';\nimport visibleMixin from '@kitware/vtk.js/Widgets/Core/StateBuilder/visibleMixin';\nimport scale1Mixin from '@kitware/vtk.js/Widgets/Core/StateBuilder/scale1Mixin';\nimport { watchStore } from '@/src/vtk/ToolWidgetUtils/utils';\nimport { PICKABLE_ANNOTATION_TOOL_HANDLE_RADIUS } from '@/src/constants';\nimport { toRaw } from 'vue';\n\nconst DIAMETER = PICKABLE_ANNOTATION_TOOL_HANDLE_RADIUS * 2;\n\nfunction _createPointState(\n  publicAPI,\n  model,\n  { id, store, key, visible = true }\n) {\n  Object.assign(model, {\n    id,\n    _store: store,\n    key,\n  });\n  vtkWidgetState.extend(publicAPI, model, {});\n  visibleMixin.extend(publicAPI, model, { visible });\n  scale1Mixin.extend(publicAPI, model, { scale1: DIAMETER });\n\n  const getTool = () => {\n    return model._store.toolByID[model.id];\n  };\n\n  const updateTool = (patch) => model._store.updateTool(model.id, patch);\n\n  publicAPI.getOrigin = () => {\n    return toRaw(getTool()?.[model.key]);\n  };\n\n  publicAPI.setOrigin = (xyz) => {\n    updateTool({\n      [model.key]: xyz,\n    });\n    publicAPI.modified();\n  };\n\n  watchStore(publicAPI, model._store, () => getTool()?.[model.key]);\n}\n\nconst createPointState = macro.newInstance(\n  _createPointState,\n  'vtkPointWidgetState'\n);\n\nexport default createPointState;\n","/* eslint-disable no-continue */\n\n/*\nFile modified from https://github.com/cornerstonejs/cornerstone3D/blob/main/packages/tools/src/utilities/math/polyline/decimate.ts\n\nMIT License\n\nCopyright (c) 2019 Open Health Imaging Foundation\n\nPermission is hereby granted, free of charge, to any person obtaining a copy\nof this software and associated documentation files (the \"Software\"), to deal\nin the Software without restriction, including without limitation the rights\nto use, copy, modify, merge, publish, distribute, sublicense, and/or sell\ncopies of the Software, and to permit persons to whom the Software is\nfurnished to do so, subject to the following conditions:\n\nThe above copyright notice and this permission notice shall be included in all\ncopies or substantial portions of the Software.\n\nTHE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\nIMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\nFITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\nAUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\nLIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\nOUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\nSOFTWARE.\n*/\n\nimport { Vector3 } from '@kitware/vtk.js/types';\nimport vtkLine from '@kitware/vtk.js/Common/DataModel/Line';\n\nconst DEFAULT_EPSILON = 0.1;\n\ntype Line = Array<Vector3>;\n\n/**\n * RamerDouglasPeucker algorithm implementation to decimate a polyline\n * to a similar polyline with fewer points\n *\n * https://en.wikipedia.org/wiki/Ramer%E2%80%93Douglas%E2%80%93Peucker_algorithm\n * https://rosettacode.org/wiki/Ramer-Douglas-Peucker_line_simplification\n * https://karthaus.nl/rdp/\n *\n * @param polyline - Polyline to decimate\n * @param epsilon - A maximum given distance 'epsilon' to decide if a point\n * should or shouldn't be added the decimated polyline version. In each\n * iteration the polyline is split into two polylines and the distance of each\n * point from those new polylines are checked against the line that connects\n * the first and last points.\n * @returns Decimated polyline\n */\nexport default function decimate(polyline: Line, epsilon = DEFAULT_EPSILON) {\n  const numPoints = polyline.length;\n\n  // The polyline must have at least a start and end points\n  if (numPoints < 3) {\n    return polyline;\n  }\n\n  const epsilonSquared = epsilon * epsilon;\n  const partitionQueue = [[0, numPoints - 1]];\n\n  // Used a boolean array to set each point that will be in the decimated polyline\n  // because pre-allocated arrays are 3-4x faster than thousands of push() calls\n  // to add all points to a new array.\n  const polylinePointFlags = new Array(numPoints).fill(false);\n\n  // Start and end points are always added to the decimated polyline\n  let numDecimatedPoints = 2;\n\n  // Add start and end points to the decimated polyline\n  polylinePointFlags[0] = true;\n  polylinePointFlags[numPoints - 1] = true;\n\n  // Iterative approach using a queue instead of recursion to reduce the number\n  // of function calls (performance)\n  while (partitionQueue.length) {\n    const [startIndex, endIndex] = partitionQueue.pop()!;\n\n    // Return if there is no point between the start and end points\n    if (endIndex - startIndex === 1) {\n      continue;\n    }\n\n    const startPoint = polyline[startIndex];\n    const endPoint = polyline[endIndex];\n    let maxDistSquared = -Infinity;\n    let maxDistIndex = -1;\n\n    // Search for the furthest point\n    for (let i = startIndex + 1; i < endIndex; i++) {\n      const currentPoint = polyline[i];\n      const { distance: distSquared } = vtkLine.distanceToLine(\n        currentPoint,\n        startPoint,\n        endPoint\n      );\n\n      if (distSquared > maxDistSquared) {\n        maxDistSquared = distSquared;\n        maxDistIndex = i;\n      }\n    }\n\n    // Do not add any of the points because the fursthest one is very close to\n    // the line based on the epsilon value\n    if (maxDistSquared < epsilonSquared) {\n      continue;\n    }\n\n    // Update the flag for the furthest point because it will be added to the\n    // decimated polyline\n    polylinePointFlags[maxDistIndex] = true;\n    numDecimatedPoints++;\n\n    // Partition the points into two parts using maxDistIndex as the pivot point\n    // and process both sides\n    partitionQueue.push([maxDistIndex, endIndex]);\n    partitionQueue.push([startIndex, maxDistIndex]);\n  }\n\n  // A pre-allocated array is 3-4x faster then multiple push() calls\n  const decimatedPolyline: Line = new Array(numDecimatedPoints);\n\n  for (let srcIndex = 0, dstIndex = 0; srcIndex < numPoints; srcIndex++) {\n    if (polylinePointFlags[srcIndex]) {\n      decimatedPolyline[dstIndex++] = polyline[srcIndex];\n    }\n  }\n\n  return decimatedPolyline;\n}\n","import macro from '@kitware/vtk.js/macros';\nimport vtkWidgetState from '@kitware/vtk.js/Widgets/Core/WidgetState';\nimport bounds from '@kitware/vtk.js/Widgets/Core/StateBuilder/boundsMixin';\nimport visibleMixin from '@kitware/vtk.js/Widgets/Core/StateBuilder/visibleMixin';\nimport scale1Mixin from '@kitware/vtk.js/Widgets/Core/StateBuilder/scale1Mixin';\nimport { Vector3 } from '@kitware/vtk.js/types';\nimport vtkAnnotationWidgetState from '@/src/vtk/ToolWidgetUtils/annotationWidgetState';\nimport { Polygon } from '@/src/types/polygon';\nimport { AnnotationToolType } from '@/src/store/tools/types';\nimport { getImageMetadata } from '@/src/composables/useCurrentImage';\nimport { getSmallestSpacing } from '@/src/utils/frameOfReference';\nimport createPointState from '../ToolWidgetUtils/pointState';\nimport { watchState } from '../ToolWidgetUtils/utils';\nimport decimate from './decimate';\n\nexport const MoveHandleLabel = 'moveHandle';\nexport const HandlesLabel = 'handles';\n\nconst HANDLE_PIXEL_SIZE = 20;\nconst DECIMATE_PIXEL_SIZE_FACTOR = 0.2;\n\ntype VtkObjectModel = {\n  classHierarchy: string[];\n};\n\ntype HandleModel = {\n  index: number;\n} & VtkObjectModel;\n\nfunction vtkPolygonWidgetState(publicAPI: any, model: any) {\n  model.classHierarchy.push('vtkPolygonWidgetState');\n  model.moveHandle = createPointState({\n    id: model.id,\n    store: publicAPI.getStore(),\n    key: 'movePoint',\n    visible: true,\n  });\n  watchState(publicAPI, model.moveHandle, () => publicAPI.modified());\n\n  const getTool = () => publicAPI.getStore().toolByID[model.id] as Polygon;\n\n  model.handles = [];\n\n  model.labels = {\n    [MoveHandleLabel]: [model.moveHandle],\n    [HandlesLabel]: [],\n  };\n\n  model.finishable = false;\n\n  // After deserialize, Pinia store already added points\n  // and addPoint will be false.\n  publicAPI.addHandle = ({ insertIndex = -1, addPoint = true } = {}) => {\n    const index = insertIndex === -1 ? model.handles.length : insertIndex;\n\n    if (addPoint) getTool().points.splice(index, 0, [0, 0, 0]);\n\n    const handleModel = { index };\n    const handlePublicAPI = {\n      getOrigin: () => getTool()?.points[handleModel.index],\n      setOrigin: (xyz: Vector3) => {\n        getTool().points[handleModel.index] = xyz;\n        publicAPI.modified();\n      },\n      getIndex: () => handleModel.index,\n      setIndex: (i: number) => {\n        handleModel.index = i;\n      },\n    };\n    vtkWidgetState.extend(handlePublicAPI, handleModel, {});\n    visibleMixin.extend(handlePublicAPI, handleModel, { visible: true });\n    scale1Mixin.extend(handlePublicAPI, handleModel, {\n      scale1: HANDLE_PIXEL_SIZE,\n    });\n    const handleModelPromoted = handleModel as HandleModel;\n    handleModelPromoted.classHierarchy.push('vtkPolygonHandleState');\n\n    model.handles.splice(index, 0, handlePublicAPI);\n    // when inserting into middle of array, update indices of subsequent handles\n    for (let i = index + 1; i < model.handles.length; i++) {\n      model.handles[i].setIndex(i);\n    }\n\n    publicAPI.bindState(handlePublicAPI, [HandlesLabel]);\n    // bindState pushes handle at end of labels array,\n    // but we may have inserted handle in middle of array.\n    // Downstream WidgetRepresentations get order of\n    // state/handles from internal HandlesLabel array.\n    // So copy handles array.\n    model.labels[HandlesLabel] = [...model.handles];\n\n    publicAPI.modified();\n    return handlePublicAPI;\n  };\n\n  publicAPI.removeHandle = (removeIndex: number) => {\n    const instance = model.handles[removeIndex];\n    publicAPI.unbindState(instance);\n    model.handles.splice(removeIndex, 1);\n\n    // update indices of subsequent handles\n    for (let i = removeIndex; i < model.handles.length; i++) {\n      model.handles[i].setIndex(i);\n    }\n\n    // Tool does not exist if loading new image\n    const tool = getTool();\n    if (tool) tool.points.splice(removeIndex, 1);\n\n    publicAPI.modified();\n  };\n\n  publicAPI.clearHandles = () => {\n    while (model.handles.length) {\n      publicAPI.removeHandle(model.handles.length - 1);\n    }\n  };\n\n  const addPointsAsHandles = () => {\n    getTool().points.forEach((point) => {\n      const handle = publicAPI.addHandle({ addPoint: false });\n      handle.setOrigin(point);\n    });\n  };\n\n  publicAPI.getPlacing = () => getTool().placing;\n\n  publicAPI.setPlacing = (placing: boolean) => {\n    const tool = getTool();\n    tool.placing = placing;\n    if (placing) return;\n\n    // Decimate points\n    const imageMeta = getImageMetadata(tool.imageID);\n    const pixelScale = getSmallestSpacing(tool.frameOfReference, imageMeta);\n    const optimizedLine = decimate(\n      tool.points,\n      pixelScale * DECIMATE_PIXEL_SIZE_FACTOR\n    );\n    publicAPI.clearHandles();\n    tool.points = optimizedLine;\n    addPointsAsHandles();\n  };\n\n  // Setup after deserialization\n  addPointsAsHandles();\n}\n\nconst defaultValues = (initialValues: any) => ({\n  toolType: AnnotationToolType.Polygon,\n  ...initialValues,\n});\n\nfunction _createPolygonWidgetState(\n  publicAPI: any,\n  model: any,\n  initialValues: any\n) {\n  Object.assign(model, defaultValues(initialValues));\n  vtkAnnotationWidgetState.extend(publicAPI, model, initialValues);\n  bounds.extend(publicAPI, model);\n\n  macro.get(publicAPI, model, ['handles', 'moveHandle', 'finishable']);\n  macro.setGet(publicAPI, model, ['finishable']);\n\n  vtkPolygonWidgetState(publicAPI, model);\n}\n\nconst createPolygonWidgetState = macro.newInstance(\n  _createPolygonWidgetState,\n  'vtkPolygonWidgetState'\n);\n\nexport default createPolygonWidgetState;\n","import macro from '@kitware/vtk.js/macro';\nimport vtkAbstractWidgetFactory from '@kitware/vtk.js/Widgets/Core/AbstractWidgetFactory';\nimport vtkPlanePointManipulator from '@kitware/vtk.js/Widgets/Manipulators/PlaneManipulator';\nimport vtkSphereHandleRepresentation from '@kitware/vtk.js/Widgets/Representations/SphereHandleRepresentation';\nimport { Behavior } from '@kitware/vtk.js/Widgets/Representations/WidgetRepresentation/Constants';\nimport vtkLineGlyphRepresentation from '@/src/vtk/LineGlyphRepresentation';\n\nimport widgetBehavior from './behavior';\nimport stateGenerator, { HandlesLabel, MoveHandleLabel } from './state';\n\n// ----------------------------------------------------------------------------\n// Factory\n// ----------------------------------------------------------------------------\n\nfunction vtkPolygonWidget(publicAPI, model) {\n  model.classHierarchy.push('vtkPolygonWidget');\n\n  // --- Widget Requirement ---------------------------------------------------\n\n  publicAPI.getRepresentationsForViewType = () => [\n    {\n      builder: vtkSphereHandleRepresentation,\n      labels: [HandlesLabel, MoveHandleLabel],\n      initialValues: {\n        scaleInPixels: true,\n      },\n    },\n    {\n      builder: vtkLineGlyphRepresentation,\n      labels: [HandlesLabel],\n      initialValues: {\n        scaleInPixels: true,\n        lineThickness: 0.25, // smaller than .5 default to prioritize picking handles\n        behavior: Behavior.HANDLE, // make pickable even if not visible\n      },\n    },\n  ];\n\n  // Default manipulator\n  model.manipulator = vtkPlanePointManipulator.newInstance();\n}\n\n// ----------------------------------------------------------------------------\n\nconst DEFAULT_VALUES = {};\n\n// ----------------------------------------------------------------------------\n\nexport function extend(publicAPI, model, initialValues = {}) {\n  Object.assign(model, DEFAULT_VALUES, initialValues);\n\n  vtkAbstractWidgetFactory.extend(publicAPI, model, {\n    ...initialValues,\n    behavior: widgetBehavior,\n    widgetState: stateGenerator(initialValues),\n  });\n  macro.get(publicAPI, model, ['manipulator']);\n\n  vtkPolygonWidget(publicAPI, model);\n}\n\n// ----------------------------------------------------------------------------\n\nexport const newInstance = macro.newInstance(extend, 'vtkPolygonWidget');\n\n// ----------------------------------------------------------------------------\n\nexport default { newInstance, extend };\n","<template>\n  <g>\n    <circle\n      v-for=\"({ point: [x, y], radius }, index) in handlePoints\"\n      :key=\"index\"\n      :cx=\"x\"\n      :cy=\"y\"\n      :stroke=\"color\"\n      :stroke-width=\"strokeWidth\"\n      fill=\"transparent\"\n      :r=\"radius\"\n      :visibility=\"index === 0 ? firstHandleVisibility : handleVisibility\"\n    />\n    <polyline\n      :points=\"linePoints\"\n      :stroke=\"color\"\n      :stroke-width=\"strokeWidth\"\n      fill=\"none\"\n    />\n  </g>\n</template>\n\n<script lang=\"ts\">\nimport { onVTKEvent } from '@/src/composables/onVTKEvent';\nimport { ANNOTATION_TOOL_HANDLE_RADIUS } from '@/src/constants';\nimport { worldToSVG } from '@/src/utils/vtk-helpers';\nimport type { Vector2, Vector3 } from '@kitware/vtk.js/types';\nimport {\n  PropType,\n  defineComponent,\n  toRefs,\n  ref,\n  watch,\n  inject,\n  computed,\n} from 'vue';\nimport { Maybe } from '@/src/types';\nimport { VtkViewContext } from '@/src/components/vtk/context';\nimport { useResizeObserver } from '@vueuse/core';\nimport { vtkFieldRef } from '@/src/core/vtk/vtkFieldRef';\n\nconst POINT_RADIUS = ANNOTATION_TOOL_HANDLE_RADIUS;\nconst FINISHABLE_POINT_RADIUS = POINT_RADIUS;\n\nexport default defineComponent({\n  props: {\n    points: {\n      type: Array as PropType<Array<Vector3>>,\n      required: true,\n    },\n    color: String,\n    strokeWidth: Number,\n    movePoint: {\n      type: Array as unknown as PropType<Maybe<Vector3>>,\n    },\n    placing: {\n      type: Boolean,\n      default: false,\n    },\n    finishable: {\n      type: Boolean,\n      default: false,\n    },\n    showHandles: {\n      type: Boolean,\n      default: false,\n    },\n  },\n  setup(props) {\n    const { points, movePoint, placing, finishable, showHandles } =\n      toRefs(props);\n\n    const view = inject(VtkViewContext);\n    if (!view) throw new Error('No VtkView');\n\n    const finishPossible = computed(() => {\n      return points.value.length > 0 && placing.value && finishable.value;\n    });\n\n    const handleVisibility = computed(() => {\n      return showHandles.value ? 'visible' : 'hidden';\n    });\n    const firstHandleVisibility = computed(() => {\n      if (finishPossible.value) {\n        return 'visible';\n      }\n      return handleVisibility.value;\n    });\n\n    type SVGPoint = { point: Vector2; radius: number };\n    const handlePoints = ref<Array<SVGPoint>>([]);\n    const linePoints = ref<string>('');\n\n    const updatePoints = () => {\n      const viewRenderer = view.renderer;\n      const svgPoints = points.value.map((point) => {\n        const point2D = worldToSVG(point, viewRenderer);\n        return {\n          point: point2D ?? ([0, 0] as Vector2),\n          radius: POINT_RADIUS,\n        };\n      });\n\n      // Indicate finishable\n      if (finishPossible.value) {\n        svgPoints[0].radius = FINISHABLE_POINT_RADIUS;\n      }\n\n      // Show point under mouse if one point placed\n      if (svgPoints.length > 0 && placing.value && movePoint.value) {\n        const moveHandlePoint =\n          worldToSVG(movePoint.value, viewRenderer) ?? ([0, 0] as Vector2);\n        svgPoints.push({\n          point: moveHandlePoint,\n          radius: POINT_RADIUS,\n        });\n      }\n\n      handlePoints.value = svgPoints;\n\n      const lines = handlePoints.value.map(({ point }) => point?.join(','));\n      if (!placing.value) {\n        // Close the polygon\n        lines.push(lines[0]);\n      }\n      linePoints.value = lines.join(' ');\n    };\n\n    const camera = vtkFieldRef(view.renderer, 'activeCamera');\n    onVTKEvent(camera, 'onModified', updatePoints);\n\n    watch([points, movePoint, placing], updatePoints, {\n      deep: true,\n      immediate: true,\n    });\n\n    // --- resize --- //\n\n    const container = vtkFieldRef(view.renderWindowView, 'container');\n    useResizeObserver(container, () => {\n      updatePoints();\n    });\n\n    return {\n      devicePixelRatio,\n      handlePoints,\n      linePoints,\n      firstHandleVisibility,\n      handleVisibility,\n    };\n  },\n});\n</script>\n","<script lang=\"ts\">\nimport {\n  reactive,\n  computed,\n  defineComponent,\n  PropType,\n  toRefs,\n  watch,\n  watchEffect,\n  inject,\n  onUnmounted,\n  ref,\n} from 'vue';\nimport vtkPlaneManipulator from '@kitware/vtk.js/Widgets/Manipulators/PlaneManipulator';\nimport { useImage } from '@/src/composables/useCurrentImage';\nimport { updatePlaneManipulatorFor2DView } from '@/src/utils/manipulators';\nimport { LPSAxisDir } from '@/src/types/lps';\nimport { onVTKEvent } from '@/src/composables/onVTKEvent';\nimport {\n  useRightClickContextMenu,\n  useWidgetVisibility,\n} from '@/src/composables/annotationTool';\nimport { getCSSCoordinatesFromEvent } from '@/src/utils/vtk-helpers';\nimport { usePolygonStore as useStore } from '@/src/store/tools/polygons';\nimport vtkWidgetFactory, {\n  vtkPolygonViewWidget as WidgetView,\n} from '@/src/vtk/PolygonWidget';\nimport { Maybe } from '@/src/types';\nimport type { Vector3 } from '@kitware/vtk.js/types';\nimport { ToolID } from '@/src/types/annotation-tool';\nimport { VtkViewContext } from '@/src/components/vtk/context';\nimport { useSliceInfo } from '@/src/composables/useSliceInfo';\nimport SVG2DComponent from './PolygonSVG2D.vue';\n\nexport default defineComponent({\n  name: 'PolygonWidget2D',\n  emits: ['placed', 'contextmenu', 'widgetHover'],\n  props: {\n    toolId: {\n      type: String as unknown as PropType<ToolID>,\n      required: true,\n    },\n    viewId: {\n      type: String,\n      required: true,\n    },\n    viewDirection: {\n      type: String as PropType<LPSAxisDir>,\n      required: true,\n    },\n    isPlacing: {\n      type: Boolean,\n      default: false,\n    },\n    imageId: String as PropType<Maybe<string>>,\n  },\n  components: {\n    SVG2DComponent,\n  },\n  setup(props, { emit }) {\n    const { toolId, viewId, viewDirection, imageId, isPlacing } = toRefs(props);\n\n    const view = inject(VtkViewContext);\n    if (!view) throw new Error('No VtkView');\n\n    const sliceInfo = useSliceInfo(viewId, imageId);\n    const slice = computed(() => sliceInfo.value?.slice);\n\n    const toolStore = useStore();\n    const tool = computed(() => toolStore.toolByID[toolId.value]);\n    const { metadata: imageMetadata } = useImage(imageId);\n\n    const widgetFactory = vtkWidgetFactory.newInstance({\n      id: toolId.value,\n    });\n    const widget = view.widgetManager.addWidget(widgetFactory) as WidgetView;\n\n    onUnmounted(() => {\n      view.widgetManager.removeWidget(widget);\n      widgetFactory.delete();\n    });\n\n    // --- reset on slice/image changes --- //\n\n    watch([slice, imageId], () => {\n      if (isPlacing.value) {\n        widget.resetInteractions();\n        widget.getWidgetState().clearHandles();\n      }\n    });\n\n    onVTKEvent(widget, 'onPlacedEvent', () => {\n      emit('placed');\n    });\n\n    const lastHoverEventData = ref<any>(null);\n    onVTKEvent(widget, 'onHoverEvent', (eventData: any) => {\n      lastHoverEventData.value = eventData;\n    });\n    const dragging = ref(false);\n    onVTKEvent(widget, 'onDraggingEvent', (eventData: any) => {\n      dragging.value = eventData.dragging;\n    });\n    const showHandles = computed(() => {\n      return lastHoverEventData.value?.hovering && !dragging.value;\n    });\n    watchEffect(() => {\n      if (!lastHoverEventData.value) return;\n      const displayXY = getCSSCoordinatesFromEvent(lastHoverEventData.value);\n      if (displayXY) {\n        emit('widgetHover', {\n          displayXY,\n          hovering: lastHoverEventData.value?.hovering && !dragging.value,\n        });\n      }\n    });\n\n    // --- right click handling --- //\n\n    useRightClickContextMenu(emit, widget);\n\n    // --- manipulator --- //\n\n    const manipulator = vtkPlaneManipulator.newInstance();\n    widget.setManipulator(manipulator);\n\n    watchEffect(() => {\n      updatePlaneManipulatorFor2DView(\n        manipulator,\n        viewDirection.value,\n        tool.value?.slice ?? slice.value ?? 0,\n        imageMetadata.value\n      );\n    });\n\n    // --- visibility --- //\n\n    const isVisible = computed(() => tool.value?.slice === slice.value);\n    useWidgetVisibility(widget, isVisible, view);\n\n    // --- //\n\n    const editState = reactive({\n      movePoint: null as Maybe<Vector3>,\n      finishable: false,\n    });\n\n    const widgetState = widgetFactory.getWidgetState();\n    onVTKEvent(widgetState, 'onModified', () => {\n      editState.movePoint = widgetState.getMoveHandle().getOrigin();\n      editState.finishable = widgetState.getFinishable();\n    });\n\n    return {\n      slice,\n      tool,\n      editState,\n      showHandles,\n    };\n  },\n});\n</script>\n\n<template>\n  <SVG2DComponent\n    v-show=\"slice === tool.slice\"\n    :points=\"tool.points\"\n    :color=\"tool.color\"\n    :stroke-width=\"tool.strokeWidth\"\n    :move-point=\"editState.movePoint\"\n    :placing=\"tool.placing\"\n    :finishable=\"editState.finishable\"\n    :show-handles=\"showHandles\"\n  />\n</template>\n","<template>\n  <div class=\"overlay-no-events\">\n    <svg class=\"overlay-no-events\">\n      <polygon-widget-2D\n        v-for=\"tool in tools\"\n        :key=\"tool.id\"\n        :tool-id=\"tool.id\"\n        :is-placing=\"tool.id === placingToolID\"\n        :image-id=\"imageId\"\n        :view-id=\"viewId\"\n        :view-direction=\"viewDirection\"\n        @contextmenu=\"openContextMenu(tool.id, $event)\"\n        @placed=\"onToolPlaced\"\n        @widgetHover=\"onHover(tool.id, $event)\"\n      />\n    </svg>\n    <annotation-context-menu ref=\"contextMenu\" :tool-store=\"activeToolStore\">\n      <v-tooltip\n        :disabled=\"mergePossible\"\n        text=\"Shift select multiple polygons that overlap and have the same label.\"\n      >\n        <template v-slot:activator=\"{ props }\">\n          <div v-bind=\"props\">\n            <v-list-item @click=\"mergeTools\" :disabled=\"!mergePossible\">\n              <template v-slot:prepend>\n                <v-icon>mdi-vector-union</v-icon>\n              </template>\n\n              <v-list-item-title>Merge Polygons</v-list-item-title>\n            </v-list-item>\n          </div>\n        </template>\n      </v-tooltip>\n    </annotation-context-menu>\n    <annotation-info :info=\"overlayInfo\" :tool-store=\"activeToolStore\" />\n  </div>\n</template>\n\n<script lang=\"ts\">\nimport { computed, defineComponent, onUnmounted, PropType, toRefs } from 'vue';\nimport { storeToRefs } from 'pinia';\nimport { useImage } from '@/src/composables/useCurrentImage';\nimport { useToolStore } from '@/src/store/tools';\nimport { Tools } from '@/src/store/tools/types';\nimport { getLPSAxisFromDir } from '@/src/utils/lps';\nimport { LPSAxisDir } from '@/src/types/lps';\nimport { usePolygonStore } from '@/src/store/tools/polygons';\nimport {\n  useContextMenu,\n  useCurrentTools,\n  useHover,\n  usePlacingAnnotationTool,\n} from '@/src/composables/annotationTool';\nimport AnnotationContextMenu from '@/src/components/tools/AnnotationContextMenu.vue';\nimport AnnotationInfo from '@/src/components/tools/AnnotationInfo.vue';\nimport { useFrameOfReference } from '@/src/composables/useFrameOfReference';\nimport { actionToKey } from '@/src/composables/useKeyboardShortcuts';\nimport { Maybe } from '@/src/types';\nimport { useSliceInfo } from '@/src/composables/useSliceInfo';\nimport { useMagicKeys, watchImmediate } from '@vueuse/core';\nimport PolygonWidget2D from './PolygonWidget2D.vue';\n\nconst useActiveToolStore = usePolygonStore;\nconst toolType = Tools.Polygon;\n\nexport default defineComponent({\n  name: 'PolygonTool',\n  props: {\n    viewId: {\n      type: String,\n      required: true,\n    },\n    viewDirection: {\n      type: String as PropType<LPSAxisDir>,\n      required: true,\n    },\n    imageId: String as PropType<Maybe<string>>,\n  },\n  components: {\n    PolygonWidget2D,\n    AnnotationContextMenu,\n    AnnotationInfo,\n  },\n  setup(props) {\n    const { viewDirection, imageId, viewId } = toRefs(props);\n    const toolStore = useToolStore();\n    const activeToolStore = useActiveToolStore();\n    const { activeLabel } = storeToRefs(activeToolStore);\n\n    const sliceInfo = useSliceInfo(viewId, imageId);\n    const slice = computed(() => sliceInfo.value?.slice ?? 0);\n\n    const { metadata: imageMetadata } = useImage(imageId);\n    const isToolActive = computed(() => toolStore.currentTool === toolType);\n    const viewAxis = computed(() => getLPSAxisFromDir(viewDirection.value));\n\n    // --- active tool management --- //\n\n    const frameOfReference = useFrameOfReference(\n      viewDirection,\n      slice,\n      imageMetadata\n    );\n\n    const placingTool = usePlacingAnnotationTool(\n      activeToolStore,\n      computed(() => {\n        if (!imageId.value) return {};\n        return {\n          imageID: imageId.value,\n          frameOfReference: frameOfReference.value,\n          slice: slice.value,\n          label: activeLabel.value,\n          ...(activeLabel.value && activeToolStore.labels[activeLabel.value]),\n        };\n      })\n    );\n\n    watchImmediate([isToolActive, imageId] as const, ([active, imageID]) => {\n      placingTool.remove();\n      if (active && imageID) {\n        placingTool.add();\n      }\n    });\n\n    onUnmounted(() => {\n      placingTool.remove();\n    });\n\n    const keys = useMagicKeys();\n    const mergeKey = computed(\n      () => keys[actionToKey.value.mergeNewPolygon].value\n    );\n\n    const onToolPlaced = () => {\n      if (imageId.value) {\n        const newToolId = placingTool.id.value;\n        placingTool.commit();\n        placingTool.add();\n        if (mergeKey.value && newToolId) {\n          activeToolStore.mergeWithOtherTools(newToolId);\n        }\n      }\n    };\n\n    // ---  //\n\n    const { contextMenu, openContextMenu } = useContextMenu();\n\n    const currentTools = useCurrentTools(activeToolStore, viewAxis);\n\n    const { onHover, overlayInfo } = useHover(currentTools, slice);\n\n    const mergePossible = computed(\n      () => activeToolStore.mergeableTools.length >= 1\n    );\n\n    return {\n      tools: currentTools,\n      placingToolID: placingTool.id,\n      onToolPlaced,\n      contextMenu,\n      openContextMenu,\n      mergeTools: activeToolStore.mergeSelectedTools,\n      mergePossible,\n      activeToolStore,\n      onHover,\n      overlayInfo,\n    };\n  },\n});\n</script>\n\n<style scoped src=\"@/src/components/styles/vtk-view.css\"></style>\n","import macro from '@kitware/vtk.js/macro';\nimport type { Vector3 } from '@kitware/vtk.js/types';\nimport { computeWorldCoords } from '@/src/vtk/ToolWidgetUtils/utils';\n\nexport enum InteractionState {\n  PlacingFirst = 'PlacingFirst',\n  PlacingSecond = 'PlacingSecond',\n  Select = 'Select',\n  Dragging = 'Dragging',\n}\n\nexport function shouldIgnoreEvent(e: any) {\n  return e.altKey || e.controlKey || e.shiftKey;\n}\n\nexport default function widgetBehavior(publicAPI: any, model: any) {\n  model.classHierarchy.push('vtkRulerWidgetProp');\n\n  model.interactionState = InteractionState.Select;\n  let draggingState: any = null;\n\n  macro.setGet(publicAPI, model, ['interactionState']);\n  // support setting per-view widget manipulators\n  macro.setGet(publicAPI, model, ['manipulator']);\n  // support forwarding events\n  macro.event(publicAPI, model, 'RightClickEvent');\n  macro.event(publicAPI, model, 'PlacedEvent');\n  macro.event(publicAPI, model, 'HoverEvent');\n\n  publicAPI.deactivateAllHandles = () => {\n    model.widgetState.deactivate();\n    model.activeState = null;\n  };\n\n  publicAPI.setFirstPoint = (coord: Vector3) => {\n    const point = model.widgetState.getFirstPoint();\n    point.setOrigin(coord);\n  };\n\n  publicAPI.setSecondPoint = (coord: Vector3) => {\n    const point = model.widgetState.getSecondPoint();\n    point.setOrigin(coord);\n  };\n\n  const originalSetInteractionState = publicAPI.setInteractionState;\n  publicAPI.setInteractionState = (state: InteractionState) => {\n    const changed = originalSetInteractionState(state);\n    if (changed && state === InteractionState.PlacingFirst) {\n      model.widgetState.setIsPlaced(false);\n      model.widgetState.getFirstPoint().setVisible(false);\n      model.widgetState.getSecondPoint().setVisible(false);\n    }\n    return changed;\n  };\n\n  publicAPI.resetInteractions = () => {\n    model._interactor.cancelAnimation(publicAPI, true);\n  };\n\n  // Check if mouse is over line segment between handles\n  const checkOverSegment = () => {\n    const selections = model._widgetManager.getSelections();\n    const overSegment =\n      selections[0]?.getProperties().prop ===\n      model.representations[1].getActors()[0]; // line representation is second representation\n    return overSegment;\n  };\n\n  const getWorldCoords = computeWorldCoords(model);\n\n  /**\n   * Places or drags a point.\n   */\n  publicAPI.handleLeftButtonPress = (eventData: any) => {\n    if (!model.manipulator || shouldIgnoreEvent(eventData)) {\n      return macro.VOID;\n    }\n\n    // turns off hover while dragging\n    publicAPI.invokeHoverEvent({\n      ...eventData,\n      hovering: false,\n    });\n\n    // This ruler widget is passive, so if another widget\n    // is active, we don't do anything.\n    const activeWidget = model._widgetManager.getActiveWidget();\n    if (activeWidget && activeWidget !== publicAPI) {\n      return macro.VOID;\n    }\n\n    const worldCoords = getWorldCoords(eventData);\n    if (!worldCoords?.length) {\n      return macro.VOID;\n    }\n\n    const intState = publicAPI.getInteractionState();\n\n    if (intState === InteractionState.PlacingFirst) {\n      publicAPI.setFirstPoint(worldCoords);\n      publicAPI.setSecondPoint(worldCoords);\n      model.widgetState.getFirstPoint().setVisible(true);\n      model.widgetState.getSecondPoint().setVisible(true);\n\n      model._interactor.requestAnimation(publicAPI);\n      publicAPI.invokeStartInteractionEvent();\n      publicAPI.setInteractionState(InteractionState.PlacingSecond);\n      return macro.EVENT_ABORT;\n    }\n\n    if (intState === InteractionState.PlacingSecond) {\n      publicAPI.setSecondPoint(worldCoords);\n      model.widgetState.setIsPlaced(true);\n\n      publicAPI.setInteractionState(InteractionState.Select);\n      publicAPI.invokeEndInteractionEvent();\n      publicAPI.invokePlacedEvent();\n\n      model._interactor.cancelAnimation(publicAPI);\n      return macro.EVENT_ABORT;\n    }\n\n    // dragging\n    if (\n      model.activeState?.getActive() &&\n      model.pickable &&\n      !checkOverSegment()\n    ) {\n      draggingState = model.activeState;\n      publicAPI.setInteractionState(InteractionState.Dragging);\n      model._apiSpecificRenderWindow.setCursor('grabbing');\n      model._interactor.requestAnimation(publicAPI);\n      publicAPI.invokeStartInteractionEvent();\n      return macro.EVENT_ABORT;\n    }\n\n    return macro.VOID;\n  };\n\n  /**\n   * Moves a point around.\n   */\n  publicAPI.handleMouseMove = (eventData: any) => {\n    const worldCoords = getWorldCoords(eventData);\n    if (!worldCoords?.length) {\n      return macro.VOID;\n    }\n\n    const intState = publicAPI.getInteractionState();\n\n    if (intState === InteractionState.PlacingSecond) {\n      model.widgetState.getSecondPoint().setOrigin(worldCoords);\n      // show second point during placement\n      model.widgetState.getSecondPoint().setVisible(true);\n      publicAPI.invokeInteractionEvent();\n      return macro.EVENT_ABORT;\n    }\n\n    if (\n      publicAPI.getInteractionState() === InteractionState.Dragging &&\n      draggingState\n    ) {\n      draggingState.setOrigin(worldCoords);\n      publicAPI.invokeInteractionEvent();\n      return macro.EVENT_ABORT;\n    }\n\n    publicAPI.invokeHoverEvent({\n      ...eventData,\n      hovering: !!model.activeState,\n    });\n\n    return macro.VOID;\n  };\n\n  /**\n   * Finishes dragging\n   */\n  publicAPI.handleLeftButtonRelease = (eventData: any) => {\n    if (draggingState) {\n      const worldCoords = getWorldCoords(eventData);\n      if (worldCoords?.length) {\n        draggingState.setOrigin(worldCoords);\n      }\n\n      draggingState = null;\n      publicAPI.setInteractionState(InteractionState.Select);\n      model._apiSpecificRenderWindow.setCursor('pointer');\n      model.widgetState.deactivate();\n      model._interactor.cancelAnimation(publicAPI);\n      publicAPI.invokeEndInteractionEvent();\n      model._widgetManager.enablePicking();\n    }\n  };\n\n  publicAPI.handleRightButtonPress = (eventData: any) => {\n    if (\n      shouldIgnoreEvent(eventData) ||\n      publicAPI.getInteractionState() !== InteractionState.Select ||\n      !model.activeState\n    ) {\n      return macro.VOID;\n    }\n    publicAPI.invokeRightClickEvent(eventData);\n    return macro.EVENT_ABORT;\n  };\n\n  publicAPI.grabFocus = () => {\n    throw new Error('grabFocus is not implemented');\n  };\n\n  publicAPI.loseFocus = () => {\n    throw new Error('loseFocus is not implemented');\n  };\n\n  publicAPI.delete = macro.chain(() => {\n    publicAPI.resetInteractions();\n  }, publicAPI.delete);\n}\n","import macro from '@kitware/vtk.js/macros';\nimport bounds from '@kitware/vtk.js/Widgets/Core/StateBuilder/boundsMixin';\nimport vtkAnnotationWidgetState from '@/src/vtk/ToolWidgetUtils/annotationWidgetState';\nimport { AnnotationToolType } from '@/src/store/tools/types';\n\nimport createPointState from '../ToolWidgetUtils/pointState';\nimport { watchState } from '../ToolWidgetUtils/utils';\n\nexport const PointsLabel = 'points';\n\nfunction vtkRulerWidgetState(publicAPI: any, model: any) {\n  const firstPoint = createPointState({\n    id: model.id,\n    store: publicAPI.getStore(),\n    key: 'firstPoint',\n    visible: true,\n  });\n  const secondPoint = createPointState({\n    id: model.id,\n    store: publicAPI.getStore(),\n    key: 'secondPoint',\n    visible: true,\n  });\n\n  watchState(publicAPI, firstPoint, () => publicAPI.modified());\n  watchState(publicAPI, secondPoint, () => publicAPI.modified());\n\n  model.labels = {\n    [PointsLabel]: [firstPoint, secondPoint],\n  };\n\n  publicAPI.getFirstPoint = () => firstPoint;\n  publicAPI.getSecondPoint = () => secondPoint;\n}\n\nconst defaultValues = (initialValues: any) => ({\n  toolType: AnnotationToolType.Ruler,\n  isPlaced: false,\n  ...initialValues,\n});\n\nfunction _createRulerWidgetState(\n  publicAPI: any,\n  model: any,\n  initialValues: any\n) {\n  Object.assign(model, defaultValues(initialValues));\n  vtkAnnotationWidgetState.extend(publicAPI, model, initialValues);\n  bounds.extend(publicAPI, model);\n\n  macro.setGet(publicAPI, model, ['isPlaced']);\n\n  vtkRulerWidgetState(publicAPI, model);\n}\n\nconst createRulerWidgetState = macro.newInstance(\n  _createRulerWidgetState,\n  'vtkRulerWidgetState'\n);\n\nexport default createRulerWidgetState;\n","import macro from '@kitware/vtk.js/macro';\nimport vtkAbstractWidgetFactory from '@kitware/vtk.js/Widgets/Core/AbstractWidgetFactory';\nimport vtkPlanePointManipulator from '@kitware/vtk.js/Widgets/Manipulators/PlaneManipulator';\nimport vtkSphereHandleRepresentation from '@kitware/vtk.js/Widgets/Representations/SphereHandleRepresentation';\nimport { distance2BetweenPoints } from '@kitware/vtk.js/Common/Core/Math';\nimport { Behavior } from '@kitware/vtk.js/Widgets/Representations/WidgetRepresentation/Constants';\nimport vtkLineGlyphRepresentation from '@/src/vtk/LineGlyphRepresentation';\n\nimport widgetBehavior from './behavior';\nimport stateGenerator, { PointsLabel } from './state';\n\nexport { InteractionState } from './behavior';\n\n// ----------------------------------------------------------------------------\n// Factory\n// ----------------------------------------------------------------------------\n\nfunction vtkRulerWidget(publicAPI, model) {\n  model.classHierarchy.push('vtkRulerWidget');\n\n  // --- Widget Requirement ---------------------------------------------------\n\n  publicAPI.getRepresentationsForViewType = () => [\n    {\n      builder: vtkSphereHandleRepresentation,\n      labels: [PointsLabel],\n      initialValues: {\n        scaleInPixels: true,\n      },\n    },\n    {\n      builder: vtkLineGlyphRepresentation,\n      labels: [PointsLabel],\n      initialValues: {\n        scaleInPixels: true,\n        lineThickness: 0.25, // smaller than .5 default to prioritize picking handles\n        behavior: Behavior.HANDLE, // make pickable even if not visible\n      },\n    },\n  ];\n\n  publicAPI.getLength = () => {\n    const first = model.widgetState.getFirstPoint().getOrigin();\n    const second = model.widgetState.getSecondPoint().getOrigin();\n    if (!first || !second) {\n      return 0;\n    }\n    return Math.sqrt(distance2BetweenPoints(first, second));\n  };\n\n  // Default manipulator\n  model.manipulator = vtkPlanePointManipulator.newInstance();\n}\n\n// ----------------------------------------------------------------------------\n\nconst DEFAULT_VALUES = {};\n\n// ----------------------------------------------------------------------------\n\nexport function extend(publicAPI, model, initialValues = {}) {\n  Object.assign(model, DEFAULT_VALUES, initialValues);\n\n  vtkAbstractWidgetFactory.extend(publicAPI, model, {\n    ...initialValues,\n    behavior: widgetBehavior,\n    widgetState: stateGenerator(initialValues),\n  });\n  macro.get(publicAPI, model, ['manipulator']);\n\n  vtkRulerWidget(publicAPI, model);\n}\n\n// ----------------------------------------------------------------------------\n\nexport const newInstance = macro.newInstance(extend, 'vtkRulerWidget');\n\n// ----------------------------------------------------------------------------\n\nexport default { newInstance, extend };\n","<template>\n  <g>\n    <line\n      v-if=\"first && second\"\n      :x1=\"first.x\"\n      :y1=\"first.y\"\n      :x2=\"second.x\"\n      :y2=\"second.y\"\n      :stroke=\"color\"\n      :stroke-width=\"strokeWidth\"\n    />\n    <circle\n      v-if=\"first\"\n      :cx=\"first.x\"\n      :cy=\"first.y\"\n      :stroke=\"color\"\n      :stroke-width=\"strokeWidth\"\n      fill=\"transparent\"\n      :r=\"ANNOTATION_TOOL_HANDLE_RADIUS\"\n    />\n    <circle\n      v-if=\"second\"\n      :cx=\"second.x\"\n      :cy=\"second.y\"\n      :stroke=\"color\"\n      :stroke-width=\"strokeWidth\"\n      fill=\"transparent\"\n      :r=\"ANNOTATION_TOOL_HANDLE_RADIUS\"\n      class=\"handle\"\n    />\n    <text\n      v-if=\"second\"\n      :x=\"second.x\"\n      :y=\"second.y\"\n      :dx=\"textdx\"\n      :dy=\"textdy\"\n      :text-anchor=\"anchor\"\n      stroke-width=\"0.75\"\n      stroke=\"black\"\n      fill=\"white\"\n      :font-size=\"`${textSize}px`\"\n      font-weight=\"bold\"\n    >\n      {{ rulerLength }}\n    </text>\n  </g>\n</template>\n\n<script lang=\"ts\">\nimport { onVTKEvent } from '@/src/composables/onVTKEvent';\nimport { ANNOTATION_TOOL_HANDLE_RADIUS } from '@/src/constants';\nimport { worldToSVG } from '@/src/utils/vtk-helpers';\nimport type { Vector3 } from '@kitware/vtk.js/types';\nimport {\n  PropType,\n  computed,\n  defineComponent,\n  toRefs,\n  unref,\n  ref,\n  watch,\n  inject,\n} from 'vue';\nimport { VtkViewContext } from '@/src/components/vtk/context';\nimport { useResizeObserver } from '@vueuse/core';\nimport { vtkFieldRef } from '@/src/core/vtk/vtkFieldRef';\n\ntype SVGPoint = {\n  x: number;\n  y: number;\n};\n\nexport default defineComponent({\n  props: {\n    point1: Array as PropType<Array<number>>,\n    point2: Array as PropType<Array<number>>,\n    color: String,\n    strokeWidth: Number,\n    length: Number,\n    textOffset: {\n      type: Number,\n      default: 8,\n    },\n    textSize: {\n      type: Number,\n      default: 14,\n    },\n  },\n  setup(props) {\n    const { point1, point2, textOffset, length } = toRefs(props);\n    const firstPoint = ref<SVGPoint | null>();\n    const secondPoint = ref<SVGPoint | null>();\n\n    const view = inject(VtkViewContext);\n    if (!view) throw new Error('No VtkView');\n\n    const updatePoints = () => {\n      const viewRenderer = view.renderer;\n      const pt1 = unref(point1) as Vector3 | undefined;\n      const pt2 = unref(point2) as Vector3 | undefined;\n      if (pt1) {\n        const point2D = worldToSVG(pt1, viewRenderer);\n        if (point2D) {\n          firstPoint.value = {\n            x: point2D[0],\n            y: point2D[1],\n          };\n        }\n      } else {\n        firstPoint.value = null;\n      }\n\n      if (pt2) {\n        const point2D = worldToSVG(pt2, viewRenderer);\n        if (point2D) {\n          secondPoint.value = {\n            x: point2D[0],\n            y: point2D[1],\n          };\n        }\n      } else {\n        secondPoint.value = null;\n      }\n    };\n\n    const camera = vtkFieldRef(view.renderer, 'activeCamera');\n    onVTKEvent(camera, 'onModified', updatePoints);\n\n    watch([point1, point2], updatePoints, {\n      deep: true,\n      immediate: true,\n    });\n\n    const textProperties = computed(() => {\n      const first = unref(firstPoint);\n      const second = unref(secondPoint);\n      const offset = textOffset.value;\n      if (!first || !second) {\n        return null;\n      }\n      if (second.x > first.x) {\n        return { dx: offset, dy: -offset, anchor: 'start' };\n      }\n      return { dx: -offset, dy: -offset, anchor: 'end' };\n    });\n\n    // --- resize --- //\n\n    const container = vtkFieldRef(view.renderWindowView, 'container');\n    useResizeObserver(container, () => {\n      updatePoints();\n    });\n\n    return {\n      textdx: computed(() => textProperties.value?.dx ?? 0),\n      textdy: computed(() => textProperties.value?.dy ?? 0),\n      anchor: computed(() => textProperties.value?.anchor ?? 'start'),\n      first: firstPoint,\n      second: secondPoint,\n      rulerLength: computed(() => length?.value?.toFixed(2) ?? ''),\n      ANNOTATION_TOOL_HANDLE_RADIUS,\n    };\n  },\n});\n</script>\n\n<style scoped>\n.handle {\n  cursor: pointer;\n}\n</style>\n","<script lang=\"ts\">\nimport vtkRulerWidget, {\n  InteractionState,\n  vtkRulerViewWidget,\n  vtkRulerWidgetState,\n} from '@/src/vtk/RulerWidget';\nimport {\n  reactive,\n  computed,\n  defineComponent,\n  PropType,\n  toRefs,\n  watch,\n  watchEffect,\n  inject,\n  onUnmounted,\n} from 'vue';\nimport vtkPlaneManipulator from '@kitware/vtk.js/Widgets/Manipulators/PlaneManipulator';\nimport { useImage } from '@/src/composables/useCurrentImage';\nimport { updatePlaneManipulatorFor2DView } from '@/src/utils/manipulators';\nimport { LPSAxisDir } from '@/src/types/lps';\nimport { useRulerStore } from '@/src/store/tools/rulers';\nimport { onVTKEvent } from '@/src/composables/onVTKEvent';\nimport RulerSVG2D from '@/src/components/tools/ruler/RulerSVG2D.vue';\nimport {\n  useRightClickContextMenu,\n  useHoverEvent,\n  useWidgetVisibility,\n} from '@/src/composables/annotationTool';\nimport { ToolID } from '@/src/types/annotation-tool';\nimport { Maybe } from '@/src/types';\nimport { useSliceInfo } from '@/src/composables/useSliceInfo';\nimport { VtkViewContext } from '@/src/components/vtk/context';\nimport { whenever } from '@vueuse/core';\n\nexport default defineComponent({\n  name: 'RulerWidget2D',\n  emits: ['placed', 'contextmenu', 'widgetHover'],\n  props: {\n    toolId: {\n      type: String as unknown as PropType<ToolID>,\n      required: true,\n    },\n    viewId: {\n      type: String,\n      required: true,\n    },\n    viewDirection: {\n      type: String as PropType<LPSAxisDir>,\n      required: true,\n    },\n    isPlacing: {\n      type: Boolean,\n      default: false,\n    },\n    imageId: String as PropType<Maybe<string>>,\n  },\n  components: {\n    RulerSVG2D,\n  },\n  setup(props, { emit }) {\n    const { toolId, viewId, viewDirection, imageId, isPlacing } = toRefs(props);\n\n    const view = inject(VtkViewContext);\n    if (!view) throw new Error('No VtkView');\n\n    const sliceInfo = useSliceInfo(viewId, imageId);\n    const slice = computed(() => sliceInfo.value?.slice ?? 0);\n\n    const rulerStore = useRulerStore();\n    const ruler = computed(() => rulerStore.rulerByID[toolId.value]);\n    const { metadata: imageMetadata } = useImage(imageId);\n\n    const widgetFactory = vtkRulerWidget.newInstance({\n      id: toolId.value,\n      isPlaced: !isPlacing.value,\n    });\n    const widget = view.widgetManager.addWidget(\n      widgetFactory\n    ) as vtkRulerViewWidget;\n\n    onUnmounted(() => {\n      view.widgetManager.removeWidget(widget);\n      widgetFactory.delete();\n    });\n\n    whenever(\n      isPlacing,\n      () => {\n        widget.setInteractionState(InteractionState.PlacingFirst);\n      },\n      { immediate: true }\n    );\n\n    // --- reset on slice/image changes --- //\n\n    watch([slice, imageId], () => {\n      const isPlaced = widget.getWidgetState().getIsPlaced();\n      if (!isPlaced) {\n        widget.resetInteractions();\n        widget.setInteractionState(InteractionState.PlacingFirst);\n      }\n    });\n\n    // --- placed event --- //\n\n    onVTKEvent(widget, 'onPlacedEvent', () => {\n      emit('placed');\n    });\n\n    useHoverEvent(emit, widget);\n\n    // --- right click handling --- //\n\n    useRightClickContextMenu(emit, widget);\n\n    // --- manipulator --- //\n\n    const manipulator = vtkPlaneManipulator.newInstance();\n    widget.setManipulator(manipulator);\n\n    watchEffect(() => {\n      updatePlaneManipulatorFor2DView(\n        manipulator,\n        viewDirection.value,\n        ruler.value?.slice ?? slice.value,\n        imageMetadata.value\n      );\n    });\n\n    // --- visibility --- //\n\n    const isVisible = computed(() => ruler.value?.slice === slice.value);\n    useWidgetVisibility(widget, isVisible, view);\n\n    // --- handle pick visibility --- //\n\n    const visibleStates = reactive({\n      firstPoint: false,\n      secondPoint: false,\n    });\n\n    const updateVisibleState = (widgetState: vtkRulerWidgetState) => {\n      visibleStates.firstPoint = widgetState.getFirstPoint().getVisible();\n      visibleStates.secondPoint = widgetState.getSecondPoint().getVisible();\n    };\n\n    const widgetState = widgetFactory.getWidgetState();\n    onVTKEvent(widgetFactory.getWidgetState(), 'onModified', () =>\n      updateVisibleState(widgetState)\n    );\n    updateVisibleState(widgetState);\n\n    return {\n      ruler,\n      slice,\n      firstPoint: computed(() => {\n        return visibleStates.firstPoint ? ruler.value?.firstPoint : undefined;\n      }),\n      secondPoint: computed(() => {\n        return visibleStates.secondPoint ? ruler.value?.secondPoint : undefined;\n      }),\n      length: computed(() => rulerStore.lengthByID[ruler.value.id]),\n    };\n  },\n});\n</script>\n\n<template>\n  <RulerSVG2D\n    v-show=\"slice === ruler.slice\"\n    :point1=\"firstPoint\"\n    :point2=\"secondPoint\"\n    :color=\"ruler.color\"\n    :strokeWidth=\"ruler.strokeWidth\"\n    :length=\"length\"\n  />\n</template>\n","<template>\n  <div class=\"overlay-no-events\">\n    <svg class=\"overlay-no-events\">\n      <ruler-widget-2D\n        v-for=\"ruler in rulers\"\n        :key=\"ruler.id\"\n        :tool-id=\"ruler.id\"\n        :is-placing=\"ruler.id === placingRulerID\"\n        :image-id=\"imageId\"\n        :view-id=\"viewId\"\n        :view-direction=\"viewDirection\"\n        @contextmenu=\"openContextMenu(ruler.id, $event)\"\n        @placed=\"onRulerPlaced\"\n        @widgetHover=\"onHover(ruler.id, $event)\"\n      />\n    </svg>\n    <annotation-info :info=\"overlayInfo\" :tool-store=\"rulerStore\" />\n    <annotation-context-menu ref=\"contextMenu\" :tool-store=\"rulerStore\" />\n  </div>\n</template>\n\n<script lang=\"ts\">\nimport { computed, defineComponent, onUnmounted, PropType, toRefs } from 'vue';\nimport { useImage } from '@/src/composables/useCurrentImage';\nimport { useToolStore } from '@/src/store/tools';\nimport { Tools } from '@/src/store/tools/types';\nimport { useRulerStore } from '@/src/store/tools/rulers';\nimport { getLPSAxisFromDir } from '@/src/utils/lps';\nimport RulerWidget2D from '@/src/components/tools/ruler/RulerWidget2D.vue';\nimport { LPSAxisDir } from '@/src/types/lps';\nimport { storeToRefs } from 'pinia';\nimport {\n  useContextMenu,\n  useCurrentTools,\n  useHover,\n  usePlacingAnnotationTool,\n} from '@/src/composables/annotationTool';\nimport AnnotationContextMenu from '@/src/components/tools/AnnotationContextMenu.vue';\nimport AnnotationInfo from '@/src/components/tools/AnnotationInfo.vue';\nimport { useFrameOfReference } from '@/src/composables/useFrameOfReference';\nimport { Maybe } from '@/src/types';\nimport { useSliceInfo } from '@/src/composables/useSliceInfo';\nimport { watchImmediate } from '@vueuse/core';\n\nexport default defineComponent({\n  name: 'RulerTool',\n  props: {\n    viewId: {\n      type: String,\n      required: true,\n    },\n    viewDirection: {\n      type: String as PropType<LPSAxisDir>,\n      required: true,\n    },\n    imageId: String as PropType<Maybe<string>>,\n  },\n  components: {\n    RulerWidget2D,\n    AnnotationContextMenu,\n    AnnotationInfo,\n  },\n  setup(props) {\n    const { viewDirection, imageId, viewId } = toRefs(props);\n    const toolStore = useToolStore();\n    const rulerStore = useRulerStore();\n    const { activeLabel } = storeToRefs(rulerStore);\n\n    const sliceInfo = useSliceInfo(viewId, imageId);\n    const slice = computed(() => sliceInfo.value?.slice ?? 0);\n\n    const { metadata: imageMetadata } = useImage(imageId);\n    const isToolActive = computed(() => toolStore.currentTool === Tools.Ruler);\n    const viewAxis = computed(() => getLPSAxisFromDir(viewDirection.value));\n\n    // --- active ruler management --- //\n\n    const frameOfReference = useFrameOfReference(\n      viewDirection,\n      slice,\n      imageMetadata\n    );\n\n    const placingTool = usePlacingAnnotationTool(\n      rulerStore,\n      computed(() => {\n        if (!imageId.value) return {};\n        return {\n          imageID: imageId.value,\n          frameOfReference: frameOfReference.value,\n          slice: slice.value,\n          label: activeLabel.value,\n          ...(activeLabel.value && rulerStore.labels[activeLabel.value]),\n        };\n      })\n    );\n\n    watchImmediate([isToolActive, imageId] as const, ([active, imageID]) => {\n      placingTool.remove();\n      if (active && imageID) {\n        placingTool.add();\n      }\n    });\n\n    onUnmounted(() => {\n      placingTool.remove();\n    });\n\n    const onRulerPlaced = () => {\n      if (imageId.value) {\n        placingTool.commit();\n        placingTool.add();\n      }\n    };\n\n    // --- //\n\n    const { contextMenu, openContextMenu } = useContextMenu();\n\n    // --- ruler data --- //\n\n    const currentTools = useCurrentTools(rulerStore, viewAxis);\n\n    const currentRulers = computed(() => {\n      const { lengthByID } = rulerStore;\n      return currentTools.value.map((ruler) => ({\n        ...ruler,\n        length: lengthByID[ruler.id],\n      }));\n    });\n\n    const { onHover, overlayInfo } = useHover(currentTools, slice);\n\n    return {\n      rulers: currentRulers,\n      placingRulerID: placingTool.id,\n      onRulerPlaced,\n      contextMenu,\n      openContextMenu,\n      rulerStore,\n      onHover,\n      overlayInfo,\n    };\n  },\n});\n</script>\n\n<style scoped src=\"@/src/components/styles/vtk-view.css\"></style>\n","import macro from '@kitware/vtk.js/macros';\nimport vtkBoundingBox from '@kitware/vtk.js/Common/DataModel/BoundingBox';\nimport vtkStateBuilder from '@kitware/vtk.js/Widgets/Core/StateBuilder';\nimport * as vtkMath from '@kitware/vtk.js/Common/Core/Math';\nimport LineGlyphRepresentation from '../LineGlyphRepresentation';\n\nfunction vtkRectangleLineRepresentation(publicAPI, model) {\n  model.classHierarchy.push('vtkRectangleLineRepresentation');\n\n  const superGetRepresentationStates = publicAPI.getRepresentationStates;\n\n  const compositeState = vtkStateBuilder\n    .createBuilder()\n    .addDynamicMixinState({\n      labels: ['handles'],\n      mixins: ['origin', 'scale1'],\n      name: 'handle',\n    })\n    .build();\n\n  const cornerStates = Array.from({ length: 4 }, () =>\n    compositeState.addHandle()\n  );\n\n  // Save behavior model to access renderer\n  const superBehavior = model.widgetAPI.behavior;\n  let behaviorModel;\n  model.widgetAPI.behavior = (publicAPIy, bModel) => {\n    behaviorModel = bModel;\n    return superBehavior(publicAPIy, bModel);\n  };\n\n  publicAPI.getRepresentationStates = (input = model.inputData[0]) => {\n    // Map 2 handles to 4 corner states in display space\n    const states = superGetRepresentationStates(input);\n    if (states.length === 0) {\n      return states;\n    }\n\n    const box = [...vtkBoundingBox.INIT_BOUNDS];\n    states.forEach((handle) => {\n      const displayPos = behaviorModel._apiSpecificRenderWindow.worldToDisplay(\n        ...handle.getOrigin(),\n        behaviorModel._renderer\n      );\n      vtkBoundingBox.addPoint(box, ...displayPos);\n    });\n    const corners = vtkBoundingBox.getCorners(box, []);\n\n    // 8 corners on plane, remove duplicates to make 4 corners\n    const corners2D = corners.reduce((outCorners, corner) => {\n      const duplicate = outCorners.some((outCorner) =>\n        vtkMath.areEquals(outCorner, corner)\n      );\n      if (!duplicate) {\n        outCorners.push(corner);\n      }\n      return outCorners;\n    }, []);\n\n    const scale = states[0].getScale1();\n\n    // reorder corners\n    const outStates = [0, 2, 3, 1]\n      // if in handles are equal, corners2D length is 1\n      .map((index) => Math.min(index, corners2D.length - 1))\n      .map((cornerIndex, stateIndex) => {\n        const worldPos = behaviorModel._apiSpecificRenderWindow.displayToWorld(\n          ...corners2D[cornerIndex],\n          behaviorModel._renderer\n        );\n        const state = cornerStates[stateIndex];\n        state.setOrigin(worldPos);\n        state.setScale1(scale);\n        return state;\n      });\n\n    return outStates;\n  };\n}\n\nexport function extend(publicAPI, model, initialValues = {}) {\n  LineGlyphRepresentation.extend(publicAPI, model, initialValues);\n\n  vtkRectangleLineRepresentation(publicAPI, model);\n}\n\nexport const newInstance = macro.newInstance(\n  extend,\n  'vtkRectangleLineRepresentation'\n);\n\nexport default { newInstance, extend };\n","import macro from '@kitware/vtk.js/macro';\n\nimport { AnnotationToolType } from '@/src/store/tools/types';\nimport vtkRulerWidget from '../RulerWidget';\nimport vtkRectangleLineRepresentation from './RectangleLineRepresentation';\n\nexport { InteractionState } from '../RulerWidget/behavior';\n\n// ----------------------------------------------------------------------------\n// Factory\n// ----------------------------------------------------------------------------\n\nfunction vtkRectangleWidget(publicAPI, model) {\n  model.classHierarchy.push('vtkRectangleWidget');\n\n  const superGetRepresentationsForViewType =\n    publicAPI.getRepresentationsForViewType;\n  publicAPI.getRepresentationsForViewType = () => {\n    const reps = superGetRepresentationsForViewType();\n    reps[1].builder = vtkRectangleLineRepresentation;\n    reps[1].initialValues = {\n      ...reps[1].initialValues,\n      widgetAPI: model,\n    };\n    return reps;\n  };\n}\n\n// ----------------------------------------------------------------------------\n\nconst DEFAULT_VALUES = {};\n\n// ----------------------------------------------------------------------------\n\nexport function extend(publicAPI, model, initialValues = {}) {\n  Object.assign(model, DEFAULT_VALUES, initialValues);\n\n  vtkRulerWidget.extend(publicAPI, model, {\n    ...initialValues,\n    toolType: AnnotationToolType.Rectangle,\n  });\n\n  vtkRectangleWidget(publicAPI, model);\n}\n\n// ----------------------------------------------------------------------------\n\nexport const newInstance = macro.newInstance(extend, 'vtkRectangleWidget');\n\n// ----------------------------------------------------------------------------\n\nexport default { newInstance, extend };\n","<template>\n  <g>\n    <rect\n      :x=\"rectangle.x\"\n      :y=\"rectangle.y\"\n      :width=\"rectangle.width\"\n      :height=\"rectangle.height\"\n      :stroke=\"color\"\n      :stroke-width=\"strokeWidth\"\n      :fill=\"fillColor\"\n    />\n    <circle\n      v-if=\"first\"\n      :cx=\"first.x\"\n      :cy=\"first.y\"\n      :stroke=\"color\"\n      :stroke-width=\"strokeWidth\"\n      fill=\"transparent\"\n      :r=\"ANNOTATION_TOOL_HANDLE_RADIUS\"\n    />\n    <circle\n      v-if=\"second\"\n      :cx=\"second.x\"\n      :cy=\"second.y\"\n      :stroke=\"color\"\n      :stroke-width=\"strokeWidth\"\n      fill=\"transparent\"\n      :r=\"ANNOTATION_TOOL_HANDLE_RADIUS\"\n    />\n  </g>\n</template>\n\n<script lang=\"ts\">\nimport { onVTKEvent } from '@/src/composables/onVTKEvent';\nimport { ANNOTATION_TOOL_HANDLE_RADIUS } from '@/src/constants';\nimport { worldToSVG } from '@/src/utils/vtk-helpers';\nimport type { Vector3 } from '@kitware/vtk.js/types';\n\nimport {\n  PropType,\n  computed,\n  defineComponent,\n  toRefs,\n  unref,\n  ref,\n  watch,\n  inject,\n} from 'vue';\nimport { VtkViewContext } from '@/src/components/vtk/context';\nimport { vtkFieldRef } from '@/src/core/vtk/vtkFieldRef';\nimport { useResizeObserver } from '@vueuse/core';\n\ntype SVGPoint = {\n  x: number;\n  y: number;\n};\n\nexport default defineComponent({\n  props: {\n    point1: Array as PropType<Array<number>>,\n    point2: Array as PropType<Array<number>>,\n    color: String,\n    fillColor: String,\n    strokeWidth: Number,\n  },\n  setup(props) {\n    const { point1, point2 } = toRefs(props);\n    const firstPoint = ref<SVGPoint | null>();\n    const secondPoint = ref<SVGPoint | null>();\n\n    const view = inject(VtkViewContext);\n    if (!view) throw new Error('No VtkView');\n\n    const updatePoints = () => {\n      const viewRenderer = view.renderer;\n      const pt1 = unref(point1) as Vector3 | undefined;\n      const pt2 = unref(point2) as Vector3 | undefined;\n      if (pt1) {\n        const point2D = worldToSVG(pt1, viewRenderer);\n        if (point2D) {\n          firstPoint.value = {\n            x: point2D[0],\n            y: point2D[1],\n          };\n        }\n      } else {\n        firstPoint.value = null;\n      }\n\n      if (pt2) {\n        const point2D = worldToSVG(pt2, viewRenderer);\n        if (point2D) {\n          secondPoint.value = {\n            x: point2D[0],\n            y: point2D[1],\n          };\n        }\n      } else {\n        secondPoint.value = null;\n      }\n    };\n\n    const rectangle = computed(() => {\n      const [firstX, firstY] = [\n        firstPoint.value?.x ?? 0,\n        firstPoint.value?.y ?? 0,\n      ];\n      const [secondX, secondY] = [\n        secondPoint.value?.x ?? firstX,\n        secondPoint.value?.y ?? firstY,\n      ];\n      return {\n        x: Math.min(firstX, secondX),\n        y: Math.min(firstY, secondY),\n        width: Math.abs(firstX - secondX),\n        height: Math.abs(firstY - secondY),\n      };\n    });\n\n    const camera = vtkFieldRef(view.renderer, 'activeCamera');\n    onVTKEvent(camera, 'onModified', updatePoints);\n\n    watch([point1, point2], updatePoints, {\n      deep: true,\n      immediate: true,\n    });\n\n    // --- resize --- //\n\n    const container = vtkFieldRef(view.renderWindowView, 'container');\n    useResizeObserver(container, () => {\n      updatePoints();\n    });\n\n    return {\n      first: firstPoint,\n      second: secondPoint,\n      rectangle,\n      ANNOTATION_TOOL_HANDLE_RADIUS,\n    };\n  },\n});\n</script>\n","<script lang=\"ts\">\nimport {\n  computed,\n  defineComponent,\n  PropType,\n  toRefs,\n  watch,\n  watchEffect,\n  reactive,\n  inject,\n  onUnmounted,\n} from 'vue';\nimport vtkPlaneManipulator from '@kitware/vtk.js/Widgets/Manipulators/PlaneManipulator';\nimport { useImage } from '@/src/composables/useCurrentImage';\nimport { updatePlaneManipulatorFor2DView } from '@/src/utils/manipulators';\nimport { LPSAxisDir } from '@/src/types/lps';\nimport { onVTKEvent } from '@/src/composables/onVTKEvent';\nimport { useRectangleStore } from '@/src/store/tools/rectangles';\nimport vtkRectangleWidget, {\n  vtkRectangleViewWidget,\n  InteractionState,\n} from '@/src/vtk/RectangleWidget';\nimport RectangleSVG2D from '@/src/components/tools/rectangle/RectangleSVG2D.vue';\nimport {\n  useRightClickContextMenu,\n  useHoverEvent,\n  useWidgetVisibility,\n} from '@/src/composables/annotationTool';\nimport { vtkRulerWidgetState } from '@/src/vtk/RulerWidget';\nimport { ToolID } from '@/src/types/annotation-tool';\nimport { VtkViewContext } from '@/src/components/vtk/context';\nimport { useSliceInfo } from '@/src/composables/useSliceInfo';\nimport { Maybe } from '@/src/types';\nimport { whenever } from '@vueuse/core';\n\nconst useStore = useRectangleStore;\nconst vtkWidgetFactory = vtkRectangleWidget;\ntype WidgetView = vtkRectangleViewWidget;\nconst SVG2DComponent = RectangleSVG2D;\n\nexport default defineComponent({\n  name: 'RectangleWidget2D',\n  emits: ['placed', 'contextmenu', 'widgetHover'],\n  props: {\n    toolId: {\n      type: String as unknown as PropType<ToolID>,\n      required: true,\n    },\n    viewId: {\n      type: String,\n      required: true,\n    },\n    viewDirection: {\n      type: String as PropType<LPSAxisDir>,\n      required: true,\n    },\n    isPlacing: {\n      type: Boolean,\n      default: false,\n    },\n    imageId: String as PropType<Maybe<string>>,\n  },\n  components: {\n    SVG2DComponent,\n  },\n  setup(props, { emit }) {\n    const { toolId, viewId, viewDirection, imageId, isPlacing } = toRefs(props);\n\n    const view = inject(VtkViewContext);\n    if (!view) throw new Error('No VtkView');\n\n    const sliceInfo = useSliceInfo(viewId, imageId);\n    const slice = computed(() => sliceInfo.value?.slice);\n\n    const toolStore = useStore();\n    const tool = computed(() => toolStore.toolByID[toolId.value]);\n    const { metadata: imageMetadata } = useImage(imageId);\n\n    const widgetFactory = vtkWidgetFactory.newInstance({\n      id: toolId.value,\n      isPlaced: !isPlacing.value,\n    });\n\n    const widget = view.widgetManager.addWidget(widgetFactory) as WidgetView;\n\n    onUnmounted(() => {\n      view.widgetManager.removeWidget(widget);\n      widgetFactory.delete();\n    });\n\n    whenever(\n      isPlacing,\n      () => {\n        widget.setInteractionState(InteractionState.PlacingFirst);\n      },\n      { immediate: true }\n    );\n\n    // --- reset on slice/image changes --- //\n\n    watch([slice, imageId], () => {\n      const isPlaced = widget.getWidgetState().getIsPlaced();\n      if (!isPlaced) {\n        widget.resetInteractions();\n        widget.setInteractionState(InteractionState.PlacingFirst);\n      }\n    });\n\n    onVTKEvent(widget, 'onPlacedEvent', () => {\n      emit('placed');\n    });\n\n    useHoverEvent(emit, widget);\n\n    // --- right click handling --- //\n\n    useRightClickContextMenu(emit, widget);\n\n    // --- manipulator --- //\n\n    const manipulator = vtkPlaneManipulator.newInstance();\n    widget.setManipulator(manipulator);\n\n    watchEffect(() => {\n      updatePlaneManipulatorFor2DView(\n        manipulator,\n        viewDirection.value,\n        tool.value?.slice ?? slice.value,\n        imageMetadata.value\n      );\n    });\n\n    // --- visibility --- //\n\n    const isVisible = computed(() => tool.value?.slice === slice.value);\n    useWidgetVisibility(widget, isVisible, view);\n\n    // --- handle pick visibility --- //\n\n    const visibleStates = reactive({\n      firstPoint: false,\n      secondPoint: false,\n    });\n\n    const updateVisibleState = (widgetState: vtkRulerWidgetState) => {\n      visibleStates.firstPoint = widgetState.getFirstPoint().getVisible();\n      visibleStates.secondPoint = widgetState.getSecondPoint().getVisible();\n    };\n\n    const widgetState = widgetFactory.getWidgetState();\n    onVTKEvent(widgetFactory.getWidgetState(), 'onModified', () =>\n      updateVisibleState(widgetState)\n    );\n    updateVisibleState(widgetState);\n\n    return {\n      tool,\n      slice,\n      firstPoint: computed(() => {\n        return visibleStates.firstPoint ? tool.value?.firstPoint : undefined;\n      }),\n      secondPoint: computed(() => {\n        return visibleStates.secondPoint ? tool.value?.secondPoint : undefined;\n      }),\n    };\n  },\n});\n</script>\n\n<template>\n  <SVG2DComponent\n    v-show=\"slice === tool.slice\"\n    :view-id=\"viewId\"\n    :point1=\"firstPoint\"\n    :point2=\"secondPoint\"\n    :color=\"tool.color\"\n    :stroke-width=\"tool.strokeWidth\"\n    :fill-color=\"tool.fillColor\"\n  />\n</template>\n","<template>\n  <div class=\"overlay-no-events\">\n    <svg class=\"overlay-no-events\" data-testid=\"rectangle-tool-container\">\n      <rectangle-widget-2D\n        v-for=\"tool in tools\"\n        :key=\"tool.id\"\n        :tool-id=\"tool.id\"\n        :is-placing=\"tool.id === placingToolID\"\n        :image-id=\"imageId\"\n        :view-id=\"viewId\"\n        :view-direction=\"viewDirection\"\n        @contextmenu=\"openContextMenu(tool.id, $event)\"\n        @placed=\"onToolPlaced\"\n        @widgetHover=\"onHover(tool.id, $event)\"\n      />\n    </svg>\n    <annotation-info :info=\"overlayInfo\" :tool-store=\"activeToolStore\" />\n    <annotation-context-menu ref=\"contextMenu\" :tool-store=\"activeToolStore\" />\n  </div>\n</template>\n\n<script lang=\"ts\">\nimport { computed, defineComponent, onUnmounted, PropType, toRefs } from 'vue';\nimport { storeToRefs } from 'pinia';\nimport { useCurrentImage } from '@/src/composables/useCurrentImage';\nimport { useToolStore } from '@/src/store/tools';\nimport { Tools } from '@/src/store/tools/types';\nimport { getLPSAxisFromDir } from '@/src/utils/lps';\nimport { LPSAxisDir } from '@/src/types/lps';\nimport { useRectangleStore } from '@/src/store/tools/rectangles';\nimport {\n  useCurrentTools,\n  useContextMenu,\n  useHover,\n  usePlacingAnnotationTool,\n} from '@/src/composables/annotationTool';\nimport AnnotationContextMenu from '@/src/components/tools/AnnotationContextMenu.vue';\nimport AnnotationInfo from '@/src/components/tools/AnnotationInfo.vue';\nimport { useFrameOfReference } from '@/src/composables/useFrameOfReference';\nimport { Maybe } from '@/src/types';\nimport { useSliceInfo } from '@/src/composables/useSliceInfo';\nimport { watchImmediate } from '@vueuse/core';\nimport RectangleWidget2D from './RectangleWidget2D.vue';\n\nconst useActiveToolStore = useRectangleStore;\nconst toolType = Tools.Rectangle;\n\nexport default defineComponent({\n  name: 'RectangleTool',\n  props: {\n    viewId: {\n      type: String,\n      required: true,\n    },\n    viewDirection: {\n      type: String as PropType<LPSAxisDir>,\n      required: true,\n    },\n    imageId: String as PropType<Maybe<string>>,\n  },\n  components: {\n    RectangleWidget2D,\n    AnnotationContextMenu,\n    AnnotationInfo,\n  },\n  setup(props) {\n    const { viewDirection, imageId, viewId } = toRefs(props);\n    const toolStore = useToolStore();\n    const activeToolStore = useActiveToolStore();\n    const { activeLabel } = storeToRefs(activeToolStore);\n\n    const sliceInfo = useSliceInfo(viewId, imageId);\n    const slice = computed(() => sliceInfo.value?.slice ?? 0);\n\n    const { currentImageID, currentImageMetadata } = useCurrentImage();\n    const isToolActive = computed(() => toolStore.currentTool === toolType);\n    const viewAxis = computed(() => getLPSAxisFromDir(viewDirection.value));\n\n    // --- active tool management --- //\n\n    const frameOfReference = useFrameOfReference(\n      viewDirection,\n      slice,\n      currentImageMetadata\n    );\n\n    const placingTool = usePlacingAnnotationTool(\n      activeToolStore,\n      computed(() => {\n        if (!currentImageID.value) return {};\n        return {\n          imageID: currentImageID.value,\n          frameOfReference: frameOfReference.value,\n          slice: slice.value,\n          label: activeLabel.value,\n          ...(activeLabel.value && activeToolStore.labels[activeLabel.value]),\n        };\n      })\n    );\n\n    watchImmediate(\n      [isToolActive, currentImageID] as const,\n      ([active, imageID]) => {\n        placingTool.remove();\n        if (active && imageID) {\n          placingTool.add();\n        }\n      }\n    );\n\n    onUnmounted(() => {\n      placingTool.remove();\n    });\n\n    const onToolPlaced = () => {\n      if (currentImageID.value) {\n        placingTool.commit();\n        placingTool.add();\n      }\n    };\n\n    // --- //\n\n    const { contextMenu, openContextMenu } = useContextMenu();\n\n    const currentTools = useCurrentTools(activeToolStore, viewAxis);\n\n    const { onHover, overlayInfo } = useHover(currentTools, slice);\n\n    return {\n      tools: currentTools,\n      placingToolID: placingTool.id,\n      onToolPlaced,\n      contextMenu,\n      openContextMenu,\n      activeToolStore,\n      onHover,\n      overlayInfo,\n    };\n  },\n});\n</script>\n\n<style scoped src=\"@/src/components/styles/vtk-view.css\"></style>\n","<script setup lang=\"ts\">\nimport { onVTKEvent } from '@/src/composables/onVTKEvent';\nimport { WIDGET_PRIORITY } from '@kitware/vtk.js/Widgets/Core/AbstractWidget/Constants';\nimport { useToolSelectionStore } from '@/src/store/tools/toolSelection';\nimport { vtkAnnotationToolWidget } from '@/src/vtk/ToolWidgetUtils/types';\nimport { inject } from 'vue';\nimport { VtkViewContext } from '@/src/components/vtk/context';\n\nconst view = inject(VtkViewContext);\nif (!view) throw new Error('No VtkView');\n\nconst selectionStore = useToolSelectionStore();\n\nonVTKEvent(\n  view.interactor,\n  'onLeftButtonPress',\n  (event: any) => {\n    const withModifiers = !!(event.shiftKey || event.controlKey);\n    const selectedData = view.widgetManager.getSelectedData();\n    if ('widget' in selectedData) {\n      // clicked in empty space.\n      const widget = selectedData.widget as vtkAnnotationToolWidget;\n      const widgetState = widget.getWidgetState();\n      const id = widgetState.getId();\n      const type = widgetState.getToolType();\n      // preserve if we've used shift or ctrl\n      if (withModifiers) {\n        selectionStore.toggleSelection(id, type);\n      } else {\n        selectionStore.clearSelection();\n        selectionStore.addSelection(id, type);\n      }\n    } else if (!withModifiers) {\n      // if no modifiers, then deselect\n      selectionStore.clearSelection();\n    }\n  },\n  {\n    // capture all events by calling handler before widgets\n    priority: WIDGET_PRIORITY + 1,\n  }\n);\n\nconst render = () => {};\n</script>\n\n<template>\n  <render />\n</template>\n","<script setup lang=\"ts\">\nimport { computed, ref, watch, toRefs, toRaw, inject } from 'vue';\nimport { ANNOTATION_TOOL_HANDLE_RADIUS } from '@/src/constants';\nimport { worldToSVG } from '@/src/utils/vtk-helpers';\nimport { nonNullable } from '@/src/utils/index';\nimport vtkBoundingBox from '@kitware/vtk.js/Common/DataModel/BoundingBox';\nimport type { Bounds, Vector3 } from '@kitware/vtk.js/types';\nimport { onVTKEvent } from '@/src/composables/onVTKEvent';\nimport { VtkViewContext } from '@/src/components/vtk/context';\nimport { vtkFieldRef } from '@/src/core/vtk/vtkFieldRef';\nimport { useResizeObserver } from '@vueuse/core';\n\nconst DEFAULT_PADDING = 2;\n\nconst props = withDefaults(\n  defineProps<{\n    points: Array<Vector3>;\n    padding?: number;\n  }>(),\n  {\n    padding: DEFAULT_PADDING,\n  }\n);\n\nconst view = inject(VtkViewContext);\nif (!view) throw new Error('No VtkView');\n\nconst visible = computed(() => {\n  return props.points.length > 0;\n});\n\nconst rectangle = ref({\n  x: 0,\n  y: 0,\n  width: 0,\n  height: 0,\n});\n\nconst updateRectangle = () => {\n  const viewRenderer = view.renderer;\n\n  const screenBounds = [...vtkBoundingBox.INIT_BOUNDS] as Bounds;\n  toRaw(props.points)\n    .map((point) => {\n      const point2D = worldToSVG(point, viewRenderer);\n      return point2D;\n    })\n    .filter(nonNullable)\n    .forEach(([x, y]) => {\n      vtkBoundingBox.addPoint(screenBounds, x, y, 0);\n    });\n\n  vtkBoundingBox.inflate(screenBounds, props.padding);\n  const [x, y] = vtkBoundingBox.getMinPoint(screenBounds);\n  const [maxX, maxY] = vtkBoundingBox.getMaxPoint(screenBounds);\n  // Plus 2 to account for the stroke width\n  const handleRadius = ANNOTATION_TOOL_HANDLE_RADIUS + 2;\n  const handleDiameter = 2 * handleRadius;\n  rectangle.value = {\n    x: x - handleRadius,\n    y: y - handleRadius,\n    width: maxX - x + handleDiameter,\n    height: maxY - y + handleDiameter,\n  };\n};\n\nconst { points } = toRefs(props);\nwatch(points, updateRectangle, { immediate: true, deep: true });\n\nconst camera = vtkFieldRef(view.renderer, 'activeCamera');\nonVTKEvent(camera, 'onModified', updateRectangle);\n\nconst container = vtkFieldRef(view.renderWindowView, 'container');\nuseResizeObserver(container, () => {\n  updateRectangle();\n});\n</script>\n\n<template>\n  <rect\n    v-if=\"visible\"\n    :x=\"rectangle.x\"\n    :y=\"rectangle.y\"\n    :width=\"rectangle.width\"\n    :height=\"rectangle.height\"\n    stroke-width=\"2\"\n    fill=\"transparent\"\n    stroke=\"lightgray\"\n  />\n</template>\n","<template>\n  <div\n    class=\"slice-slider\"\n    ref=\"handleContainer\"\n    @pointerdown=\"onDragStart\"\n    @pointermove=\"onDragMove\"\n    @pointerup=\"onDragEnd\"\n    @pointercancel=\"onDragEnd\"\n    @contextmenu=\"$event.preventDefault()\"\n  >\n    <div class=\"slice-slider-track\" />\n    <div\n      class=\"slice-slider-handle\"\n      ref=\"handle\"\n      :style=\"{\n        height: `${handleHeight}px`,\n        transform: `translate3d(0, ${handlePosition}px, 0)`,\n      }\"\n    />\n  </div>\n</template>\n\n<script>\nfunction getYOffsetFromTransform(matStr) {\n  if (!matStr || matStr === 'none') {\n    return 0;\n  }\n  const values = matStr\n    .match(/matrix(?:3d)?\\((.+)\\)/)[1]\n    .split(',')\n    .map((v) => Number(v));\n  const is3D = matStr.includes('3d');\n  return is3D ? values[13] : values[5];\n}\n\nexport default {\n  props: {\n    modelValue: {\n      type: Number,\n      default: 0,\n    },\n    min: {\n      type: Number,\n      required: true,\n    },\n    max: {\n      type: Number,\n      required: true,\n    },\n    step: {\n      type: Number,\n      required: true,\n    },\n    handleHeight: {\n      type: Number,\n      default: 20,\n    },\n  },\n\n  emits: ['update:modelValue'],\n\n  data() {\n    return {\n      maxHandlePos: 0,\n      dragging: false,\n      initialHandlePos: 0,\n      initialMousePosY: 0,\n      yOffset: 0,\n    };\n  },\n\n  computed: {\n    handlePosition() {\n      const range = this.max - this.min <= 0 ? 1 : this.max - this.min;\n      const pos = this.maxHandlePos * ((this.modelValue - this.min) / range);\n      return this.dragging ? this.draggingHandlePos : pos;\n    },\n    draggingHandlePos() {\n      return Math.min(\n        Math.max(0, this.initialHandlePos + this.yOffset),\n        this.maxHandlePos\n      );\n    },\n  },\n\n  mounted() {\n    this.updateMaxHandlePos();\n    this.resizeObserver = new ResizeObserver((entries) => {\n      if (entries.length === 1) {\n        this.updateMaxHandlePos();\n      }\n    });\n    this.resizeObserver.observe(this.$refs.handleContainer);\n  },\n\n  beforeUnmount() {\n    this.resizeObserver.disconnect();\n  },\n\n  methods: {\n    updateMaxHandlePos() {\n      this.maxHandlePos =\n        this.$refs.handleContainer.clientHeight - this.handleHeight;\n    },\n\n    onDragStart(ev) {\n      ev.preventDefault();\n\n      this.dragging = true;\n      this.initialMousePosY = ev.pageY;\n\n      if (ev.target === this.$refs.handle) {\n        const handleStyles = window.getComputedStyle(this.$refs.handle);\n        this.initialHandlePos = getYOffsetFromTransform(handleStyles.transform);\n      } else {\n        // move handle to mouse pos\n        const { y } = this.$refs.handleContainer.getBoundingClientRect();\n        this.initialHandlePos = Math.max(\n          0,\n          Math.min(this.maxHandlePos, ev.pageY - y - this.handleHeight / 2)\n        );\n        const newSlice = this.getNearestSlice(this.initialHandlePos);\n        this.$emit('update:modelValue', newSlice);\n      }\n\n      this.yOffset = 0;\n\n      this.$refs.handleContainer.setPointerCapture(ev.pointerId);\n    },\n\n    onDragMove(ev) {\n      if (!this.$refs.handleContainer.hasPointerCapture(ev.pointerId)) return;\n      ev.preventDefault();\n\n      this.yOffset = ev.pageY - this.initialMousePosY;\n      const slice = this.getNearestSlice(this.handlePosition);\n      this.$emit('update:modelValue', slice);\n    },\n\n    onDragEnd(ev) {\n      if (!this.$refs.handleContainer.hasPointerCapture(ev.pointerId)) return;\n      ev.preventDefault();\n      this.$refs.handleContainer.releasePointerCapture(ev.pointerId);\n\n      this.dragging = false;\n      const slice = this.getNearestSlice(this.handlePosition);\n      this.$emit('update:modelValue', slice);\n    },\n\n    getNearestSlice(pos) {\n      const sliceEstimate = pos / this.maxHandlePos;\n      const frac = sliceEstimate * (this.max - this.min) + this.min;\n      return Math.round(frac / this.step) * this.step;\n    },\n  },\n};\n</script>\n\n<style scoped>\n.slice-slider {\n  touch-action: none;\n}\n\n.slice-slider-handle {\n  position: relative;\n  width: 100%;\n  background: #ccc;\n  box-sizing: border-box;\n  border-radius: 3px;\n  border: 1px solid #999;\n}\n\n.slice-slider-track {\n  position: absolute;\n  margin: 0 auto;\n  top: 8px;\n  left: 0;\n  right: 0;\n  bottom: 8px;\n  width: 1px;\n  border: 1px solid #888;\n  border-radius: 2px;\n}\n</style>\n","import { useImage } from '@/src/composables/useCurrentImage';\nimport { useSliceConfig } from '@/src/composables/useSliceConfig';\nimport useViewSliceStore from '@/src/store/view-configs/slicing';\nimport { Maybe } from '@/src/types';\nimport { LPSAxisDir } from '@/src/types/lps';\nimport { getLPSAxisFromDir } from '@/src/utils/lps';\nimport type { vtkRange } from '@kitware/vtk.js/interfaces';\nimport { watchImmediate } from '@vueuse/core';\nimport { MaybeRef, computed, toRef, unref } from 'vue';\n\nexport function useSliceConfigInitializer(\n  viewID: MaybeRef<string>,\n  imageID: MaybeRef<Maybe<string>>,\n  viewDirection: MaybeRef<LPSAxisDir>,\n  slicingDomain?: MaybeRef<vtkRange>\n) {\n  const store = useViewSliceStore();\n  const { config: sliceConfig } = useSliceConfig(viewID, imageID);\n  const { metadata, isLoading } = useImage(imageID);\n\n  const viewAxis = computed(() => getLPSAxisFromDir(unref(viewDirection)));\n  const sliceDomain = computed(() => {\n    const domainArg = unref(slicingDomain);\n    if (domainArg) return domainArg;\n    const { lpsOrientation, dimensions } = metadata.value;\n    const ijkIndex = lpsOrientation[viewAxis.value];\n    const dimMax = dimensions[ijkIndex];\n\n    return {\n      min: 0,\n      max: dimMax - 1,\n    };\n  });\n\n  watchImmediate(\n    [\n      toRef(sliceDomain),\n      toRef(viewDirection),\n      toRef(imageID),\n      isLoading,\n    ] as const,\n    ([domain, axisDirection, id, loading]) => {\n      if (loading || !id) return;\n\n      const configExisted = !!sliceConfig.value;\n      store.updateConfig(unref(viewID), id, {\n        ...domain,\n        axisDirection,\n      });\n      if (!configExisted) {\n        store.resetSlice(unref(viewID), id);\n      }\n    }\n  );\n}\n","<script setup lang=\"ts\">\nimport { VtkViewContext } from '@/src/components/vtk/context';\nimport { useSliceConfig } from '@/src/composables/useSliceConfig';\nimport { useSliceConfigInitializer } from '@/src/composables/useSliceConfigInitializer';\nimport { useMouseRangeManipulatorListener } from '@/src/core/vtk/useMouseRangeManipulatorListener';\nimport { useVtkInteractionManipulator } from '@/src/core/vtk/useVtkInteractionManipulator';\nimport { Maybe } from '@/src/types';\nimport { LPSAxisDir } from '@/src/types/lps';\nimport vtkMouseRangeManipulator, {\n  IMouseRangeManipulatorInitialValues,\n} from '@kitware/vtk.js/Interaction/Manipulators/MouseRangeManipulator';\nimport vtkInteractorStyleManipulator from '@kitware/vtk.js/Interaction/Style/InteractorStyleManipulator';\nimport { syncRef } from '@vueuse/core';\nimport { inject, toRefs, unref, watch, computed } from 'vue';\nimport { useViewStore } from '@/src/store/views';\n\ninterface Props {\n  viewId: string;\n  imageId: Maybe<string>;\n  viewDirection: LPSAxisDir;\n  manipulatorConfig?: IMouseRangeManipulatorInitialValues;\n}\n\nconst props = defineProps<Props>();\nconst { viewId, imageId, viewDirection, manipulatorConfig } = toRefs(props);\n\nconst view = inject(VtkViewContext);\nif (!view) throw new Error('No VtkView');\n\nconst interactorStyle =\n  view.interactorStyle as Maybe<vtkInteractorStyleManipulator>;\nif (!interactorStyle?.isA('vtkInteractorStyleManipulator')) {\n  throw new Error('No vtkInteractorStyleManipulator');\n}\n\nconst config = computed(() => {\n  return {\n    button: 1,\n    dragEnabled: false,\n    scrollEnabled: true,\n    ...manipulatorConfig?.value,\n  };\n});\n\nconst { instance: rangeManipulator } = useVtkInteractionManipulator(\n  interactorStyle,\n  vtkMouseRangeManipulator,\n  config\n);\n\nconst sliceConfig = useSliceConfig(viewId, imageId);\nuseSliceConfigInitializer(viewId, imageId, viewDirection);\n\nconst scroll = useMouseRangeManipulatorListener(\n  rangeManipulator,\n  'scroll',\n  sliceConfig.range,\n  1,\n  sliceConfig.slice.value\n);\n\nwatch(scroll, () => {\n  const viewStore = useViewStore();\n  if (unref(viewId) !== viewStore.activeViewID) {\n    viewStore.setActiveViewID(unref(viewId));\n  }\n});\n\nsyncRef(scroll, sliceConfig.slice, { immediate: true });\n</script>\n\n<template><slot></slot></template>\n","<template>\n  <div\n    class=\"vtk-container-wrapper\"\n    tabindex=\"0\"\n    @pointerenter=\"hover = true\"\n    @pointerleave=\"hover = false\"\n    @focusin=\"hover = true\"\n    @focusout=\"hover = false\"\n  >\n    <div class=\"vtk-gutter\">\n      <v-btn dark icon size=\"medium\" variant=\"text\" @click=\"resetCamera\">\n        <v-icon size=\"medium\" class=\"py-1\">mdi-camera-flip-outline</v-icon>\n        <v-tooltip\n          location=\"right\"\n          activator=\"parent\"\n          transition=\"slide-x-transition\"\n        >\n          Reset Camera\n        </v-tooltip>\n      </v-btn>\n      <slice-slider\n        v-model=\"currentSlice\"\n        class=\"slice-slider\"\n        :min=\"sliceRange[0]\"\n        :max=\"sliceRange[1]\"\n        :step=\"1\"\n        :handle-height=\"20\"\n      />\n    </div>\n    <div class=\"vtk-container\" data-testid=\"two-view-container\">\n      <div class=\"vtk-sub-container\">\n        <vtk-slice-view\n          class=\"vtk-view\"\n          ref=\"vtkView\"\n          data-testid=\"vtk-view vtk-two-view\"\n          :disable-auto-reset-camera=\"disableCameraAutoReset\"\n          :view-id=\"id\"\n          :image-id=\"currentImageID\"\n          :view-direction=\"viewDirection\"\n          :view-up=\"viewUp\"\n        >\n          <vtk-mouse-interaction-manipulator\n            v-if=\"currentTool === Tools.Pan\"\n            :manipulator-constructor=\"vtkMouseCameraTrackballPanManipulator\"\n            :manipulator-props=\"{ button: 1 }\"\n          ></vtk-mouse-interaction-manipulator>\n          <vtk-mouse-interaction-manipulator\n            :manipulator-constructor=\"vtkMouseCameraTrackballPanManipulator\"\n            :manipulator-props=\"{ button: 1, shift: true }\"\n          ></vtk-mouse-interaction-manipulator>\n          <vtk-mouse-interaction-manipulator\n            :manipulator-constructor=\"vtkMouseCameraTrackballPanManipulator\"\n            :manipulator-props=\"{ button: 2 }\"\n          ></vtk-mouse-interaction-manipulator>\n          <vtk-mouse-interaction-manipulator\n            v-if=\"currentTool === Tools.Zoom\"\n            :manipulator-constructor=\"\n              vtkMouseCameraTrackballZoomToMouseManipulator\n            \"\n            :manipulator-props=\"{ button: 1 }\"\n          ></vtk-mouse-interaction-manipulator>\n          <vtk-mouse-interaction-manipulator\n            :manipulator-constructor=\"\n              vtkMouseCameraTrackballZoomToMouseManipulator\n            \"\n            :manipulator-props=\"{ button: 3 }\"\n          ></vtk-mouse-interaction-manipulator>\n          <vtk-slice-view-slicing-manipulator\n            :view-id=\"id\"\n            :image-id=\"currentImageID\"\n            :view-direction=\"viewDirection\"\n          ></vtk-slice-view-slicing-manipulator>\n          <vtk-slice-view-window-manipulator\n            :view-id=\"id\"\n            :image-id=\"currentImageID\"\n            :manipulator-config=\"windowingManipulatorProps\"\n          ></vtk-slice-view-window-manipulator>\n          <slice-viewer-overlay\n            :view-id=\"id\"\n            :image-id=\"currentImageID\"\n          ></slice-viewer-overlay>\n          <vtk-base-slice-representation\n            :view-id=\"id\"\n            :image-id=\"currentImageID\"\n            :axis=\"viewAxis\"\n          ></vtk-base-slice-representation>\n          <vtk-segmentation-slice-representation\n            v-for=\"segId in segmentations\"\n            :key=\"`seg-${segId}`\"\n            :view-id=\"id\"\n            :segmentation-id=\"segId\"\n            :axis=\"viewAxis\"\n          ></vtk-segmentation-slice-representation>\n          <template v-if=\"currentImageID\">\n            <vtk-layer-slice-representation\n              v-for=\"layer in currentLayers\"\n              :key=\"`layer-${layer.id}`\"\n              :view-id=\"id\"\n              :layer-id=\"layer.id\"\n              :parent-id=\"currentImageID\"\n              :axis=\"viewAxis\"\n            ></vtk-layer-slice-representation>\n          </template>\n          <crop-tool :view-id=\"viewId\" :image-id=\"currentImageID\" />\n          <crosshairs-tool\n            :view-id=\"viewId\"\n            :image-id=\"currentImageID\"\n            :view-direction=\"viewDirection\"\n          />\n          <paint-tool\n            :view-id=\"viewId\"\n            :image-id=\"currentImageID\"\n            :view-direction=\"viewDirection\"\n          />\n          <polygon-tool\n            :view-id=\"viewId\"\n            :image-id=\"currentImageID\"\n            :view-direction=\"viewDirection\"\n          />\n          <ruler-tool\n            :view-id=\"viewId\"\n            :image-id=\"currentImageID\"\n            :view-direction=\"viewDirection\"\n          />\n          <rectangle-tool\n            :view-id=\"viewId\"\n            :image-id=\"currentImageID\"\n            :view-direction=\"viewDirection\"\n          />\n          <select-tool />\n          <svg class=\"overlay-no-events\">\n            <bounding-rectangle :points=\"selectionPoints\" />\n          </svg>\n          <slot></slot>\n        </vtk-slice-view>\n      </div>\n      <transition name=\"loading\">\n        <div v-if=\"isImageLoading\" class=\"overlay-no-events loading\">\n          <div>Loading the image</div>\n          <div>\n            <v-progress-circular indeterminate color=\"blue\" />\n          </div>\n        </div>\n      </transition>\n    </div>\n  </div>\n</template>\n\n<script setup lang=\"ts\">\nimport { ref, toRefs, computed } from 'vue';\nimport { storeToRefs } from 'pinia';\nimport { useCurrentImage } from '@/src/composables/useCurrentImage';\nimport { LPSAxisDir } from '@/src/types/lps';\nimport { getLPSAxisFromDir } from '@/src/utils/lps';\nimport VtkSliceView from '@/src/components/vtk/VtkSliceView.vue';\nimport { VtkViewApi } from '@/src/types/vtk-types';\nimport type { LayoutViewProps } from '@/src/types';\nimport { Tools } from '@/src/store/tools/types';\nimport VtkBaseSliceRepresentation from '@/src/components/vtk/VtkBaseSliceRepresentation.vue';\nimport VtkSegmentationSliceRepresentation from '@/src/components/vtk/VtkSegmentationSliceRepresentation.vue';\nimport { useSegmentGroupStore } from '@/src/store/segmentGroups';\nimport VtkLayerSliceRepresentation from '@/src/components/vtk/VtkLayerSliceRepresentation.vue';\nimport { useViewAnimationListener } from '@/src/composables/useViewAnimationListener';\nimport CropTool from '@/src/components/tools/crop/CropTool.vue';\nimport CrosshairsTool from '@/src/components/tools/crosshairs/CrosshairsTool.vue';\nimport PaintTool from '@/src/components/tools/paint/PaintTool.vue';\nimport PolygonTool from '@/src/components/tools/polygon/PolygonTool.vue';\nimport RulerTool from '@/src/components/tools/ruler/RulerTool.vue';\nimport RectangleTool from '@/src/components/tools/rectangle/RectangleTool.vue';\nimport SelectTool from '@/src/components/tools/SelectTool.vue';\nimport BoundingRectangle from '@/src/components/tools/BoundingRectangle.vue';\nimport SliceSlider from '@/src/components/SliceSlider.vue';\nimport SliceViewerOverlay from '@/src/components/SliceViewerOverlay.vue';\nimport { useToolSelectionStore } from '@/src/store/tools/toolSelection';\nimport { useAnnotationToolStore, useToolStore } from '@/src/store/tools';\nimport { useViewCameraStore } from '@/src/store/view-configs/camera';\nimport { doesToolFrameMatchViewAxis } from '@/src/composables/annotationTool';\nimport { useWebGLWatchdog } from '@/src/composables/useWebGLWatchdog';\nimport { useSliceConfig } from '@/src/composables/useSliceConfig';\nimport VtkSliceViewWindowManipulator from '@/src/components/vtk/VtkSliceViewWindowManipulator.vue';\nimport VtkSliceViewSlicingManipulator from '@/src/components/vtk/VtkSliceViewSlicingManipulator.vue';\nimport VtkMouseInteractionManipulator from '@/src/components/vtk/VtkMouseInteractionManipulator.vue';\nimport vtkMouseCameraTrackballPanManipulator from '@kitware/vtk.js/Interaction/Manipulators/MouseCameraTrackballPanManipulator';\nimport vtkMouseCameraTrackballZoomToMouseManipulator from '@kitware/vtk.js/Interaction/Manipulators/MouseCameraTrackballZoomToMouseManipulator';\nimport { useResetViewsEvents } from '@/src/components/tools/ResetViews.vue';\nimport { whenever } from '@vueuse/core';\n\ninterface Props extends LayoutViewProps {\n  viewDirection: LPSAxisDir;\n  viewUp: LPSAxisDir;\n}\n\nconst vtkView = ref<VtkViewApi>();\n\nconst props = defineProps<Props>();\n\nconst { disableCameraAutoReset } = storeToRefs(useViewCameraStore());\n\nconst { id: viewId, type: viewType, viewDirection, viewUp } = toRefs(props);\nconst viewAxis = computed(() => getLPSAxisFromDir(viewDirection.value));\n\nconst hover = ref(false);\n\nfunction resetCamera() {\n  if (!vtkView.value) return;\n  vtkView.value.resetCamera();\n}\n\nuseResetViewsEvents().onClick(resetCamera);\n\nuseWebGLWatchdog(vtkView);\nuseViewAnimationListener(vtkView, viewId, viewType);\n\n// active tool\nconst { currentTool } = storeToRefs(useToolStore());\nconst windowingManipulatorProps = computed(() =>\n  currentTool.value === Tools.WindowLevel ? { button: 1 } : { button: -1 }\n);\n\n// base image\nconst { currentImageID, currentLayers, currentImageMetadata, isImageLoading } =\n  useCurrentImage();\nconst { slice: currentSlice, range: sliceRange } = useSliceConfig(\n  viewId,\n  currentImageID\n);\n\nwhenever(\n  computed(() => !isImageLoading.value),\n  () => {\n    resetCamera();\n  }\n);\n\n// segmentations\nconst segmentations = computed(() => {\n  if (!currentImageID.value) return [];\n  const store = useSegmentGroupStore();\n  return store.orderByParent[currentImageID.value];\n});\n\n// --- selection points --- //\n\nconst selectionStore = useToolSelectionStore();\nconst selectionPoints = computed(() => {\n  return selectionStore.selection\n    .map((sel) => {\n      const store = useAnnotationToolStore(sel.type);\n      return { store, tool: store.toolByID[sel.id] };\n    })\n    .filter(\n      ({ tool }) =>\n        tool.slice === currentSlice.value &&\n        !tool.hidden &&\n        doesToolFrameMatchViewAxis(viewAxis, tool, currentImageMetadata)\n    )\n    .flatMap(({ store, tool }) => store.getPoints(tool.id));\n});\n</script>\n\n<style scoped src=\"@/src/components/styles/vtk-view.css\"></style>\n<style scoped src=\"@/src/components/styles/utils.css\"></style>\n","import { MaybeRef } from 'vue';\nimport vtkImageData from '@kitware/vtk.js/Common/DataModel/ImageData';\nimport { useVtkRepresentation } from '@/src/core/vtk/useVtkRepresentation';\nimport { Maybe } from '@/src/types';\nimport { View } from '@/src/core/vtk/types';\nimport vtkVolume from '@kitware/vtk.js/Rendering/Core/Volume';\nimport vtkVolumeMapper from '@kitware/vtk.js/Rendering/Core/VolumeMapper';\n\nexport function useVolumeRepresentation(\n  view: View,\n  imageData: MaybeRef<Maybe<vtkImageData>>\n) {\n  const volRep = useVtkRepresentation({\n    view,\n    data: imageData,\n    vtkActorClass: vtkVolume,\n    vtkMapperClass: vtkVolumeMapper,\n  });\n\n  return volRep;\n}\n","import { useImage } from '@/src/composables/useCurrentImage';\nimport useVolumeColoringStore from '@/src/store/view-configs/volume-coloring';\nimport { Maybe } from '@/src/types';\nimport { watchImmediate } from '@vueuse/core';\nimport { MaybeRef, computed, unref } from 'vue';\n\nexport function useVolumeColoringInitializer(\n  viewId: MaybeRef<string>,\n  imageId: MaybeRef<Maybe<string>>\n) {\n  const store = useVolumeColoringStore();\n  const coloringConfig = computed(() =>\n    store.getConfig(unref(viewId), unref(imageId))\n  );\n\n  const { imageData, isLoading } = useImage(imageId);\n\n  watchImmediate([coloringConfig, viewId, imageId, isLoading], () => {\n    if (coloringConfig.value || isLoading.value) return;\n\n    const viewIdVal = unref(viewId);\n    const imageIdVal = unref(imageId);\n    if (!imageIdVal || !imageData.value) return;\n\n    store.resetToDefaultColoring(viewIdVal, imageIdVal, imageData.value);\n  });\n}\n","import { ref } from 'vue';\nimport { onVTKEvent } from '@/src/composables/onVTKEvent';\nimport { View } from '@/src/core/vtk/types';\n\nexport function isViewAnimating(view: View) {\n  const isAnimating = ref(false);\n\n  onVTKEvent(view.interactor, 'onStartAnimation', () => {\n    isAnimating.value = true;\n  });\n  onVTKEvent(view.interactor, 'onEndAnimation', () => {\n    isAnimating.value = false;\n  });\n\n  return isAnimating;\n}\n","import {\n  DEFAULT_AMBIENT,\n  DEFAULT_DIFFUSE,\n  DEFAULT_SPECULAR,\n} from '@/src/store/view-configs/volume-coloring';\nimport vtkDataArray from '@kitware/vtk.js/Common/Core/DataArray';\nimport { getDiagonalLength } from '@kitware/vtk.js/Common/DataModel/BoundingBox';\nimport vtkImageData from '@kitware/vtk.js/Common/DataModel/ImageData';\nimport vtkRenderer from '@kitware/vtk.js/Rendering/Core/Renderer';\nimport vtkVolumeMapper from '@kitware/vtk.js/Rendering/Core/VolumeMapper';\nimport vtkVolumeProperty from '@kitware/vtk.js/Rendering/Core/VolumeProperty';\nimport { Vector3 } from '@kitware/vtk.js/types';\nimport { vec3 } from 'gl-matrix';\n\n/**\n * Sets the volume sampling distance.\n * @param mapper\n * @param distance A value betweeen 0 and 1.\n * @param imageData\n */\nexport function setSamplingDistance(\n  mapper: vtkVolumeMapper,\n  distance: number,\n  imageData: vtkImageData\n) {\n  const sampleDistance =\n    0.7 *\n    Math.sqrt(\n      imageData\n        .getSpacing()\n        .map((v) => v * v)\n        .reduce((a, b) => a + b, 0)\n    );\n  mapper.setSampleDistance(sampleDistance * 2 ** (distance * 3.0 - 1.5));\n}\n\n/**\n * Sets the edge gradient.\n * @param property\n * @param edgeGradient A value between 0 and 1.\n * @param dataArray\n */\nexport function setEdgeGradient(\n  property: vtkVolumeProperty,\n  edgeGradient: number,\n  dataArray: vtkDataArray\n) {\n  const numberOfComponents = dataArray.getNumberOfComponents();\n  for (let component = 0; component < numberOfComponents; component++) {\n    if (edgeGradient === 0) {\n      property.setUseGradientOpacity(component, false);\n      // eslint-disable-next-line no-continue\n      continue;\n    }\n\n    property.setUseGradientOpacity(component, true);\n\n    const range = dataArray.getRange(component);\n    const width = range[1] - range[0];\n    const minV = Math.max(0.0, edgeGradient - 0.3) / 0.7;\n    const minGradOpacity =\n      minV > 0 ? Math.exp(Math.log(width * 0.2) * minV ** 2) : 0;\n    const maxGradOpacity = Math.exp(Math.log(width * edgeGradient ** 2));\n\n    property.setGradientOpacityMinimumValue(component, minGradOpacity);\n    property.setGradientOpacityMaximumValue(component, maxGradOpacity);\n  }\n}\n\nexport interface SetCinematicLightingParameters {\n  renderer: vtkRenderer;\n  enabled: boolean;\n  center: Vector3;\n  lightFollowsCamera: boolean;\n}\n\nexport function setCinematicLighting({\n  renderer,\n  enabled,\n  center,\n  lightFollowsCamera,\n}: SetCinematicLightingParameters) {\n  if (renderer.getLights().length === 0) {\n    renderer.createLight();\n  }\n  const light = renderer.getLights()[0];\n  if (enabled) {\n    light.setFocalPoint(...center);\n    light.setColor(1, 1, 1);\n    light.setIntensity(1);\n    light.setConeAngle(90);\n    light.setPositional(true);\n    renderer.setTwoSidedLighting(false);\n    if (lightFollowsCamera) {\n      light.setLightTypeToHeadLight();\n      renderer.updateLightsGeometryToFollowCamera();\n    } else {\n      light.setLightTypeToSceneLight();\n    }\n  } else {\n    light.setPositional(false);\n  }\n}\n\nexport interface SetCinematicVolumeSamplingParameters {\n  enabled: boolean;\n  mapper: vtkVolumeMapper;\n  quality: number;\n  isAnimating: boolean;\n  image: vtkImageData;\n}\n\nexport function setCinematicVolumeSampling({\n  enabled,\n  mapper,\n  quality,\n  isAnimating,\n  image,\n}: SetCinematicVolumeSamplingParameters) {\n  if (isAnimating) {\n    mapper.setSampleDistance(0.75);\n    mapper.setMaximumSamplesPerRay(1000);\n    mapper.setGlobalIlluminationReach(0);\n    mapper.setComputeNormalFromOpacity(false);\n  } else {\n    const dims = image.getDimensions();\n    const spacing = image.getSpacing();\n    const spatialDiagonal = vec3.length(\n      vec3.fromValues(\n        dims[0] * spacing[0],\n        dims[1] * spacing[1],\n        dims[2] * spacing[2]\n      )\n    );\n\n    // Use the average spacing for sampling by default\n    let sampleDistance = spacing.reduce((a, b) => a + b) / 3.0;\n    // Adjust the volume sampling by the quality slider value\n    sampleDistance /= quality > 1 ? 0.5 * quality ** 2 : 1.0;\n    const samplesPerRay = spatialDiagonal / sampleDistance + 1;\n    mapper.setMaximumSamplesPerRay(samplesPerRay);\n    mapper.setSampleDistance(sampleDistance);\n    // Adjust the global illumination reach by volume quality slider\n    mapper.setGlobalIlluminationReach(enabled ? 0.25 * quality : 0);\n    mapper.setComputeNormalFromOpacity(!enabled && quality > 2);\n  }\n}\n\nexport interface SetCinematicVolumeShadingParameters {\n  enabled: boolean;\n  image: vtkImageData;\n  property: vtkVolumeProperty;\n  ambient: number;\n  diffuse: number;\n  specular: number;\n  component?: number;\n}\n\nexport function setCinematicVolumeShading({\n  enabled,\n  image,\n  property,\n  ambient,\n  diffuse,\n  specular,\n  component = 0,\n}: SetCinematicVolumeShadingParameters) {\n  property.setScalarOpacityUnitDistance(\n    0,\n    (0.5 * getDiagonalLength(image.getBounds())) /\n      Math.max(...image.getDimensions())\n  );\n\n  property.setShade(true);\n  property.setUseGradientOpacity(component, !enabled);\n  property.setGradientOpacityMinimumValue(component, 0.0);\n  const dataRange = image.getPointData().getScalars().getRange();\n  property.setGradientOpacityMaximumValue(\n    component,\n    (dataRange[1] - dataRange[0]) * 0.01\n  );\n  property.setGradientOpacityMinimumOpacity(component, 0.0);\n  property.setGradientOpacityMaximumOpacity(component, 1.0);\n\n  // do not toggle these parameters when animating\n  property.setAmbient(enabled ? ambient : DEFAULT_AMBIENT);\n  property.setDiffuse(enabled ? diffuse : DEFAULT_DIFFUSE);\n  property.setSpecular(enabled ? specular : DEFAULT_SPECULAR);\n}\n\nexport interface SetCinematicVolumeScatterParameters {\n  enabled: boolean;\n  mapper: vtkVolumeMapper;\n  blending: number;\n}\n\nexport function setCinematicVolumeScatter({\n  enabled,\n  mapper,\n  blending,\n}: SetCinematicVolumeScatterParameters) {\n  (window as any).am = mapper;\n  mapper.setVolumetricScatteringBlending(enabled ? blending : 0);\n}\n\nexport interface SetCinematicLocalAmbientOcclusionParameters {\n  enabled: boolean;\n  mapper: vtkVolumeMapper;\n  kernelSize: number;\n  kernelRadius: number;\n}\n\nexport function setCinematicLocalAmbientOcclusion({\n  enabled,\n  mapper,\n  kernelSize,\n  kernelRadius,\n}: SetCinematicLocalAmbientOcclusionParameters) {\n  if (enabled) {\n    mapper.setLocalAmbientOcclusion(true);\n    mapper.setLAOKernelSize(kernelSize);\n    mapper.setLAOKernelRadius(kernelRadius);\n  } else {\n    mapper.setLocalAmbientOcclusion(false);\n    mapper.setLAOKernelSize(0);\n    mapper.setLAOKernelRadius(0);\n  }\n}\n","import { croppingPlanesEqual } from '@/src/store/tools/crop';\nimport { Maybe } from '@/src/types';\nimport vtkPlane from '@kitware/vtk.js/Common/DataModel/Plane';\nimport vtkVolumeMapper from '@kitware/vtk.js/Rendering/Core/VolumeMapper';\nimport { watchImmediate } from '@vueuse/core';\nimport { MaybeRef, toRef } from 'vue';\n\nexport function useCroppingEffect(\n  mapper: vtkVolumeMapper,\n  planes: MaybeRef<Maybe<vtkPlane[]>>\n) {\n  // TODO make sure that the default planes are based off of spatial extent\n  watchImmediate(toRef(planes), (newPlanes, oldPlanes) => {\n    if (!newPlanes) return;\n    if (oldPlanes && croppingPlanesEqual(newPlanes, oldPlanes)) return;\n\n    mapper.removeAllClippingPlanes();\n    newPlanes.forEach((plane) => mapper.addClippingPlane(plane));\n  });\n}\n","<script setup lang=\"ts\">\nimport { toRefs, computed, inject, watchEffect } from 'vue';\nimport { useImage } from '@/src/composables/useCurrentImage';\nimport { useVolumeRepresentation } from '@/src/core/vtk/useVolumeRepresentation';\nimport { Maybe } from '@/src/types';\nimport { VtkViewContext } from '@/src/components/vtk/context';\nimport { useColoringEffect } from '@/src/composables/useColoringEffect';\nimport useVolumeColoringStore, {\n  DEFAULT_AMBIENT,\n  DEFAULT_DIFFUSE,\n  DEFAULT_SPECULAR,\n} from '@/src/store/view-configs/volume-coloring';\nimport vtkColorTransferFunction from '@kitware/vtk.js/Rendering/Core/ColorTransferFunction';\nimport vtkPiecewiseFunction from '@kitware/vtk.js/Common/DataModel/PiecewiseFunction';\nimport { useVolumeColoringInitializer } from '@/src/composables/useVolumeColoringInitializer';\nimport { isViewAnimating } from '@/src/composables/isViewAnimating';\nimport { InterpolationType } from '@kitware/vtk.js/Rendering/Core/VolumeProperty/Constants';\nimport {\n  setCinematicLighting,\n  setCinematicLocalAmbientOcclusion,\n  setCinematicVolumeSampling,\n  setCinematicVolumeScatter,\n  setCinematicVolumeShading,\n} from '@/src/utils/volumeProperties';\nimport vtkBoundingBox from '@kitware/vtk.js/Common/DataModel/BoundingBox';\nimport type { vtkObject } from '@kitware/vtk.js/interfaces';\nimport { onVTKEvent } from '@/src/composables/onVTKEvent';\nimport { useCroppingEffect } from '@/src/composables/useCroppingEffect';\nimport { useCropStore } from '@/src/store/tools/crop';\n\ninterface Props {\n  viewId: string;\n  imageId: Maybe<string>;\n}\n\nconst props = defineProps<Props>();\nconst { viewId: viewID, imageId: imageID } = toRefs(props);\n\nconst view = inject(VtkViewContext);\nif (!view) throw new Error('No VtkView');\n\nconst { imageData, metadata: imageMetadata } = useImage(imageID);\nconst coloringConfig = computed(() =>\n  useVolumeColoringStore().getConfig(viewID.value, imageID.value)\n);\n\n// setup base image\nconst rep = useVolumeRepresentation(view, imageData);\n\nconst cfun = vtkColorTransferFunction.newInstance();\nconst ofun = vtkPiecewiseFunction.newInstance();\nrep.property.setRGBTransferFunction(0, cfun);\nrep.property.setScalarOpacity(0, ofun);\nrep.property.setShade(true);\nrep.property.setInterpolationType(InterpolationType.LINEAR);\nrep.property.setAmbient(DEFAULT_AMBIENT);\nrep.property.setDiffuse(DEFAULT_DIFFUSE);\nrep.property.setSpecular(DEFAULT_SPECULAR);\n\n[cfun, ofun].forEach((obj: vtkObject) => {\n  onVTKEvent(obj, 'onModified', view.requestRender);\n});\n\n// cinematic volume rendering\nconst cvrParams = computed(() => coloringConfig.value?.cvr);\nconst center = computed(() =>\n  vtkBoundingBox.getCenter(imageMetadata.value.worldBounds)\n);\nconst isAnimating = isViewAnimating(view);\n\nwatchEffect(() => {\n  const image = imageData.value;\n  if (!cvrParams.value || !image) return;\n\n  const {\n    enabled: cvrEnabled,\n    lightFollowsCamera,\n    ambient,\n    diffuse,\n    specular,\n    volumetricScatteringBlending,\n    volumeQuality,\n    useLocalAmbientOcclusion,\n    useVolumetricScatteringBlending,\n    laoKernelRadius,\n    laoKernelSize,\n  } = cvrParams.value;\n  const { property, mapper } = rep;\n\n  const enabled = cvrEnabled && !isAnimating.value;\n  const dataArray = image.getPointData().getScalars();\n\n  setCinematicLighting({\n    enabled,\n    renderer: view.renderer,\n    lightFollowsCamera,\n    center: center.value,\n  });\n\n  for (let comp = 0; comp < dataArray.getNumberOfComponents(); comp++) {\n    setCinematicVolumeShading({\n      enabled,\n      image,\n      ambient,\n      diffuse,\n      specular,\n      property,\n      component: comp,\n    });\n  }\n\n  setCinematicVolumeScatter({\n    enabled: enabled && useVolumetricScatteringBlending,\n    mapper,\n    blending: volumetricScatteringBlending,\n  });\n\n  setCinematicVolumeSampling({\n    enabled,\n    image,\n    mapper,\n    quality: volumeQuality,\n    isAnimating: isAnimating.value,\n  });\n\n  setCinematicLocalAmbientOcclusion({\n    enabled: enabled && useLocalAmbientOcclusion,\n    kernelRadius: laoKernelRadius,\n    kernelSize: laoKernelSize,\n    mapper,\n  });\n\n  view.requestRender();\n});\n\n// apply coloring\nuseVolumeColoringInitializer(viewID, imageID);\n\nuseColoringEffect(coloringConfig, cfun, ofun);\n\n// cropping\nconst cropStore = useCropStore();\nconst croppingPlanes = cropStore.getComputedVTKPlanes(imageID);\nuseCroppingEffect(rep.mapper, croppingPlanes);\n\ndefineExpose(rep);\n</script>\n\n<template>\n  <slot></slot>\n</template>\n","import { Maybe } from '@/src/types';\nimport vtkOrientationMarkerWidget from '@kitware/vtk.js/Interaction/Widgets/OrientationMarkerWidget';\nimport { Corners } from '@kitware/vtk.js/Interaction/Widgets/OrientationMarkerWidget/Constants';\nimport vtkActor from '@kitware/vtk.js/Rendering/Core/Actor';\nimport vtkRenderWindowInteractor from '@kitware/vtk.js/Rendering/Core/RenderWindowInteractor';\nimport { MaybeRef, computed, onScopeDispose, unref, watchEffect } from 'vue';\n\nexport const DEFAULT_CORNER = Corners.BOTTOM_LEFT;\nexport const DEFAULT_VIEWPORT_SIZE = 0.1;\n\nexport interface UseOrientationMarkerOptions {\n  corner?: Corners;\n  size?: number;\n}\n\nexport function useOrientationMarker(\n  actor: MaybeRef<Maybe<vtkActor>>,\n  interactor: vtkRenderWindowInteractor,\n  options?: MaybeRef<Maybe<UseOrientationMarkerOptions>>\n) {\n  const widget = vtkOrientationMarkerWidget.newInstance({\n    interactor,\n  });\n\n  watchEffect(() => {\n    const actorVal = unref(actor);\n    if (actorVal) {\n      widget.setActor(actorVal);\n      widget.setEnabled(true);\n    } else {\n      widget.setEnabled(false);\n    }\n  });\n\n  onScopeDispose(() => {\n    widget.setEnabled(false);\n  });\n\n  const corner = computed(() => unref(options)?.corner ?? DEFAULT_CORNER);\n  watchEffect(() => {\n    widget.setViewportCorner(corner.value);\n  });\n\n  const viewportSize = computed(\n    () => unref(options)?.size ?? DEFAULT_VIEWPORT_SIZE\n  );\n  watchEffect(() => {\n    widget.setViewportSize(viewportSize.value);\n  });\n\n  return { widget };\n}\n","<script setup lang=\"ts\">\nimport { inject } from 'vue';\nimport { VtkViewContext } from '@/src/components/vtk/context';\nimport { useOrientationMarker } from '@/src/core/vtk/useOrientationMarker';\nimport vtkAnnotatedCubeActor from '@kitware/vtk.js/Rendering/Core/AnnotatedCubeActor';\nimport AnnotatedCubePresets from '@kitware/vtk.js/Rendering/Core/AnnotatedCubeActor/Presets';\n\nconst view = inject(VtkViewContext);\nif (!view) throw new Error('No VtkView');\n\nconst actor = vtkAnnotatedCubeActor.newInstance();\nAnnotatedCubePresets.applyPreset('default', actor); // applies color\nAnnotatedCubePresets.applyPreset('lps', actor);\n\nuseOrientationMarker(actor, view.interactor);\n</script>\n\n<template><slot></slot></template>\n","<template>\n  <div class=\"vtk-container-wrapper volume-viewer-container\" tabindex=\"0\">\n    <div class=\"vtk-container\" data-testid=\"two-view-container\">\n      <div class=\"vtk-sub-container\">\n        <vtk-volume-view\n          class=\"vtk-view\"\n          ref=\"vtkView\"\n          data-testid=\"vtk-view vtk-two-view\"\n          :view-id=\"id\"\n          :image-id=\"currentImageID\"\n          :view-direction=\"viewDirection\"\n          :view-up=\"viewUp\"\n        >\n          <vtk-base-volume-representation\n            :view-id=\"id\"\n            :image-id=\"currentImageID\"\n          ></vtk-base-volume-representation>\n          <vtk-orientation-marker></vtk-orientation-marker>\n          <crop-tool :view-id=\"viewId\" :image-id=\"currentImageID\"></crop-tool>\n          <slot></slot>\n        </vtk-volume-view>\n      </div>\n      <view-overlay-grid class=\"overlay-no-events view-annotations\">\n        <template v-slot:top-left>\n          <div class=\"annotation-cell\">\n            <v-btn\n              class=\"pointer-events-all\"\n              dark\n              icon\n              size=\"medium\"\n              variant=\"text\"\n              @click=\"resetCamera\"\n            >\n              <v-icon size=\"medium\" class=\"py-1\">\n                mdi-camera-flip-outline\n              </v-icon>\n              <v-tooltip\n                location=\"right\"\n                activator=\"parent\"\n                transition=\"slide-x-transition\"\n              >\n                Reset Camera\n              </v-tooltip>\n            </v-btn>\n            <span class=\"ml-3\">{{ presetName }}</span>\n          </div>\n        </template>\n      </view-overlay-grid>\n\n      <transition name=\"loading\">\n        <div v-if=\"isImageLoading\" class=\"overlay-no-events loading\">\n          <div>Loading the image</div>\n          <div>\n            <v-progress-circular indeterminate color=\"blue\" />\n          </div>\n        </div>\n      </transition>\n    </div>\n  </div>\n</template>\n\n<script setup lang=\"ts\">\nimport { ref, toRefs, computed } from 'vue';\nimport { useCurrentImage } from '@/src/composables/useCurrentImage';\nimport { LPSAxisDir } from '@/src/types/lps';\nimport VtkVolumeView from '@/src/components/vtk/VtkVolumeView.vue';\nimport { VtkViewApi } from '@/src/types/vtk-types';\nimport { LayoutViewProps } from '@/src/types';\nimport VtkBaseVolumeRepresentation from '@/src/components/vtk/VtkBaseVolumeRepresentation.vue';\nimport { useViewAnimationListener } from '@/src/composables/useViewAnimationListener';\nimport CropTool from '@/src/components/tools/crop/CropTool.vue';\nimport { useWebGLWatchdog } from '@/src/composables/useWebGLWatchdog';\nimport VtkOrientationMarker from '@/src/components/vtk/VtkOrientationMarker.vue';\nimport ViewOverlayGrid from '@/src/components/ViewOverlayGrid.vue';\nimport useVolumeColoringStore from '@/src/store/view-configs/volume-coloring';\nimport { useResetViewsEvents } from '@/src/components/tools/ResetViews.vue';\nimport { whenever } from '@vueuse/core';\n\ninterface Props extends LayoutViewProps {\n  viewDirection: LPSAxisDir;\n  viewUp: LPSAxisDir;\n}\n\nconst vtkView = ref<VtkViewApi>();\n\nconst props = defineProps<Props>();\n\nconst { id: viewId, type: viewType, viewDirection, viewUp } = toRefs(props);\n\nfunction resetCamera() {\n  if (!vtkView.value) return;\n  vtkView.value.resetCamera();\n  vtkView.value.renderer.updateLightsGeometryToFollowCamera();\n}\n\nuseResetViewsEvents().onClick(resetCamera);\n\nuseWebGLWatchdog(vtkView);\nuseViewAnimationListener(vtkView, viewId, viewType);\n\n// base image\nconst { currentImageID, isImageLoading } = useCurrentImage();\n\nwhenever(\n  computed(() => !isImageLoading.value),\n  () => {\n    resetCamera();\n  }\n);\n\n// color preset\nconst coloringStore = useVolumeColoringStore();\nconst coloringConfig = computed(() =>\n  coloringStore.getConfig(viewId.value, currentImageID.value)\n);\nconst presetName = computed(\n  () => coloringConfig.value?.transferFunction.preset.replace(/-/g, ' ') ?? ''\n);\n</script>\n\n<style scoped src=\"@/src/components/styles/vtk-view.css\"></style>\n<style scoped src=\"@/src/components/styles/utils.css\"></style>\n\n<style scoped>\n.volume-viewer-container {\n  background-color: black;\n  grid-template-columns: auto;\n}\n</style>\n","import { Component } from 'vue';\nimport MultiObliqueSliceViewer from '@/src/components/MultiObliqueSliceViewer.vue';\nimport ObliqueSliceViewer from '@/src/components/ObliqueSliceViewer.vue';\nimport SliceViewer from '@/src/components/SliceViewer.vue';\nimport VolumeViewer from '@/src/components/VolumeViewer.vue';\n\nexport const ViewTypeToComponent: Record<string, Component> = {\n  '2D': SliceViewer,\n  '3D': VolumeViewer,\n  Oblique: ObliqueSliceViewer,\n  Oblique3D: MultiObliqueSliceViewer,\n};\n","<template>\n  <div\n    class=\"layout-container flex-equal\"\n    :class=\"flexFlow\"\n    data-testid=\"layout-grid\"\n  >\n    <div v-for=\"(item, i) in items\" :key=\"i\" class=\"d-flex flex-equal\">\n      <layout-grid v-if=\"item.type === 'layout'\" :layout=\"(item as Layout)\" />\n      <div v-else class=\"layout-item\">\n        <component\n          :is=\"item.component\"\n          :key=\"item.id\"\n          :id=\"item.id\"\n          :type=\"item.viewType\"\n          v-bind=\"item.props\"\n          @focus=\"onFocusView(item.id!, item.viewType!)\"\n        />\n      </div>\n    </div>\n  </div>\n</template>\n\n<script lang=\"ts\">\nimport { computed, defineComponent, PropType, toRefs } from 'vue';\nimport { storeToRefs } from 'pinia';\nimport { ViewTypeToComponent } from '@/src/core/viewTypes';\nimport { Layout, LayoutDirection } from '../types/layout';\nimport { useViewStore } from '../store/views';\n\nexport default defineComponent({\n  name: 'LayoutGrid',\n  methods: {\n    onFocusView(id: string, type: string) {\n      if (type === '2D') {\n        useViewStore().setActiveViewID(id);\n      }\n    },\n  },\n  props: {\n    layout: {\n      type: Object as PropType<Layout>,\n      required: true,\n    },\n  },\n  setup(props) {\n    const { layout } = toRefs(props);\n    const viewStore = useViewStore();\n    const { viewSpecs } = storeToRefs(viewStore);\n\n    const flexFlow = computed(() => {\n      return layout.value.direction === LayoutDirection.H\n        ? 'flex-column'\n        : 'flex-row';\n    });\n\n    const items = computed(() => {\n      const viewIDToSpecs = viewSpecs.value;\n      return layout.value.items.map((item) => {\n        if (typeof item === 'string') {\n          const spec = viewIDToSpecs[item];\n          return {\n            type: 'view',\n            id: item,\n            viewType: spec.viewType,\n            component: ViewTypeToComponent[spec.viewType],\n            props: spec.props,\n          };\n        }\n        return {\n          type: 'layout',\n          ...item,\n        };\n      });\n    });\n\n    return {\n      items,\n      flexFlow,\n    };\n  },\n});\n</script>\n\n<style scoped src=\"@/src/components/styles/utils.css\"></style>\n\n<style scoped>\n.layout-container {\n  display: flex;\n  flex-direction: column;\n}\n\n.layout-item {\n  display: flex;\n  flex: 1;\n  border: 1px solid #222;\n}\n</style>\n","<script setup>\nimport { toRefs, computed } from 'vue';\n\n/**\n * This differs from v-overlay:\n * - smaller API\n * - does not hide unless disabled\n * - requires parent el to have position != static\n * - uses CSS theme vars\n */\n\nconst props = defineProps({\n  disabled: {\n    type: Boolean,\n    default: false,\n  },\n  /**\n   * Must be a vuetify color\n   */\n  color: {\n    type: String,\n    default: '',\n  },\n  opacity: {\n    type: Number,\n    default: 0.2,\n  },\n  zIndex: {\n    type: Number,\n    default: 10,\n  },\n});\n\nconst { disabled, color, opacity, zIndex } = toRefs(props);\n\nconst colorAsStyle = computed(() =>\n  color.value && color.value.startsWith('#') ? color.value : ''\n);\nconst colorAsClass = computed(() =>\n  color.value && !colorAsStyle.value ? `bg-${color.value}` : ''\n);\n\nconst scrimClasses = computed(() => {\n  const classes = {\n    'persistent-overlay-scrim': true,\n    'persistent-overlay-scrim-themed': color.value.length === 0,\n  };\n  if (colorAsClass.value) {\n    classes[colorAsClass.value] = true;\n  }\n  return classes;\n});\n\nconst scrimStyles = computed(() => {\n  const styles = {\n    opacity: opacity.value,\n  };\n  if (colorAsStyle.value) {\n    styles['background-color'] = colorAsStyle.value;\n  }\n  return styles;\n});\n\nconst containerStyles = computed(() => {\n  const styles = {\n    zIndex: zIndex.value,\n  };\n  return styles;\n});\n</script>\n\n<template>\n  <div v-if=\"!disabled\" class=\"persistent-overlay\" :style=\"containerStyles\">\n    <div :class=\"scrimClasses\" :style=\"scrimStyles\" />\n    <slot />\n  </div>\n</template>\n\n<style scoped>\n.persistent-overlay {\n  position: absolute;\n  top: 0;\n  height: 100%;\n  width: 100%;\n}\n\n.persistent-overlay-scrim {\n  position: absolute;\n  top: 0;\n  height: 100%;\n  width: 100%;\n  z-index: -100;\n}\n\n.persistent-overlay-scrim-themed {\n  background-color: rgb(var(--v-theme-background));\n}\n</style>\n","<template>\n  <v-hover v-slot=\"{ isHovering, props }\">\n    <v-card\n      :disabled=\"disabled\"\n      variant=\"outlined\"\n      :ripple=\"!disabled\"\n      :class=\"{\n        'image-list-card-hover': !disabled && isHovering,\n        'image-list-card-active': !disabled && active,\n      }\"\n      v-bind=\"{ ...props, ...$attrs }\"\n    >\n      <v-container :title=\"htmlTitle\">\n        <v-row no-gutters class=\"flex-nowrap\">\n          <v-col v-if=\"selectable\" cols=\"1\" class=\"d-flex align-center\">\n            <v-checkbox\n              @click.stop\n              :key=\"id\"\n              density=\"compact\"\n              :disabled=\"disabled\"\n              :value=\"inputValue\"\n              :model-value=\"modelValue\"\n              @update:model-value=\"$emit('update:model-value', $event)\"\n            />\n          </v-col>\n          <v-col\n            cols=\"4\"\n            class=\"image-container flex-grow-0\"\n            :style=\"{ maxWidth: `${imageSize}px` }\"\n          >\n            <v-img\n              contain\n              :height=\"`${imageSize}px`\"\n              :width=\"`${imageSize}px`\"\n              :src=\"imageUrl\"\n            />\n            <persistent-overlay :disabled=\"!$slots['image-overlay']\">\n              <slot name=\"image-overlay\" />\n            </persistent-overlay>\n          </v-col>\n          <v-col :cols=\"selectable ? 7 : 8\" class=\"ml-2\">\n            <slot></slot>\n          </v-col>\n        </v-row>\n      </v-container>\n    </v-card>\n  </v-hover>\n</template>\n\n<style scoped>\n.image-list-card-active {\n  background-color: rgb(var(--v-theme-selection-bg-color));\n  border-color: rgb(var(--v-theme-selection-border-color));\n}\n\n.image-container {\n  position: relative;\n  margin-left: 8px;\n  margin-right: 8px;\n}\n</style>\n\n<script lang=\"ts\">\nimport { defineComponent } from 'vue';\nimport PersistentOverlay from './PersistentOverlay.vue';\n\nexport default defineComponent({\n  name: 'ImageListCard',\n  props: {\n    active: Boolean,\n    imageSize: {\n      type: Number,\n      default: 80,\n    },\n    imageUrl: {\n      type: String,\n    },\n    selectable: {\n      type: Boolean,\n      default: false,\n    },\n    id: String,\n    modelValue: Array,\n    inputValue: String,\n    disabled: Boolean,\n    htmlTitle: String,\n  },\n  components: { PersistentOverlay },\n});\n</script>\n","<script lang=\"ts\">\nimport { defineComponent, reactive, computed } from 'vue';\nimport ImageListCard from '@/src/components/ImageListCard.vue';\nimport { useDatasetStore } from '@/src/store/datasets';\nimport {\n  convertSuccessResultToDataSelection,\n  importDataSources,\n} from '@/src/io/import/importDataSources';\nimport { remoteFileToDataSource } from '@/src/io/import/dataSource';\nimport useVolumeColoringStore from '@/src/store/view-configs/volume-coloring';\nimport { SAMPLE_DATA } from '../config';\nimport { useMessageStore } from '../store/messages';\nimport { SampleDataset } from '../types';\nimport { useImageStore } from '../store/datasets-images';\nimport { useDICOMStore } from '../store/datasets-dicom';\nimport { fetchFile } from '../utils/fetch';\n\nenum ProgressState {\n  Pending,\n  Error,\n  Done,\n}\n\ninterface Progress {\n  [name: string]: {\n    state: ProgressState;\n    progress: number;\n  };\n}\n\nexport default defineComponent({\n  components: {\n    ImageListCard,\n  },\n  setup() {\n    const datasetStore = useDatasetStore();\n    const status = reactive<{ progress: Progress }>({\n      progress: {},\n    });\n    // URL -> data ID\n    const loaded = reactive<{\n      urlToID: Record<string, string>;\n      idToURL: Record<string, string>;\n    }>({\n      urlToID: {},\n      idToURL: {},\n    });\n\n    const clearLoadedStatus = (id: string) => {\n      const url = loaded.idToURL[id];\n      if (url) {\n        delete loaded.idToURL[id];\n        delete loaded.urlToID[url];\n      }\n    };\n\n    const imageStore = useImageStore();\n    imageStore.$onAction(({ name, args, after }) => {\n      if (name === 'deleteData') {\n        after(() => {\n          const [id] = args;\n          clearLoadedStatus(id as string);\n        });\n      }\n    });\n\n    const dicomStore = useDICOMStore();\n    dicomStore.$onAction(({ name, args, after }) => {\n      if (name === 'deleteVolume') {\n        after(() => {\n          const [key] = args;\n          clearLoadedStatus(key as string);\n        });\n      }\n    });\n\n    async function downloadSample(sample: SampleDataset) {\n      const progress = (percent: number) => {\n        status.progress[sample.name] = {\n          state: ProgressState.Pending,\n          progress: percent * 100,\n        };\n      };\n      try {\n        progress(Infinity);\n\n        const sampleFile = await fetchFile(sample.url, sample.filename, {\n          progress,\n        });\n        status.progress[sample.name].state = ProgressState.Done;\n\n        const [loadResult] = await importDataSources([\n          remoteFileToDataSource(sampleFile, sample.url),\n        ]);\n\n        if (!loadResult) {\n          throw new Error('Did not receive a load result');\n        }\n        if (!loadResult.ok) {\n          throw loadResult.errors[0].cause;\n        }\n\n        const selection = convertSuccessResultToDataSelection(loadResult);\n        if (selection) {\n          loaded.idToURL[selection] = sample.url;\n          loaded.urlToID[sample.url] = selection;\n\n          useVolumeColoringStore().setDefaults(selection, {\n            transferFunction: {\n              preset: sample.defaults?.colorPreset,\n            },\n          });\n        }\n        datasetStore.setPrimarySelection(selection);\n      } catch (error) {\n        status.progress[sample.name].state = ProgressState.Error;\n        const messageStore = useMessageStore();\n        messageStore.addError('Failed to load sample data', error as Error);\n      } finally {\n        delete status.progress[sample.name];\n      }\n    }\n\n    const samples = computed(() =>\n      SAMPLE_DATA.map((sample) => {\n        const isDone =\n          status.progress[sample.name]?.state === ProgressState.Done;\n        const isError =\n          status.progress[sample.name]?.state === ProgressState.Error;\n        const isLoaded = !!loaded.urlToID[sample.url];\n        const progress =\n          isDone || isLoaded\n            ? 100\n            : Math.floor(status.progress[sample.name]?.progress);\n        return {\n          ...sample,\n          isDownloading: sample.name in status.progress,\n          isDone,\n          isError,\n          isLoaded,\n          indeterminate: progress === Infinity,\n          progress,\n        };\n      })\n    );\n\n    return {\n      samples,\n      downloadSample,\n    };\n  },\n});\n</script>\n\n<template>\n  <div data-testid=\"samples-list\">\n    <image-list-card\n      v-for=\"sample in samples\"\n      :disabled=\"sample.isDownloading || sample.isLoaded\"\n      :key=\"sample.name\"\n      :html-title=\"sample.name\"\n      :image-url=\"sample.image\"\n      :image-size=\"100\"\n      class=\"mb-1\"\n      @click=\"downloadSample(sample)\"\n    >\n      <div class=\"text-body-2 font-weight-bold text-no-wrap text-truncate\">\n        {{ sample.name }}\n      </div>\n      <div class=\"text-body-2 mt-2\">{{ sample.description }}</div>\n      <template #image-overlay v-if=\"sample.isDownloading || sample.isLoaded\">\n        <v-row class=\"fill-height ma-0 align-center justify-center\">\n          <v-progress-circular\n            class=\"sample-progress\"\n            color=\"white\"\n            :indeterminate=\"sample.indeterminate && !sample.isDone\"\n            :model-value=\"sample.progress\"\n          >\n            <v-icon v-if=\"sample.isDone || sample.isLoaded\" small color=\"white\">\n              mdi-check\n            </v-icon>\n            <v-icon v-else-if=\"sample.isError\" small color=\"white\">\n              mdi-alert-circle\n            </v-icon>\n            <span\n              v-else-if=\"!sample.indeterminate\"\n              class=\"text-caption text--white\"\n            >\n              {{ sample.progress }}\n            </span>\n          </v-progress-circular>\n        </v-row>\n      </template>\n    </image-list-card>\n  </div>\n</template>\n\n<style>\n/* The transition animation causes the progress bar to load slowly\n   when the value is updated rapidly. */\n.v-progress-circular__overlay {\n  transition: unset;\n}\n</style>\n\n<style scoped>\n.sample-progress {\n  background: rgba(0, 0, 0, 0.75);\n  border-radius: 16px;\n  box-shadow: 0 0 8px 8px rgba(0, 0, 0, 0.75);\n}\n</style>\n","export enum ThumbnailSlice {\n  First,\n  Middle,\n  Last,\n}\n","import vtkImageData from '@kitware/vtk.js/Common/DataModel/ImageData';\nimport type { TypedArray } from '@kitware/vtk.js/types';\nimport { ThumbnailSlice } from '.';\n\nfunction scalarImageToImageData(\n  values: TypedArray,\n  width: number,\n  height: number,\n  scaleMin: number,\n  scaleMax: number\n) {\n  const im = new ImageData(width, height);\n  const arr32 = new Uint32Array(im.data.buffer);\n  // scale to 1 unsigned byte\n  const factor = 255 / (scaleMax - scaleMin);\n  for (let i = 0; i < values.length; i += 1) {\n    const byte = Math.floor((values[i] - scaleMin) * factor);\n    // ABGR order\n    // eslint-disable-next-line no-bitwise\n    arr32[i] = (255 << 24) | (byte << 16) | (byte << 8) | byte;\n  }\n\n  return im;\n}\n\n/**\n * Generates a thumbnail given an image data.\n *\n * Assumption: image is comprised of single-component scalars\n */\nfunction generateThumbnail(\n  imageData: vtkImageData,\n  axis: 0 | 1 | 2 = 2,\n  whichSlice = ThumbnailSlice.Middle\n) {\n  const scalars = imageData.getPointData().getScalars();\n  const data = scalars.getData() as TypedArray;\n  const dataRange = scalars.getRange();\n  const dims = imageData.getDimensions();\n\n  // ThumbnailSlice.First\n  let slice = 0;\n  if (whichSlice === ThumbnailSlice.Middle) {\n    slice = Math.floor(dims[axis] / 2);\n  } else if (whichSlice === ThumbnailSlice.Last) {\n    slice = dims[axis] - 1;\n  }\n\n  let sliceData: TypedArray;\n  let width: number;\n  let height: number;\n\n  if (axis === 0) {\n    // work-around for typing data.constructor.\n    // data is not necessarily of type Uint8Array.\n    sliceData = new (<Uint8ArrayConstructor>data.constructor)(\n      dims[1] * dims[2]\n    );\n    [, width, height] = dims;\n    for (let k = 0; k < dims[2]; k++) {\n      for (let j = 0; j < dims[1]; j++) {\n        const index = slice + j * dims[0] + k * dims[0] * dims[1];\n        const offset = k * dims[1] + j;\n        sliceData[offset] = data[index];\n      }\n    }\n  } else if (axis === 1) {\n    sliceData = new (<Uint8ArrayConstructor>data.constructor)(\n      dims[0] * dims[2]\n    );\n    [width, , height] = dims;\n    for (let k = 0; k < dims[2]; k++) {\n      for (let i = 0; i < dims[0]; i++) {\n        const index = i + slice * dims[0] + k * dims[0] * dims[1];\n        const offset = k * dims[0] + i;\n        sliceData[offset] = data[index];\n      }\n    }\n  } else if (axis === 2) {\n    [width, height] = dims;\n    const skip = dims[0] * dims[1];\n    const sliceOffset = slice * skip;\n    sliceData = Array.isArray(data)\n      ? data.slice(sliceOffset, sliceOffset + skip)\n      : data.subarray(sliceOffset, sliceOffset + skip);\n  }\n\n  return scalarImageToImageData(\n    sliceData!,\n    width!,\n    height!,\n    dataRange[0],\n    dataRange[1]\n  );\n}\n\nexport function createVTKImageThumbnailer() {\n  const canvas = document.createElement('canvas');\n  const ctx = canvas.getContext('2d');\n\n  const resizeCanvas = document.createElement('canvas');\n  const resizeContext = resizeCanvas.getContext('2d');\n\n  if (!ctx || !resizeContext) {\n    throw new Error('[thumbnailer] Failed to create a 2D context');\n  }\n  return {\n    generate(\n      imageData: vtkImageData,\n      axis: 0 | 1 | 2 = 2,\n      whichSlice = ThumbnailSlice.Middle\n    ) {\n      return generateThumbnail(imageData, axis, whichSlice);\n    },\n    imageDataToDataURI(\n      im: ImageData,\n      resizeWidth: number,\n      resizeHeight: number\n    ) {\n      canvas.width = im.width;\n      canvas.height = im.height;\n      ctx.putImageData(im, 0, 0);\n\n      let { width, height } = im;\n      if (im.width > im.height) {\n        width = resizeWidth;\n        height *= resizeWidth / im.width;\n      } else {\n        height = resizeHeight;\n        width *= resizeHeight / im.height;\n      }\n\n      resizeCanvas.width = width;\n      resizeCanvas.height = height;\n      resizeContext.clearRect(0, 0, width, height);\n      resizeContext.scale(width / im.width, height / im.height);\n      resizeContext.drawImage(canvas, 0, 0);\n      // jpegs are smaller than pngs\n      return resizeCanvas.toDataURL('image/jpeg');\n    },\n  };\n}\n","import { computed, ref, Ref, watch } from 'vue';\n\nexport function useMultiSelection<T = string>(allItems: Ref<T[]>) {\n  const selected = ref<T[]>([]) as Ref<T[]>;\n\n  // remove deleted item\n  watch(allItems, () => {\n    selected.value = selected.value.filter((item) =>\n      allItems.value.includes(item)\n    );\n  });\n\n  const selectedSome = computed(() => selected.value.length > 0);\n  const selectedAll = computed(\n    () =>\n      selected.value.length > 0 &&\n      selected.value.length === allItems.value.length\n  );\n\n  const toggleSelectAll = () => {\n    if (selectedAll.value) {\n      selected.value = [];\n    } else {\n      selected.value = allItems.value;\n    }\n  };\n\n  return { selected, selectedAll, selectedSome, toggleSelectAll };\n}\n","<script lang=\"ts\">\nimport { computed, defineComponent, reactive, watch } from 'vue';\nimport ItemGroup from '@/src/components/ItemGroup.vue';\nimport GroupableItem from '@/src/components/GroupableItem.vue';\nimport ImageListCard from '@/src/components/ImageListCard.vue';\nimport { createVTKImageThumbnailer } from '@/src/core/thumbnailers/vtk-image';\nimport { useSegmentGroupStore } from '@/src/store/segmentGroups';\nimport {\n  isRegularImage,\n  type DataSelection,\n  selectionEquals,\n} from '@/src/utils/dataSelection';\nimport { useImageStore } from '../store/datasets-images';\nimport { useDatasetStore } from '../store/datasets';\n\nimport { useMultiSelection } from '../composables/useMultiSelection';\nimport { useLayersStore } from '../store/datasets-layers';\nimport { useViewSliceStore } from '../store/view-configs/slicing';\nimport { useViewCameraStore } from '../store/view-configs/camera';\n\nfunction imageCacheKey(dataID: string) {\n  return `image-${dataID}`;\n}\n\nexport default defineComponent({\n  components: {\n    ItemGroup,\n    GroupableItem,\n    ImageListCard,\n  },\n  setup() {\n    const imageStore = useImageStore();\n    const dataStore = useDatasetStore();\n    const layersStore = useLayersStore();\n    const segmentGroupStore = useSegmentGroupStore();\n    const viewSliceStore = useViewSliceStore();\n    const viewCameraStore = useViewCameraStore();\n\n    const primarySelection = computed(() => dataStore.primarySelection);\n\n    const nonDICOMImages = computed(() =>\n      imageStore.idList.filter((id) => isRegularImage(id))\n    );\n\n    const images = computed(() => {\n      const { metadata } = imageStore;\n\n      const layerImages = layersStore\n        .getLayers(primarySelection.value)\n        .filter(({ selection }) => isRegularImage(selection));\n      const layerImageIDs = layerImages.map(({ selection }) => selection);\n      const loadedLayerImageIDs = layerImages\n        .filter(({ id }) => id in layersStore.layerImages)\n        .map(({ selection }) => selection);\n\n      const selectedImageID =\n        isRegularImage(primarySelection.value) && primarySelection.value;\n\n      return nonDICOMImages.value.map((id) => {\n        const selectionKey = id as DataSelection;\n        const isLayer = layerImageIDs.includes(id);\n        const layerLoaded = loadedLayerImageIDs.includes(id);\n        const layerLoading = isLayer && !layerLoaded;\n        const layerable =\n          id !== selectedImageID && primarySelection.value != null;\n        return {\n          id,\n          cacheKey: imageCacheKey(id),\n          // for UI selection\n          selectionKey,\n          name: metadata[id].name,\n          dimensions: metadata[id].dimensions,\n          spacing: [...metadata[id].spacing].map((s) => s.toFixed(2)),\n          layerable,\n          layerLoading,\n          isLayer,\n          layerHandler: () => {\n            if (!layerLoading && layerable) {\n              if (isLayer)\n                layersStore.deleteLayer(primarySelection.value, selectionKey);\n              else layersStore.addLayer(primarySelection.value, selectionKey);\n            }\n          },\n        };\n      });\n    });\n\n    // --- thumbnails --- //\n\n    type Thumbnail = {\n      imageURI: string;\n      aspectRatio: number;\n    };\n    const thumbnails = reactive<Record<string, Thumbnail>>({});\n    const thumbnailer = createVTKImageThumbnailer();\n\n    watch(\n      nonDICOMImages,\n      (imageIDs) => {\n        imageIDs.forEach(async (id) => {\n          const cacheKey = imageCacheKey(id);\n          if (!(cacheKey in thumbnails)) {\n            const imageData = imageStore.dataIndex[id];\n            const canvasIM = thumbnailer.generate(imageData);\n            const imageURI = thumbnailer.imageDataToDataURI(canvasIM, 100, 100);\n            const dims = imageData.getDimensions();\n            const aspectRatio = dims[0] / dims[1];\n            thumbnails[cacheKey] = { imageURI, aspectRatio };\n          }\n        });\n\n        // delete old thumbnails\n        const idLookup = new Set(imageIDs.map((id) => imageCacheKey(id)));\n        Object.keys(thumbnails).forEach((cacheKey) => {\n          if (!idLookup.has(cacheKey)) {\n            delete thumbnails[cacheKey];\n          }\n        });\n      },\n      { immediate: true, deep: true }\n    );\n\n    // --- sync --- //\n    const sameSpaceImages = computed(() => {\n      return imageStore.checkAllImagesSameSpace();\n    });\n    const isSync = computed(() => {\n      return viewSliceStore.isSync() && viewCameraStore.isSync();\n    });\n    function toggleSyncImages() {\n      viewSliceStore.toggleSyncImages();\n      viewCameraStore.toggleSyncCameras();\n      viewCameraStore.disableCameraAutoReset = isSync.value;\n    }\n    watch(isSync, () => {\n      viewSliceStore.updateSyncConfigs();\n      viewCameraStore.updateSyncConfigs();\n    });\n\n    // --- selection --- //\n\n    const { selected, selectedAll, selectedSome, toggleSelectAll } =\n      useMultiSelection(nonDICOMImages);\n\n    function removeSelection() {\n      selected.value.forEach(dataStore.remove);\n      selected.value = [];\n    }\n\n    function convertToLabelMap(key: string) {\n      if (primarySelection.value) {\n        segmentGroupStore.convertImageToLabelmap(key, primarySelection.value);\n      }\n    }\n\n    function removeData(id: string) {\n      dataStore.remove(id);\n    }\n\n    return {\n      selected,\n      selectedAll,\n      selectedSome,\n      toggleSelectAll,\n      removeSelection,\n      removeData,\n      convertToLabelMap,\n      images,\n      thumbnails,\n      primarySelection,\n      selectionEquals,\n      setPrimarySelection: (sel: DataSelection) => {\n        dataStore.setPrimarySelection(sel);\n      },\n      sameSpaceImages,\n      toggleSyncImages,\n      isSync,\n    };\n  },\n});\n</script>\n\n<template>\n  <div>\n    <div v-if=\"images.length === 0\" class=\"text-center\">No images loaded</div>\n    <v-container v-show=\"images.length\" class=\"pa-0\">\n      <v-row no-gutters justify=\"space-between\" align=\"center\" class=\"mb-1\">\n        <v-col cols=\"6\">\n          <v-checkbox\n            class=\"ml-3\"\n            :indeterminate=\"selectedSome && !selectedAll\"\n            label=\"Select All\"\n            v-model=\"selectedAll\"\n            @click.stop=\"toggleSelectAll\"\n            density=\"compact\"\n            hide-details\n          />\n        </v-col>\n        <v-col cols=\"6\" align-self=\"center\" class=\"d-flex justify-end\">\n          <v-btn\n            icon\n            variant=\"text\"\n            :disabled=\"!sameSpaceImages\"\n            @click.stop=\"toggleSyncImages\"\n          >\n            <v-icon v-if=\"isSync\">mdi-lock</v-icon>\n            <v-icon flip=\"vertical\" v-else>mdi-lock-open-variant</v-icon>\n            <v-tooltip\n              :disabled=\"!sameSpaceImages\"\n              location=\"left\"\n              activator=\"parent\"\n            >\n              Sync Images\n            </v-tooltip>\n          </v-btn>\n          <v-btn\n            icon\n            variant=\"text\"\n            :disabled=\"!selectedSome\"\n            @click.stop=\"removeSelection\"\n          >\n            <v-icon>mdi-delete</v-icon>\n            <v-tooltip\n              :disabled=\"!selectedSome\"\n              location=\"left\"\n              activator=\"parent\"\n            >\n              Delete selected\n            </v-tooltip>\n          </v-btn>\n        </v-col>\n      </v-row>\n    </v-container>\n    <item-group\n      :model-value=\"primarySelection\"\n      :equals-test=\"selectionEquals\"\n      @update:model-value=\"setPrimarySelection\"\n    >\n      <groupable-item\n        v-for=\"image in images\"\n        :key=\"image.id\"\n        v-slot=\"{ active, select }\"\n        :value=\"image.selectionKey\"\n      >\n        <image-list-card\n          v-model=\"selected\"\n          class=\"mt-1 position-relative\"\n          selectable\n          :inputValue=\"image.id\"\n          :active=\"active\"\n          :html-title=\"image.name\"\n          :image-url=\"(thumbnails[image.cacheKey] || {}).imageURI || ''\"\n          :image-size=\"100\"\n          :id=\"image.id\"\n          @click=\"select\"\n        >\n          <div class=\"d-flex flex-row justify-space-between\">\n            <div class=\"allow-trunc-text-flex-child\">\n              <div\n                class=\"text-body-2 font-weight-bold text-no-wrap text-truncate\"\n              >\n                {{ image.name }}\n              </div>\n              <div class=\"text-caption\">\n                Dims: ({{ image.dimensions.join(', ') }})\n              </div>\n              <div class=\"text-caption\">\n                Spacing: ({{ image.spacing.join(', ') }})\n              </div>\n            </div>\n            <v-btn icon variant=\"plain\" size=\"x-small\" class=\"dataset-menu\">\n              <v-menu activator=\"parent\">\n                <v-list>\n                  <v-list-item\n                    v-if=\"image.layerable\"\n                    @click.stop=\"image.layerHandler()\"\n                  >\n                    <template v-if=\"image.layerLoading\">\n                      <div style=\"margin: 0 auto\">\n                        <v-progress-circular indeterminate size=\"small\" />\n                      </div>\n                    </template>\n                    <template v-else>\n                      <span v-if=\"image.isLayer\">Remove as layer</span>\n                      <span v-else>Add as layer</span>\n                    </template>\n                  </v-list-item>\n                  <v-list-item\n                    @click=\"\n                      image.layerable ? convertToLabelMap(image.id) : null\n                    \"\n                  >\n                    <v-icon v-if=\"!image.layerable\" class=\"mr-1\">\n                      mdi-alert\n                    </v-icon>\n                    Convert to Segment Group\n                    <v-tooltip\n                      activator=\"parent\"\n                      location=\"end\"\n                      max-width=\"200px\"\n                      :disabled=\"image.layerable\"\n                    >\n                      Must load a background image before converting\n                    </v-tooltip>\n                  </v-list-item>\n                  <v-list-item @click=\"removeData(image.id)\">\n                    Delete\n                  </v-list-item>\n                </v-list>\n              </v-menu>\n              <v-icon size=\"medium\">mdi-dots-vertical</v-icon>\n            </v-btn>\n          </div>\n        </image-list-card>\n      </groupable-item>\n    </item-group>\n  </div>\n</template>\n\n<style scoped>\n.allow-trunc-text-flex-child {\n  min-width: 0;\n}\n\n.dataset-menu {\n  position: relative;\n  top: -8px;\n  right: -4px;\n}\n</style>\n","<script lang=\"ts\">\nimport { computed, defineComponent, reactive, toRefs, watch } from 'vue';\nimport { Image } from 'itk-wasm';\nimport type { PropType } from 'vue';\nimport GroupableItem from '@/src/components/GroupableItem.vue';\nimport { DataSelection, isDicomImage } from '@/src/utils/dataSelection';\nimport { getDisplayName, useDICOMStore } from '../store/datasets-dicom';\nimport { useDatasetStore } from '../store/datasets';\nimport { useMultiSelection } from '../composables/useMultiSelection';\nimport { useMessageStore } from '../store/messages';\nimport { useLayersStore } from '../store/datasets-layers';\nimport PersistentOverlay from './PersistentOverlay.vue';\n\nconst canvas = document.createElement('canvas');\n\nfunction dicomCacheKey(volKey: string) {\n  return `dicom-${volKey}`;\n}\n\ntype Thumbnail =\n  | { kind: 'image'; value: string }\n  | { kind: 'text'; value: string };\n\n// Assume itkImage type is Uint8Array\nfunction itkImageToURI(itkImage: Image) {\n  const [width, height] = itkImage.size;\n  const im = new ImageData(width, height);\n  const arr32 = new Uint32Array(im.data.buffer);\n  const itkBuf = itkImage.data;\n  if (!itkBuf) {\n    return '';\n  }\n\n  for (let i = 0; i < itkBuf.length; i += 1) {\n    const byte = itkBuf[i] as number;\n    // ABGR order\n    // eslint-disable-next-line no-bitwise\n    arr32[i] = (255 << 24) | (byte << 16) | (byte << 8) | byte;\n  }\n\n  canvas.width = width;\n  canvas.height = height;\n  const ctx = canvas.getContext('2d');\n  if (ctx) {\n    ctx.putImageData(im, 0, 0);\n    return canvas.toDataURL('image/png');\n  }\n  return '';\n}\n\nasync function generateDICOMThumbnail(\n  dicomStore: ReturnType<typeof useDICOMStore>,\n  volumeKey: string\n) {\n  if (volumeKey in dicomStore.volumeInfo) {\n    return (await dicomStore.getVolumeThumbnail(volumeKey)) as Image;\n  }\n  throw new Error('No matching volume key in dicomStore');\n}\n\nexport default defineComponent({\n  name: 'PatientStudyVolumeBrowser',\n  props: {\n    volumeKeys: {\n      type: Array as PropType<Array<string>>,\n      required: true,\n    },\n  },\n  components: {\n    GroupableItem,\n    PersistentOverlay,\n  },\n  setup(props) {\n    const { volumeKeys } = toRefs(props);\n    const dicomStore = useDICOMStore();\n    const datasetStore = useDatasetStore();\n    const layersStore = useLayersStore();\n\n    const primarySelectionRef = computed(() => datasetStore.primarySelection);\n    const volumes = computed(() => {\n      const volumeInfo = dicomStore.volumeInfo;\n      const primarySelection = primarySelectionRef.value;\n      const layerVolumes = layersStore\n        .getLayers(primarySelection)\n        .filter(({ selection }) => isDicomImage(selection));\n      const layerVolumeKeys = layerVolumes.map(({ selection }) => selection);\n      const loadedLayerVolumeKeys = layerVolumes\n        .filter(({ id }) => id in layersStore.layerImages)\n        .map(({ selection }) => selection);\n      const selectedVolumeKey =\n        isDicomImage(primarySelection) && primarySelection;\n\n      return volumeKeys.value.map((volumeKey) => {\n        const selectionKey = volumeKey as DataSelection;\n        const isLayer = layerVolumeKeys.includes(volumeKey);\n        const layerLoaded = loadedLayerVolumeKeys.includes(volumeKey);\n        const layerLoading = isLayer && !layerLoaded;\n        const layerable = volumeKey !== selectedVolumeKey && primarySelection;\n        return {\n          key: volumeKey,\n          // for thumbnailing\n          cacheKey: dicomCacheKey(volumeKey),\n          info: volumeInfo[volumeKey],\n          name: getDisplayName(volumeInfo[volumeKey]),\n          // for UI selection\n          selectionKey,\n          isLayer,\n          layerable,\n          layerLoading,\n          layerHandler: () => {\n            if (!layerLoading && layerable) {\n              if (isLayer)\n                layersStore.deleteLayer(primarySelection, selectionKey);\n              else layersStore.addLayer(primarySelection, selectionKey);\n            }\n          },\n        };\n      });\n    });\n\n    // --- thumbnails --- //\n\n    const thumbnailCache = reactive<Record<string, Thumbnail>>({});\n\n    watch(\n      volumeKeys,\n      (keys) => {\n        keys.forEach(async (key) => {\n          const cacheKey = dicomCacheKey(key);\n          if (cacheKey in thumbnailCache) {\n            return;\n          }\n\n          try {\n            const thumb = await generateDICOMThumbnail(dicomStore, key);\n            if (thumb !== null) {\n              const encodedImage = itkImageToURI(thumb);\n              thumbnailCache[cacheKey] = { kind: 'image', value: encodedImage };\n            } else {\n              thumbnailCache[cacheKey] = {\n                kind: 'text',\n                value: dicomStore.volumeInfo[key].Modality,\n              };\n            }\n          } catch (err) {\n            if (err instanceof Error) {\n              const messageStore = useMessageStore();\n              messageStore.addError('Failed to generate thumbnails', {\n                details: `${err}. More details can be found in the developer's console.`,\n              });\n            }\n            thumbnailCache[cacheKey] = {\n              kind: 'text',\n              value: dicomStore.volumeInfo[key].Modality,\n            };\n          }\n        });\n\n        // deletion case\n        const lookup = new Set(keys.map((key) => dicomCacheKey(key)));\n        Object.keys(thumbnailCache).forEach((key) => {\n          if (!lookup.has(key)) {\n            delete thumbnailCache[key];\n          }\n        });\n      },\n      { immediate: true, deep: true }\n    );\n\n    // --- selection --- //\n\n    const { selected, selectedAll, selectedSome, toggleSelectAll } =\n      useMultiSelection(volumeKeys);\n\n    const removeData = (key: string) => {\n      datasetStore.remove(key);\n    };\n\n    const removeSelectedDICOMVolumes = () => {\n      // make copy of selected as removing selected will change the array\n      [...selected.value].forEach(removeData);\n\n      selected.value = [];\n    };\n\n    return {\n      selected,\n      selectedAll,\n      selectedSome,\n      toggleSelectAll,\n      thumbnailCache,\n      volumes,\n      removeData,\n      removeSelectedDICOMVolumes,\n    };\n  },\n});\n</script>\n\n<template>\n  <v-container class=\"pa-0\">\n    <v-row no-gutters justify=\"space-between\">\n      <v-col cols=\"6\" align-self=\"center\">\n        <v-checkbox\n          class=\"ml-3 align-center justify-center\"\n          :indeterminate=\"selectedSome && !selectedAll\"\n          label=\"Select All\"\n          v-model=\"selectedAll\"\n          @click.stop=\"toggleSelectAll\"\n          density=\"compact\"\n          hide-details\n        />\n      </v-col>\n      <v-col cols=\"6\" align-self=\"center\" class=\"d-flex justify-end mt-2\">\n        <v-btn\n          icon\n          variant=\"text\"\n          :disabled=\"!selectedSome\"\n          @click.stop=\"removeSelectedDICOMVolumes\"\n        >\n          <v-icon>mdi-delete</v-icon>\n          <v-tooltip location=\"left\" activator=\"parent\">\n            Delete selected\n          </v-tooltip>\n        </v-btn>\n      </v-col>\n    </v-row>\n    <v-row no-gutters>\n      <v-col>\n        <div class=\"my-2 volume-list\">\n          <groupable-item\n            v-for=\"volume in volumes\"\n            :key=\"volume.info.VolumeID\"\n            v-slot:default=\"{ active, select }\"\n            :value=\"volume.selectionKey\"\n          >\n            <v-card\n              variant=\"outlined\"\n              ripple\n              :class=\"{\n                'volume-card': true,\n                'mt-1': true,\n                'volume-card-active': active,\n              }\"\n              min-height=\"180px\"\n              min-width=\"180px\"\n              :html-title=\"volume.info.SeriesDescription\"\n              @click=\"select\"\n            >\n              <v-row no-gutters class=\"pa-0\" justify=\"center\">\n                <div class=\"thumbnail-container\">\n                  <v-img\n                    cover\n                    height=\"150\"\n                    width=\"150\"\n                    :src=\"\n                      (thumbnailCache[volume.cacheKey] &&\n                        thumbnailCache[volume.cacheKey].kind === 'image' &&\n                        thumbnailCache[volume.cacheKey].value) ||\n                      ''\n                    \"\n                  >\n                    <template v-slot:placeholder>\n                      <v-row\n                        class=\"fill-height ma-0\"\n                        align=\"center\"\n                        justify=\"center\"\n                      >\n                        <v-progress-circular\n                          v-if=\"thumbnailCache[volume.cacheKey] === undefined\"\n                          indeterminate\n                          color=\"grey-lighten-5\"\n                        />\n                        <span\n                          v-else-if=\"\n                            thumbnailCache[volume.cacheKey] &&\n                            thumbnailCache[volume.cacheKey].kind === 'text'\n                          \"\n                        >\n                          {{ thumbnailCache[volume.cacheKey].value }}\n                        </span>\n                      </v-row>\n                    </template>\n                    <persistent-overlay>\n                      <div class=\"d-flex flex-column fill-height\">\n                        <v-row no-gutters justify=\"end\" align-content=\"start\">\n                          <v-checkbox\n                            :key=\"volume.info.VolumeID\"\n                            :value=\"volume.key\"\n                            v-model=\"selected\"\n                            @click.stop\n                            density=\"compact\"\n                            hide-details\n                            class=\"series-selector\"\n                          />\n                        </v-row>\n                        <v-spacer />\n                        <v-row no-gutters justify=\"start\" align=\"end\">\n                          <div class=\"mb-1 ml-1 text-caption\">\n                            [{{ volume.info.NumberOfSlices }}]\n                          </div>\n                        </v-row>\n                      </div>\n                    </persistent-overlay>\n                  </v-img>\n                </div>\n                <v-btn\n                  icon\n                  variant=\"plain\"\n                  size=\"x-small\"\n                  class=\"dataset-menu\"\n                  @click.stop\n                  data-testid=\"dataset-menu-button\"\n                >\n                  <v-menu activator=\"parent\">\n                    <v-list>\n                      <v-list-item\n                        v-if=\"volume.layerable\"\n                        @click.stop=\"volume.layerHandler()\"\n                        data-testid=\"dataset-menu-layer-item\"\n                      >\n                        <template v-if=\"volume.layerLoading\">\n                          <div style=\"margin: 0 auto\">\n                            <v-progress-circular indeterminate size=\"small\" />\n                          </div>\n                        </template>\n                        <template v-else>\n                          <span v-if=\"volume.isLayer\">Remove as layer</span>\n                          <span v-else>Add as layer</span>\n                        </template>\n                      </v-list-item>\n                      <v-list-item @click=\"removeData(volume.key)\">\n                        Delete\n                      </v-list-item>\n                    </v-list>\n                  </v-menu>\n                  <v-icon size=\"medium\">mdi-dots-vertical</v-icon>\n                </v-btn>\n              </v-row>\n              <v-card-text\n                class=\"text--primary text-caption text-center series-desc mt-n3\"\n              >\n                <div class=\"text-ellipsis\">\n                  {{ volume.name }}\n                </div>\n              </v-card-text>\n            </v-card>\n          </groupable-item>\n        </div>\n      </v-col>\n    </v-row>\n  </v-container>\n</template>\n\n<style scoped>\n.volume-list {\n  display: grid;\n  grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));\n  grid-auto-rows: 200px;\n  justify-content: center;\n}\n\n.volume-card {\n  padding: 8px;\n  cursor: pointer;\n}\n\n.volume-card-active {\n  background-color: rgb(var(--v-theme-selection-bg-color));\n  border-color: rgb(var(--v-theme-selection-border-color));\n}\n\n.series-desc {\n  white-space: nowrap;\n  text-overflow: ellipsis;\n  overflow: hidden;\n}\n\n.series-selector {\n  max-width: 36px;\n}\n\n.thumbnail-container {\n  background-color: rgba(0, 0, 0, 0.1);\n  border-radius: 3px;\n}\n\n.dataset-menu {\n  position: absolute;\n  top: 4px;\n  right: 4px;\n}\n</style>\n","<script lang=\"ts\">\nimport { computed, defineComponent, ref, toRefs, watch } from 'vue';\nimport ItemGroup from '@/src/components/ItemGroup.vue';\nimport { type DataSelection, selectionEquals } from '@/src/utils/dataSelection';\nimport { useDICOMStore } from '../store/datasets-dicom';\nimport { useDatasetStore } from '../store/datasets';\nimport { useMultiSelection } from '../composables/useMultiSelection';\nimport PatientStudyVolumeBrowser from './PatientStudyVolumeBrowser.vue';\n\nexport default defineComponent({\n  name: 'PatientBrowser',\n  props: {\n    patientKey: {\n      type: String,\n      required: true,\n    },\n  },\n  components: {\n    ItemGroup,\n    PatientStudyVolumeBrowser,\n  },\n  setup(props) {\n    const { patientKey } = toRefs(props);\n\n    const dicomStore = useDICOMStore();\n    const dataStore = useDatasetStore();\n\n    const primarySelection = computed(() => dataStore.primarySelection);\n\n    const studies = computed(() => {\n      const selPatient = patientKey.value;\n      const { patientStudies, studyInfo, studyVolumes } = dicomStore;\n      return (patientStudies[selPatient] ?? []).map((studyKey) => {\n        const info = studyInfo[studyKey];\n        return {\n          ...info,\n          key: studyKey,\n          title:\n            info.StudyDescription || info.StudyDate || info.StudyInstanceUID,\n          volumeKeys: studyVolumes[studyKey].sort(),\n        };\n      });\n    });\n\n    const studyKeys = computed(() => studies.value.map((study) => study.key));\n    const panels = ref<string[]>([]);\n\n    watch(\n      studyKeys,\n      (keys) => {\n        panels.value = Array.from(new Set([...panels.value, ...keys]));\n      },\n      { immediate: true }\n    );\n\n    // --- selection --- //\n\n    const { selected, selectedAll, selectedSome, toggleSelectAll } =\n      useMultiSelection(studyKeys);\n\n    const removeSelectedStudies = () => {\n      selected.value\n        .flatMap((study) => dicomStore.studyVolumes[study])\n        .forEach(dataStore.remove);\n      selected.value = [];\n    };\n\n    return {\n      selected,\n      selectedAll,\n      selectedSome,\n      toggleSelectAll,\n      primarySelection,\n      removeSelectedStudies,\n      studies,\n      selectionEquals,\n      setPrimarySelection: (sel: DataSelection) => {\n        dataStore.setPrimarySelection(sel);\n      },\n      panels,\n    };\n  },\n});\n</script>\n\n<template>\n  <item-group\n    :model-value=\"primarySelection\"\n    :equals-test=\"selectionEquals\"\n    @update:model-value=\"setPrimarySelection\"\n  >\n    <v-container class=\"pa-0\">\n      <v-row no-gutters justify=\"space-between\" class=\"mb-2\">\n        <v-col cols=\"6\" align-self=\"center\">\n          <v-checkbox\n            class=\"ml-3 align-center justify-center\"\n            :indeterminate=\"selectedSome && !selectedAll\"\n            label=\"Select All Studies\"\n            v-model=\"selectedAll\"\n            @click.stop=\"toggleSelectAll\"\n            density=\"compact\"\n            hide-details\n          />\n        </v-col>\n        <v-col cols=\"6\" align-self=\"center\" class=\"d-flex justify-end mt-2\">\n          <v-btn\n            icon\n            variant=\"text\"\n            :disabled=\"!selectedSome\"\n            @click.stop=\"removeSelectedStudies\"\n          >\n            <v-icon>mdi-delete</v-icon>\n            <v-tooltip activator=\"parent\" location=\"left\">\n              Delete Selected\n            </v-tooltip>\n          </v-btn>\n        </v-col>\n      </v-row>\n    </v-container>\n    <v-expansion-panels\n      v-model=\"panels\"\n      id=\"patient-data-studies\"\n      accordion\n      multiple\n    >\n      <v-expansion-panel\n        v-for=\"study in studies\"\n        :key=\"study.StudyInstanceUID\"\n        :value=\"study.StudyInstanceUID\"\n        class=\"patient-data-study-panel\"\n      >\n        <v-expansion-panel-title\n          color=\"#1976fa0a\"\n          class=\"pl-3 no-select\"\n          :title=\"study.StudyDate\"\n        >\n          <div class=\"study-header\">\n            <div class=\"study-header-title\">\n              <v-checkbox\n                class=\"study-selector\"\n                density=\"compact\"\n                hide-details\n                :key=\"study.StudyInstanceUID\"\n                :value=\"study.StudyInstanceUID\"\n                v-model=\"selected\"\n                @click.stop\n              />\n              <v-icon>mdi-folder-table</v-icon>\n              <div class=\"ml-2 overflow-hidden text-no-wrap\">\n                <div class=\"text-subtitle-2 text-truncate\" :title=\"study.title\">\n                  {{ study.title }}\n                </div>\n                <div\n                  v-if=\"study.StudyDescription\"\n                  class=\"text-caption text-truncate\"\n                >\n                  {{ study.StudyDate }}\n                </div>\n              </div>\n            </div>\n\n            <div class=\"d-flex flex-column align-center justify-end mx-2\">\n              <div class=\"d-flex flex-row align-center mr-2\">\n                <v-icon small>mdi-folder-open</v-icon>\n                <span class=\"text-caption text--secondary text-no-wrap\">\n                  : {{ study.volumeKeys.length }}\n                </span>\n                <v-tooltip location=\"bottom\" activator=\"parent\">\n                  Total series in study\n                </v-tooltip>\n              </div>\n            </div>\n          </div>\n        </v-expansion-panel-title>\n        <v-expansion-panel-text>\n          <patient-study-volume-browser :volume-keys=\"study.volumeKeys\" />\n        </v-expansion-panel-text>\n      </v-expansion-panel>\n    </v-expansion-panels>\n  </item-group>\n</template>\n\n<style>\n#patient-data-studies .v-expansion-panel::before {\n  box-shadow: none;\n}\n</style>\n\n<style scoped>\n.study-header {\n  display: flex;\n  flex-flow: row;\n  align-items: center;\n  width: calc(100% - 24px);\n}\n\n.study-selector {\n  flex: 0 0 auto;\n}\n\n.study-header-title {\n  display: flex;\n  flex-flow: row;\n  align-items: center;\n  flex-grow: 1;\n  /* used to ensure that the text can truncate */\n  min-width: 0;\n}\n</style>\n","<script lang=\"ts\">\nimport { computed, defineComponent, reactive, ref, toRefs, watch } from 'vue';\nimport type { PropType } from 'vue';\nimport { useDicomMetaStore } from '../../store/dicom-web/dicom-meta-store';\nimport {\n  useDicomWebStore,\n  isDownloadable,\n  VolumeProgress,\n} from '../../store/dicom-web/dicom-web-store';\nimport { formatBytes } from '../../utils';\nimport PersistentOverlay from '../PersistentOverlay.vue';\n\nconst percentDone = (progress: VolumeProgress): number => {\n  if (!progress || progress.total === 0) return 0;\n  const { total, loaded } = progress;\n  return Math.round((100 * loaded) / total);\n};\n\nexport default defineComponent({\n  name: 'StudyVolumeDicomWeb',\n  props: {\n    volumeKeys: {\n      type: Array as PropType<Array<string>>,\n      required: true,\n    },\n  },\n  components: { PersistentOverlay },\n  setup(props) {\n    const dicomStore = useDicomMetaStore();\n    const dicomWebStore = useDicomWebStore();\n\n    const { volumeKeys } = toRefs(props);\n\n    // If deep linking for specific series, don't try to show other series initially, so filter.\n    const volumeKeysWithInstanceInfo = computed(() => {\n      const { volumeInstances, instanceInfo } = dicomStore;\n      return volumeKeys.value.filter(\n        (volumeKey) => instanceInfo[volumeInstances[volumeKey][0]]\n      );\n    });\n\n    const isFetching = ref(true);\n    dicomWebStore.fetchVolumesMeta(volumeKeys.value).then(() => {\n      isFetching.value = false;\n    });\n\n    const volumes = computed(() => {\n      if (isFetching.value) return [];\n\n      const { volumeInfo, volumeInstances, instanceInfo } = dicomStore;\n      return volumeKeysWithInstanceInfo.value.map((volumeKey) => {\n        const { Rows: rows, Columns: columns } =\n          instanceInfo[volumeInstances[volumeKey][0]];\n        const info = volumeInfo[volumeKey];\n        return {\n          key: volumeKey,\n          info,\n          widthHeightFrames: `${columns} x ${rows} x ${info.NumberOfSlices}`,\n          isDisabled: !isDownloadable(dicomWebStore.volumes[volumeKey]),\n          progress: {\n            ...dicomWebStore.volumes[volumeKey],\n            percent: percentDone(dicomWebStore.volumes[volumeKey]),\n          },\n        };\n      });\n    });\n\n    const thumbnailCache = reactive<Record<string, string>>({});\n\n    watch(\n      [volumeKeysWithInstanceInfo, isFetching],\n      ([keys, guard]) => {\n        if (guard) return;\n\n        keys\n          .filter((key) => !(key in thumbnailCache))\n          .forEach(async (key) => {\n            const thumb = await dicomWebStore.fetchVolumeThumbnail(key);\n            if (thumb !== null) {\n              thumbnailCache[key] = thumb;\n            }\n          });\n      },\n      { immediate: true, deep: true }\n    );\n\n    function downloadDicom(volumeKey: string) {\n      dicomWebStore.downloadVolume(volumeKey);\n    }\n\n    return {\n      thumbnailCache,\n      volumes,\n      downloadDicom,\n      formatBytes,\n      isFetching,\n    };\n  },\n});\n</script>\n\n<template>\n  <v-container class=\"pa-0\">\n    <v-row no-gutters>\n      <v-col>\n        <div class=\"my-2 volume-list\">\n          <v-progress-circular v-if=\"isFetching\" class=\"fetching\" indeterminate>\n          </v-progress-circular>\n\n          <v-card\n            v-for=\"volume in volumes\"\n            :key=\"volume.info.VolumeID\"\n            variant=\"outlined\"\n            class=\"volume-card mt-1\"\n            min-height=\"180px\"\n            min-width=\"180px\"\n            :html-title=\"volume.info.SeriesDescription\"\n            :disabled=\"volume.isDisabled\"\n            :ripple=\"!volume.isDisabled\"\n            @click=\"downloadDicom(volume.info.VolumeID)\"\n          >\n            <v-row no-gutters class=\"pa-0\" justify=\"center\">\n              <div class=\"thumbnail-container\">\n                <v-img\n                  cover\n                  height=\"150\"\n                  width=\"150\"\n                  :src=\"(thumbnailCache || {})[volume.key] || ''\"\n                >\n                  <persistent-overlay>\n                    <v-row no-gutters>\n                      <div class=\"mb-1 ml-1 text-caption\">\n                        {{ volume.widthHeightFrames }}\n                        <v-tooltip location=\"top\" activator=\"parent\">\n                          Width by height by frames\n                        </v-tooltip>\n                      </div>\n                    </v-row>\n                  </persistent-overlay>\n\n                  <persistent-overlay\n                    v-if=\"\n                      volume.progress &&\n                      volume.progress.state &&\n                      volume.progress.state !== 'Remote'\n                    \"\n                  >\n                    <div class=\"d-flex flex-column fill-height ma-0\">\n                      <v-row no-gutters justify=\"center\" align=\"end\">\n                        <v-progress-circular\n                          color=\"white\"\n                          :indeterminate=\"\n                            volume.progress.percent === 0 &&\n                            volume.progress.state === 'Pending'\n                          \"\n                          :model-value=\"volume.progress.percent\"\n                        >\n                          <v-icon\n                            v-if=\"volume.progress.state === 'Done'\"\n                            color=\"white\"\n                          >\n                            mdi-check\n                          </v-icon>\n                          <v-icon\n                            v-else-if=\"volume.progress.state === 'Error'\"\n                            color=\"white\"\n                          >\n                            mdi-alert-circle\n                          </v-icon>\n                          <span\n                            v-else-if=\"volume.progress.percent !== 0\"\n                            class=\"text-caption text--white\"\n                          >\n                            {{ volume.progress.percent }}\n                          </span>\n                        </v-progress-circular>\n                      </v-row>\n                      <v-row no-gutters justify=\"center\" align=\"end\">\n                        <div\n                          v-if=\"volume.progress.loaded !== 0\"\n                          class=\"mb-1 text-caption\"\n                        >\n                          {{ formatBytes(volume.progress.loaded) }}\n                        </div>\n                      </v-row>\n                    </div>\n                  </persistent-overlay>\n                </v-img>\n              </div>\n            </v-row>\n            <v-card-text\n              class=\"text--primary text-caption text-center series-desc mt-n3\"\n            >\n              <div class=\"text-ellipsis\">\n                {{ volume.info.SeriesDescription || '(no series description)' }}\n              </div>\n            </v-card-text>\n          </v-card>\n        </div>\n      </v-col>\n    </v-row>\n  </v-container>\n</template>\n\n<style scoped>\n.volume-list {\n  display: grid;\n  grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));\n  grid-auto-rows: 200px;\n  justify-content: center;\n}\n\n.volume-card {\n  padding: 8px;\n  cursor: pointer;\n}\n\n.series-desc {\n  white-space: nowrap;\n  text-overflow: ellipsis;\n  overflow: hidden;\n}\n\n.thumbnail-container {\n  background-color: rgba(0, 0, 0, 0.1);\n  border-radius: 3px;\n}\n\n.fetching {\n  align-self: center;\n  justify-self: center;\n}\n</style>\n","<script lang=\"ts\">\nimport { computed, defineComponent, ref, toRefs, watch } from 'vue';\nimport { useDicomMetaStore } from '../../store/dicom-web/dicom-meta-store';\nimport { useDicomWebStore } from '../../store/dicom-web/dicom-web-store';\nimport StudyVolumeDicomWeb from './StudyVolumeDicomWeb.vue';\n\nexport default defineComponent({\n  name: 'PatientDetails',\n  props: {\n    patientKey: {\n      type: String,\n      required: true,\n    },\n  },\n  components: {\n    StudyVolumeDicomWeb,\n  },\n  setup(props) {\n    const { patientKey } = toRefs(props);\n    const dicomStore = useDicomMetaStore();\n    const dicomWebStore = useDicomWebStore();\n\n    const isFetching = ref(true);\n    dicomWebStore.fetchPatientMeta(patientKey.value).then(() => {\n      isFetching.value = false;\n    });\n\n    const studies = computed(() => {\n      const { patientStudies, studyInfo, studyVolumes } = dicomStore;\n      return patientStudies[patientKey.value].map((studyKey) => {\n        const info = studyInfo[studyKey];\n        return {\n          ...info,\n          key: studyKey,\n          title:\n            info.StudyDescription || info.StudyDate || info.StudyInstanceUID,\n          volumeKeys: studyVolumes[studyKey].sort(),\n        };\n      });\n    });\n\n    const studyKeys = computed(() => studies.value.map(({ key }) => key));\n    const panels = ref<string[]>([]);\n\n    watch(\n      studyKeys,\n      (keys) => {\n        if (dicomWebStore.linkedToStudyOrSeries)\n          panels.value = Array.from(new Set([...panels.value, ...keys]));\n      },\n      { immediate: true }\n    );\n\n    return {\n      studies,\n      isFetching,\n      panels,\n    };\n  },\n});\n</script>\n\n<template>\n  <v-expansion-panels\n    id=\"patient-data-studies\"\n    v-model=\"panels\"\n    accordion\n    multiple\n  >\n    <v-expansion-panel\n      v-for=\"study in studies\"\n      :key=\"study.StudyInstanceUID\"\n      :value=\"study.StudyInstanceUID\"\n      class=\"patient-data-study-panel\"\n    >\n      <v-expansion-panel-title\n        color=\"#1976fa0a\"\n        class=\"pl-3 no-select\"\n        :title=\"study.StudyDate\"\n      >\n        <div class=\"study-header\">\n          <div class=\"study-header-title\">\n            <v-icon class=\"mb-2\">mdi-folder-table</v-icon>\n            <div class=\"ml-2 overflow-hidden text-no-wrap\">\n              <div class=\"text-subtitle-2 text-truncate\" :title=\"study.title\">\n                {{ study.title }}\n              </div>\n              <div\n                v-if=\"study.StudyDescription\"\n                class=\"text-caption text-truncate\"\n              >\n                {{ study.StudyDate }}\n              </div>\n            </div>\n          </div>\n\n          <div class=\"d-flex flex-column align-center justify-end mx-2\">\n            <div class=\"d-flex flex-row align-center mr-2\">\n              <v-progress-circular\n                v-if=\"isFetching\"\n                indeterminate\n                :size=\"20\"\n                :width=\"2\"\n                class=\"mr-2\"\n              >\n              </v-progress-circular>\n              <v-icon size=\"small\">mdi-folder-open</v-icon>\n              <span class=\"text-caption text--secondary text-no-wrap\">\n                : {{ study.volumeKeys.length }}\n              </span>\n              <v-tooltip location=\"bottom\" activator=\"parent\">\n                Total series in study\n              </v-tooltip>\n            </div>\n          </div>\n        </div>\n      </v-expansion-panel-title>\n      <v-expansion-panel-text>\n        <study-volume-dicom-web :volume-keys=\"study.volumeKeys\" />\n      </v-expansion-panel-text>\n    </v-expansion-panel>\n  </v-expansion-panels>\n</template>\n\n<style>\n#patient-data-studies .v-expansion-panel::before {\n  box-shadow: none;\n}\n</style>\n\n<style scoped>\n.study-header {\n  display: flex;\n  flex-flow: row;\n  align-items: center;\n  width: calc(100% - 24px);\n}\n\n.study-header-title {\n  display: flex;\n  flex-flow: row;\n  align-items: center;\n  flex-grow: 1;\n  /* used to ensure that the text can truncate */\n  min-width: 0;\n}\n</style>\n","<script lang=\"ts\">\nimport { computed, defineComponent, ref, watch } from 'vue';\n\nimport { useDicomWebStore } from '@/src/store/dicom-web/dicom-web-store';\nimport { useDicomMetaStore } from '@/src/store/dicom-web/dicom-meta-store';\n\nimport PatientDetails from './PatientDetails.vue';\n\nexport default defineComponent({\n  components: {\n    PatientDetails,\n  },\n  setup() {\n    const dicomWebStore = useDicomWebStore();\n    const dicomWebMeta = useDicomMetaStore();\n    dicomWebStore.fetchDicomsOnce();\n\n    const patients = computed(() =>\n      Object.values(dicomWebMeta.patientInfo)\n        .map((info) => ({\n          key: info.PatientID,\n          name: info.PatientName,\n        }))\n        .sort((a, b) => (a.name < b.name ? -1 : 1))\n    );\n\n    const patientKeys = computed(() => patients.value.map(({ key }) => key));\n    const panels = ref<string[]>([]);\n\n    watch(\n      patientKeys,\n      (keys) => {\n        if (dicomWebStore.linkedToStudyOrSeries)\n          panels.value = Array.from(new Set([...panels.value, ...keys]));\n      },\n      { immediate: true }\n    );\n\n    return {\n      patients,\n      dicomWebStore,\n      panels,\n    };\n  },\n});\n</script>\n\n<template>\n  <p v-if=\"dicomWebStore.message.length > 0\" class=\"error-message\">\n    {{ dicomWebStore.message }}\n  </p>\n\n  <v-expansion-panels\n    v-else-if=\"patients.length > 0\"\n    v-model=\"panels\"\n    multiple\n    accordion\n  >\n    <v-expansion-panel\n      v-for=\"patient in patients\"\n      :key=\"patient.key\"\n      :value=\"patient.key\"\n    >\n      <v-expansion-panel-title>\n        <div class=\"patient-header\">\n          <v-icon class=\"collection-header-icon\">mdi-account</v-icon>\n          <span class=\"patient-header-name\" :title=\"patient.name\">\n            {{ patient.name }}\n          </span>\n        </div>\n      </v-expansion-panel-title>\n      <v-expansion-panel-text>\n        <patient-details :patient-key=\"patient.key\" />\n      </v-expansion-panel-text>\n    </v-expansion-panel>\n  </v-expansion-panels>\n</template>\n\n<style scoped>\n.v-expansion-panel--active:not(:first-child):after {\n  opacity: 100;\n}\n\n.v-expansion-panel--active + .v-expansion-panel::after {\n  opacity: 100;\n}\n\n.error-message {\n  margin-top: 1em;\n  color: red;\n}\n</style>\n","<script lang=\"ts\">\nimport { computed, defineComponent, ref, watch } from 'vue';\nimport { isRegularImage } from '@/src/utils/dataSelection';\nimport SampleDataBrowser from './SampleDataBrowser.vue';\nimport { useDicomWebStore } from '../store/dicom-web/dicom-web-store';\nimport ImageDataBrowser from './ImageDataBrowser.vue';\nimport PatientBrowser from './PatientBrowser.vue';\nimport PatientList from './dicom-web/PatientList.vue';\nimport { useDICOMStore } from '../store/datasets-dicom';\nimport { useImageStore } from '../store/datasets-images';\nimport { useDataBrowserStore } from '../store/data-browser';\nimport { useDatasetStore } from '../store/datasets';\nimport { removeFromArray } from '../utils';\n\nconst SAMPLE_DATA_KEY = 'sampleData';\nconst ANONYMOUS_DATA_KEY = 'anonymousData';\nconst DICOM_WEB_KEY = 'dicomWeb';\n\nexport default defineComponent({\n  name: 'DataBrowser',\n  components: {\n    SampleDataBrowser,\n    ImageDataBrowser,\n    PatientBrowser,\n    PatientList,\n  },\n  setup() {\n    const dicomStore = useDICOMStore();\n    const imageStore = useImageStore();\n    const dicomWeb = useDicomWebStore();\n    const dataBrowserStore = useDataBrowserStore();\n    const datasetStore = useDatasetStore();\n\n    // TODO show patient ID in parens if there is a name conflict\n    const patients = computed(() =>\n      Object.entries(dicomStore.patientInfo)\n        .map(([key, info]) => ({\n          key,\n          name: info.PatientName,\n          info,\n        }))\n        .sort((a, b) => (a.name < b.name ? -1 : 1))\n    );\n\n    const hasAnonymousImages = computed(\n      () => imageStore.idList.filter((id) => isRegularImage(id)).length > 0\n    );\n\n    const panels = ref<string[]>([SAMPLE_DATA_KEY, DICOM_WEB_KEY]);\n\n    watch(\n      [hasAnonymousImages, patients] as const,\n      ([showAnonymous, patients_]) => {\n        const showPatients = patients_.length > 0;\n        if (showAnonymous) {\n          panels.value.push(ANONYMOUS_DATA_KEY);\n        }\n        if (showPatients) {\n          panels.value.push(...patients_.map((patient) => patient.key));\n        }\n        if (showAnonymous || showPatients) {\n          removeFromArray(panels.value, SAMPLE_DATA_KEY);\n        }\n      }\n    );\n\n    const hideSampleData = computed(() => dataBrowserStore.hideSampleData);\n\n    const deletePatient = (key: string) => {\n      dicomStore.patientStudies[key]\n        .flatMap((study) => dicomStore.studyVolumes[study])\n        .forEach(datasetStore.remove);\n    };\n\n    return {\n      panels,\n      patients,\n      deletePatient,\n      hasAnonymousImages,\n      dicomWeb,\n      SAMPLE_DATA_KEY,\n      ANONYMOUS_DATA_KEY,\n      DICOM_WEB_KEY,\n      hideSampleData,\n    };\n  },\n});\n</script>\n\n<template>\n  <div id=\"data-module\" class=\"mx-1 fill-height\">\n    <div id=\"data-panels\">\n      <v-expansion-panels\n        v-model=\"panels\"\n        multiple\n        variant=\"accordion\"\n        class=\"no-panels\"\n      >\n        <v-expansion-panel\n          v-if=\"hasAnonymousImages\"\n          :value=\"ANONYMOUS_DATA_KEY\"\n        >\n          <v-expansion-panel-title>\n            <v-icon class=\"collection-header-icon\">mdi-image</v-icon>\n            <span>Anonymous</span>\n          </v-expansion-panel-title>\n          <v-expansion-panel-text>\n            <image-data-browser />\n          </v-expansion-panel-text>\n        </v-expansion-panel>\n\n        <v-expansion-panel\n          v-for=\"patient in patients\"\n          :key=\"patient.key\"\n          :value=\"patient.key\"\n        >\n          <v-expansion-panel-title>\n            <div class=\"patient-header\">\n              <v-icon class=\"collection-header-icon\">mdi-account</v-icon>\n              <span class=\"patient-header-name\" :title=\"patient.name\">\n                {{ patient.name }}\n              </span>\n              <v-spacer />\n              <v-menu offset-x>\n                <template v-slot:activator=\"{ props }\">\n                  <v-btn\n                    v-bind=\"props\"\n                    variant=\"text\"\n                    icon=\"mdi-dots-vertical\"\n                    size=\"small\"\n                    class=\"mr-3\"\n                    @click.stop\n                  />\n                </template>\n                <v-list density=\"compact\">\n                  <v-list-item @click.stop=\"deletePatient(patient.key)\">\n                    <v-list-item-title>Delete Patient</v-list-item-title>\n                  </v-list-item>\n                </v-list>\n              </v-menu>\n            </div>\n          </v-expansion-panel-title>\n          <v-expansion-panel-text>\n            <patient-browser :patient-key=\"patient.key\" />\n          </v-expansion-panel-text>\n        </v-expansion-panel>\n\n        <v-expansion-panel v-if=\"dicomWeb.isConfigured\" :value=\"DICOM_WEB_KEY\">\n          <v-expansion-panel-title>\n            <v-icon class=\"collection-header-icon\">mdi-cloud-download</v-icon>\n            <span class=\"text-truncate\">\n              {{ `${dicomWeb.hostName || dicomWeb.host} | DICOMWeb` }}\n            </span>\n          </v-expansion-panel-title>\n          <v-expansion-panel-text>\n            <patient-list />\n          </v-expansion-panel-text>\n        </v-expansion-panel>\n\n        <v-expansion-panel v-if=\"!hideSampleData\" :value=\"SAMPLE_DATA_KEY\">\n          <v-expansion-panel-title>\n            <v-icon class=\"collection-header-icon\">mdi-card-bulleted</v-icon>\n            <span>Sample Data</span>\n          </v-expansion-panel-title>\n          <v-expansion-panel-text>\n            <sample-data-browser />\n          </v-expansion-panel-text>\n        </v-expansion-panel>\n      </v-expansion-panels>\n      <div class=\"empty-state ma-4 text-center\">No data loaded</div>\n    </div>\n  </div>\n</template>\n\n<style scoped>\n#data-module {\n  display: flex;\n  flex-flow: column;\n}\n\n#data-panels {\n  flex: 2;\n  overflow-y: auto;\n}\n\n.collection-header-icon {\n  flex: 0;\n  margin-right: 16px;\n}\n\n.patient-header {\n  display: flex;\n  flex-flow: row;\n  align-items: center;\n  width: 100%;\n  /* 24px accomodates the open/close icon indicator */\n  max-width: calc(100% - 24px);\n}\n\n.patient-header-name {\n  overflow: hidden;\n  text-overflow: ellipsis;\n  white-space: nowrap;\n}\n\n.empty-state {\n  display: none;\n}\n\n.no-panels:empty + .empty-state {\n  display: block;\n}\n</style>\n","<script lang=\"ts\">\nimport { computed, defineComponent, ref } from 'vue';\nimport { useVolumeColoringInitializer } from '@/src/composables/useVolumeColoringInitializer';\nimport { useCurrentImage } from '../composables/useCurrentImage';\nimport { CVRConfig } from '../types/views';\nimport useVolumeColoringStore from '../store/view-configs/volume-coloring';\nimport { InitViewIDs } from '../config';\n\nconst TARGET_VIEW_ID = InitViewIDs.Three;\n\nconst LIGHTING_MODELS = {\n  standard: 'Standard',\n  hybrid: 'Hybrid',\n};\n\nexport default defineComponent({\n  name: 'VolumeRendering',\n  setup() {\n    const volumeColoringStore = useVolumeColoringStore();\n\n    const { currentImageID } = useCurrentImage();\n\n    useVolumeColoringInitializer(TARGET_VIEW_ID, currentImageID);\n\n    const volumeColorConfig = computed(() =>\n      volumeColoringStore.getConfig(TARGET_VIEW_ID, currentImageID.value)\n    );\n\n    // --- CVR --- //\n\n    const cvrParams = computed(() => volumeColorConfig.value?.cvr);\n\n    const setCVRParam = (key: keyof CVRConfig, value: any) => {\n      if (!currentImageID.value) return;\n      volumeColoringStore.updateCVRParameters(\n        TARGET_VIEW_ID,\n        currentImageID.value,\n        {\n          [key]: value,\n        }\n      );\n    };\n\n    const laoEnabled = computed(\n      () => !!cvrParams.value?.useLocalAmbientOcclusion\n    );\n    const vsbEnabled = computed(\n      () => !!cvrParams.value?.useVolumetricScatteringBlending\n    );\n\n    type LightingModel = keyof typeof LIGHTING_MODELS;\n    const lightingModel = computed<LightingModel>(() =>\n      cvrParams.value?.useVolumetricScatteringBlending ? 'hybrid' : 'standard'\n    );\n    const selectLightingMode = (model: LightingModel) => {\n      setCVRParam('useVolumetricScatteringBlending', model === 'hybrid');\n    };\n\n    const volumeQualityLabels = {\n      1: 'Good',\n      2: 'Better',\n      3: 'Ultra',\n      4: 'Beta',\n    };\n    const showQualityWarning = ref(false);\n    const disableQualityWarning = ref(false);\n\n    return {\n      LIGHTING_MODELS,\n      cvrParams,\n      disableQualityWarning,\n      laoEnabled,\n      lightingModel,\n      selectLightingMode,\n      setCVRParam,\n      showQualityWarning,\n      volumeQualityLabels,\n      vsbEnabled,\n    };\n  },\n});\n</script>\n\n<template>\n  <div class=\"mx-2\">\n    <div class=\"mt-4\" ref=\"editorContainerRef\">\n      <div ref=\"pwfEditorRef\" />\n    </div>\n    <div v-if=\"!!cvrParams\">\n      <v-slider\n        show-ticks=\"always\"\n        tick-size=\"4\"\n        :ticks=\"volumeQualityLabels\"\n        min=\"1\"\n        max=\"4\"\n        step=\"1\"\n        :model-value=\"cvrParams.volumeQuality\"\n        @update:model-value=\"\n          {\n            showQualityWarning = !disableQualityWarning && $event > 2;\n            setCVRParam('volumeQuality', $event);\n          }\n        \"\n      />\n      <v-alert\n        v-model=\"showQualityWarning\"\n        border=\"top\"\n        variant=\"tonal\"\n        type=\"warning\"\n        color=\"grey\"\n        elevation=\"2\"\n        close-text=\"Close Warning\"\n        transition=\"slide-y-transition\"\n        density=\"compact\"\n        @click=\"showQualityWarning = false\"\n      >\n        <div>\n          <b>Ultra</b> and <b>Beta</b> modes are unstable on some systems.\n        </div>\n        <v-btn\n          size=\"small\"\n          variant=\"tonal\"\n          block\n          class=\"mt-2\"\n          @click=\"\n            disableQualityWarning = true;\n            showQualityWarning = false;\n          \"\n        >\n          Don't Show Again\n        </v-btn>\n      </v-alert>\n      <v-divider class=\"my-8\" />\n      <v-slider\n        label=\"Ambient\"\n        min=\"0\"\n        max=\"1\"\n        step=\"0.1\"\n        density=\"compact\"\n        hide-details\n        thumb-label\n        :model-value=\"cvrParams.ambient\"\n        @update:model-value=\"setCVRParam('ambient', $event)\"\n      />\n      <v-slider\n        label=\"Diffuse\"\n        min=\"0\"\n        max=\"1\"\n        step=\"0.1\"\n        density=\"compact\"\n        hide-details\n        thumb-label\n        :model-value=\"cvrParams.diffuse\"\n        @update:model-value=\"setCVRParam('diffuse', $event)\"\n      />\n      <v-switch\n        label=\"Light follows camera\"\n        density=\"compact\"\n        hide-details\n        :model-value=\"cvrParams.lightFollowsCamera\"\n        @update:model-value=\"setCVRParam('lightFollowsCamera', !!$event)\"\n      />\n      <v-divider class=\"my-8\" />\n\n      <v-switch\n        label=\"Local Ambient Occlusion\"\n        density=\"compact\"\n        hide-details\n        :model-value=\"cvrParams.useLocalAmbientOcclusion\"\n        @update:model-value=\"setCVRParam('useLocalAmbientOcclusion', !!$event)\"\n      />\n\n      <v-row class=\"my-4\">\n        <v-btn-toggle\n          :model-value=\"lightingModel\"\n          @update:model-value=\"selectLightingMode\"\n          mandatory\n          divided\n          variant=\"outlined\"\n          class=\"w-100\"\n        >\n          <v-btn\n            v-for=\"model in Object.keys(LIGHTING_MODELS)\"\n            :key=\"model\"\n            :value=\"model\"\n            class=\"w-50\"\n          >\n            {{ model }}\n          </v-btn>\n        </v-btn-toggle>\n      </v-row>\n\n      <v-spacer class=\"my-2\" />\n\n      <v-slider\n        label=\"Scatter Blending\"\n        min=\"0\"\n        max=\"1\"\n        step=\"0.05\"\n        density=\"compact\"\n        hide-details\n        thumb-label\n        v-if=\"vsbEnabled\"\n        :model-value=\"cvrParams.volumetricScatteringBlending\"\n        @update:model-value=\"\n          setCVRParam('volumetricScatteringBlending', $event)\n        \"\n      />\n    </div>\n  </div>\n</template>\n","import vtkColorMaps from '@kitware/vtk.js/Rendering/Core/ColorTransferFunction/ColorMaps';\nimport MedicalPresets from '@/src/vtk/MedicalColorPresets.json';\n\nfunction registerPresets(presets: typeof MedicalPresets) {\n  for (let i = 0; i < presets.length; i += 1) {\n    vtkColorMaps.addPreset(presets[i]);\n  }\n}\n\nregisterPresets(MedicalPresets);\n\nconst twoHotOpaque = {\n  ...vtkColorMaps.getPresetByName('2hot'),\n  Name: '2hot-opaque',\n  OpacityPoints: [0, 1],\n};\nvtkColorMaps.addPreset(twoHotOpaque);\n\n/* prettier-ignore */\nconst GroupedPresets = [\n  {\n    group: 'CT',\n    presets: [\n      'CT-AAA',\n      'CT-AAA2',\n      'CT-Bone',\n      'CT-Bones',\n      'CT-Cardiac',\n      'CT-Cardiac2',\n      'CT-Cardiac3',\n      'CT-Chest-Contrast-Enhanced',\n      'CT-Chest-Vessels',\n      'CT-Coronary-Arteries',\n      'CT-Coronary-Arteries-2',\n      'CT-Coronary-Arteries-3',\n      'CT-Cropped-Volume-Bone',\n      'CT-Fat',\n      'CT-Liver-Vasculature',\n      'CT-Lung',\n      'CT-MIP',\n      'CT-Muscle',\n      'CT-Pulmonary-Arteries',\n      'CT-Soft-Tissue',\n      'CT-Air',\n      'CT-X-ray',\n    ],\n  },\n  {\n    group: 'MR',\n    presets: [\n      'MR-Default',\n      'MR-Angio',\n      'MR-MIP',\n      'MR-T2-Brain',\n    ],\n  },\n  {\n    group: 'DTI',\n    presets: [\n      'DTI-FA-Brain',\n    ],\n  },\n  {\n    group: 'US',\n    presets: [\n      'US-Fetal',\n    ],\n  },\n];\n\nexport const PresetNameList = GroupedPresets.flatMap((group) => group.presets);\nexport default GroupedPresets;\n","import macro from '@kitware/vtk.js/macro';\nimport vtkPiecewiseGaussianWidget from '@kitware/vtk.js/Interaction/Widgets/PiecewiseGaussianWidget';\n\nexport const Mode = {\n  Gaussians: 1,\n  Points: 2,\n};\n\nexport const ADJUST_POSITION_CURSOR = '-webkit-grab';\n\n/**\n * Samples a piecewise linear function at regular intervals in [0,1].\n * The first and last values are set to zero, since the output\n * is used for vtkPiecewiseGaussianWidget.drawChart().\n *\n * Assumes normalized x/y coordinate points.\n */\n\nexport function samplePiecewiseLinear(\n  points,\n  shift = 0,\n  shiftAlpha = 0,\n  samples = 256\n) {\n  const filledPoints = [...points];\n  // set endpoints to drop to 0\n  filledPoints.push([points[0][0], 0]);\n  filledPoints.push([points[points.length - 1][0], 0]);\n\n  const sampledPoints = [];\n  let pi = 0;\n  let p1 = filledPoints[0]; // left\n  let p2 = filledPoints[1]; // right\n  let slope = (p2[1] - p1[1]) / (p2[0] - p1[0]);\n  for (let i = 0; i < samples; i += 1) {\n    const sx = i / (samples - 1) - shift; // sample x\n    if (i < samples - 1) {\n      while (sx > p2[0] && pi < filledPoints.length - 2) {\n        pi += 1;\n        // extraneous work if this loop goes over more than once,\n        // which only happens if sx > 0 on first iteration (aka shift < 0)\n        p1 = filledPoints[pi];\n        p2 = filledPoints[pi + 1];\n        if (Math.abs(p2[0] - p1[0]) < 1e-8) {\n          slope = Infinity * Math.sign(p2[1] - p1[1]);\n        } else {\n          slope = (p2[1] - p1[1]) / (p2[0] - p1[0]);\n        }\n      }\n      if (slope === Infinity) {\n        sampledPoints.push(1);\n      } else if (slope === -Infinity) {\n        sampledPoints.push(0);\n      } else {\n        // Non-zero values should be affected by shift\n        // but original values of zero should not\n        let value = slope * (sx - p1[0]) + p1[1];\n        value = value && value - shiftAlpha;\n        sampledPoints.push(value);\n      }\n    }\n  }\n  return sampledPoints;\n}\n\n// ----------------------------------------------------------------------------\n// vtkPiecewiseWidget methods\n// ----------------------------------------------------------------------------\n\nfunction vtkPiecewiseWidget(publicAPI, model) {\n  model.classHierarchy.push('vtkPiecewiseWidget');\n\n  const superClass = { ...publicAPI };\n\n  model.pwMode = Mode.Gaussians;\n  model.opacityPoints = [];\n  model.opacityPointShift = 0;\n  model.opacityValueShift = 0;\n\n  publicAPI.setGaussiansMode = () => {\n    model.pwMode = Mode.Gaussians;\n  };\n\n  publicAPI.setPointsMode = () => {\n    // clear gaussians so we don't keep this ref around\n    model.gaussians = [];\n    model.pwMode = Mode.Points;\n  };\n\n  publicAPI.isModeGaussians = () => model.pwMode === Mode.Gaussians;\n  publicAPI.isModePoints = () => model.pwMode === Mode.Points;\n  publicAPI.getMode = () => model.pwMode;\n\n  publicAPI.shiftPosition = (coords, meta) => {\n    if (model.shiftOpacityValues) {\n      model.opacityValueShift =\n        meta.originalOpacityValueShift + coords[1] - meta.originalXY[1];\n    } else {\n      model.opacityPointShift =\n        meta.originalOpacityPointShift + coords[0] - meta.originalXY[0];\n    }\n    return true;\n  };\n\n  publicAPI.onHover = (x, y) => {\n    if (publicAPI.isModeGaussians()) {\n      return superClass.onHover(x, y);\n    }\n    model.canvas.style.cursor = ADJUST_POSITION_CURSOR;\n    return true;\n  };\n\n  publicAPI.onClick = (x, y) => {\n    if (publicAPI.isModeGaussians()) {\n      return superClass.onClick(x, y);\n    }\n    return undefined;\n  };\n\n  publicAPI.onDown = (x, y) => {\n    if (publicAPI.isModeGaussians()) {\n      return superClass.onDown(x, y);\n    }\n\n    if (!model.mouseIsDown) {\n      publicAPI.invokeAnimation(true);\n    }\n\n    const mouseCoords = vtkPiecewiseGaussianWidget.normalizeCoordinates(\n      x,\n      y,\n      model.graphArea\n    );\n\n    model.mouseIsDown = true;\n    model.activeGaussian = -1;\n    model.dragAction = {\n      originalXY: mouseCoords,\n      originalOpacityPointShift: model.opacityPointShift,\n      originalOpacityValueShift: model.opacityValueShift,\n    };\n\n    return true;\n  };\n\n  publicAPI.onDrag = (x, y) => {\n    if (publicAPI.isModeGaussians()) {\n      return superClass.onDrag(x, y);\n    }\n\n    const normCoords = vtkPiecewiseGaussianWidget.normalizeCoordinates(\n      x,\n      y,\n      model.graphArea\n    );\n    if (publicAPI.shiftPosition(normCoords, model.dragAction)) {\n      model.opacities = samplePiecewiseLinear(\n        model.opacityPoints,\n        model.opacityPointShift,\n        model.opacityValueShift\n      );\n      publicAPI.invokeOpacityChange(publicAPI, true);\n    }\n\n    publicAPI.modified();\n    return true;\n  };\n\n  publicAPI.setOpacityPoints = (points, shift = 0, shiftAlpha = 0) => {\n    if (publicAPI.isModePoints()) {\n      // deep copy\n      model.opacityPoints = points.map((p) => [p[0], p[1]]);\n      model.opacityPointShift = shift;\n      model.opacityValueShift = shiftAlpha;\n\n      model.opacities = samplePiecewiseLinear(\n        model.opacityPoints,\n        model.opacityPointShift,\n        model.opacityValueShift\n      );\n      publicAPI.modified();\n    }\n  };\n\n  publicAPI.getEffectiveOpacityPoints = () =>\n    model.opacityPoints.map((p) => [\n      p[0] + model.opacityPointShift,\n      p[1] + model.opacityValueShift,\n    ]);\n\n  publicAPI.render = () => {\n    if (publicAPI.isModePoints()) {\n      model.activeGaussian = -1;\n      model.selectedGaussian = -1;\n    }\n    superClass.render();\n  };\n}\n\n// ----------------------------------------------------------------------------\n// Object factory\n// ----------------------------------------------------------------------------\n\nconst DEFAULT_VALUES = {};\n\n// ----------------------------------------------------------------------------\n\nexport function extend(publicAPI, model, initialValues = {}) {\n  Object.assign(model, DEFAULT_VALUES, initialValues);\n\n  vtkPiecewiseGaussianWidget.extend(publicAPI, model, initialValues);\n\n  macro.setGet(publicAPI, model, [\n    'opacityPoints',\n    'opacityPointShift',\n    'opacityValueShift',\n    'shiftOpacityValues',\n  ]);\n\n  // Object specific methods\n  vtkPiecewiseWidget(publicAPI, model);\n}\n\n// ----------------------------------------------------------------------------\n\nexport const newInstance = macro.newInstance(extend, 'vtkPiecewiseWidget');\n\n// ----------------------------------------------------------------------------\n\nexport default { newInstance, extend };\n","import { onBeforeUnmount, Ref, watch } from 'vue';\n\n/**\n * Invokes a callback whenever an element is resized.\n */\nexport function useResizeObserver(\n  targetElRef: Ref<Element | null | undefined>,\n  callback: (entry: ResizeObserverEntry) => void\n) {\n  const observer = new ResizeObserver((entries) => {\n    if (entries.length === 1) {\n      callback(entries[0]);\n    }\n  });\n\n  watch(\n    targetElRef,\n    (targetEl, prevTarget) => {\n      if (prevTarget) {\n        observer.unobserve(prevTarget);\n      }\n      if (targetEl) {\n        observer.observe(targetEl);\n      }\n    },\n    { immediate: true }\n  );\n\n  onBeforeUnmount(() => {\n    observer.disconnect();\n  });\n\n  return observer;\n}\n","import vtkGenericRenderWindow from '@kitware/vtk.js/Rendering/Misc/GenericRenderWindow';\nimport vtkVolume from '@kitware/vtk.js/Rendering/Core/Volume';\nimport vtkVolumeMapper from '@kitware/vtk.js/Rendering/Core/VolumeMapper';\nimport vtkColorTransferFunction from '@kitware/vtk.js/Rendering/Core/ColorTransferFunction';\nimport vtkPiecewiseFunction from '@kitware/vtk.js/Common/DataModel/PiecewiseFunction';\nimport vtkImageData from '@kitware/vtk.js/Common/DataModel/ImageData';\nimport vtkPiecewiseFunctionProxy from '@kitware/vtk.js/Proxy/Core/PiecewiseFunctionProxy';\nimport vtkLookupTableProxy from '@kitware/vtk.js/Proxy/Core/LookupTableProxy';\nimport { vec3 } from 'gl-matrix';\nimport type { Vector3 } from '@kitware/vtk.js/types';\nimport vtkVolumeProperty from '@kitware/vtk.js/Rendering/Core/VolumeProperty';\nimport { getDiagonalLength } from '@kitware/vtk.js/Common/DataModel/BoundingBox';\n\nexport function createRenderingPipeline() {\n  const actor = vtkVolume.newInstance();\n  const mapper = vtkVolumeMapper.newInstance();\n  const property = actor.getProperty();\n  const cfun = vtkColorTransferFunction.newInstance();\n  const ofun = vtkPiecewiseFunction.newInstance();\n  property.setRGBTransferFunction(0, cfun);\n  property.setScalarOpacity(0, ofun);\n  actor.setMapper(mapper);\n  return {\n    actor,\n    mapper,\n    property,\n    cfun,\n    ofun,\n  };\n}\n\nfunction updateRenderingProperty(\n  prop: vtkVolumeProperty,\n  mapper: vtkVolumeMapper,\n  image: vtkImageData\n) {\n  const scalars = image.getPointData().getScalars();\n  const dataRange = scalars.getRange();\n\n  const sampleDistance =\n    0.7 *\n    Math.sqrt(\n      image\n        .getSpacing()\n        .map((v) => v * v)\n        .reduce((a, b) => a + b, 0)\n    );\n  mapper.setSampleDistance(sampleDistance * 2 ** (0.4 * 3.0 - 1.5));\n\n  prop.setScalarOpacityUnitDistance(\n    0,\n    getDiagonalLength(image.getBounds()) / Math.max(...image.getDimensions())\n  );\n  prop.setGradientOpacityMinimumValue(0, 0);\n  prop.setGradientOpacityMaximumValue(0, (dataRange[1] - dataRange[0]) * 0.05);\n  // - Use shading based on gradient\n  prop.setShade(true);\n  prop.setUseGradientOpacity(0, true);\n  // - generic good default\n  prop.setGradientOpacityMinimumOpacity(0, 0.0);\n  prop.setGradientOpacityMaximumOpacity(0, 1.0);\n  prop.setAmbient(0.2);\n  prop.setDiffuse(0.7);\n  prop.setSpecular(0.3);\n  prop.setSpecularPower(8.0);\n}\n\nexport function createVolumeThumbnailer(size: number) {\n  const container = document.createElement('div');\n  container.style.width = `${size}px`;\n  container.style.height = `${size}px`;\n\n  const scene = vtkGenericRenderWindow.newInstance({\n    listenWindowResize: false,\n    background: [0.2, 0.3, 0.4],\n  });\n  scene.setContainer(container);\n\n  const pipeline = createRenderingPipeline();\n  const { actor, mapper } = pipeline;\n  const renderer = scene.getRenderer();\n\n  // wrap with proxies for easier usage\n  const opacityFuncProxy = vtkPiecewiseFunctionProxy.newInstance({\n    piecewiseFunction: pipeline.ofun,\n  });\n  const colorTransferFuncProxy = vtkLookupTableProxy.newInstance({\n    lookupTable: pipeline.cfun,\n  });\n\n  return {\n    scene,\n    pipeline,\n    opacityFuncProxy,\n    colorTransferFuncProxy,\n    setInputImage(image: vtkImageData | null) {\n      if (image) {\n        mapper.setInputData(image);\n        updateRenderingProperty(actor.getProperty(), mapper, image);\n        if (!renderer.hasViewProp(actor)) {\n          renderer.addVolume(actor);\n        }\n      } else {\n        renderer.removeVolume(actor);\n      }\n    },\n    resetCameraWithOrientation(direction: Vector3, up: Vector3) {\n      const image = mapper.getInputData() as vtkImageData | null;\n      if (image) {\n        const camera = renderer.getActiveCamera();\n        const bounds = image.getBounds();\n        const center = [\n          (bounds[0] + bounds[1]) / 2,\n          (bounds[2] + bounds[3]) / 2,\n          (bounds[4] + bounds[5]) / 2,\n        ] as Vector3;\n\n        const position = vec3.clone(center) as Vector3;\n        vec3.sub(position, position, direction);\n        camera.setFocalPoint(...center);\n        camera.setPosition(...position);\n        camera.setDirectionOfProjection(...direction);\n        camera.setViewUp(...up);\n        renderer.resetCamera();\n        // ensure correct lighting post camera manip\n        renderer.updateLightsGeometryToFollowCamera();\n      }\n    },\n  };\n}\n","import type { Vector3 } from '@kitware/vtk.js/types';\nimport { computed, Ref, unref } from 'vue';\nimport { MaybeRef } from '@vueuse/core';\nimport { mat3 } from 'gl-matrix';\nimport { ImageMetadata } from '@/src/types/image';\nimport { LPSAxisDir } from '@/src/types/lps';\nimport { getLPSDirections } from '@/src/utils/lps';\n\n/**\n *\n * @param {Ref<LPSAxisDir>} viewDirection an LPS view look-direction\n * @param {Ref<LPSAxisDir>} viewUp an LPS view up-direction\n * @param {Ref<ImageMetadata>} imageMetadataRef image metadata\n */\nexport function useCameraOrientation(\n  viewDirection: MaybeRef<LPSAxisDir>,\n  viewUp: MaybeRef<LPSAxisDir>,\n  imageMetadataRef: Ref<ImageMetadata>\n) {\n  const orientationMatrix = computed(\n    () => imageMetadataRef.value.orientation as mat3\n  );\n  const lpsDirections = computed(() =>\n    getLPSDirections(orientationMatrix.value)\n  );\n  const cameraDirVec = computed(\n    () => lpsDirections.value[unref(viewDirection)] as Vector3\n  );\n  const cameraUpVec = computed(\n    () => lpsDirections.value[unref(viewUp)] as Vector3\n  );\n\n  return {\n    cameraDirVec,\n    cameraUpVec,\n  };\n}\n","import { onBeforeUnmount, reactive, ref, watch } from 'vue';\nimport { Mode as LookupTableProxyMode } from '@kitware/vtk.js/Proxy/Core/LookupTableProxy';\nimport vtkImageData from '@kitware/vtk.js/Common/DataModel/ImageData';\nimport vtkPiecewiseFunctionProxy from '@kitware/vtk.js/Proxy/Core/PiecewiseFunctionProxy';\nimport vtkColorMaps from '@kitware/vtk.js/Rendering/Core/ColorTransferFunction/ColorMaps';\nimport type { Vector3 } from '@kitware/vtk.js/types';\nimport { createVolumeThumbnailer } from '../core/thumbnailers/volume-thumbnailer';\nimport { useCameraOrientation } from './useCameraOrientation';\nimport { useImageStore } from '../store/datasets-images';\nimport { InitViewIDs, InitViewSpecs } from '../config';\nimport { useCurrentImage } from './useCurrentImage';\nimport {\n  getColorFunctionRangeFromPreset,\n  getOpacityRangeFromPreset,\n} from '../utils/vtk-helpers';\nimport { PresetNameList } from '../vtk/ColorMaps';\n\nfunction resetOpacityFunction(\n  pwfProxy: vtkPiecewiseFunctionProxy,\n  dataRange: [number, number],\n  presetName: string\n) {\n  // reset pwf proxy range\n  pwfProxy.setDataRange(...dataRange);\n\n  const preset = vtkColorMaps.getPresetByName(presetName);\n  if (preset.OpacityPoints) {\n    const OpacityPoints = preset.OpacityPoints as number[];\n    const points = [];\n    for (let i = 0; i < OpacityPoints.length; i += 2) {\n      points.push([OpacityPoints[i], OpacityPoints[i + 1]]);\n    }\n\n    const [xmin, xmax] = dataRange;\n    const width = xmax - xmin;\n    const pointsNormalized = points.map(([x, y]) => [(x - xmin) / width, y]);\n\n    pwfProxy.setMode(vtkPiecewiseFunctionProxy.Mode.Points);\n    pwfProxy.setPoints(pointsNormalized);\n  } else {\n    pwfProxy.setMode(vtkPiecewiseFunctionProxy.Mode.Gaussians);\n    pwfProxy.setGaussians(vtkPiecewiseFunctionProxy.Defaults.Gaussians);\n  }\n}\n\nexport function useVolumeThumbnailing(thumbnailSize: number) {\n  const thumbnails = reactive<Record<string, Record<string, string>>>({});\n  const thumbnailer = createVolumeThumbnailer(thumbnailSize);\n  const currentThumbnails = ref<Record<string, string>>({});\n\n  const { currentImageMetadata, currentImageID, currentImageData } =\n    useCurrentImage();\n\n  // same as 3D view\n  const { cameraDirVec, cameraUpVec } = useCameraOrientation(\n    InitViewSpecs[InitViewIDs.Three].props.viewDirection,\n    InitViewSpecs[InitViewIDs.Three].props.viewUp,\n    currentImageMetadata\n  );\n\n  // used to interrupt a thumbnailing cycle if\n  // doThumbnailing is called again\n  let interruptSentinel = Symbol('interrupt');\n\n  async function doThumbnailing(imageID: string, image: vtkImageData) {\n    const localSentinel = Symbol('interrupt');\n    interruptSentinel = localSentinel;\n\n    thumbnailer.setInputImage(image);\n    const imageDataRange = image.getPointData().getScalars().getRange();\n\n    async function helper(presetName: string) {\n      // bail if a new thumbnail process has started\n      if (interruptSentinel !== localSentinel) {\n        return;\n      }\n\n      // sanity check; did the current image change\n      if (imageID !== currentImageID.value) {\n        return;\n      }\n\n      if (!(imageID in thumbnails)) {\n        thumbnails[imageID] = {};\n      }\n\n      if (presetName in thumbnails[imageID]) {\n        return;\n      }\n\n      const opRange = getOpacityRangeFromPreset(presetName);\n      resetOpacityFunction(\n        thumbnailer.opacityFuncProxy,\n        opRange || imageDataRange,\n        presetName\n      );\n\n      thumbnailer.colorTransferFuncProxy.setMode(LookupTableProxyMode.Preset);\n      thumbnailer.colorTransferFuncProxy.setPresetName(presetName);\n      const ctRange = getColorFunctionRangeFromPreset(presetName);\n      thumbnailer.colorTransferFuncProxy.setDataRange(\n        ...(ctRange || imageDataRange)\n      );\n\n      thumbnailer.resetCameraWithOrientation(\n        cameraDirVec.value as Vector3,\n        cameraUpVec.value as Vector3\n      );\n\n      const renWin = thumbnailer.scene.getRenderWindow();\n      renWin.render();\n      const imageURL = await renWin.captureImages()[0];\n      if (imageURL) {\n        thumbnails[imageID][presetName] = imageURL;\n      }\n    }\n\n    PresetNameList.reduce(\n      (promise, presetName) => promise.then(() => helper(presetName)),\n      Promise.resolve()\n    );\n  }\n\n  // workaround for computed not properly working on deeply reactive objects\n  // in vue 2.\n  watch(\n    thumbnails,\n    () => {\n      if (currentImageID.value) {\n        currentThumbnails.value = thumbnails[currentImageID.value];\n      }\n    },\n    { deep: true }\n  );\n\n  // force thumbnailing to stop\n  onBeforeUnmount(() => {\n    interruptSentinel = Symbol('unmount');\n  });\n\n  // trigger thumbnailing\n  watch(\n    currentImageID,\n    (imageID) => {\n      if (imageID) {\n        doThumbnailing(imageID, currentImageData.value!);\n      }\n    },\n    { immediate: true }\n  );\n\n  // delete thumbnails if an image is deleted\n  const imageStore = useImageStore();\n  imageStore.$onAction(({ name, args, after }) => {\n    if (name === 'deleteData') {\n      const [id] = args as [string];\n      if (id in thumbnails) {\n        after(() => {\n          delete thumbnails[id];\n        });\n      }\n    }\n  });\n\n  return { currentThumbnails };\n}\n","<script lang=\"ts\">\nimport {\n  computed,\n  defineComponent,\n  onBeforeUnmount,\n  ref,\n  watch,\n  watchEffect,\n} from 'vue';\nimport { onKeyDown, onKeyUp } from '@vueuse/core';\nimport { PresetNameList } from '@/src/vtk/ColorMaps';\nimport vtkPiecewiseWidget from '@/src/vtk/PiecewiseWidget';\nimport type { vtkSubscription } from '@kitware/vtk.js/interfaces';\nimport vtkColorMaps from '@kitware/vtk.js/Rendering/Core/ColorTransferFunction/ColorMaps';\nimport vtkPiecewiseFunctionProxy from '@kitware/vtk.js/Proxy/Core/PiecewiseFunctionProxy';\nimport vtkColorTransferFunction from '@kitware/vtk.js/Rendering/Core/ColorTransferFunction';\nimport { onVTKEvent } from '@/src/composables/onVTKEvent';\nimport useViewAnimationStore from '@/src/store/view-animation';\nimport { useResetViewsEvents } from '@/src/components/tools/ResetViews.vue';\nimport { useVolumeColoringInitializer } from '@/src/composables/useVolumeColoringInitializer';\nimport { useResizeObserver } from '../composables/useResizeObserver';\nimport { useCurrentImage } from '../composables/useCurrentImage';\nimport useVolumeColoringStore from '../store/view-configs/volume-coloring';\nimport {\n  getColorFunctionRangeFromPreset,\n  getShiftedOpacityFromPreset,\n} from '../utils/vtk-helpers';\nimport { useVolumeThumbnailing } from '../composables/useVolumeThumbnailing';\nimport { InitViewIDs } from '../config';\n\nconst WIDGET_WIDTH = 250;\nconst WIDGET_HEIGHT = 150;\nconst THUMBNAIL_SIZE = 80;\nconst TARGET_VIEW_ID = InitViewIDs.Three;\n\nexport default defineComponent({\n  name: 'VolumeRendering',\n  setup() {\n    const volumeColoringStore = useVolumeColoringStore();\n    const editorContainerRef = ref<HTMLElement | null>(null);\n    const pwfEditorRef = ref<HTMLElement | null>(null);\n\n    let recurseGuard = false;\n\n    const { currentImageID, currentImageData } = useCurrentImage();\n\n    useVolumeColoringInitializer(TARGET_VIEW_ID, currentImageID);\n\n    const volumeColorConfig = computed(() =>\n      volumeColoringStore.getConfig(TARGET_VIEW_ID, currentImageID.value)\n    );\n\n    const colorTransferFunctionRef = computed(\n      () => volumeColorConfig.value?.transferFunction\n    );\n    const opacityFunction = computed(\n      () => volumeColorConfig.value?.opacityFunction\n    );\n\n    // --- piecewise color function editor --- //\n\n    const pwfWidget = vtkPiecewiseWidget.newInstance({\n      numberOfBins: 256,\n      size: [WIDGET_WIDTH, WIDGET_HEIGHT],\n    });\n    pwfWidget.updateStyle({\n      backgroundColor: 'rgba(255, 255, 255, 0.6)',\n      histogramColor: 'rgba(100, 100, 100, 0.5)',\n      strokeColor: 'rgb(0, 0, 0)',\n      activeColor: 'rgb(255, 255, 255)',\n      handleColor: 'rgb(50, 150, 50)',\n      buttonDisableFillColor: 'rgba(255, 255, 255, 0.5)',\n      buttonDisableStrokeColor: 'rgba(0, 0, 0, 0.5)',\n      buttonStrokeColor: 'rgba(0, 0, 0, 1)',\n      buttonFillColor: 'rgba(255, 255, 255, 1)',\n      strokeWidth: 2,\n      activeStrokeWidth: 3,\n      buttonStrokeWidth: 1.5,\n      handleWidth: 3,\n      iconSize: 0,\n      padding: 10,\n    });\n\n    const colorTransferFunc = vtkColorTransferFunction.newInstance();\n    pwfWidget.setColorTransferFunction(colorTransferFunc);\n\n    const pwfSubscriptions: vtkSubscription[] = [];\n\n    onBeforeUnmount(() => {\n      while (pwfSubscriptions.length) {\n        pwfSubscriptions.pop()!.unsubscribe();\n      }\n    });\n\n    function updateOpacityFunc() {\n      if (recurseGuard || !currentImageID.value) {\n        return;\n      }\n      recurseGuard = true;\n\n      const { mode } = opacityFunction.value ?? {};\n      if (mode === vtkPiecewiseFunctionProxy.Mode.Gaussians) {\n        volumeColoringStore.updateOpacityFunction(\n          TARGET_VIEW_ID,\n          currentImageID.value,\n          {\n            mode,\n            gaussians: pwfWidget.getGaussians(),\n          }\n        );\n      } else if (mode === vtkPiecewiseFunctionProxy.Mode.Points) {\n        volumeColoringStore.updateOpacityFunction(\n          TARGET_VIEW_ID,\n          currentImageID.value,\n          {\n            mode,\n            shift: pwfWidget.getOpacityPointShift(),\n            shiftAlpha: pwfWidget.getOpacityValueShift(),\n          }\n        );\n      }\n\n      pwfWidget.render();\n\n      recurseGuard = false;\n    }\n\n    onVTKEvent(pwfWidget, 'onOpacityChange', updateOpacityFunc);\n\n    // trigger 3D view animations when updating the opacity widget\n    const viewAnimationStore = useViewAnimationStore();\n    let animationRequested = false;\n\n    const request3DAnimation = () => {\n      if (!animationRequested) {\n        animationRequested = true;\n        viewAnimationStore.requestAnimation(pwfWidget, {\n          byViewType: ['3D'],\n        });\n      }\n    };\n\n    const cancel3DAnimation = () => {\n      animationRequested = false;\n      viewAnimationStore.cancelAnimation(pwfWidget);\n    };\n\n    onVTKEvent(pwfWidget, 'onAnimation', (animating: boolean) => {\n      if (animating) {\n        request3DAnimation();\n      } else {\n        cancel3DAnimation();\n      }\n    });\n\n    // handles edge case where component unmounts while widget is animating\n    onBeforeUnmount(() => {\n      cancel3DAnimation();\n    });\n\n    useResizeObserver(editorContainerRef, (entry) => {\n      const { width } = entry.contentRect;\n      if (width > 0) {\n        pwfWidget.setSize(width, WIDGET_HEIGHT);\n      }\n      pwfWidget.render();\n    });\n\n    // mounted the pwf widget container\n    watchEffect(() => {\n      if (pwfEditorRef.value) {\n        pwfWidget.setContainer(pwfEditorRef.value);\n        pwfWidget.bindMouseListeners();\n      }\n    });\n\n    onBeforeUnmount(() => {\n      pwfWidget.unbindMouseListeners();\n      pwfWidget.setContainer(null);\n    });\n\n    watch(\n      currentImageData,\n      (image) => {\n        if (image) {\n          const scalars = image.getPointData().getScalars();\n          pwfWidget.setDataArray(scalars.getData());\n          pwfWidget.render();\n        }\n      },\n      { immediate: true }\n    );\n\n    // update pwf widget when lut changes\n    watch(\n      colorTransferFunctionRef,\n      (func) => {\n        if (func) {\n          const { preset: name, mappingRange } = func;\n          const preset = vtkColorMaps.getPresetByName(name);\n          colorTransferFunc.applyColorMap(preset);\n          colorTransferFunc.setMappingRange(...mappingRange);\n          // force modification when mapping range is the same\n          colorTransferFunc.modified();\n        }\n      },\n      { immediate: true }\n    );\n\n    onVTKEvent(colorTransferFunc, 'onModified', () => pwfWidget.render());\n\n    // update pwf widget when opacity function changes\n    watch(\n      opacityFunction,\n      (opFunc) => {\n        if (!opFunc) return;\n\n        if (opFunc.mode === vtkPiecewiseFunctionProxy.Mode.Gaussians) {\n          pwfWidget.setGaussiansMode();\n          pwfWidget.setGaussians(opFunc.gaussians);\n        } else if (opFunc.mode === vtkPiecewiseFunctionProxy.Mode.Points) {\n          pwfWidget.setPointsMode();\n          // get non-shifted points for the widget\n          const points = getShiftedOpacityFromPreset(\n            opFunc.preset,\n            opFunc.mappingRange,\n            0,\n            0\n          );\n          pwfWidget.setOpacityPoints(points, opFunc.shift, opFunc.shiftAlpha);\n        }\n      },\n      { immediate: true }\n    );\n\n    // -- thumbnailing -- //\n\n    const { currentThumbnails } = useVolumeThumbnailing(THUMBNAIL_SIZE);\n\n    // --- selection and updates --- //\n\n    const selectedPreset = computed(\n      () => colorTransferFunctionRef.value?.preset || null\n    );\n    const hasCurrentImage = computed(() => !!currentImageData.value);\n\n    // the data range, if any\n    const imageDataRange = computed((): [number, number] => {\n      const image = currentImageData.value;\n      if (image) {\n        return image.getPointData().getScalars().getRange();\n      }\n      return [0, 1];\n    });\n\n    const fullMappingRange = computed(\n      () =>\n        getColorFunctionRangeFromPreset(selectedPreset.value || '') ||\n        imageDataRange.value\n    );\n    const fullMappingRangeWidth = computed(() => {\n      const range = fullMappingRange.value;\n      return range[1] - range[0];\n    });\n\n    const selectPreset = (name: string) => {\n      if (!currentImageID.value) return;\n      volumeColoringStore.setColorPreset(\n        TARGET_VIEW_ID,\n        currentImageID.value,\n        name\n      );\n    };\n\n    // --- mapping range editing --- //\n\n    const rangeShift = ref(0);\n    const rangeWidth = ref(0);\n\n    onKeyDown('Control', () => pwfWidget.setShiftOpacityValues(true));\n    onKeyUp('Control', () => pwfWidget.setShiftOpacityValues(false));\n\n    const reset = () => {\n      rangeShift.value = 0;\n      rangeWidth.value = fullMappingRangeWidth.value;\n    };\n    // reset case\n    watch([selectedPreset, currentImageID], reset, { immediate: true });\n\n    useResetViewsEvents().onClick(reset);\n\n    watch([rangeShift, rangeWidth], ([shift, width]) => {\n      const imageID = currentImageID.value;\n      const config = volumeColoringStore.getConfig(TARGET_VIEW_ID, imageID);\n      // wait for config to be initialized with preset \"all view default\" for particular image\n      if (!imageID || !config) return;\n\n      const fullRange = fullMappingRange.value;\n      const fullWidth = fullMappingRangeWidth.value;\n      const min = fullRange[0] + Math.floor((fullWidth - width) / 2) + shift;\n      const max = fullRange[1] - Math.ceil((fullWidth - width) / 2) + shift;\n\n      volumeColoringStore.updateColorTransferFunction(TARGET_VIEW_ID, imageID, {\n        mappingRange: [min, max],\n      });\n    });\n\n    return {\n      editorContainerRef,\n      pwfEditorRef,\n      thumbnails: currentThumbnails,\n      hasCurrentImage,\n      preset: selectedPreset,\n      fullMappingRange,\n      mappingRange: computed(\n        () => colorTransferFunctionRef.value!.mappingRange\n      ),\n      colorSliderStep: computed(() => {\n        const [low, high] = imageDataRange.value;\n        const width = high - low;\n        const step = Math.min(1, width / 256);\n        return step > 1 ? Math.round(step) : step;\n      }),\n      presetList: PresetNameList,\n      size: THUMBNAIL_SIZE,\n      rangeShiftMin: computed(() => -fullMappingRangeWidth.value / 2),\n      rangeShiftMax: computed(() => fullMappingRangeWidth.value / 2),\n      rangeShift,\n      rangeWidth,\n      rangeWidthMax: computed(() => fullMappingRangeWidth.value * 2),\n      request3DAnimation,\n      cancel3DAnimation,\n      selectPreset,\n    };\n  },\n});\n</script>\n\n<template>\n  <div class=\"overflow-hidden\">\n    <div class=\"mt-4 pwf-editor\" ref=\"editorContainerRef\">\n      <div ref=\"pwfEditorRef\" />\n    </div>\n    <div class=\"mapping-range-editor\">\n      <v-slider\n        v-model=\"rangeShift\"\n        density=\"compact\"\n        hide-details\n        label=\"Shift\"\n        :min=\"rangeShiftMin\"\n        :max=\"rangeShiftMax\"\n        :step=\"colorSliderStep\"\n        @pointerdown=\"request3DAnimation\"\n        @pointerup=\"cancel3DAnimation\"\n      />\n      <v-slider\n        v-model=\"rangeWidth\"\n        density=\"compact\"\n        hide-details\n        label=\"Width\"\n        min=\"1\"\n        :max=\"rangeWidthMax\"\n        :step=\"colorSliderStep\"\n        @pointerdown=\"request3DAnimation\"\n        @pointerup=\"cancel3DAnimation\"\n      />\n    </div>\n  </div>\n</template>\n\n<style scoped>\n.pwf-editor {\n  touch-action: none;\n}\n\n.mapping-range-editor {\n  padding: 8px 16px 8px 4px;\n}\n</style>\n","<script lang=\"ts\">\nimport { computed, defineComponent } from 'vue';\nimport { PresetNameList } from '@/src/vtk/ColorMaps';\nimport vtkColorMaps from '@kitware/vtk.js/Rendering/Core/ColorTransferFunction/ColorMaps';\nimport ItemGroup from '@/src/components/ItemGroup.vue';\nimport GroupableItem from '@/src/components/GroupableItem.vue';\nimport { useVolumeColoringInitializer } from '@/src/composables/useVolumeColoringInitializer';\nimport PersistentOverlay from './PersistentOverlay.vue';\nimport { useCurrentImage } from '../composables/useCurrentImage';\nimport useVolumeColoringStore from '../store/view-configs/volume-coloring';\nimport { getColorFunctionRangeFromPreset } from '../utils/vtk-helpers';\nimport { useVolumeThumbnailing } from '../composables/useVolumeThumbnailing';\nimport { InitViewIDs } from '../config';\n\nconst THUMBNAIL_SIZE = 80;\nconst TARGET_VIEW_ID = InitViewIDs.Three;\n\nexport default defineComponent({\n  name: 'VolumePresets',\n  components: {\n    ItemGroup,\n    GroupableItem,\n    PersistentOverlay,\n  },\n  setup() {\n    const volumeColoringStore = useVolumeColoringStore();\n\n    const { currentImageID, currentImageData } = useCurrentImage();\n\n    useVolumeColoringInitializer(TARGET_VIEW_ID, currentImageID);\n\n    const volumeColorConfig = computed(() =>\n      volumeColoringStore.getConfig(TARGET_VIEW_ID, currentImageID.value)\n    );\n\n    const colorTransferFunctionRef = computed(\n      () => volumeColorConfig.value?.transferFunction\n    );\n\n    const { currentThumbnails } = useVolumeThumbnailing(THUMBNAIL_SIZE);\n\n    // --- selection and updates --- //\n\n    const selectedPreset = computed(\n      () => colorTransferFunctionRef.value?.preset || null\n    );\n    const hasCurrentImage = computed(() => !!currentImageData.value);\n\n    // the data range, if any\n    const imageDataRange = computed((): [number, number] => {\n      const image = currentImageData.value;\n      if (image) {\n        return image.getPointData().getScalars().getRange();\n      }\n      return [0, 1];\n    });\n    const effectiveMappingRange = computed(\n      () =>\n        getColorFunctionRangeFromPreset(selectedPreset.value || '') ||\n        imageDataRange.value\n    );\n\n    const selectPreset = (name: string) => {\n      if (!currentImageID.value) return;\n      volumeColoringStore.setColorPreset(\n        TARGET_VIEW_ID,\n        currentImageID.value,\n        name\n      );\n    };\n\n    const rgbPoints = computed(\n      () =>\n        vtkColorMaps.getPresetByName(colorTransferFunctionRef.value!.preset)\n          ?.RGBPoints\n    );\n\n    const updateColorMappingRange = (range: [number, number]) => {\n      const { mappingRange } = colorTransferFunctionRef.value ?? {};\n      // guard against infinite loops\n      if (\n        currentImageID.value &&\n        mappingRange &&\n        (Math.abs(range[0] - mappingRange[0]) > 1e-6 ||\n          Math.abs(range[1] - mappingRange[1]) > 1e-6)\n      ) {\n        volumeColoringStore.updateColorTransferFunction(\n          TARGET_VIEW_ID,\n          currentImageID.value,\n          {\n            mappingRange: range,\n          }\n        );\n      }\n    };\n\n    return {\n      thumbnails: currentThumbnails,\n      hasCurrentImage,\n      preset: selectedPreset,\n      fullMappingRange: effectiveMappingRange,\n      mappingRange: computed(\n        () => colorTransferFunctionRef.value!.mappingRange\n      ),\n      presetList: PresetNameList,\n      size: THUMBNAIL_SIZE,\n      rgbPoints,\n      selectPreset,\n      updateColorMappingRange,\n    };\n  },\n});\n</script>\n\n<template>\n  <div class=\"overflow-x-visible mx-2\">\n    <item-group :model-value=\"preset\" @update:model-value=\"selectPreset\">\n      <v-row no-gutters justify=\"center\">\n        <groupable-item\n          v-for=\"preset in presetList\"\n          :key=\"preset\"\n          v-slot=\"{ active, select }\"\n          :value=\"preset\"\n        >\n          <v-col\n            cols=\"4\"\n            :class=\"{\n              'thumbnail-container': true,\n              'bg-blue': active,\n            }\"\n            @click=\"select\"\n          >\n            <v-img :src=\"thumbnails[preset] || ''\" cover aspect-ratio=\"1\">\n              <persistent-overlay class=\"thumbnail-overlay\">\n                <div class=\"thumbnail-overlay-text\">\n                  {{ preset.replace(/-/g, ' ') }}\n                </div>\n              </persistent-overlay>\n            </v-img>\n          </v-col>\n        </groupable-item>\n      </v-row>\n    </item-group>\n  </div>\n</template>\n\n<style scoped>\n.thumbnail-container {\n  cursor: pointer;\n  padding: 6px !important;\n}\n\n.thumbnail-overlay {\n  top: 70%;\n  height: 30%;\n  font-size: 0.75em;\n  text-align: center;\n}\n\n.thumbnail-overlay-text {\n  display: flex;\n  flex-flow: row;\n  align-items: center;\n  justify-content: space-around;\n  width: 100%;\n  height: 100%;\n  padding: 2px 4px;\n  color: white;\n}\n</style>\n","<script lang=\"ts\">\nimport { computed, defineComponent, PropType, toRefs } from 'vue';\nimport { InitViewSpecs } from '../config';\nimport { useImageStore } from '../store/datasets-images';\nimport { BlendConfig } from '../types/views';\nimport { Layer } from '../store/datasets-layers';\nimport useLayerColoringStore from '../store/view-configs/layers';\n\nconst VIEWS_2D = Object.entries(InitViewSpecs)\n  .filter(([, { viewType }]) => viewType === '2D')\n  .map(([viewID]) => viewID);\n\nexport default defineComponent({\n  name: 'LayerProperties',\n  props: {\n    layer: {\n      required: true,\n      type: Object as PropType<Layer>,\n    },\n  },\n  setup(props) {\n    const { layer } = toRefs(props);\n    const imageStore = useImageStore();\n\n    const imageName = computed(() => {\n      const { selection } = props.layer;\n      return imageStore.metadata[selection].name;\n    });\n\n    const layerColoringStore = useLayerColoringStore();\n\n    const layerID = computed(() => layer.value.id);\n\n    const layerConfigs = computed(() =>\n      VIEWS_2D.map((viewID) => ({\n        config: layerColoringStore.getConfig(viewID, layerID.value),\n        viewID,\n      }))\n    );\n\n    const blendConfig = computed(\n      () =>\n        // may be undefined if a 2D view has not been mounted\n        layerConfigs.value.find(({ config }) => config)?.config?.blendConfig\n    );\n\n    const setBlendConfig = (key: keyof BlendConfig, value: any) => {\n      if (layerConfigs.value.length === 0) return;\n      layerConfigs.value.forEach(({ viewID }) =>\n        layerColoringStore.updateBlendConfig(viewID, layerID.value, {\n          [key]: value,\n        })\n      );\n    };\n\n    return {\n      imageName,\n      blendConfig,\n      setBlendConfig,\n    };\n  },\n});\n</script>\n\n<template>\n  <div class=\"mx-2\" v-if=\"blendConfig\">\n    <v-tooltip :text=\"imageName\" location=\"top\">\n      <template v-slot:activator=\"{ props }\">\n        <h4 class=\"text-ellipsis\" v-bind=\"props\">{{ imageName }}</h4>\n      </template>\n    </v-tooltip>\n    <!-- padding top so thumb value tip does not overlap image name too much -->\n    <v-slider\n      class=\"pt-4\"\n      label=\"Opacity\"\n      min=\"0\"\n      max=\"1\"\n      step=\"0.01\"\n      density=\"compact\"\n      hide-details\n      thumb-label\n      :model-value=\"blendConfig.opacity\"\n      @update:model-value=\"setBlendConfig('opacity', $event)\"\n      data-testid=\"layer-opacity-slider\"\n    />\n  </div>\n</template>\n","<script lang=\"ts\">\nimport { computed, defineComponent } from 'vue';\nimport { useCurrentImage } from '../composables/useCurrentImage';\nimport LayerProperties from './LayerProperties.vue';\n\nexport default defineComponent({\n  name: 'LayerList',\n  components: {\n    LayerProperties,\n  },\n  setup() {\n    const { currentLayers } = useCurrentImage();\n    const layers = computed(() => [...currentLayers.value].reverse());\n\n    return {\n      layers,\n    };\n  },\n});\n</script>\n\n<template>\n  <div class=\"mx-2\">\n    <layer-properties\n      v-for=\"layer in layers\"\n      :key=\"layer.id\"\n      :layer=\"layer\"\n      class=\"py-4\"\n    >\n    </layer-properties>\n  </div>\n</template>\n","<script lang=\"ts\">\nimport { computed, defineComponent, ref } from 'vue';\nimport { useCurrentImage } from '../composables/useCurrentImage';\nimport VolumeProperties from './VolumeProperties.vue';\nimport VolumeRendering from './VolumeRendering.vue';\nimport VolumePresets from './VolumePresets.vue';\nimport LayerList from './LayerList.vue';\n\nexport default defineComponent({\n  components: { VolumeRendering, VolumePresets, VolumeProperties, LayerList },\n  setup() {\n    const { currentImageData } = useCurrentImage();\n    const hasCurrentImage = computed(() => !!currentImageData.value);\n\n    const { currentLayers } = useCurrentImage();\n    const hasLayers = computed(() => !!currentLayers.value.length);\n\n    const panels = ref<string[]>(['properties', 'layers']);\n\n    return {\n      panels,\n      hasCurrentImage,\n      hasLayers,\n    };\n  },\n});\n</script>\n\n<template>\n  <div class=\"overflow-y-auto mx-2 fill-height\">\n    <template v-if=\"hasCurrentImage\">\n      <volume-rendering />\n      <v-expansion-panels v-model=\"panels\" multiple variant=\"accordion\">\n        <v-expansion-panel value=\"preset\">\n          <v-expansion-panel-title>\n            <v-icon class=\"flex-grow-0 mr-4\">mdi-palette</v-icon>\n            Color Presets\n          </v-expansion-panel-title>\n          <v-expansion-panel-text>\n            <volume-presets />\n          </v-expansion-panel-text>\n        </v-expansion-panel>\n\n        <v-expansion-panel value=\"properties\">\n          <v-expansion-panel-title>\n            <v-icon class=\"flex-grow-0 mr-4\">mdi-cube-scan</v-icon>\n            Cinematic Rendering\n          </v-expansion-panel-title>\n          <v-expansion-panel-text>\n            <volume-properties />\n          </v-expansion-panel-text>\n        </v-expansion-panel>\n\n        <v-expansion-panel v-if=\"hasLayers\" value=\"layers\">\n          <v-expansion-panel-title>\n            <v-icon class=\"flex-grow-0 mr-4\">mdi-layers</v-icon>\n            Layers\n          </v-expansion-panel-title>\n          <v-expansion-panel-text>\n            <layer-list />\n          </v-expansion-panel-text>\n        </v-expansion-panel>\n      </v-expansion-panels>\n    </template>\n    <template v-else>\n      <div class=\"text-center pt-12 text-subtitle-1\">No image selected</div>\n    </template>\n  </div>\n</template>\n","import {\n  ToolSelection,\n  useToolSelectionStore,\n} from '@/src/store/tools/toolSelection';\nimport { AnnotationToolType } from '@/src/store/tools/types';\nimport { ToolID } from '@/src/types/annotation-tool';\nimport { MaybeRef, computed, unref } from 'vue';\n\nexport enum MultipleSelectionState {\n  None,\n  Some,\n  All,\n}\n\nexport const useMultipleToolSelection = (\n  collection: MaybeRef<ToolSelection[]>\n) => {\n  const store = useToolSelectionStore();\n\n  const idToType = computed(() =>\n    unref(collection).reduce(\n      (acc, { id, type }) => ({ ...acc, [id]: type }),\n      {} as Record<ToolID, AnnotationToolType>\n    )\n  );\n\n  const selected = computed<ToolID[]>({\n    get: () => store.selection.map(({ id }) => id),\n    set: (newSelection) => {\n      store.clearSelection();\n      newSelection.forEach((id) => {\n        store.addSelection(id, idToType.value[id]);\n      });\n    },\n  });\n\n  const selectionState = computed<MultipleSelectionState>(() => {\n    const coll = unref(collection);\n    const { length } = unref(coll).filter((tool) => store.isSelected(tool.id));\n    if (length === 0) {\n      return MultipleSelectionState.None;\n    }\n    if (length === coll.length) {\n      return MultipleSelectionState.All;\n    }\n    return MultipleSelectionState.Some;\n  });\n\n  const selectAll = () => {\n    unref(collection).forEach((tool) => store.addSelection(tool.id, tool.type));\n  };\n\n  const deselectAll = () => {\n    // technically correct solution is collection.forEach(remove),\n    // but this will suffice (and is faster).\n    store.clearSelection();\n  };\n\n  return {\n    selectAll,\n    deselectAll,\n    selected,\n    selectionState,\n  };\n};\n","<script setup lang=\"ts\">\nimport { computed } from 'vue';\nimport { useCurrentImage } from '@/src/composables/useCurrentImage';\nimport { frameOfReferenceToImageSliceAndAxis } from '@/src/utils/frameOfReference';\nimport { nonNullable } from '@/src/utils/index';\nimport { AnnotationToolType } from '@/src/store/tools/types';\nimport { useAnnotationToolStore } from '@/src/store/tools';\nimport {\n  useMultipleToolSelection,\n  MultipleSelectionState,\n} from '@/src/composables/useMultipleToolSelection';\nimport { useToolSelectionStore } from '@/src/store/tools/toolSelection';\nimport MeasurementToolDetails from './MeasurementToolDetails.vue';\nimport { AnnotationTool } from '../types/annotation-tool';\n\ntype AnnotationToolConfig = {\n  type: AnnotationToolType;\n  icon: string;\n  details?: typeof MeasurementToolDetails;\n};\n\nexport type AnnotationTools = Array<AnnotationToolConfig>;\n\nconst props = defineProps<{\n  tools: AnnotationTools;\n}>();\n\nconst { currentImageID, currentImageMetadata } = useCurrentImage();\n\n// Filter and add axis for specific annotation type\nconst getTools = (type: AnnotationToolType) => {\n  const toolStore = useAnnotationToolStore(type);\n  return toolStore.finishedTools\n    .filter((tool) => tool.imageID === currentImageID.value)\n    .map((tool) => {\n      const { axis } = frameOfReferenceToImageSliceAndAxis(\n        tool.frameOfReference,\n        currentImageMetadata.value,\n        {\n          allowOutOfBoundsSlice: true,\n        }\n      ) ?? { axis: 'unknown' };\n      return {\n        ...tool,\n        axis,\n      };\n    });\n};\n\n// Flatten all tool types and add actions\nconst tools = computed(() => {\n  return props.tools.flatMap(\n    ({ type, icon, details = MeasurementToolDetails }) => {\n      const store = useAnnotationToolStore(type);\n      const toolsWithAxis = getTools(type);\n      return toolsWithAxis.map((tool) => ({\n        id: tool.id,\n        type,\n        toolData: tool,\n        icon,\n        details,\n        remove: () => store.removeTool(tool.id),\n        jumpTo: () => store.jumpToTool(tool.id),\n        toggleHidden: () => {\n          const toggled = !store.toolByID[tool.id].hidden;\n          store.updateTool(tool.id, { hidden: toggled });\n        },\n        updateTool: (patch: Partial<AnnotationTool>) => {\n          store.updateTool(tool.id, patch);\n        },\n      }));\n    }\n  );\n});\n\n// --- selection and batch actions  --- //\n\nconst selectionStore = useToolSelectionStore();\n\nconst { selectAll, deselectAll, selected, selectionState } =\n  useMultipleToolSelection(tools);\n\nconst toggleSelectAll = (shouldSelectAll: boolean) => {\n  if (shouldSelectAll) {\n    selectAll();\n  } else {\n    deselectAll();\n  }\n};\n\nfunction removeAll() {\n  selectionStore.selection.forEach((sel) => {\n    const store = useAnnotationToolStore(sel.type);\n    store.removeTool(sel.id);\n  });\n}\n\n// If all selected tools are already hidden, it should be \"show\".\n// If at least one selected tool is visible, it should be \"hide\".\nconst allHidden = computed(() => {\n  return selected.value\n    .map((id) => tools.value.find((tool) => id === tool.id))\n    .filter(nonNullable)\n    .every((tool) => tool.toolData.hidden);\n});\n\nconst forEachSelectedTool = (\n  callback: (tool: (typeof tools.value)[number]) => void\n) =>\n  tools.value\n    .filter((tool) => selectionStore.isSelected(tool.id))\n    .forEach(callback);\n\nfunction toggleGlobalHidden() {\n  const hidden = !allHidden.value;\n  forEachSelectedTool((tool) => {\n    tool.updateTool({ hidden });\n  });\n}\n</script>\n\n<template>\n  <v-row no-gutters justify=\"space-between\" align=\"center\" class=\"mb-1\">\n    <v-col class=\"d-flex\">\n      <v-checkbox\n        class=\"ml-3\"\n        :indeterminate=\"selectionState === MultipleSelectionState.Some\"\n        label=\"Select All\"\n        :model-value=\"selectionState === MultipleSelectionState.All\"\n        @update:model-value=\"toggleSelectAll\"\n        density=\"compact\"\n        hide-details\n      />\n    </v-col>\n\n    <!-- Count of selected tools -->\n    <v-col class=\"v-label\">\n      {{ selected.length }} of {{ tools.length }} selected\n    </v-col>\n\n    <v-col align-self=\"center\" class=\"d-flex justify-end\">\n      <v-btn\n        icon\n        variant=\"text\"\n        :disabled=\"selectionState === MultipleSelectionState.None\"\n        @click.stop=\"toggleGlobalHidden\"\n      >\n        <v-icon v-if=\"allHidden\">mdi-eye-off</v-icon>\n        <v-icon v-else>mdi-eye</v-icon>\n        <v-tooltip location=\"top\" activator=\"parent\">{{\n          allHidden ? 'Show' : 'Hide'\n        }}</v-tooltip>\n      </v-btn>\n      <v-btn\n        icon\n        variant=\"text\"\n        :disabled=\"selectionState === MultipleSelectionState.None\"\n        @click.stop=\"removeAll\"\n      >\n        <v-icon>mdi-delete</v-icon>\n        <v-tooltip\n          :disabled=\"selectionState === MultipleSelectionState.None\"\n          location=\"top\"\n          activator=\"parent\"\n        >\n          Delete selected\n        </v-tooltip>\n      </v-btn>\n    </v-col>\n  </v-row>\n\n  <v-list-item v-for=\"tool in tools\" :key=\"tool.id\">\n    <v-container>\n      <v-row class=\"d-flex align-center main-row\">\n        <v-checkbox\n          class=\"no-grow mr-4\"\n          density=\"compact\"\n          hide-details\n          :key=\"tool.id\"\n          :value=\"tool.id\"\n          v-model=\"selected\"\n          @click.stop\n        />\n\n        <v-icon class=\"tool-icon mr-4\">{{ tool.icon }}</v-icon>\n\n        <div\n          class=\"color-dot flex-shrink-0 mr-2\"\n          :style=\"{ backgroundColor: tool.toolData.color }\"\n        />\n        <v-list-item-title v-bind=\"$attrs\">\n          {{ tool.toolData.labelName }}\n        </v-list-item-title>\n\n        <span class=\"ml-auto flex-shrink-0\">\n          <v-btn icon variant=\"text\" @click=\"tool.jumpTo()\">\n            <v-icon>mdi-target</v-icon>\n            <v-tooltip location=\"top\" activator=\"parent\">\n              Reveal Slice\n            </v-tooltip>\n          </v-btn>\n          <v-btn icon variant=\"text\" @click=\"tool.toggleHidden()\">\n            <v-icon v-if=\"tool.toolData.hidden\">mdi-eye-off</v-icon>\n            <v-icon v-else>mdi-eye</v-icon>\n            <v-tooltip location=\"top\" activator=\"parent\">{{\n              tool.toolData.hidden ? 'Show' : 'Hide'\n            }}</v-tooltip>\n          </v-btn>\n          <v-btn icon variant=\"text\" @click=\"tool.remove()\">\n            <v-icon>mdi-delete</v-icon>\n            <v-tooltip location=\"top\" activator=\"parent\">Delete</v-tooltip>\n          </v-btn>\n        </span>\n      </v-row>\n\n      <v-row class=\"mt-4\">\n        <v-list-item-subtitle class=\"w-100\">\n          <component :is=\"tool.details\" :tool=\"tool.toolData\" />\n        </v-list-item-subtitle>\n      </v-row>\n    </v-container>\n  </v-list-item>\n</template>\n\n<style src=\"@/src/components/styles/utils.css\"></style>\n\n<style scoped>\n.main-row {\n  flex-wrap: nowrap;\n}\n\n.color-dot {\n  width: 24px;\n  height: 24px;\n  background: yellow;\n  border-radius: 16px;\n}\n\n.tool-icon {\n  opacity: var(--v-medium-emphasis-opacity);\n}\n\n.no-grow {\n  flex: 0 0 auto;\n}\n</style>\n","import { computed, MaybeRef, unref } from 'vue';\nimport { InitViewSpecs } from '@/src/config';\nimport useLayerColoringStore from '@/src/store/view-configs/layers';\nimport { LayersConfig } from '@/src/store/view-configs/types';\nimport { useSegmentGroupConfigInitializer } from '@/src/composables/useSegmentGroupConfigInitializer';\n\n// Returns first existing view's config as the \"value\" and updates all views' configs with updateConfig()\nexport const useGlobalLayerColorConfig = (layerId: MaybeRef<string>) => {\n  const layerColoringStore = useLayerColoringStore();\n\n  const VIEWS_2D = Object.entries(InitViewSpecs)\n    .filter(([, { viewType }]) => viewType === '2D')\n    .map(([viewID]) => viewID);\n\n  useSegmentGroupConfigInitializer(VIEWS_2D[0], unref(layerId));\n\n  const layerConfigs = computed(() =>\n    VIEWS_2D.map((viewID) => ({\n      config: layerColoringStore.getConfig(viewID, unref(layerId)),\n      viewID,\n    }))\n  );\n\n  const sampledConfig = computed(() =>\n    layerConfigs.value.find(({ config }) => config)\n  );\n\n  const updateConfig = (patch: Partial<LayersConfig>) => {\n    layerConfigs.value.forEach(({ viewID }) =>\n      layerColoringStore.updateConfig(viewID, unref(layerId), patch)\n    );\n  };\n\n  return { sampledConfig, updateConfig };\n};\n","<script setup lang=\"ts\">\nimport { computed, toRefs } from 'vue';\nimport { useGlobalLayerColorConfig } from '@/src/composables/useGlobalLayerColorConfig';\nimport { useGlobalSegmentGroupConfig } from '@/src/store/view-configs/segmentGroups';\n\nconst props = defineProps<{\n  groupId: string;\n  selected: string[];\n}>();\n\nconst { groupId, selected } = toRefs(props);\n\nconst { sampledConfig } = useGlobalLayerColorConfig(groupId);\n\nconst blendConfig = computed(() => sampledConfig.value!.config!.blendConfig);\n\nconst layerUpdateFunctions = computed(() =>\n  selected.value.map((id) => {\n    return useGlobalLayerColorConfig(id).updateConfig;\n  })\n);\n\nconst setOpacity = (opacity: number) => {\n  layerUpdateFunctions.value.forEach((updateFn) => {\n    updateFn({\n      blendConfig: {\n        ...blendConfig.value,\n        // 1.0 puts us in Opaque render pass which changes stack order.\n        opacity: Math.min(opacity, 0.9999),\n      },\n    });\n  });\n};\n\nconst { config } = useGlobalSegmentGroupConfig(groupId);\n\nconst groupUpdateFunctions = computed(() =>\n  selected.value.map((id) => {\n    return useGlobalSegmentGroupConfig(id).updateConfig;\n  })\n);\n\nconst outlineOpacity = computed({\n  get: () => config.value!.config!.outlineOpacity,\n  set: (opacity: number) => {\n    groupUpdateFunctions.value.forEach((updateFn) => {\n      updateFn({\n        outlineOpacity: opacity,\n      });\n    });\n  },\n});\n\nconst outlineThickness = computed({\n  get: () => config.value!.config!.outlineThickness,\n  set: (thickness: number) => {\n    groupUpdateFunctions.value.forEach((updateFn) => {\n      updateFn({\n        outlineThickness: thickness,\n      });\n    });\n  },\n});\n</script>\n\n<template>\n  <v-slider\n    class=\"mx-4\"\n    label=\"Fill Opacity\"\n    min=\"0\"\n    max=\"1\"\n    step=\"0.01\"\n    density=\"compact\"\n    hide-details\n    thumb-label\n    :model-value=\"blendConfig.opacity\"\n    @update:model-value=\"setOpacity($event)\"\n  />\n  <v-slider\n    class=\"mx-4\"\n    label=\"Outline Opacity\"\n    min=\"0\"\n    max=\"1\"\n    step=\"0.01\"\n    density=\"compact\"\n    hide-details\n    thumb-label\n    v-model=\"outlineOpacity\"\n  />\n  <v-slider\n    class=\"mx-4\"\n    label=\"Outline Thickness\"\n    min=\"0\"\n    max=\"10\"\n    step=\"1\"\n    density=\"compact\"\n    hide-details\n    thumb-label\n    v-model=\"outlineThickness\"\n  />\n</template>\n","<script setup lang=\"ts\">\nimport LabelEditor from '@/src/components/LabelEditor.vue';\nimport { computed } from 'vue';\n\ndefineEmits([\n  'done',\n  'cancel',\n  'delete',\n  'update:name',\n  'update:color',\n  'update:opacity',\n]);\n\nconst props = defineProps<{\n  name: string;\n  color: string;\n  invalidNames: Set<string>;\n  opacity: number;\n}>();\n\nfunction isUniqueEditingName(name: string) {\n  return !props.invalidNames.has(name.trim());\n}\n\nfunction uniqueNameRule(name: string) {\n  return isUniqueEditingName(name) || 'Name is not unique';\n}\n\nconst valid = computed(() => {\n  return isUniqueEditingName(props.name);\n});\n</script>\n\n<template>\n  <label-editor\n    :color=\"color\"\n    :valid=\"valid\"\n    @update:color=\"$emit('update:color', $event)\"\n    @delete=\"$emit('delete')\"\n    @cancel=\"$emit('cancel')\"\n    @done=\"$emit('done')\"\n  >\n    <template #fields=\"{ done }\">\n      <v-text-field\n        label=\"Name\"\n        class=\"flex-grow-0\"\n        :model-value=\"name\"\n        @update:model-value=\"$emit('update:name', $event)\"\n        @keydown.stop.enter=\"done\"\n        :rules=\"[uniqueNameRule]\"\n      />\n      <v-slider\n        class=\"mx-4 my-1\"\n        label=\"Segment Fill Opacity\"\n        min=\"0\"\n        max=\"1\"\n        step=\"0.01\"\n        density=\"compact\"\n        hide-details\n        thumb-label\n        :model-value=\"opacity\"\n        @update:model-value=\"$emit('update:opacity', $event)\"\n      />\n    </template>\n  </label-editor>\n</template>\n","import type { RGBAColor } from '@kitware/vtk.js/types';\n\n/**\n * Converts an RGBA tuple to a hex string with alpha.\n *\n * Adds the prefix '#'.\n *\n * @param rgba a 4-tuple with components ranging from 0-255.\n */\nexport function rgbaToHexa(rgba: RGBAColor) {\n  const hexa = rgba.map((comp) => `0${comp.toString(16)}`.slice(-2));\n  return `#${hexa.join('')}`;\n}\n\n/**\n * Parses a hex color with optional alpha channel.\n *\n * Returns an RGBA array with components scaled to [0,255].\n *\n * @param hexa a hexa color in the format \"[#]RRGGBB[AA]\"\n */\nexport function hexaToRGBA(hexa: string): RGBAColor {\n  const values = hexa.startsWith('#') ? hexa.substring(1) : hexa;\n  const rgba: RGBAColor = [0, 0, 0, 255];\n  const length = Math.min(4, values.length / 2);\n  for (let i = 0; i < length; i++) {\n    rgba[i] = Number.parseInt(values.substring(2 * i, 2 * i + 2), 16);\n  }\n  return rgba;\n}\n","<script setup lang=\"ts\">\nimport EditableChipList from '@/src/components/EditableChipList.vue';\nimport SegmentEditor from '@/src/components/SegmentEditor.vue';\nimport IsolatedDialog from '@/src/components/IsolatedDialog.vue';\nimport {\n  useSegmentGroupStore,\n  makeDefaultSegmentName,\n} from '@/src/store/segmentGroups';\nimport { Maybe } from '@/src/types';\nimport { hexaToRGBA, rgbaToHexa } from '@/src/utils/color';\nimport { reactive, ref, toRefs, computed, watch } from 'vue';\nimport { SegmentMask } from '@/src/types/segment';\nimport { usePaintToolStore } from '@/src/store/tools/paint';\nimport type { RGBAColor } from '@kitware/vtk.js/types';\n\nconst props = defineProps({\n  groupId: {\n    required: true,\n    type: String,\n  },\n});\n\nconst { groupId } = toRefs(props);\n\nconst segmentGroupStore = useSegmentGroupStore();\nconst paintStore = usePaintToolStore();\n\nconst segments = computed<SegmentMask[]>(() => {\n  return segmentGroupStore.segmentByGroupID[groupId.value] ?? [];\n});\n\nfunction addNewSegment() {\n  segmentGroupStore.addSegment(groupId.value);\n}\n\n// --- selection --- //\n\nconst selectedSegment = computed({\n  get: () => paintStore.activeSegment,\n  set: (value: Maybe<number>) => {\n    paintStore.setActiveSegment(value);\n  },\n});\n\n// reset selection when necessary\nwatch(\n  segments,\n  (segments_) => {\n    let reset = true;\n    if (segments_ && selectedSegment.value) {\n      reset = !segments_.find((seg) => seg.value === selectedSegment.value);\n    }\n\n    if (reset) {\n      selectedSegment.value = segments_?.length ? segments_[0].value : null;\n    }\n  },\n  { immediate: true }\n);\n\nconst toggleVisible = (value: number) => {\n  const segment = segmentGroupStore.getSegment(groupId.value, value);\n  if (!segment) return;\n  segmentGroupStore.updateSegment(groupId.value, value, {\n    visible: !segment.visible,\n  });\n};\n\nconst allVisible = computed(() => {\n  return segments.value.every((seg) => seg.visible);\n});\n\nfunction toggleGlobalVisible() {\n  const visible = !allVisible.value;\n\n  segments.value.forEach((seg) => {\n    segmentGroupStore.updateSegment(groupId.value, seg.value, {\n      visible,\n    });\n  });\n}\n\n// --- editing state --- //\n\nconst editingSegmentValue = ref<Maybe<number>>(null);\nconst editState = reactive({\n  name: '',\n  color: '',\n  opacity: 1,\n});\nconst editDialog = ref(false);\n\nconst editingSegment = computed(() => {\n  if (editingSegmentValue.value == null) return null;\n  return segmentGroupStore.getSegment(groupId.value, editingSegmentValue.value);\n});\nconst invalidNames = computed(() => {\n  const names = new Set(segments.value.map((seg) => seg.name));\n  const currentName = editingSegment.value?.name;\n  if (currentName) names.delete(currentName); // allow current name\n  return names;\n});\n\nfunction startEditing(value: number) {\n  editDialog.value = true;\n  editingSegmentValue.value = value;\n  if (!editingSegment.value) return;\n  editState.name = editingSegment.value.name;\n  editState.color = rgbaToHexa(editingSegment.value.color);\n  editState.opacity = editingSegment.value.color[3] / 255;\n}\n\nfunction stopEditing(commit: boolean) {\n  if (editingSegmentValue.value && commit) {\n    const color = [\n      ...(hexaToRGBA(editState.color).slice(0, 3) as [number, number, number]),\n      Math.round(editState.opacity * 255),\n    ] as RGBAColor;\n    segmentGroupStore.updateSegment(groupId.value, editingSegmentValue.value, {\n      name: editState.name ?? makeDefaultSegmentName(editingSegmentValue.value),\n      color,\n    });\n  }\n  editingSegmentValue.value = null;\n  editDialog.value = false;\n}\n\nfunction deleteSegment(value: number) {\n  segmentGroupStore.deleteSegment(groupId.value, value);\n}\n\nfunction deleteEditingSegment() {\n  if (editingSegmentValue.value) deleteSegment(editingSegmentValue.value);\n  stopEditing(false);\n}\n</script>\n\n<template>\n  <v-btn @click.stop=\"toggleGlobalVisible\" class=\"my-1\">\n    Toggle Segments\n    <slot name=\"append\">\n      <v-icon v-if=\"allVisible\" class=\"pl-2\">mdi-eye</v-icon>\n      <v-icon v-else class=\"pl-2\">mdi-eye-off</v-icon>\n      <v-tooltip location=\"top\" activator=\"parent\">{{\n        allVisible ? 'Hide' : 'Show'\n      }}</v-tooltip>\n    </slot>\n  </v-btn>\n\n  <editable-chip-list\n    v-model=\"selectedSegment\"\n    :items=\"segments\"\n    item-key=\"value\"\n    item-title=\"name\"\n    create-label-text=\"New segment\"\n    @create=\"addNewSegment\"\n    class=\"my-4\"\n  >\n    <template #item-prepend=\"{ item }\">\n      <!-- dot container keeps overflowing name from squishing dot width  -->\n      <div class=\"dot-container mr-3\">\n        <div\n          class=\"color-dot\"\n          :style=\"{ background: rgbaToHexa([...item.color.slice(0,3), 255] as RGBAColor) }\"\n        />\n      </div>\n    </template>\n    <template #item-append=\"{ key, item }\">\n      <v-btn\n        icon\n        size=\"small\"\n        density=\"compact\"\n        class=\"ml-auto mr-1\"\n        variant=\"plain\"\n        @click.stop=\"toggleVisible(key as number)\"\n      >\n        <v-icon v-if=\"item.visible\" style=\"pointer-events: none\"\n          >mdi-eye</v-icon\n        >\n        <v-icon v-else style=\"pointer-events: none\">mdi-eye-off</v-icon>\n        <v-tooltip location=\"left\" activator=\"parent\">{{\n          item.visible ? 'Hide' : 'Show'\n        }}</v-tooltip>\n      </v-btn>\n      <v-btn\n        icon=\"mdi-pencil\"\n        size=\"small\"\n        density=\"compact\"\n        class=\"ml-auto mr-1\"\n        variant=\"plain\"\n        @click.stop=\"startEditing(key as number)\"\n      />\n      <v-btn\n        icon=\"mdi-delete\"\n        size=\"small\"\n        density=\"compact\"\n        class=\"ml-auto\"\n        variant=\"plain\"\n        @click.stop=\"deleteSegment(key as number)\"\n      />\n    </template>\n  </editable-chip-list>\n\n  <isolated-dialog v-model=\"editDialog\" @keydown.stop max-width=\"800px\">\n    <segment-editor\n      v-if=\"!!editingSegment\"\n      v-model:name=\"editState.name\"\n      v-model:color=\"editState.color\"\n      v-model:opacity=\"editState.opacity\"\n      @delete=\"deleteEditingSegment\"\n      @cancel=\"stopEditing(false)\"\n      @done=\"stopEditing(true)\"\n      :invalidNames=\"invalidNames\"\n    />\n  </isolated-dialog>\n</template>\n\n<style scoped>\n.color-dot {\n  width: 18px;\n  height: 18px;\n  border-radius: 16px;\n  border: 1px solid #111;\n}\n.dot-container {\n  width: 18px;\n}\n</style>\n","<template>\n  <v-card>\n    <v-card-title class=\"d-flex flex-row align-center\">\n      Save Segment Group\n    </v-card-title>\n    <v-card-text>\n      <v-form v-model=\"valid\" @submit.prevent=\"saveSegmentGroup\">\n        <v-text-field\n          v-model=\"fileName\"\n          hint=\"Filename that will appear in downloads.\"\n          label=\"Filename\"\n          :rules=\"[validFileName]\"\n          required\n          id=\"filename\"\n        />\n\n        <v-select\n          label=\"Format\"\n          v-model=\"fileFormat\"\n          :items=\"EXTENSIONS\"\n        ></v-select>\n      </v-form>\n    </v-card-text>\n    <v-card-actions>\n      <v-spacer />\n      <v-btn\n        :loading=\"saving\"\n        color=\"secondary\"\n        @click=\"saveSegmentGroup\"\n        :disabled=\"!valid\"\n      >\n        <v-icon class=\"mr-2\">mdi-content-save</v-icon>\n        <span data-testid=\"save-confirm-button\">Save</span>\n      </v-btn>\n    </v-card-actions>\n  </v-card>\n</template>\n\n<script setup lang=\"ts\">\nimport { onMounted, ref } from 'vue';\nimport { onKeyDown } from '@vueuse/core';\nimport { saveAs } from 'file-saver';\nimport { useSegmentGroupStore } from '@/src/store/segmentGroups';\nimport { writeImage } from '@/src/io/readWriteImage';\nimport { useErrorMessage } from '@/src/composables/useErrorMessage';\n\nconst EXTENSIONS = [\n  'nrrd',\n  'nii',\n  'nii.gz',\n  'dcm',\n  'hdf5',\n  'tif',\n  'mha',\n  'vtk',\n  'iwi.cbor',\n];\n\nconst props = defineProps<{\n  id: string;\n}>();\n\nconst emit = defineEmits(['done']);\n\nconst fileName = ref('');\nconst valid = ref(true);\nconst saving = ref(false);\nconst fileFormat = ref(EXTENSIONS[0]);\n\nconst segmentGroupStore = useSegmentGroupStore();\n\nasync function saveSegmentGroup() {\n  if (fileName.value.trim().length === 0) {\n    return;\n  }\n\n  saving.value = true;\n  await useErrorMessage('Failed to save segment group', async () => {\n    const image = segmentGroupStore.dataIndex[props.id];\n    const serialized = await writeImage(fileFormat.value, image);\n    saveAs(new Blob([serialized]), `${fileName.value}.${fileFormat.value}`);\n  });\n  saving.value = false;\n  emit('done');\n}\n\nonMounted(() => {\n  // trigger form validation check so can immediately save with default value\n  fileName.value = segmentGroupStore.metadataByID[props.id].name;\n});\n\nonKeyDown('Enter', () => {\n  saveSegmentGroup();\n});\n\nfunction validFileName(name: string) {\n  return name.trim().length > 0 || 'Required';\n}\n</script>\n","<script setup lang=\"ts\">\nimport SegmentGroupOpacity from '@/src/components/SegmentGroupOpacity.vue';\nimport SegmentList from '@/src/components/SegmentList.vue';\nimport CloseableDialog from '@/src/components/CloseableDialog.vue';\nimport SaveSegmentGroupDialog from '@/src/components/SaveSegmentGroupDialog.vue';\nimport { useCurrentImage } from '@/src/composables/useCurrentImage';\nimport { useDatasetStore } from '@/src/store/datasets';\nimport {\n  getSelectionName,\n  selectionEquals,\n  DataSelection,\n} from '@/src/utils/dataSelection';\nimport { useSegmentGroupStore } from '@/src/store/segmentGroups';\nimport { useGlobalLayerColorConfig } from '@/src/composables/useGlobalLayerColorConfig';\nimport { usePaintToolStore } from '@/src/store/tools/paint';\nimport { Maybe } from '@/src/types';\nimport { reactive, ref, computed, watch, toRaw } from 'vue';\nimport { useMultiSelection } from '@/src/composables/useMultiSelection';\n\nconst UNNAMED_GROUP_NAME = 'Unnamed Segment Group';\n\nconst segmentGroupStore = useSegmentGroupStore();\nconst { currentImageID } = useCurrentImage();\nconst dataStore = useDatasetStore();\n\nconst currentSegmentGroups = computed(() => {\n  if (!currentImageID.value) return [];\n  const { orderByParent, metadataByID } = segmentGroupStore;\n  if (!(currentImageID.value in orderByParent)) return [];\n  return orderByParent[currentImageID.value].map((id) => {\n    const { sampledConfig, updateConfig } = useGlobalLayerColorConfig(id);\n    return {\n      id,\n      name: metadataByID[id].name,\n      visibility: sampledConfig.value?.config?.blendConfig.visibility ?? true,\n      toggleVisibility: () => {\n        const currentBlend = sampledConfig.value!.config!.blendConfig;\n        updateConfig({\n          blendConfig: {\n            ...currentBlend,\n            visibility: !currentBlend.visibility,\n          },\n        });\n      },\n    };\n  });\n});\n\nconst paintStore = usePaintToolStore();\nconst currentSegmentGroupID = computed({\n  get: () => paintStore.activeSegmentGroupID,\n  set: (id) => paintStore.setActiveSegmentGroup(id),\n});\n\n// clear selection if we delete the active segment group\nwatch(currentSegmentGroups, () => {\n  const selection = currentSegmentGroupID.value;\n  if (selection && !(selection in segmentGroupStore.dataIndex)) {\n    currentSegmentGroupID.value = null;\n  }\n});\n\nfunction deleteGroup(id: string) {\n  segmentGroupStore.removeGroup(id);\n}\n\n// --- editing state --- //\n\nconst editingGroupID = ref<Maybe<string>>(null);\nconst editState = reactive({ name: '' });\nconst editDialog = ref(false);\n\nconst editingMetadata = computed(() => {\n  if (!editingGroupID.value) return null;\n  return segmentGroupStore.metadataByID[editingGroupID.value];\n});\n\nconst existingNames = computed(() => {\n  return new Set(\n    Object.values(segmentGroupStore.metadataByID).map((meta) => meta.name)\n  );\n});\n\nfunction isUniqueEditingName(name: string) {\n  return !existingNames.value.has(name) || name === editingMetadata.value?.name;\n}\n\nconst editingNameConflict = computed(() => {\n  return !isUniqueEditingName(editState.name);\n});\n\nfunction uniqueNameRule(name: string) {\n  return isUniqueEditingName(name) || 'Name is not unique';\n}\n\nfunction startEditing(id: string) {\n  editDialog.value = true;\n  editingGroupID.value = id;\n  if (editingMetadata.value) {\n    editState.name = editingMetadata.value.name;\n  }\n}\n\nfunction stopEditing(commit: boolean) {\n  if (editingNameConflict.value) return;\n\n  editDialog.value = false;\n  if (editingGroupID.value && commit)\n    segmentGroupStore.updateMetadata(editingGroupID.value, {\n      name: editState.name || UNNAMED_GROUP_NAME,\n    });\n  editingGroupID.value = null;\n}\n\n// --- //\n\nfunction createSegmentGroup() {\n  if (!currentImageID.value)\n    throw new Error('Cannot create a labelmap without a base image');\n\n  const id = segmentGroupStore.newLabelmapFromImage(currentImageID.value);\n  if (!id) throw new Error('Could not create a new labelmap');\n\n  // copy segments from current labelmap\n  if (currentSegmentGroupID.value) {\n    const metadata =\n      segmentGroupStore.metadataByID[currentSegmentGroupID.value];\n    const copied = structuredClone(toRaw(metadata.segments));\n    segmentGroupStore.updateMetadata(id, { segments: copied });\n  }\n\n  currentSegmentGroupID.value = id;\n\n  startEditing(id);\n}\n\n// Collect images that can be converted into\n// a SegmentGroup for the current background image.\nconst segmentGroupConvertibles = computed(() => {\n  const primarySelection = dataStore.primarySelection;\n  if (!primarySelection) return [];\n  return dataStore.idsAsSelections\n    .filter((selection) => !selectionEquals(selection, primarySelection))\n    .map((selection) => ({\n      selection,\n      name: getSelectionName(selection),\n    }));\n});\n\nfunction createSegmentGroupFromImage(selection: DataSelection) {\n  const primarySelection = dataStore.primarySelection;\n  if (!primarySelection) {\n    throw new Error('No primary selection');\n  }\n  segmentGroupStore.convertImageToLabelmap(selection, primarySelection);\n}\n\nconst saveId = ref('');\nconst saveDialog = ref(false);\nfunction openSaveDialog(id: string) {\n  saveId.value = id;\n  saveDialog.value = true;\n}\n\nconst segGroupIds = computed(() =>\n  currentSegmentGroups.value.map((group) => group.id)\n);\n\nconst { selected, selectedAll, selectedSome } = useMultiSelection(segGroupIds);\n\n// ensure currentSegmentGroupID is always in selected\nwatch(\n  // includes currentImageID to reselect when switching images because currentSegmentGroupID is not updated on image change\n  [currentSegmentGroupID, currentImageID],\n  () => {\n    const groupId = currentSegmentGroupID.value;\n    if (!groupId) return;\n    selected.value = [groupId];\n  },\n  { immediate: true }\n);\n\nfunction toggleSelectAll() {\n  if (selectedAll.value && currentSegmentGroupID.value) {\n    selected.value = [currentSegmentGroupID.value];\n  } else if (selectedAll.value) {\n    selected.value = [];\n  } else {\n    selected.value = segGroupIds.value;\n  }\n}\n\nconst allHidden = computed(() => {\n  return selected.value\n    .map((id) => currentSegmentGroups.value.find((group) => id === group.id))\n    .filter((group): group is NonNullable<typeof group> => group != null)\n    .every((group) => !group.visibility);\n});\n\nfunction toggleGlobalVisibility() {\n  const shouldShow = allHidden.value;\n  selected.value.forEach((id) => {\n    const group = currentSegmentGroups.value.find((g) => g.id === id);\n    if (group) {\n      const { sampledConfig, updateConfig } = useGlobalLayerColorConfig(id);\n      const currentBlend = sampledConfig.value!.config!.blendConfig;\n      updateConfig({\n        blendConfig: {\n          ...currentBlend,\n          visibility: shouldShow,\n        },\n      });\n    }\n  });\n}\n\nfunction deleteSelected() {\n  selected.value.forEach((id) => deleteGroup(id));\n}\n</script>\n\n<template>\n  <div class=\"mt-2\" v-if=\"currentImageID\">\n    <div\n      class=\"text-grey text-subtitle-2 d-flex align-center justify-space-evenly mb-2\"\n    >\n      <v-btn\n        variant=\"tonal\"\n        color=\"secondary\"\n        density=\"compact\"\n        @click.stop=\"createSegmentGroup\"\n      >\n        <v-icon class=\"mr-1\">mdi-plus</v-icon> New Group\n      </v-btn>\n      <v-menu location=\"bottom\">\n        <template v-slot:activator=\"{ props }\">\n          <v-btn\n            variant=\"tonal\"\n            color=\"secondary\"\n            density=\"compact\"\n            v-bind=\"props\"\n          >\n            <v-icon class=\"mr-1\">mdi-chevron-down</v-icon>From Image\n          </v-btn>\n        </template>\n        <v-list v-if=\"segmentGroupConvertibles.length !== 0\">\n          <v-list-item\n            v-for=\"(item, index) in segmentGroupConvertibles\"\n            :key=\"index\"\n            @click=\"createSegmentGroupFromImage(item.selection)\"\n          >\n            {{ item.name }}\n            <v-tooltip activator=\"parent\" location=\"end\" max-width=\"200px\">\n              Convert to segment group\n            </v-tooltip>\n          </v-list-item>\n        </v-list>\n        <v-list v-else>\n          <v-list-item class=\"font-italic\" title=\"No eligible images found\" />\n        </v-list>\n      </v-menu>\n    </div>\n\n    <segment-group-opacity\n      v-if=\"currentSegmentGroupID\"\n      :group-id=\"currentSegmentGroupID\"\n      :selected=\"selected\"\n    />\n\n    <div class=\"d-flex align-center\" v-if=\"currentSegmentGroups.length > 0\">\n      <v-checkbox\n        class=\"ml-3\"\n        :indeterminate=\"selectedSome && !selectedAll\"\n        label=\"Select All\"\n        :model-value=\"selectedAll\"\n        @update:model-value=\"toggleSelectAll\"\n        density=\"compact\"\n        hide-details\n      />\n      <v-btn\n        icon\n        variant=\"text\"\n        :disabled=\"selected.length === 0\"\n        @click.stop=\"toggleGlobalVisibility\"\n      >\n        <v-icon v-if=\"allHidden\">mdi-eye-off</v-icon>\n        <v-icon v-else>mdi-eye</v-icon>\n        <v-tooltip location=\"top\" activator=\"parent\">\n          {{ allHidden ? 'Show' : 'Hide' }} selected\n        </v-tooltip>\n      </v-btn>\n      <v-btn\n        icon\n        variant=\"text\"\n        :disabled=\"selected.length === 0\"\n        @click.stop=\"deleteSelected\"\n      >\n        <v-icon>mdi-delete</v-icon>\n        <v-tooltip location=\"top\" activator=\"parent\">\n          Delete selected\n        </v-tooltip>\n      </v-btn>\n    </div>\n    <v-list density=\"comfortable\" class=\"my-1 segment-group-list\">\n      <v-list-item\n        v-for=\"group in currentSegmentGroups\"\n        :key=\"group.id\"\n        :active=\"currentSegmentGroupID === group.id\"\n        @click=\"currentSegmentGroupID = group.id\"\n      >\n        <div class=\"d-flex flex-row align-center w-100\" :title=\"group.name\">\n          <v-checkbox\n            class=\"no-grow mr-4\"\n            density=\"compact\"\n            hide-details\n            @click.stop\n            :value=\"group.id\"\n            v-model=\"selected\"\n            :disabled=\"group.id === currentSegmentGroupID\"\n          />\n          <span class=\"group-name\">{{ group.name }}</span>\n          <v-spacer />\n          <v-btn\n            icon\n            variant=\"text\"\n            size=\"small\"\n            @click.stop=\"group.toggleVisibility\"\n          >\n            <v-icon v-if=\"group.visibility\" style=\"pointer-events: none\"\n              >mdi-eye</v-icon\n            >\n            <v-icon v-else style=\"pointer-events: none\">mdi-eye-off</v-icon>\n            <v-tooltip location=\"left\" activator=\"parent\">\n              {{ group.visibility ? 'Hide' : 'Show' }}\n            </v-tooltip>\n          </v-btn>\n          <v-btn\n            icon=\"mdi-content-save\"\n            size=\"small\"\n            variant=\"text\"\n            @click.stop=\"openSaveDialog(group.id)\"\n          />\n          <v-btn\n            icon=\"mdi-pencil\"\n            size=\"small\"\n            variant=\"text\"\n            @click.stop=\"startEditing(group.id)\"\n          />\n          <v-btn\n            icon=\"mdi-delete\"\n            size=\"small\"\n            variant=\"text\"\n            @click.stop=\"deleteGroup(group.id)\"\n          />\n        </div>\n      </v-list-item>\n      <v-list-item v-if=\"currentSegmentGroups.length === 0\">\n        <div class=\"text-center text-grey-darken-1 py-4 w-100\">\n          Create a segment group with the above buttons or click the paint tool\n        </div>\n      </v-list-item>\n    </v-list>\n\n    <v-divider class=\"my-4\" />\n  </div>\n  <div v-else class=\"text-center text-caption\">No selected image</div>\n  <segment-list\n    v-if=\"currentSegmentGroupID\"\n    :group-id=\"currentSegmentGroupID\"\n  />\n\n  <v-dialog v-model=\"editDialog\" max-width=\"400px\">\n    <v-card>\n      <v-card-text>\n        <v-text-field\n          v-model=\"editState.name\"\n          :placeholder=\"UNNAMED_GROUP_NAME\"\n          :rules=\"[uniqueNameRule]\"\n          @keydown.stop.enter=\"stopEditing(true)\"\n        />\n      </v-card-text>\n      <v-card-actions>\n        <v-spacer />\n        <v-btn color=\"error\" @click=\"stopEditing(false)\">Cancel</v-btn>\n        <v-btn :disabled=\"editingNameConflict\" @click=\"stopEditing(true)\">\n          Done\n        </v-btn>\n      </v-card-actions>\n    </v-card>\n  </v-dialog>\n\n  <closeable-dialog v-model=\"saveDialog\" max-width=\"30%\">\n    <template v-slot=\"{ close }\">\n      <save-segment-group-dialog :id=\"saveId\" @done=\"close\" />\n    </template>\n  </closeable-dialog>\n</template>\n\n<style>\n.segment-group-list {\n  max-height: 240px;\n  overflow-y: auto;\n}\n\n.group-name {\n  word-wrap: none;\n  white-space: nowrap;\n  overflow: hidden;\n  text-overflow: ellipsis;\n  padding-right: 10px;\n  text-align: left;\n}\n\n.no-grow {\n  flex: 0 0 auto;\n}\n</style>\n","<template>\n  <v-container>\n    <v-row no-gutters align=\"center\" class=\"mb-4 ml-1\">\n      <v-item-group v-model=\"mode\" mandatory selected-class=\"selected\">\n        <v-item\n          :value=\"PaintMode.CirclePaint\"\n          v-slot=\"{ selectedClass, toggle }\"\n        >\n          <v-btn\n            variant=\"tonal\"\n            rounded=\"8\"\n            stacked\n            :class=\"['mode-button', selectedClass]\"\n            @click.stop=\"toggle\"\n          >\n            <v-icon>mdi-brush</v-icon>\n            <span class=\"text-caption\">Paint</span>\n          </v-btn>\n        </v-item>\n        <v-item :value=\"PaintMode.Erase\" v-slot=\"{ selectedClass, toggle }\">\n          <v-btn\n            variant=\"tonal\"\n            rounded=\"8\"\n            stacked\n            :class=\"['mode-button', selectedClass]\"\n            @click.stop=\"toggle\"\n          >\n            <v-icon>mdi-eraser</v-icon>\n            <span class=\"text-caption\">Eraser</span>\n          </v-btn>\n        </v-item>\n      </v-item-group>\n    </v-row>\n    <v-row no-gutters align=\"center\">\n      <v-col>\n        <v-slider\n          :model-value=\"brushSize\"\n          @update:model-value=\"setBrushSize\"\n          density=\"compact\"\n          hide-details\n          label=\"Size\"\n          min=\"1\"\n          max=\"50\"\n        >\n          <template v-slot:append>\n            <v-text-field\n              :model-value=\"brushSize\"\n              @input=\"setBrushSize\"\n              variant=\"plain\"\n              class=\"mt-n3 pt-0 pl-2\"\n              style=\"width: 60px\"\n              density=\"compact\"\n              hide-details\n              type=\"number\"\n              min=\"1\"\n              max=\"50\"\n            />\n          </template>\n        </v-slider>\n      </v-col>\n    </v-row>\n  </v-container>\n</template>\n\n<script lang=\"ts\">\nimport { defineComponent, computed } from 'vue';\nimport { storeToRefs } from 'pinia';\nimport { PaintMode } from '@/src/core/tools/paint';\nimport { usePaintToolStore } from '../store/tools/paint';\n\nexport default defineComponent({\n  name: 'PaintControls',\n\n  setup() {\n    const paintStore = usePaintToolStore();\n    const { brushSize, activeMode } = storeToRefs(paintStore);\n\n    const setBrushSize = (size: number) => {\n      paintStore.setBrushSize(Number(size));\n    };\n\n    const mode = computed({\n      get: () => activeMode.value,\n      set: (m) => {\n        paintStore.setMode(m);\n      },\n    });\n\n    return {\n      brushSize,\n      setBrushSize,\n      mode,\n      PaintMode,\n    };\n  },\n});\n</script>\n\n<style scoped>\n.selected {\n  background-color: rgb(var(--v-theme-selection-bg-color));\n  border-color: rgb(var(--v-theme-selection-border-color));\n}\n\n.mode-button {\n  min-height: 56px;\n  min-width: 56px;\n  height: 56px;\n  width: 56px;\n}\n\n.mode-button:not(:last-child) {\n  margin-right: 6px;\n}\n</style>\n","<script setup lang=\"ts\">\nimport { computed } from 'vue';\nimport PaintControls from '@/src/components/PaintControls.vue';\nimport { useToolStore } from '../store/tools';\nimport { Tools } from '../store/tools/types';\nimport RectangleControls from './RectangleControls.vue';\nimport RulerControls from './RulerControls.vue';\nimport PolygonControls from './PolygonControls.vue';\n\nconst toolStore = useToolStore();\n\nconst tools = new Map([\n  [Tools.Rectangle, { component: RectangleControls, label: 'Rectangle' }],\n  [Tools.Ruler, { component: RulerControls, label: 'Ruler' }],\n  [Tools.Polygon, { component: PolygonControls, label: 'Polygon' }],\n  [Tools.Paint, { component: PaintControls, label: 'Paint' }],\n]);\n\nconst tool = computed(() => tools.get(toolStore.currentTool));\n</script>\n\n<template>\n  <div v-if=\"tool\">\n    <div class=\"header\">{{ tool.label }}</div>\n    <div class=\"content\">\n      <component :is=\"tool.component\" />\n    </div>\n  </div>\n</template>\n\n<style scoped src=\"./styles/annotations.css\"></style>\n","<script setup lang=\"ts\">\nimport { useRulerStore } from '@/src/store/tools/rulers';\nimport { AnnotationTool } from '../types/annotation-tool';\n\ndefineProps<{\n  tool: AnnotationTool & { axis: string };\n}>();\n\nconst toolStore = useRulerStore();\n</script>\n\n<template>\n  <v-row>\n    <v-col cols=\"4\">Slice: {{ tool.slice + 1 }}</v-col>\n    <v-col cols=\"4\">Axis: {{ tool.axis }}</v-col>\n    <v-col>\n      Length:\n      <span class=\"value\">\n        {{ toolStore.lengthByID[tool.id].toFixed(2) }}mm\n      </span>\n    </v-col>\n  </v-row>\n</template>\n","<script setup lang=\"ts\">\nimport { ref, watch } from 'vue';\nimport { storeToRefs } from 'pinia';\nimport { AnnotationToolType, Tools } from '@/src/store/tools/types';\nimport { useToolStore } from '@/src/store/tools';\nimport MeasurementsToolList from './MeasurementsToolList.vue';\nimport SegmentGroupControls from './SegmentGroupControls.vue';\nimport ToolControls from './ToolControls.vue';\nimport MeasurementRulerDetails from './MeasurementRulerDetails.vue';\n\nconst Tabs = {\n  Measurements: 'measurements',\n  SegmentGroups: 'segmentGroups',\n};\n\nconst MeasurementTools = [\n  {\n    type: AnnotationToolType.Ruler,\n    icon: 'mdi-ruler',\n    details: MeasurementRulerDetails,\n  },\n  {\n    type: AnnotationToolType.Rectangle,\n    icon: 'mdi-vector-square',\n  },\n  {\n    type: AnnotationToolType.Polygon,\n    icon: 'mdi-pentagon-outline',\n  },\n];\n\nconst MeasurementToolTypes = new Set<string>(\n  MeasurementTools.map(({ type }) => type)\n);\n\nconst tab = ref(Tabs.SegmentGroups);\nconst { currentTool } = storeToRefs(useToolStore());\n\nfunction autoFocusTab() {\n  if (currentTool.value === Tools.Paint) {\n    tab.value = Tabs.SegmentGroups;\n  } else if (MeasurementToolTypes.has(currentTool.value)) {\n    tab.value = Tabs.Measurements;\n  }\n}\n\nwatch(\n  currentTool,\n  () => {\n    autoFocusTab();\n  },\n  { immediate: true }\n);\n</script>\n\n<template>\n  <div class=\"overflow-y-auto mx-2 fill-height\">\n    <tool-controls />\n    <v-divider thickness=\"4\" />\n    <v-tabs v-model=\"tab\" align-tabs=\"center\" density=\"compact\" class=\"my-1\">\n      <v-tab value=\"segmentGroups\" class=\"tab-header\">Segment Groups</v-tab>\n      <v-tab value=\"measurements\" class=\"tab-header\">Measurements</v-tab>\n    </v-tabs>\n    <v-window v-model=\"tab\">\n      <v-window-item value=\"segmentGroups\">\n        <segment-group-controls />\n      </v-window-item>\n      <v-window-item value=\"measurements\">\n        <measurements-tool-list :tools=\"MeasurementTools\" />\n      </v-window-item>\n    </v-window>\n  </div>\n</template>\n\n<style scoped>\n.tab-header {\n  font-size: 0.8rem;\n}\n</style>\n\n<style scoped src=\"./styles/annotations.css\"></style>\n","<script setup lang=\"ts\">\nimport { computed, ref } from 'vue';\nimport { useCurrentImage } from '@/src/composables/useCurrentImage';\nimport { useServerStore, ConnectionState } from '@/src/store/server';\n\nconst serverStore = useServerStore();\nconst { client } = serverStore;\nconst ready = computed(\n  () => serverStore.connState === ConnectionState.Connected\n);\n\n// --- adding --- //\n\nconst sum = ref(0);\nconst sumOp1 = ref(0);\nconst sumOp2 = ref(0);\nconst doSumLoading = ref(false);\n\nconst doSum = async () => {\n  doSumLoading.value = true;\n  try {\n    sum.value = await client.call('add', [sumOp1.value, sumOp2.value]);\n  } finally {\n    doSumLoading.value = false;\n  }\n};\n\n// --- number trivia --- //\n\nconst trivia = ref('');\nconst triviaLoading = ref(false);\n\nconst getTrivia = async () => {\n  triviaLoading.value = true;\n  try {\n    trivia.value = (await client.call('number_trivia')) as string;\n  } finally {\n    triviaLoading.value = false;\n  }\n};\n\n// --- stream test --- //\n\nconst streamProgress = ref(0);\nconst streamLoading = ref(false);\n\nconst streamProgressText = computed(() => {\n  const p = streamProgress.value;\n  return p < 100 ? p : 'Done!';\n});\n\ntype StreamData = { progress: number };\n\nconst onStreamData = (data: StreamData) => {\n  const { progress } = data;\n  streamProgress.value = progress;\n  if (progress === 100) {\n    streamLoading.value = false;\n  }\n};\n\nconst startStream = async () => {\n  streamLoading.value = true;\n  await client.stream('progress', onStreamData);\n};\n\n// --- median filter --- //\n\nconst medianFilterLoading = ref(false);\nconst { currentImageID } = useCurrentImage();\nconst medianFilterRadius = ref(2);\n\nconst doMedianFilter = async () => {\n  const id = currentImageID.value;\n  if (!id) return;\n\n  medianFilterLoading.value = true;\n  try {\n    await client.call('medianFilter', [id, medianFilterRadius.value]);\n  } finally {\n    medianFilterLoading.value = false;\n  }\n};\n\nconst hasCurrentImage = computed(() => !!currentImageID.value);\n</script>\n\n<template>\n  <div class=\"overflow-y-auto overflow-x-hidden ma-2 fill-height\">\n    <v-alert v-if=\"!ready\" color=\"info\">Not connected to the server.</v-alert>\n    <v-divider />\n    <v-list-subheader>Add numbers</v-list-subheader>\n    <v-row class=\"pb-3\">\n      <v-col cols=\"3\">\n        <v-text-field\n          :model-value=\"sumOp1\"\n          @update:model-value=\"sumOp1 = Number($event || 0)\"\n          type=\"number\"\n          variant=\"outlined\"\n          density=\"compact\"\n          hide-details\n          placeholder=\"0\"\n        />\n      </v-col>\n      <v-col cols=\"1\" class=\"d-flex flex-row align-center\">+</v-col>\n      <v-col cols=\"3\">\n        <v-text-field\n          :model-value=\"sumOp2\"\n          @update:model-value=\"sumOp2 = Number($event || 0)\"\n          type=\"number\"\n          variant=\"outlined\"\n          density=\"compact\"\n          hide-details\n          placeholder=\"0\"\n        />\n      </v-col>\n      <v-col cols=\"1\" class=\"d-flex flex-row align-center\">\n        <v-btn @click=\"doSum\" :loading=\"doSumLoading\" :disabled=\"!ready\">\n          =>\n        </v-btn>\n        <span class=\"ml-3\">{{ sum }}</span>\n      </v-col>\n    </v-row>\n    <v-divider />\n    <v-list-subheader>Trivia</v-list-subheader>\n    <v-row>\n      <v-btn @click=\"getTrivia\" :loading=\"triviaLoading\" :disabled=\"!ready\">\n        Random number trivia\n      </v-btn>\n    </v-row>\n    <v-row>\n      <v-col>\n        <label for=\"remote-trivia-text\">\n          <textarea\n            id=\"remote-trivia-text\"\n            readonly\n            class=\"text-white\"\n            style=\"width: 100%\"\n            :value=\"trivia\"\n          />\n        </label>\n      </v-col>\n    </v-row>\n    <v-divider />\n    <v-list-subheader>Progress</v-list-subheader>\n    <v-row class=\"mb-4\">\n      <v-col>\n        <v-btn @click=\"startStream\" :loading=\"streamLoading\" :disabled=\"!ready\">\n          Start progress\n        </v-btn>\n        <span class=\"ml-3\"> Progress: {{ streamProgressText }} </span>\n      </v-col>\n    </v-row>\n    <v-divider />\n    <v-list-subheader>Median Filter</v-list-subheader>\n    <div>\n      <v-row>\n        <v-col cols=\"3\">\n          <v-text-field\n            :model-value=\"medianFilterRadius\"\n            @update:model-value=\"medianFilterRadius = Number($event || 0)\"\n            type=\"number\"\n            variant=\"outlined\"\n            density=\"compact\"\n            hide-details\n            placeholder=\"1\"\n          />\n        </v-col>\n        <v-col>\n          <v-btn\n            @click=\"doMedianFilter\"\n            :loading=\"medianFilterLoading\"\n            :disabled=\"!ready || !hasCurrentImage\"\n          >\n            Run Median Filter\n          </v-btn>\n          <span v-if=\"!hasCurrentImage\" class=\"ml-4 body-2\">\n            No image loaded\n          </span>\n        </v-col>\n      </v-row>\n    </div>\n  </div>\n</template>\n","<template>\n  <div class=\"fill-height d-flex flex-column\">\n    <div id=\"module-switcher\">\n      <v-tabs\n        id=\"module-switcher-tabs\"\n        v-model=\"selectedModuleIndex\"\n        icons-and-text\n        show-arrows\n      >\n        <v-tab\n          v-for=\"item in modules\"\n          :key=\"item.name\"\n          :data-testid=\"`module-tab-${item.name}`\"\n          :disabled=\"item.disabled\"\n        >\n          <div class=\"tab-content\">\n            <span class=\"mb-0 mt-1 module-text\">{{ item.name }}</span>\n            <v-icon>mdi-{{ item.icon }}</v-icon>\n          </div>\n        </v-tab>\n      </v-tabs>\n    </div>\n    <div id=\"module-container\">\n      <v-window v-model=\"selectedModuleIndex\" touchless class=\"fill-height\">\n        <v-window-item\n          v-for=\"mod in modules\"\n          :key=\"mod.name\"\n          class=\"fill-height\"\n        >\n          <component\n            :key=\"mod.name\"\n            v-show=\"modules[selectedModuleIndex] === mod\"\n            :is=\"mod.component\"\n          />\n        </v-window-item>\n      </v-window>\n    </div>\n  </div>\n</template>\n\n<script lang=\"ts\">\nimport { Component, computed, defineComponent, ref, watch } from 'vue';\n\nimport { ConnectionState, useServerStore } from '@/src/store/server';\nimport DataBrowser from './DataBrowser.vue';\nimport RenderingModule from './RenderingModule.vue';\nimport AnnotationsModule from './AnnotationsModule.vue';\nimport ServerModule from './ServerModule.vue';\nimport { useToolStore } from '../store/tools';\nimport { Tools } from '../store/tools/types';\n\ninterface Module {\n  name: string;\n  icon: string;\n  component: Component;\n  disabled?: boolean;\n}\n\nconst Modules: Module[] = [\n  {\n    name: 'Data',\n    icon: 'database',\n    component: DataBrowser,\n  },\n  {\n    name: 'Annotations',\n    icon: 'pencil',\n    component: AnnotationsModule,\n  },\n  {\n    name: 'Rendering',\n    icon: 'cube',\n    component: RenderingModule,\n  },\n  {\n    name: 'Remote',\n    icon: 'server-network',\n    component: ServerModule,\n  },\n];\n\nconst autoSwitchToAnnotationsTools = [\n  Tools.Rectangle,\n  Tools.Ruler,\n  Tools.Polygon,\n  Tools.Paint,\n];\n\nexport default defineComponent({\n  name: 'ModulePanel',\n  setup() {\n    const selectedModuleIndex = ref(0);\n\n    const toolStore = useToolStore();\n    watch(\n      () => toolStore.currentTool,\n      (newTool) => {\n        if (autoSwitchToAnnotationsTools.includes(newTool))\n          selectedModuleIndex.value = 1;\n      }\n    );\n\n    const serverStore = useServerStore();\n    const modules = computed(() => {\n      if (!serverStore.url) {\n        return Modules.filter((m) => m.name !== 'Remote');\n      }\n\n      if (serverStore.connState === ConnectionState.Connected) {\n        return Modules;\n      }\n\n      return Modules.map((m) => {\n        if (m.name === 'Remote') {\n          return { ...m, disabled: true };\n        }\n        return m;\n      });\n    });\n\n    return {\n      selectedModuleIndex,\n      modules,\n    };\n  },\n});\n</script>\n\n<style scoped>\n#module-switcher {\n  display: relative;\n  flex: 0 2;\n  /* roughly match vuetify's dark/light transition */\n  transition: border-bottom 0.3s;\n  border-bottom: 2px solid rgb(var(--v-theme-on-surface-variant));\n}\n\n#close-btn {\n  position: absolute;\n  top: 1.5em;\n  left: 0.5em;\n  z-index: 10;\n}\n\n#module-container {\n  position: relative;\n  flex: 2;\n  overflow: auto;\n}\n\n.module-text {\n  font-size: 0.6rem;\n  white-space: pre;\n}\n\n.tab-content {\n  display: flex;\n  justify-content: flex-end;\n  flex-direction: column-reverse;\n  height: 100%;\n  align-items: center;\n}\n\n#module-switcher-tabs :deep(.v-slide-group__content) {\n  justify-content: center;\n}\n\n#module-switcher-tabs\n  :deep(.v-slide-group__prev.v-slide-group__prev--disabled) {\n  visibility: hidden;\n}\n\n#module-switcher-tabs\n  :deep(.v-slide-group__next.v-slide-group__next--disabled) {\n  visibility: hidden;\n}\n</style>\n","<template>\n  <div\n    v-on:dragover.prevent=\"onDragOver\"\n    v-on:dragleave=\"onDragLeave\"\n    v-on:drop.prevent=\"onDrop\"\n    v-bind=\"$attrs\"\n  >\n    <slot :dragHover=\"dragHover\" />\n  </div>\n</template>\n\n<script>\nasync function readAllDirEntries(dirEntry) {\n  const reader = dirEntry.createReader();\n  const allEntries = [];\n  let entries = [];\n  do {\n    // eslint-disable-next-line no-await-in-loop\n    entries = await new Promise((resolve, reject) => {\n      reader.readEntries(resolve, reject);\n    });\n    allEntries.push(...entries);\n  } while (entries.length);\n  return allEntries;\n}\n\nasync function entryToFile(fileEntry) {\n  return new Promise((resolve, reject) => {\n    fileEntry.file(resolve, reject);\n  });\n}\n\nasync function readAllFiles(entries) {\n  const toProcess = [...entries];\n  const fileEntries = [];\n  while (toProcess.length) {\n    const entry = toProcess.shift();\n    if (entry.isFile) {\n      fileEntries.push(entry);\n    } else {\n      // eslint-disable-next-line no-await-in-loop\n      toProcess.push(...(await readAllDirEntries(entry)));\n    }\n  }\n  return Promise.all(fileEntries.map(entryToFile));\n}\n\nexport default {\n  name: 'DragAndDrop',\n  props: {\n    enabled: Boolean,\n  },\n  data() {\n    return {\n      dragHover: false,\n    };\n  },\n  methods: {\n    onDragOver(ev) {\n      if (this.enabled) {\n        ev.preventDefault();\n\n        const { types } = ev.dataTransfer;\n        if (\n          types && types instanceof Array\n            ? types.indexOf('Files') !== -1\n            : 'Files' in types\n        ) {\n          this.dragHover = true;\n          if (this.dragTimeout !== null) {\n            window.clearTimeout(this.dragTimeout);\n            this.dragTimeout = null;\n          }\n        }\n      }\n    },\n    onDragLeave() {\n      if (this.enabled) {\n        this.dragTimeout = window.setTimeout(() => {\n          this.dragHover = false;\n          this.dragTimeout = null;\n        }, 50);\n      }\n    },\n    async onDrop(ev) {\n      if (this.enabled) {\n        this.dragHover = false;\n        if (ev.dataTransfer.items) {\n          const entries = [...ev.dataTransfer.items]\n            .map((item) => {\n              const getAsEntry = item.webkitGetAsEntry || item.getAsEntry;\n              return getAsEntry.call(item);\n            })\n            .filter(Boolean);\n          const files = await readAllFiles(entries);\n          this.$emit('drop-files', files);\n        } else {\n          this.$emit('drop-files', Array.from(ev.dataTransfer.files));\n        }\n      }\n    },\n  },\n  created() {\n    // used to debounce dragover\n    this.dragTimeout = null;\n  },\n};\n</script>\n","<template>\n  <closeable-dialog v-model=\"keyboardStore.settingsOpen\">\n    <v-card class=\"pa-4\">\n      <div class=\"text-h4 pb-2\">View Controls</div>\n      <v-table>\n        <tbody>\n          <tr>\n            <td>Scroll Slices</td>\n            <td>Mouse wheel or 2 finger vertical scroll</td>\n          </tr>\n          <tr>\n            <td>Zoom</td>\n            <td>Right mouse button + move vertically</td>\n          </tr>\n          <tr>\n            <td>Pan</td>\n            <td>Shift + left mouse button + move</td>\n          </tr>\n        </tbody>\n      </v-table>\n\n      <div class=\"text-h4 pb-2\">Keyboard Shortcuts</div>\n      <v-table>\n        <tbody>\n          <tr v-for=\"[action, key] in bindings\" :key=\"action\">\n            <td>{{ action }}</td>\n            <td class=\"keybinding\">{{ key }}</td>\n          </tr>\n        </tbody>\n      </v-table>\n    </v-card>\n  </closeable-dialog>\n</template>\n\n<script setup lang=\"ts\">\nimport { computed } from 'vue';\nimport { actionToKey } from '@/src/composables/useKeyboardShortcuts';\nimport { ACTIONS } from '@/src/constants';\nimport { useKeyboardShortcutsStore } from '@/src/store/keyboard-shortcuts';\nimport CloseableDialog from './CloseableDialog.vue';\nimport { getEntries } from '../utils';\n\nconst keyboardStore = useKeyboardShortcutsStore();\n\nconst bindings = computed(() =>\n  getEntries(actionToKey.value).map(([action, key]) => [\n    ACTIONS[action].readable,\n    key,\n  ])\n);\n</script>\n\n<style scoped>\n.keybinding {\n  font-family: monospace;\n}\n</style>\n","import { onBeforeUnmount, onMounted } from 'vue';\nimport { captureException } from '@sentry/vue';\nimport { useMessageStore } from '../store/messages';\n\nexport function useGlobalErrorHook() {\n  const messageStore = useMessageStore();\n\n  const onError = (event: ErrorEvent) => {\n    console.error(event);\n    const errorMessage = event.message ?? 'Unknown global error';\n\n    captureException(event.error ?? errorMessage);\n\n    const details = event.error ? event.error : { details: errorMessage };\n    messageStore.addError('Application error (click for details)', details);\n  };\n\n  onMounted(() => {\n    window.addEventListener('error', onError);\n  });\n\n  onBeforeUnmount(() => {\n    window.removeEventListener('error', onError);\n  });\n}\n","import { setGlobalHeader } from '@/src/utils/fetch';\nimport vtkURLExtract from '@kitware/vtk.js/Common/Core/URLExtract';\nimport { UrlParams } from '@vueuse/core';\n\nexport function stripTokenFromUrl() {\n  const params = new URLSearchParams(window.location.search);\n  const url = new URL(window.location.toString());\n  params.delete('token');\n  url.search = `?${params.toString()}`;\n  window.history.replaceState(null, '', url.toString());\n}\n\nexport function populateAuthorizationToken() {\n  const urlParams = vtkURLExtract.extractURLParameters() as UrlParams;\n\n  if (urlParams.token) {\n    setGlobalHeader('Authorization', `Bearer ${urlParams.token}`);\n  }\n\n  if (urlParams.tokenUrl) {\n    fetch(String(urlParams.tokenUrl), {\n      method: String(urlParams.tokenUrlMethod || 'GET'),\n    })\n      .then((response) => {\n        if (response.status % 100 !== 2) {\n          throw new Error('received non-200 response');\n        }\n        return response.text();\n      })\n      .then((text) => {\n        setGlobalHeader('Authorization', `Bearer ${text}`);\n      })\n      .catch((err) => {\n        console.error('error while fetching token from tokenUrl:', err);\n      });\n  }\n}\n","<template>\n  <drag-and-drop enabled @drop-files=\"loadFiles\" id=\"app-container\">\n    <template v-slot=\"{ dragHover }\">\n      <v-app>\n        <app-bar @click:left-menu=\"leftSideBar = !leftSideBar\"></app-bar>\n        <v-navigation-drawer\n          v-model=\"leftSideBar\"\n          app\n          clipped\n          touchless\n          width=\"450\"\n          id=\"left-nav\"\n        >\n          <module-panel @close=\"leftSideBar = false\" />\n        </v-navigation-drawer>\n        <v-main id=\"content-main\">\n          <div class=\"fill-height d-flex flex-row flex-grow-1\">\n            <controls-strip :has-data=\"hasData\"></controls-strip>\n            <div class=\"d-flex flex-column flex-grow-1\">\n              <layout-grid v-show=\"hasData\" :layout=\"layout\" />\n              <welcome-page\n                v-if=\"!hasData\"\n                :loading=\"showLoading\"\n                class=\"clickable\"\n                @click=\"loadUserPromptedFiles\"\n              >\n              </welcome-page>\n            </div>\n          </div>\n        </v-main>\n        <controls-modal />\n      </v-app>\n      <persistent-overlay\n        :disabled=\"!dragHover\"\n        color=\"#000\"\n        :opacity=\"0.3\"\n        :z-index=\"2000\"\n        class=\"text-center\"\n      >\n        <div class=\"d-flex flex-column align-center justify-center h-100\">\n          <div class=\"dnd-prompt\">\n            <v-icon size=\"4.75rem\">mdi-download</v-icon>\n            <div class=\"text-h2 font-weight-bold\">Drop your files to open</div>\n          </div>\n        </div>\n      </persistent-overlay>\n    </template>\n  </drag-and-drop>\n</template>\n\n<script lang=\"ts\">\nimport { computed, defineComponent, onMounted, ref, watch } from 'vue';\nimport { storeToRefs } from 'pinia';\nimport { UrlParams } from '@vueuse/core';\nimport vtkURLExtract from '@kitware/vtk.js/Common/Core/URLExtract';\nimport { useDisplay } from 'vuetify';\nimport useLoadDataStore from '@/src/store/load-data';\nimport { useViewStore } from '@/src/store/views';\nimport useRemoteSaveStateStore from '@/src/store/remote-save-state';\nimport AppBar from '@/src/components/AppBar.vue';\nimport ControlsStrip from '@/src/components/ControlsStrip.vue';\nimport {\n  loadFiles,\n  loadUserPromptedFiles,\n  loadUrls,\n} from '@/src/actions/loadUserFiles';\nimport WelcomePage from '@/src/components/WelcomePage.vue';\nimport { useDICOMStore } from '@/src/store/datasets-dicom';\nimport LayoutGrid from '@/src/components/LayoutGrid.vue';\nimport ModulePanel from '@/src/components/ModulePanel.vue';\nimport DragAndDrop from '@/src/components/DragAndDrop.vue';\nimport PersistentOverlay from '@/src/components/PersistentOverlay.vue';\nimport ControlsModal from '@/src/components/ControlsModal.vue';\nimport {\n  defaultImageMetadata,\n  useImageStore,\n} from '@/src/store/datasets-images';\nimport { useServerStore } from '@/src/store/server';\nimport { useGlobalErrorHook } from '@/src/composables/useGlobalErrorHook';\nimport { useKeyboardShortcuts } from '@/src/composables/useKeyboardShortcuts';\nimport { useCurrentImage } from '@/src/composables/useCurrentImage';\nimport {\n  populateAuthorizationToken,\n  stripTokenFromUrl,\n} from '@/src/utils/token';\n\nexport default defineComponent({\n  name: 'App',\n\n  components: {\n    ControlsStrip,\n    LayoutGrid,\n    DragAndDrop,\n    ModulePanel,\n    PersistentOverlay,\n    ControlsModal,\n    WelcomePage,\n    AppBar,\n  },\n\n  setup() {\n    const imageStore = useImageStore();\n    const dicomStore = useDICOMStore();\n\n    useGlobalErrorHook();\n    useKeyboardShortcuts();\n\n    // --- file handling --- //\n\n    const loadDataStore = useLoadDataStore();\n    const hasData = computed(\n      () =>\n        imageStore.idList.length > 0 ||\n        Object.keys(dicomStore.volumeInfo).length > 0\n    );\n    // show loading if actually loading or has any data,\n    // since the welcome screen shouldn't be visible when\n    // a dataset is opened.\n    const showLoading = computed(\n      () => loadDataStore.isLoading || hasData.value\n    );\n\n    const { currentImageMetadata, isImageLoading } = useCurrentImage();\n    const defaultImageMetadataName = defaultImageMetadata().name;\n    watch(currentImageMetadata, (newMetadata) => {\n      let prefix = '';\n      if (\n        newMetadata?.name &&\n        // wait until we get a real name, but if we never do, show default name\n        (newMetadata.name !== defaultImageMetadataName || !isImageLoading)\n      ) {\n        prefix = `${newMetadata.name} -`;\n      }\n      document.title = `${prefix}VolView`;\n    });\n\n    // --- parse URL -- //\n\n    populateAuthorizationToken();\n    stripTokenFromUrl();\n\n    const urlParams = vtkURLExtract.extractURLParameters() as UrlParams;\n\n    onMounted(() => {\n      if (!urlParams.urls) {\n        return;\n      }\n\n      loadUrls(urlParams);\n    });\n\n    // --- remote server --- //\n\n    const serverStore = useServerStore();\n\n    onMounted(() => {\n      serverStore.connect();\n    });\n\n    // --- save state --- //\n    if (import.meta.env.VITE_ENABLE_REMOTE_SAVE && urlParams.save) {\n      const url = Array.isArray(urlParams.save)\n        ? urlParams.save[0]\n        : urlParams.save;\n      useRemoteSaveStateStore().setSaveUrl(url);\n    }\n\n    // --- layout --- //\n\n    const { layout } = storeToRefs(useViewStore());\n\n    // --- //\n\n    const display = useDisplay();\n\n    return {\n      leftSideBar: ref(!display.mobile.value),\n      loadUserPromptedFiles,\n      loadFiles,\n      hasData,\n      showLoading,\n      layout,\n    };\n  },\n});\n</script>\n\n<style>\n#content-main {\n  /* disable v-content transition when we resize our app drawer */\n  transition: initial;\n  width: 100%;\n  height: 100%;\n  position: fixed;\n}\n\n#left-nav {\n  border-right: 1px solid rgb(var(--v-theme-background));\n}\n\n#content-main > .v-content__wrap {\n  display: flex;\n}\n\n#module-switcher .v-input__prepend-inner {\n  /* better icon alignment */\n  margin-top: 15px;\n}\n\n.alert > .v-snack__wrapper {\n  /* transition background color */\n  transition: background-color 0.25s;\n}\n</style>\n\n<style src=\"@/src/components/styles/utils.css\"></style>\n\n<style scoped>\n#app-container {\n  width: 100%;\n  height: 100%;\n}\n\n.dnd-prompt {\n  background: rgba(0, 0, 0, 0.4);\n  color: white;\n  border-radius: 8px;\n  box-shadow: 0px 0px 10px 5px rgba(0, 0, 0, 0.4);\n  padding: 64px;\n}\n</style>\n","import { convertItkToVtkImage } from '@kitware/vtk.js/Common/DataModel/ITKHelper';\nimport { readImage, extensionToImageIo } from '@itk-wasm/image-io';\nimport { getWorker } from '@/src/io/itk/worker';\nimport { FileReaderMap } from '.';\n\nimport { stlReader, vtiReader, vtpReader } from './vtk/async';\nimport { FILE_EXT_TO_MIME } from './mimeTypes';\n\nexport const ITK_IMAGE_MIME_TYPES = Array.from(\n  new Set(\n    Array.from(extensionToImageIo.keys()).map(\n      (ext) => FILE_EXT_TO_MIME[ext.toLowerCase()]\n    )\n  )\n);\n\nasync function itkReader(file: File) {\n  const { image } = await readImage(file, {\n    webWorker: getWorker(),\n  });\n  return convertItkToVtkImage(image);\n}\n\n/**\n * Resets the file reader map to the default values.\n */\nexport function registerAllReaders(readerMap: FileReaderMap) {\n  readerMap.set('application/vnd.unknown.vti', vtiReader);\n  readerMap.set('application/vnd.unknown.vtp', vtpReader);\n  readerMap.set('model/stl', stlReader);\n\n  ITK_IMAGE_MIME_TYPES.forEach((mime) => {\n    readerMap.set(mime, itkReader);\n  });\n}\n","import PaintTool from './tools/paint';\n\n/**\n * Pinia plugin for injecting tool services.\n */\nexport function CorePiniaProviderPlugin({\n  paint,\n}: {\n  paint?: PaintTool;\n} = {}) {\n  const dependencies = {\n    $paint: paint ?? new PaintTool(),\n  };\n  return () => dependencies;\n}\n","/**\n * document.exitPointerLock is undefined on iOS.\n * - Tested on iOS Safari 15.6.1.\n */\nexport function patchExitPointerLock() {\n  const { exitPointerLock } = document;\n  document.exitPointerLock = () => {\n    try {\n      exitPointerLock?.call(document);\n    } catch (e) {\n      // ignore if undefined\n    }\n  };\n}\n","import 'vue-toastification/dist/index.css';\nimport 'vuetify/lib/styles/main.css';\nimport '@/src/global.css';\n\nimport '@kitware/vtk.js/Rendering/OpenGL/Profiles/Geometry';\nimport '@kitware/vtk.js/Rendering/OpenGL/Profiles/Volume';\nimport '@kitware/vtk.js/Rendering/OpenGL/Profiles/Glyph';\n\nimport { createApp } from 'vue';\nimport VueToast from 'vue-toastification';\nimport { createPinia } from 'pinia';\nimport vtkMapper from '@kitware/vtk.js/Rendering/Core/Mapper';\n\nimport { setPipelinesBaseUrl, setPipelineWorkerUrl } from 'itk-wasm';\nimport { setPipelinesBaseUrl as imageIoSetPipelinesBaseUrl } from '@itk-wasm/image-io';\nimport itkConfig from '@/src/io/itk/itkConfig';\n\nimport App from './components/App.vue';\nimport vuetify from './plugins/vuetify';\nimport { FILE_READERS } from './io';\nimport { registerAllReaders } from './io/readers';\nimport { CorePiniaProviderPlugin } from './core/provider';\nimport { patchExitPointerLock } from './utils/hacks';\nimport { init as initErrorReporting } from './utils/errorReporting';\nimport { StoreRegistry } from './plugins/storeRegistry';\nimport { initItkWorker } from './io/itk/worker';\n\n// patches\npatchExitPointerLock();\n\ninitItkWorker();\n\n// Initialize global mapper topologies\n// polys and lines in the front\nvtkMapper.setResolveCoincidentTopologyToPolygonOffset();\nvtkMapper.setResolveCoincidentTopologyPolygonOffsetParameters(-3, -3);\nvtkMapper.setResolveCoincidentTopologyLineOffsetParameters(-3, -3);\n\nregisterAllReaders(FILE_READERS);\n\n// Must be set at runtime as new version of @itk-wasm/dicom and @itk-wasm/image-io\n// do not pickup build time `../itkConfig` alias remap.\nsetPipelinesBaseUrl(itkConfig.pipelinesUrl);\nsetPipelineWorkerUrl(itkConfig.pipelineWorkerUrl);\nimageIoSetPipelinesBaseUrl(itkConfig.imageIOUrl);\n\nconst pinia = createPinia();\npinia.use(CorePiniaProviderPlugin({}));\npinia.use(StoreRegistry);\n\nconst app = createApp(App);\n\ninitErrorReporting(app);\n\napp.use(pinia);\napp.use(VueToast);\napp.use(vuetify);\napp.mount('#app');\n"],"names":["fullUrl","relative","u","origin","pathParts","itkConfig","SPECIAL_SCHEME_RE","WriteableURL","url","base","proto","re","parseUrl","parsed","identity","arg","defer","innerResolve","innerReject","resolve","value","reject","reason","res","rej","removeFromArray","arr","el","idx","clampValue","min","max","pick","obj","keys","o","k","partition","predicate","partitioned","val","partitionIndex","partitionByType","guard","ret","ensureDefault","key","records","default_","arrayEquals","a","b","i","arrayEqualsWithComparator","cmp","wrapInArray","maybeArray","formatBytes","bytes","decimals","dm","sizes","roundIfCloseToInteger","eps","EPSILON","rounded","hasKey","remapKeys","keyMap","omit","ensureError","cleanUndefined","cleaned","zodEnumFromObjKeys","firstKey","otherKeys","z","nonNullable","TypedArrayConstructorNames","getEntries","normalizeForStore","objects","order","byKey","acc","MessageType","MessageType2","useMessageStore","defineStore","id","msg","title","opts","details","options","logError","error","cur","debug","NOOP","toast","createToastInterface","useToast","NotificationMessages","LoadingToastOptions","TYPE","useLoadingNotifications","messageStore","loadingCount","ref","loadingError","startLoading","stopLoading","setError","err","toastID","showLoadingToast","showResults","watch","count","computed","useLoadDataStore","isLoading","MRICardiacThumbnail","MRIPROSTATExThumbnail","MRAHeadThumbnail","CTAHeadThumbnail","USFetusThumbnail","LayoutDirection","InitViewIDs","InitViewSpecs","DefaultViewSpec","DefaultLayoutName","Layouts","layouts","layout","SAMPLE_DATA","TOOL_COLORS","STROKE_WIDTH_ANNOTATION_TOOL_DEFAULT","RULER_LABEL_DEFAULTS","RECTANGLE_LABEL_DEFAULTS","POLYGON_LABEL_DEFAULTS","DEFAULT_PRESET_BY_MODALITY","DEFAULT_PRESET","LAYER_PRESET_BY_MODALITY","LAYER_PRESET_DEFAULT","ACTION_TO_KEY","DEFAULT_SEGMENT_MASKS","CATEGORICAL_COLORS","patchDoubleKeyRecord","record","k1","k2","patch","deleteSecondKey","getDoubleKeyRecord","_a","START_ID","useIdStore","LPSAxes","createLPSPoint","createLPSBounds","getAxisBounds","bounds","axis","directions","index","getLPSAxisFromDir","dir","getVTKViewTypeFromLPSAxis","ViewTypes","defaultLPSDirections","vec3.fromValues","getLPSDirections","direction","availableCols","availableRows","lpsDirs","bestValue","bestValueLoc","removeIndices","col","colIdx","row","rowIdx","axisVector","vecSign","posVector","c","negVector","AnnotationToolType","Tools","DatasetType","DatasetTypeNative","LPSAxisDir","Dataset","baseRemoteFileSchema","RemoteFile","LayoutDirectionNative","Layout","Vector3","WindowLevelConfig","SliceConfig","CameraConfig","ColorBy","PiecewiseGaussian","PiecewiseNode","OpacityGaussians","vtkPiecewiseFunctionProxy","OpacityPoints","OpacityNodes","OpacityFunction","ColorTransferFunction","CVRConfig","VolumeColorConfig","BlendConfig","LayersConfig","SegmentGroupConfig","ViewConfig","View","RGBAColor","SegmentMask","SegmentGroupMetadata","LabelMap","FrameOfReference","annotationTool","makeToolEntry","tool","Ruler","Rulers","Rectangle","Rectangles","Polygon","Polygons","Crosshairs","ToolsEnumNative","ToolsEnum","Paint","LPSCroppingPlanes","Cropping","ParentToLayers","ManifestSchema","fileToDataSource","file","uriToDataSource","uri","name","remoteFileToDataSource","isRemoteDataSource","ds","getDataSourceName","sources","first","more","serializeDataSource","output","useFileStore","state","dataID","files","serializeData","stateFile","dataIDs","dataType","fileStore","zip","datasets","remoteFiles","remotes","toZip","dataPath","filePath","RELAXED_EPSILON","getImageWorldCorners","im","extent","worldCorners","j","compareImageSpaces","im1","im2","corners1","corners2","p1","p2","areEquals","defaultImageMetadata","mat3.create","vec3.create","mat4.create","useImageStore","imageData","useId","metadata","dataFirst","DEFAULT_NUM_WORKERS","readDicomSeriesWorkerPool","webWorker","ensureWorker","getDefaultWebWorker","ensureDicomSeriesWorkerPool","numberOfWorkers","WorkerPool","readImageDicomFileSeriesWorkerFunction","getWorker","getDicomSeriesWorkerPool","initItkWorker","readDicomTags","readImage","sanitizeFileName","sanitizeFile","runTask","module","args","inputs","outputs","runPipeline","splitAndSort","instances","mapToBlob","instance","buffer","InterfaceTypes","fd","result","volumeToFileIndexes","volumeKey","fileIndexes","fileIndex","readTags","tags","tagsArgs","tag","tagValues","info","t","readVolumeSlice","asThumbnail","buildSegmentGroups","inputImage","readOverlappingSegmentation","buildImage","seriesFiles","inputImages","readImageDicomFileSeries","ANONYMOUS_PATIENT","ANONYMOUS_PATIENT_ID","imageCacheMultiKey","offset","modality","messages","segFile","results","DICOM.buildSegmentGroups","DICOM.buildImage","constructImage","volumeInfo","image","vtkITKHelper","DICOM.readTags","cleanupName","getDisplayName","getWindowLevels","WindowWidth","WindowLevel","widths","levels","w","l","width","useDICOMStore","allFiles","volumeToFiles","DICOM.splitAndSort","volumeDatasetFiles","source","rawTags","patient","study","volume","patientKey","studyKey","volumeKeys","sliceIndex","cacheKey","numSlices","volumeFiles","sliceFile","itkImage","DICOM.readVolumeSlice","NumberOfSlices","middleSlice","forceRebuild","imageStore","alreadyBuilt","buildNeeded","oldImagePromise","newVolumeBuildResults","volumeBuildResults","message","useErrorMessage","task","selectionEquals","isDicomImage","imageID","store","isRegularImage","getImage","images","dicoms","getImageName","getSelectionName","selection","runWasm","pipeline","aImage","splits","splitsArg","tasks","split","taskArgs","num","imageSharedBufferOrCopy","workerPool","imageSplits","r","pipelineOutput","stackImages","resample","fixed","moving","label","labelFlag","size","spacing","ensureSameSpace","target","resampleCandidate","useLayersStore","parentToLayers","layerImages","_addLayer","parent","parentImage","sourceImage","vtkBoundingBox","addLayer","deleteLayer","layers","layerToDelete","layer","getLayers","getLayer","layerID","remove","selectionToRemove","layerStore","serialize","selectionKey","deserialize","manifest","dataIDMap","remapSelection","parentToLayersSerialized","sourceSelectionKeys","sourceKey","useModelStore","polyData","useDatasetStore","dicomStore","layersStore","modelStore","primarySelection","primaryImageID","primaryDataset","dataIndex","idsAsSelections","setPrimarySelection","sel","CurrentImageInjectionKey","getImageSpatialExtent","lpsOrientation","getImageMetadata","getImageData","getIsImageLoading","getImageLayers","useImage","unref","useCurrentImage","storeToRefs","defaultContext","hasInjectionContext","inject","serializeViewConfigV2","viewConfigs","viewConfigStateKey","dataset","views","view","config","viewConfig","configForData","createViewConfigSerializer","defaultSliceConfig","useViewSliceStore","configs","reactive","getConfig","viewID","updateConfig","resetSlice","removeView","removeData","toggleSyncImages","syncState","isSync","sc","updateSyncConfigs","currentImageID","defaultWindowLevelConfig","WL_AUTO_DEFAULT","useWindowingStore","syncAcrossViews","runtimeConfigWindowLevel","setSyncAcrossViews","yn","syncWindowLevel","srcViewID","srcDataID","resetWindowLevel","level","defaults","computeWorldToDisplay","xyz","renderer","_b","x","y","normalizeMouseEventPosition","ev","canvas","scaleX","scaleY","intersectMouseEventWithPlane","normal","position","intersectDisplayWithPlane","worldToSVG","coords","height","getCSSCoordinatesFromEvent","eventData","pokedRenderer","bbox","_c","getShiftedOpacityFromPreset","presetName","effectiveRange","shift","shiftAlpha","preset","vtkColorMaps","points","xmin","xmax","shifted","yVal","getOpacityFunctionFromPreset","getColorFunctionRangeFromPreset","AbsoluteRange","RGBPoints","getOpacityRangeFromPreset","applyPointsToPiecewiseFunction","pwf","range","rescaled","applyNodesToPiecewiseFunction","nodes","n","getPreset","Modality","defaultLayersConfig","useLayerColoringStore","createUpdateFunc","transform","update","updatedConfig","updateColorBy","updateColorTransferFunction","updateOpacityFunction","updateBlendConfig","setColorPreset","imageDataRange","ctRange","opFunc","initConfig","resetColorPreset","useViewCameraStore","disableCameraAutoReset","toggleCameraAutoReset","toggleSyncCameras","DEFAULT_AMBIENT","DEFAULT_DIFFUSE","DEFAULT_SPECULAR","getPresetFromImageModality","volKey","getColorAndOpacityFuncsFromPreset","ctFunc","defaultVolumeColorConfig","useVolumeColoringStore","defaultConfigs","updateCVRParameters","colorFunc","opacityFunc","resetToDefaultColoring","scalars","setDefaults","useViewConfigStore","viewSliceStore","windowingStore","layerColoringStore","viewCameraStore","volumeColoringStore","newDataID","useViewStore","layoutsToProcess","item","viewConfigStore","spec","type","props","viewSpec","dirname","path","p","basename","normalize","join","segments","onImageDeleted","callback","newIndex","oldIndex","deleted","PromiseWorker","worker","transferables","wrappedMsg","deferred","runAsyncVTKReader","readerName","asyncWorker","data","vtk","runAsyncVTKWriter","writerName","dataSet","stlReader","vtiReader","vtpReader","vtiWriter","readImageItk","writeImage","format","copyImage","writeImageItk","vtkImageExtractComponentsFilter","publicAPI","model","inData","outData","inputData","outputData","vtkImageData","components","inputScalars","numInputComponents","inputArray","numPixels","outputNumComponents","outputArray","pixel","vtkDataArray","DEFAULT_VALUES","extend","initialValues","macro","newInstance","vtkImageExtractComponents","vtkLabelMap","originalAPI","from","to","pixels","len","deepEqual","defaultValues","vtkLabelMap$1","LabelmapArrayType","LABELMAP_BACKGROUND_VALUE","makeDefaultSegmentName","makeDefaultSegmentGroupName","baseName","numberer","createLabelmapFromImage","labelmap","convertToUint8","array","uint8Array","getLabelMapScalars","values","toLabelMap","extractEachComponent","input","numComponents","extractComponentsFilter","_","useSegmentGroupStore","metadataByID","orderByParent","getMetadata","segmentGroupID","getSegment","segmentValue","validateSegment","segment","addLabelmap","nextDefaultIndex","pickUniqueName","formatName","parentID","existingNames","meta","nameIndex","newLabelmapFromImage","removeGroup","nextColorIndex","getNextColor","color","decodeSegments","imageId","component","noZeroBackground","convertImageToLabelmap","childImage","matchingParentSpace","labelmapImage","segmentGroupStore","updateMetadata","createNewSegment","addSegment","seg","updateSegment","segmentUpdate","deleteSegment","saveFormat","serialized","vtkImage","serializedImage","stateFiles","labelMaps","segmentGroupIDMap","newLabelmapIDs","labelMap","entry","newID","segmentByGroupID","byValue","segsByID","toRaw","clampRangeToBounds","convertCropBoundaryToPlane","cropBounds","lowerUpper","indexToWorld","orientation","axisIndex","vec3.transformMat4","neg","reorientBoundaryNormals","lowerPlane","upperPlane","lowerToUpper","vec3.sub","vec3.normalize","vec3.negate","croppingPlanesEqual","a1","a2","vec3.equals","useCropStore","getComputedVTKPlanes","planes","plane","vtkPlane","clampCroppingPlanes","lpsBounds","setCropping","setCroppingForAxis","resetCropping","tools","cropping","newImageID","activateTool","deactivateTool","readonly","generateState","vtkStateBuilder","clampPointToBounds","point","widgetBehavior","isDragging","ignoreKey","e","callData","worldCoordsOfPointer","handle","worldToIndex","indexCoordsOfPointer","worldOrigin","indexOrigin","vtkCrosshairsWidget","stateGenerator","viewType","center","vtkPlanePointManipulator","vtkAbstractWidgetFactory","vtkCrosshairsWidget$1","useCrosshairsToolStore","factory","widgetState","active","currentImageMetadata","imagePosition","out","viewStore","currentViewIDs","getWidgetFactory","setPosition","pos","indexPos","sliceConfig","slice","xDim","yDim","zDim","imageBounds","inflate","crosshairs","generateContour","stencil","location","slicingIndex","xdim","ydim","xoffset","yoffset","gridxdim","gridydim","vertices","lines","vertexMap","getOrCreateVertexIndex","indexCoords","worldCoords","getStampPixelAt","gy","gx","v0","v1","vtkPaintBrushContextRepresentation","vtkPolyData","vtkMapper2D","vtkCoordinate","Coordinate","vtkActor2D","actorProperty","DisplayLocation","Representation","vtkWidgetRepresentation","brush","contour","vtkContextRepresentation","vtkPaintBrushContextRepresentation$1","watchStore","getter","cached","unsubscribe","originalDelete","watchState","subscription","computeWorldCoords","event","manipulator","shouldIgnoreEvent","getWorldCoords","isPainting","vtkPaintWidget","vtkPaintWidget$1","rasterizeEllipse","xdiam","ydiam","putPixel","blitLine","x0","x1","start","end","y0","y1","b1","dx","dy","e2","EllipsePaintBrush","scale","scaledSize","ERASE_BRUSH_VALUE","PaintMode","PaintMode2","PaintTool$1","mode","sliceAxis","startPoint","endPoint","brushValue","ijkSlice","labelmapPixels","labelmapDims","jStride","kStride","isInBounds","centerX","centerY","point1","point2","curPoint","ydelta","xdelta","pixelOffset","steps","incX","incY","DEFAULT_BRUSH_SIZE","usePaintToolStore","activeMode","activeSegmentGroupID","activeSegment","brushSize","strokePoints","isActive","activeLabelmap","setMode","setActiveSegmentGroup","getValidSegmentGroupID","segmentGroups","ensureActiveSegmentGroupForImage","setActiveSegment","segValue","setBrushSize","doPaintStroke","lastIndex","lastPoint","prevPoint","setSliceAxis","ensureSegmentGroup","startStroke","indexPoint","vec3.clone","placeStrokePoint","endStroke","paint","defineAnnotationToolStore","setup","tmp","frameOfReferenceToImageSliceAndAxis","frame","epsilon","allowNonIntegralSlice","allowOutOfBoundsSlice","planeNormal","planeOrigin","dimensions","Left","Right","Posterior","Anterior","Superior","Inferior","getSmallestSpacing","getPlaneTransforms","scratchA","scratchB","e1","vtkMath","point3D","v","point2D","useToolSelectionStore","selectionMap","addSelection","clearSelection","removeSelection","toggleSelection","isSelected","labelDefault","useLabels","newLabelDefault","labels","activeLabel","setActiveLabel","nextToolColorIndex","addLabel","deleteLabel","labelIDs","updateLabel","defaultLabels","clearDefaultLabels","findLabel","labelName","mergeLabel","matchingName","existingID","newLabels","annotationToolLabelDefault","makeAnnotationToolDefaults","useAnnotationTool","toolDefaults","initialLabels","toolIDs","toolByID","byID","finishedTools","makePropsFromLabel","labelProps","addTool","removeTool","updateTool","propsFromLabel","jumpToTool","toolID","toolImageFrame","relevantViewIDs","viewDir","serializeTools","rest","deserializeTools","labelIDMap","rulerDefaults","useRulerStore","rulerIDs","rulerByID","rulers","addRuler","updateRuler","removeRuler","jumpToRuler","lengthByID","lengths","firstPoint","secondPoint","distance2BetweenPoints","getPoints","rectangleDefaults","useRectangleStore","toolAPI","ensureVec2","regions","region","usePolygonStore","toPolyLibStructure","polygon","to2D","polygonsOverlap","aGeo","bGeo","polybool","pointEquals","mergeRegions","mergedRegion","candidates","regionIndex","mergedCommonPointIndex","candidateCommonPointIndex","candidate","candidatePointIndex","commonPointIndex","nextPoint","toMerge","oldStart","startWithCommonPoint","mergePolygons","polygons","libPolygons","seg2","comb","unionPolyRegions","singleRegion","firstTool","to3D","toolProps","sameSliceAndLabel","mergable","selectionStore","isPolygonTool","mergeableTools","selectedPolygons","overlapping","overlappingIndex","inTool","mergeTools","mergeGroup","mergedTool","mergeSelectedTools","mergeWithOtherTools","lastTool","olderTools","mergeable","older","AnnotationToolStoreMap","ToolStoreMap","useAnnotationToolStore","useStore","setupTool","teardownTool","useToolStore","FILE_EXT_TO_MIME","FILE_EXTENSIONS","MIME_TYPES","ARCHIVE_FILE_TYPES","FILE_MAGIC_DB","HEAD_CHUNK","prefixEquals","prefix","getFileMimeFromMagic","head","reader","chunk","mime","header","skip","getFileMimeType","fileType","supportedExt","ext","mimeFromMagic","retypeFile","MANIFEST","MANIFEST_VERSION","datasetStore","labelStore","toolStore","JSZip","isStateFile","typedFile","globalHeaders","setGlobalHeader","mergeHeaders","supplementInit","merged","$fetch","init","HTTPHandler","protocol","progress","response","contentLength","recv","done","readData","HANDLERS","canFetchUrl","h","fetchFile","handler","cache","promise","blob","fetchJSON","decoder","useRemoteSaveStateStore","saveUrl","isSaving","stopAllButEscape","close","$emit","display","useDisplay","maxWidth","_sfc_main","_hoisted_2","_openBlock","_createElementBlock","_hoisted_1","_hoisted_19","useKeyboardShortcutsStore","_imports_0","defineComponent","VolViewFullLogo","keyboardStore","_withScopeId","_createElementVNode","_hoisted_12","_hoisted_14","_hoisted_15","_hoisted_16","_hoisted_17","_hoisted_18","_hoisted_20","_hoisted_21","_createBlock","_component_v_card","_createVNode","_component_v_card_title","_component_vol_view_full_logo","_component_v_alert","_component_v_card_text","_component_v_btn","_ctx","_component_v_divider","_component_v_img","_hoisted_3","_hoisted_4","_hoisted_5","_hoisted_6","_hoisted_7","_hoisted_8","_hoisted_9","_hoisted_10","_hoisted_11","_hoisted_13","_component_v_badge","_hoisted_22","_hoisted_23","_hoisted_24","_sfc_render","_cache","mobile","aboutBoxDialog","partitionResults","createPipelineError","cause","DoneSentinel","Pipeline","handlers","extraContext","nestedExecutions","execution","terminate","invokeHandler","doneInvoked","pipelineResult","endOfPipeline","context","innerExtra","thrown","innerResults","succeededInner","failedInner","failedResult","innerErrors","okResult","isArchive","isLoadableResult","importResult","isVolumeResult","isConfigResult","handleDicomFile","dataSource","extra","fileSrc","downloadUrl","execute","uriSrc","extractFilesFromZip","zipFile","promises","paths","relPath","fileName","fileEntry","extractArchive","extractArchiveContents","archiveFile","contentsPromise","mapping","fullPath","path.join","extractArchiveTarget","archiveSrc","archiveCache","archiveContents","targetName","path.normalize","targetFile","isAmazonS3Uri","getObjectPublicUrl","bucket","fetchObjectsWithPagination","onObjectAvailable","client","S3Client","request","paginate","continuationToken","listObjectsCmd","ListObjectsV2Command","extractBucketAndPrefixFromS3Uri","pathname","objectName","getObjectsFromS3","s3Uri","objPrefix","handleAmazonS3","isGoogleCloudStorageUri","extractBucketAndPrefixFromGsUri","getObjectEndpoint","nextToken","page","getObjectsFromGsUri","gsUri","bucketName","handleGoogleCloudStorage","object","FILE_READERS","importSingleFile","dataObject","axisDir","lpsFromDir","lpsOrient","dimMax","RemoteResource","RemoteDataManifest","readRemoteManifestFile","manifestFile","ab","text","handleRemoteManifest","remote","flow","fns","fn","pipe","doneWithDataSource","updateFileMimeType","src","LABELMAP_PALETTE_2_1_0","migrateOrPass","versions","migrationFunc","inputManifest","migrateBefore210","migrate210To300","migrateManifest","manifestString","resolveUriSource","processParentIfNoFile","resolveArchiveMember","getDataSourcesForDataset","stateFileContents","inStateFile","restoreDatasets","datasetFiles","stateDatasetFiles","datasetFile","stateIDToStoreID","resolvePipeline","datasetDataSources","dicomSources","importResults","restoreStateFile","pipelineContext","manifests","restOfStateFile","dataFile","migrated","selectedID","useDataBrowserStore","useSliceConfig","configDefaults","imageIdVal","applyLabelOffset","toolToStore","activeToolStore","activeLabelIndex","nextLabel","setTool","showKeyboardShortcuts","changeSlice","activeViewID","currentSlice","clearScene","deleteCurrentImage","ACTION_TO_FUNC","actionToKey","useKeyboardShortcuts","useMagicKeys","unwatchFuncs","actionMap","unwatch","action","individualKeys","lastKey","whenever","shiftPressed","lastPressedKey","currentKeyWithCase","keyCountMatches","lastKeyMatches","shiftCaseMatches","dataBrowser","shortcuts","ACTIONS","rulerLabel","polygonLabel","rectangleLabel","io","windowing","readConfigFile","configFile","applyLabels","defaultLabelsIfUndefined","toolLabels","applyLabelsToStore","maybeLabels","labelsOrFallback","rulerLabels","rectangleLabels","polygonLabels","applySampleData","applyLayout","startingLayout","applyShortcuts","applyIo","applyWindowing","applyConfig","handleConfig","toMeaningfulErrorString","strThrown","unhandledResource","isSelectable","importConfigs","importDicomFiles","dicomDataSources","resultSources","importDataSources","dataSources","importContext","middleware","extractArchiveTargetFromCache","loader","configResult","dicomResult","toDataSelection","loadable","convertSuccessResultToDataSelection","BASE_MODALITY_TYPES","findBaseDicom","loadableDataSources","baseDicomVolumes","dicomSource","infoA","infoB","priorityDiff","isSegmentation","extension","findBaseImage","segmentGroupExtension","baseImages","filterLoadableDataSources","succeeded","filterMatchingNames","primaryDataSource","primaryName","primaryNamePrefix","hasExtension","nameMatchesPrimary","getStudyUID","volumeID","findBaseDataSource","baseDicom","baseImage","filterOtherVolumesInStudy","targetStudyUID","loadLayers","otherVolumesInStudy","toLayer","layerSelection","loadSegmentations","matchingNames","otherSegVolumesInStudy","loadDataSources","loadDataStore","dataStore","errored","errorMessages","errResult","firstError","failedError","openFileDialog","fileEl","loadFiles","loadUserPromptedFiles","loadUrls","params","urls","names","DEFAULT_FILENAME","_sfc_main$1B","valid","saving","saveSession","saveAs","onMounted","onKeyDown","validFileName","_withCtx","_component_v_form","$event","_withModifiers","_component_v_text_field","_component_v_card_actions","_component_v_spacer","_component_v_icon","classSpec","_mergeProps","$options","$props","_component_v_tooltip","_renderSlot","_sfc_main$1z","_toDisplayString","_createTextVNode","_createCommentVNode","TIMEOUT","_sfc_main$1y","emit","toasts","makeToastOptions","msgID","msgLookup","after","toastMethod","showDetailsButton","MessageNotificationContent","useDicomMetaStore","instanceInfo","instanceKey","studies","parseTag","alpha","parseInstance","withNamedTags","fileCounter","toFile","makeClient","dicomWebRoot","headers","api","searchForStudies","retrieveStudyMetadata","retrieveSeriesMetadata","fetchSeries","progressCallback","fetchInstanceThumbnail","thumbnail","arrayBufferView","LEVELS","deepDicomWebUrl","sansSlash","parentIDs","idObj","dicomLevel","urlLevel","dicomID","pathsToSlice","allPaths","DICOM_WEB_URL_PARAM","isDownloadable","fetchFunctions","levelToFetchKey","levelToMetaKey","useDicomWebStore","VITE_DICOM_WEB_NAME","VITE_DICOM_WEB_URL","hostName","useLocalStorage","hostConfig","vtkURLExtract","savedHost","host","parsedURL","cleanHost","isConfigured","fetchVolumeThumbnail","middleInstance","fetchPatientMeta","studyMeta","seriesMeta","fetchVolumesMeta","volumeMeta","instanceMeta","volumes","downloadVolume","seriesInstanceUID","studyInstanceUID","seriesInfo","loaded","total","loadResult","fetchDicomsProgress","fetchError","linkedToStudyOrSeries","fetchDicoms","deepestLevel","fetchFunc","urlIDs","fetchOptions","fetchedMetas","urlMetaIDs","fetchedMeta","seriesID","lastFetchedHostUrl","fetchDicomsOnce","loadedVolumeKey","_sfc_main$1x","dicomWeb","onUnmounted","AllowedTypedArrays","isTypedArrayName","isImageData","wrapValuesInTypedArray","serializedImageData","arrays","da","serializeVtkImageData","deserializeVtkImageData","DefaultSerializeTransformers","DefaultDeserializeTransformers","transformObject","transformObjects","CHUNK_SIZE","CHUNKED_PACKET_TYPE","isBinary","getLength","allStringChunks","chunks","allArrayBufferChunks","ChunkedEncoder","BaseParser.Encoder","packet","m","chunkedSizes","str","chunkEnd","binary","ChunkedDecoder","BaseParser.Decoder","byteLength","sum","reconstructed","Encoder","Decoder","CLIENT_ID_SIZE","RPC_ID_SIZE","RPC_CALL_EVENT","RPC_RESULT_EVENT","STREAM_CALL_EVENT","STREAM_RESULT_EVENT","RpcOkResultSchema","makeRpcOkResult","RpcErrorResultSchema","makeRpcErrorResult","RpcResultSchema","validateRpcResult","StreamDataResultSchema","StreamResultSchema","validateStreamResult","RpcCallSchema","validateRpcCall","justHostUrl","parts","getSocketIoPath","RpcClient","clearListeners","rpcInfo","rpcId","nanoid","ChunkedParser","cleanup","rpcName","pending","methodName","argsOrCallback","maybeCallback","eventType","payload","deserializedArgs","stores","getPiniaStore","StoreRegistry","restrictServerStore","storeName","restrictPiniaProperties","propPath","RestrictHooks","getStoreProperty","hook","prop","callStoreMethod","StoreApi","VITE_REMOTE_SERVER_URL","ConnectionState","ConnectionState2","useServerStore","connState","connect","disconnect","setUrl","newUrl","markRaw","serverStore","serverUrl","StatusToText","connStatus","toggleConnection","connectBtnText","getContextFromOffscreenCanvas","getContextFromHTMLCanvas","getGPUInfo","gl","dbg","VITE_SENTRY_DSN","LOCAL_STORAGE_KEY","errorReportingConfigured","app","Sentry.init","Sentry.setContext","Sentry.captureException","setEnabled","enabled","Sentry.getCurrentHub","useErrorReporting","disableReportingStorage","disableReporting","_sfc_main$1v","theme","useTheme","ThemeStorageKey","dark","DarkTheme","isDark","LightTheme","errorReportingStore","reportingEnabled","DicomWebSettings","ServerSettings","_component_v_switch","_component_dicom_web_settings","ItemGroupProvider","_sfc_main$1u","slots","modelValue","mandatory","equalsTest","toRefs","internalValue","provide","_sfc_main$1t","itemGroup","select","toggle","_sfc_main$1s","ControlButton","showLeft","menuOn","enableMenu","on","_component_v_menu","_component_control_button","_normalizeClass","_sfc_main$1r","cropStore","clickEvent","createEventHook","useResetViewsEvents","_sfc_main$1q","_resolveComponent","itemsToRender","doneDisabled","cancel","onDelete","isUniqueEditingName","uniqueNameRule","selectedLabel","editingLabelID","editDialog","editState","editingLabel","invalidNames","currentName","makeUniqueName","uniqueName","createLabel","startEditing","stopEditing","commit","deleteEditingLabel","_sfc_main$1i","panel","windowingDefaults","viewIDs","parseLabel","ctTags","showCtPresets","wlDefaults","wlConfig","wlWidth","wlLevel","wlOptions","defaultWidth","defaultLevel","useAuto","newValue","WLPresetsCT","WLAutoRanges","_component_v_expansion_panels","_component_v_expansion_panel","_component_v_expansion_panel_title","_component_v_expansion_panel_text","_component_v_radio_group","_Fragment","_renderList","_component_v_radio","wl","_sfc_main$1h","MenuControlButton","ItemGroup","GroupableItem","CropControls","ResetViews","RulerControls","RectangleControls","PolygonControls","WindowLevelControls","noCurrentImage","currentTool","currentLayout","isObliqueLayout","paintMenu","cropMenu","windowingMenu","nameToShortcut","_pushScopeId","_popScopeId","_component_item_group","_component_menu_control_button","_component_groupable_item","MessageTypeClass","_sfc_main$1g","_sfc_main$1f","MessageItem","showErrors","showWarnings","showInfo","filteredMessages","show","deleteItem","messageID","_component_v_checkbox","_component_message_item","useViewLayout","layoutName","useSaveControls","remoteSaveStateStore","saveDialog","useMessageBubble","badgeColor","useServerConnection","icon","settingsDialog","messageDialog","connIcon","handleSave","msgCount","msgBadgeColor","errorStore","isRemoteSaveDisabled","dataSecurityDialog","onVTKEvent","vtkObj","eventHookName","listenerRef","stop","listener","onScopeDispose","batchForNextTask","timeout","useWebGLRenderWindow","container","renderWindowView","vtkOpenGLRenderWindow","watchPostEffect","onCleanup","useWidgetManager","manager","vtkWidgetManager","updatePickingState","widgetCount","useVtkView","vtkRenderer","renderWindow","vtkRenderWindow","interactor","vtkRenderWindowInteractor","widgetManager","deferredRender","immediateRender","requestRender","immediate","setSize","scaledWidth","scaledHeight","useElementSize","watchEffect","useVtkInteractorStyle","vtkCtor","style","vtkWarningMacro","watchCompare","newData","oldData","cleanupFn","innerOnCleanup","changed","stableDeepRef","sourceRef","stableRef","addManipulator","manip","removeManipulator","useVtkInteractionManipulator","stableProps","toRef","oldManipulator","eyeFrameDimIndices","lookAxis","eyeUpAxis","computeParallelScale","viewUpAxis","viewSize","widthIndex","heightIndex","dimAspect","viewWidth","viewHeight","viewAspect","resizeToFit","upAxis","positionCamera","camera","directionOfProjection","viewUp","focalPoint","resetCameraToImage","viewDirection","worldBounds","lpsDirections","camerViewUp","resizeToFitImage","viewDirAxis","dimsWithSpacing","onPausableVTKEvent","paused","pause","resume","withPaused","vtkFieldRef","fieldNameOrFactory","setter","getterName","capitalize","setterName","_getter","_setter","notNull","hasSetter","set","customRef","track","trigger","onModified","triggerRef","guardedWritableRef","accept","usePersistCameraConfig","cameraRefs","refs","incoming","configRefs","viewIDVal","dataIDVal","syncRef","VtkViewContext","vtkContainerRef","imageMetadata","scope","effectScope","interactorStyle","vtkInteractorStyleManipulator","vtkMouseCameraTrackballPanManipulator","vtkMouseCameraTrackballZoomManipulator","vtkMouseCameraTrackballRotateManipulator","resetCamera","watchImmediate","noAutoReset","__expose","useVtkRepresentation","vtkActorClass","vtkMapperClass","actor","mapper","property","useResliceRepresentation","sliceRep","vtkImageSlice","vtkImageResliceMapper","useWindowingConfig","generateComputed","slicePlane","SlabTypes","useVtkFilter","filterClass","filter","mtime","port","getOutputData","computedWithControl","thickness","outline","vtkImageDataOutlineFilter","cutterFilter","vtkCutter","rep","vtkActor","vtkMapper","slicePlaneNormal","slicePlaneOrigin","syncRefs","matchesViewFilter","filterSpec","byViewType","byViewIds","mergeArrayFilters","arr1","arr2","mergeViewFilters","filterSpecs","useViewAnimationStore","animating","requestors","shallowRef","viewFilter","requestor","useViewAnimationListener","viewId","canAnimate","requested","viewVal","mapAxisToViewType","resetReslicePlanes","resliceCursorState","useResliceInit","resliceCursor","currentImageData","useResliceCursorStore","vtkResliceCursorWidget","vtkView","slices","resliceStore","resliceCenter","obliqueSliceProps","sliceSpec","outlineColor","vec3.scale","OBLIQUE_OUTLINE_COLORS","isViewMounted","onViewMounted","isMounted","onViewUnmounted","viewAxis","resliceCursorStore","widget","vtkViewType","useAutoFitState","autoFit","withoutAutoFitEffect","autoFitImage","useResizeObserver","THROTTLE_THRESHOLD","getVolumeMapperContext","vol","useWebGLWatchdog","reportError","useThrottleFn","Messages","contexts","captureMessage","renWinView","useEventListener","toOrderedLabels","vec","useOrientationLabels","top","left","bottom","right","updateAxes","vup","vdir","vright","vec3.cross","vbottom","vleft","dicomInfo","studyInfo","patientID","studyID","studyDescription","seriesNumber","seriesDescription","topLabel","leftLabel","sliceRange","windowWidth","windowLevel","useAutoRangeValues","histogram","dataRange","numberOfBins","hist","scalarData","cumm","WL_HIST_BINS","prev","startIdx","endIdx","useWindowingConfigInitializer","windowConfig","autoRangeValues","autoRange","firstTag","windowLevels","viewIdVal","firstTagVal","forcedWL","percentile","DEFAULT_STEP","useMouseRangeManipulatorListener","step","initialValue","newRange","removerName","manipulatorConfig","rangeManipulator","vtkMouseRangeManipulator","computeStep","wlStep","horiz","vert","manipulatorConstructor","manipulatorProps","draggableManipulatorProps","windowingManipulatorProps","widgetViewType","slicePlaneRange","cornerPoints","sliceNormal","vtkMatrixBuilder","corners","pt","minX","maxX","imageCorners","ymin","ymax","zmin","zmax","sliceDomain","updateResliceCamera","resetFocalPoint","useSliceRepresentation","vtkImageMapper","ijkIndex","SlicingMode","colorLevel","colorWindow","CONFIG_NAME","defaultConfig","useSegmentGroupConfigStore","aConfig","firstViewID","firstDataID","useGlobalSegmentGroupConfig","dataId","useLayerConfigInitializerForSegmentGroups","layerId","coloringStore","colorConfig","layerIdVal","useSegmentGroupConfigInitializer","segmentGroupId","configStore","config_","segmentationId","segmentationStore","vtkColorTransferFunction","vtkPiecewiseFunction","InterpolationType","visibility","opacity","parentImageId","parentMetadata","storedSlice","cfun","ofun","maxValue","segId","g","outlineThickness","largestValue","segThicknesses","useLayerConfigInitializer","applyColoring","colorFunction","opacityFunction","componentIndex","mappingRange","vtkPiecewiseGaussianWidget","opacityPoints","useColoringEffect","colorTransferFunction","parentId","coloringConfig","wheneverImageLoaded","cb","hasImageData","newVal","oldVal","useSliceInfo","axisDirection","useVTKViewContainer","useVTKMultiWorldToDisplay","displayCoords","ren","disp","useVTKMultiWorldToSVG","xy","_sfc_main$Y","cursor","grabLineEl","focusWidth","down","hover","$setup","$data","computeCropLines","cropAxis","cropPlanes","boundary","cropAxisVal","cropPlanesVal","boundaryVal","sliceInfo","perpAxis","ax","cropRange","perpRange","perpBoundary","sliceCropRange","outOfBounds","getLineSegments","startEdge","startCrop","endCrop","endEdge","cropLinesToSVGDisplay","cropLines","worldPoints","indexLPSPoint","indexPt","svgPoints","useDragging","mouseEventToLPSPoint","getCropEdgePos","setCropEdgePos","activeAxis","activeEdge","initialPointerIndex","initialCrop","viewAnimationStore","selectedCropEdge","initialPoint","delta","_sfc_main$X","Crop2DLineHandle","imageExtent","currentSlicingAxis","inPlaneAxes","ax1","ax2","ax1Lines","ax2Lines","ax1SVGLines","ax2SVGLines","onPointerDown","onPointerMove","onPointerUp","coord","lower","upper","newPlanes","_component_crop_2D_line_handle","isValidCroppingPlanes","lpsPlanesEqual","_sfc_main$W","croppingPlanes","vtkImageCroppingWidget","onBeforeUnmount","applyPlanes","lpsPlanes","dirs","planesFromStore","_sfc_main$V","Crop2D","Crop3D","_component_crop_3D","_component_crop_2D","updatePlaneManipulatorFor2DView","_sfc_main$U","vtkPlaneManipulator","_sfc_main$T","position2D","updatePoints","viewRenderer","_sfc_main$S","CrosshairsWidget2D","CrosshairSVG2D","isVisible","crosshairsSlice","_component_CrosshairsWidget2D","_withDirectives","_component_CrosshairSVG2D","_sfc_main$R","paintStore","widgetFactory","viewAxisIndex","worldPointToIndex","worldPoint","checkIfPointerInView","_sfc_main$Q","PaintWidget2D","_component_PaintWidget2D","usePopperState","delay","isSet","delayedSet","useDebounceFn","SHOW_OVERLAY_DELAY","doesToolFrameMatchViewAxis","toolAxis","useCurrentTools","curImageID","useContextMenu","contextMenu","useRightClickContextMenu","displayXY","useHoverEvent","useHover","toolHoverState","toolsOnCurrentSlice","toolsHovers","onHover","synchronousOverlayInfo","visibleToolID","showOverlay","resetOverlay","overlayInfo","usePlacingAnnotationTool","id_","add","useWidgetVisibility","visible","shallowReactive","deleteToolFromContextMenu","hideToolFromContextMenu","TOOLTIP_PADDING_X","TOOLTIP_PADDING_Y","tooltip","content","useFrameOfReference","lpsIdx","vtkLineGlyphRepresentation","cylinderScale","states","vtkGlyph3DMapper","scales","allocateArray","nextOrigin","vtkMath.subtract","length","vtkMath.normalize","scaleFactor","getPixelWorldHeightAtCoord","cylinderDirection","OrientationModes","up","vtkMath.perpendiculars","Behavior","vtkCylinderSource","vtkGlyphRepresentation","LineGlyphRepresentation","FINISHABLE_DISTANCE","FINISHABLE_DISTANCE_SQUARED","DOUBLE_CLICK_TIMEOUT","DOUBLE_CLICK_SLIP_DISTANCE_MAX","DOUBLE_CLICK_SLIP_DISTANCE_MAX_SQUARED","setDragging","overUnselectedHandle","freeHanding","checkOverSegment","selections","reset","removeLastHandle","handles","finishPlacing","isFinishable","moveHandle","moveCoords","firstCoords","cssPixelDistance","updateActiveStateHandle","addHandle","activeWidget","lastReleaseTime","lastReleasePosition","isDoubleClick","currentTime","currentDisplayPos","elapsed","distance","doubleClicked","makeWidgetActions","widgetActions","activeState","overSegment","insertIndex","newHandle","eventWithWidgetAction","vtkWidgetState","vtkAnnotationWidgetState","DIAMETER","PICKABLE_ANNOTATION_TOOL_HANDLE_RADIUS","_createPointState","visibleMixin","scale1Mixin","getTool","createPointState","DEFAULT_EPSILON","decimate","polyline","numPoints","epsilonSquared","partitionQueue","polylinePointFlags","numDecimatedPoints","startIndex","endIndex","maxDistSquared","maxDistIndex","currentPoint","distSquared","vtkLine","decimatedPolyline","srcIndex","dstIndex","MoveHandleLabel","HandlesLabel","HANDLE_PIXEL_SIZE","DECIMATE_PIXEL_SIZE_FACTOR","vtkPolygonWidgetState","addPoint","handleModel","handlePublicAPI","removeIndex","addPointsAsHandles","placing","imageMeta","pixelScale","optimizedLine","_createPolygonWidgetState","createPolygonWidgetState","vtkPolygonWidget","vtkSphereHandleRepresentation","vtkWidgetFactory$1","POINT_RADIUS","ANNOTATION_TOOL_HANDLE_RADIUS","FINISHABLE_POINT_RADIUS","_sfc_main$N","movePoint","finishable","showHandles","finishPossible","handleVisibility","firstHandleVisibility","handlePoints","linePoints","moveHandlePoint","radius","_sfc_main$M","SVG2DComponent","toolId","isPlacing","vtkWidgetFactory","lastHoverEventData","dragging","_component_SVG2DComponent","useActiveToolStore","toolType","_sfc_main$L","PolygonWidget2D","AnnotationContextMenu","AnnotationInfo","isToolActive","frameOfReference","placingTool","mergeKey","onToolPlaced","newToolId","openContextMenu","currentTools","mergePossible","_component_polygon_widget_2D","_component_annotation_context_menu","_normalizeProps","_guardReactiveProps","_component_v_list_item","_component_v_list_item_title","_component_annotation_info","InteractionState","draggingState","originalSetInteractionState","intState","PointsLabel","vtkRulerWidgetState","_createRulerWidgetState","createRulerWidgetState","vtkRulerWidget","second","vtkRulerWidget$1","_sfc_main$K","textOffset","pt1","pt2","textProperties","_sfc_main$J","RulerSVG2D","rulerStore","ruler","visibleStates","updateVisibleState","_component_RulerSVG2D","_sfc_main$I","RulerWidget2D","onRulerPlaced","currentRulers","_component_ruler_widget_2D","vtkRectangleLineRepresentation","superGetRepresentationStates","compositeState","cornerStates","superBehavior","behaviorModel","publicAPIy","bModel","box","displayPos","corners2D","outCorners","corner","outCorner","vtkMath.areEquals","cornerIndex","stateIndex","worldPos","vtkRectangleLineRepresentation$1","vtkRectangleWidget","superGetRepresentationsForViewType","reps","vtkRectangleWidget$1","_sfc_main$H","rectangle","firstX","firstY","secondX","secondY","_d","RectangleSVG2D","_sfc_main$G","_sfc_main$F","RectangleWidget2D","_component_rectangle_widget_2D","withModifiers","selectedData","WIDGET_PRIORITY","render","DEFAULT_PADDING","updateRectangle","screenBounds","maxY","handleRadius","handleDiameter","getYOffsetFromTransform","matStr","entries","handleStyles","newSlice","frac","_normalizeStyle","useSliceConfigInitializer","slicingDomain","domainArg","domain","loading","configExisted","scroll","currentLayers","isImageLoading","segmentations","selectionPoints","useVolumeRepresentation","vtkVolume","vtkVolumeMapper","useVolumeColoringInitializer","isViewAnimating","isAnimating","setCinematicLighting","lightFollowsCamera","light","setCinematicVolumeSampling","quality","dims","spatialDiagonal","vec3.length","sampleDistance","samplesPerRay","setCinematicVolumeShading","ambient","diffuse","specular","getDiagonalLength","setCinematicVolumeScatter","blending","setCinematicLocalAmbientOcclusion","kernelSize","kernelRadius","useCroppingEffect","oldPlanes","cvrParams","cvrEnabled","volumetricScatteringBlending","volumeQuality","useLocalAmbientOcclusion","useVolumetricScatteringBlending","laoKernelRadius","laoKernelSize","dataArray","comp","DEFAULT_CORNER","Corners","DEFAULT_VIEWPORT_SIZE","useOrientationMarker","vtkOrientationMarkerWidget","actorVal","viewportSize","vtkAnnotatedCubeActor","AnnotatedCubePresets","ViewTypeToComponent","SliceViewer","VolumeViewer","ObliqueSliceViewer","MultiObliqueSliceViewer","_sfc_main$w","viewSpecs","flexFlow","viewIDToSpecs","_component_layout_grid","_resolveDynamicComponent","disabled","zIndex","colorAsStyle","colorAsClass","scrimClasses","classes","scrimStyles","styles","containerStyles","_sfc_main$u","PersistentOverlay","_component_v_hover","isHovering","_component_v_container","_component_v_row","_component_v_col","_component_persistent_overlay","_sfc_main$t","ImageListCard","status","clearLoadedStatus","downloadSample","sample","percent","sampleFile","isDone","isError","isLoaded","_component_image_list_card","_createSlots","_component_v_progress_circular","ThumbnailSlice","ThumbnailSlice2","scalarImageToImageData","scaleMin","scaleMax","arr32","factor","byte","generateThumbnail","whichSlice","sliceData","sliceOffset","createVTKImageThumbnailer","ctx","resizeCanvas","resizeContext","resizeWidth","resizeHeight","useMultiSelection","allItems","selected","selectedSome","selectedAll","imageCacheKey","_sfc_main$s","nonDICOMImages","layerImageIDs","loadedLayerImageIDs","selectedImageID","isLayer","layerLoaded","layerLoading","layerable","s","thumbnails","thumbnailer","imageIDs","canvasIM","imageURI","aspectRatio","idLookup","sameSpaceImages","toggleSelectAll","convertToLabelMap","_vShow","_component_v_list","dicomCacheKey","itkImageToURI","itkBuf","generateDICOMThumbnail","_sfc_main$r","primarySelectionRef","layerVolumes","layerVolumeKeys","loadedLayerVolumeKeys","selectedVolumeKey","thumbnailCache","thumb","encodedImage","lookup","_sfc_main$q","PatientStudyVolumeBrowser","selPatient","patientStudies","studyVolumes","studyKeys","panels","_component_patient_study_volume_browser","percentDone","_sfc_main$p","dicomWebStore","volumeKeysWithInstanceInfo","volumeInstances","isFetching","rows","columns","downloadDicom","_sfc_main$o","StudyVolumeDicomWeb","_component_study_volume_dicom_web","_sfc_main$n","PatientDetails","dicomWebMeta","patients","patientKeys","_component_patient_details","SAMPLE_DATA_KEY","ANONYMOUS_DATA_KEY","DICOM_WEB_KEY","_sfc_main$m","SampleDataBrowser","ImageDataBrowser","PatientBrowser","PatientList","dataBrowserStore","hasAnonymousImages","showAnonymous","patients_","showPatients","hideSampleData","_component_patient_browser","TARGET_VIEW_ID","LIGHTING_MODELS","_sfc_main$l","volumeColorConfig","setCVRParam","laoEnabled","vsbEnabled","lightingModel","selectLightingMode","volumeQualityLabels","showQualityWarning","disableQualityWarning","_component_v_slider","_component_v_btn_toggle","registerPresets","presets","MedicalPresets","twoHotOpaque","GroupedPresets","PresetNameList","group","Mode","ADJUST_POSITION_CURSOR","samplePiecewiseLinear","samples","filledPoints","sampledPoints","pi","slope","sx","vtkPiecewiseWidget","superClass","mouseCoords","normCoords","vtkPiecewiseWidget$1","targetElRef","observer","targetEl","prevTarget","createRenderingPipeline","updateRenderingProperty","createVolumeThumbnailer","scene","vtkGenericRenderWindow","opacityFuncProxy","colorTransferFuncProxy","vtkLookupTableProxy","useCameraOrientation","imageMetadataRef","orientationMatrix","cameraDirVec","cameraUpVec","resetOpacityFunction","pwfProxy","pointsNormalized","useVolumeThumbnailing","thumbnailSize","currentThumbnails","interruptSentinel","doThumbnailing","localSentinel","helper","opRange","LookupTableProxyMode","renWin","imageURL","WIDGET_WIDTH","WIDGET_HEIGHT","THUMBNAIL_SIZE","_sfc_main$k","editorContainerRef","pwfEditorRef","recurseGuard","colorTransferFunctionRef","pwfWidget","colorTransferFunc","pwfSubscriptions","updateOpacityFunc","animationRequested","request3DAnimation","cancel3DAnimation","func","selectedPreset","hasCurrentImage","fullMappingRange","fullMappingRangeWidth","selectPreset","rangeShift","rangeWidth","onKeyUp","fullRange","fullWidth","low","high","_sfc_main$j","effectiveMappingRange","rgbPoints","updateColorMappingRange","VIEWS_2D","_sfc_main$i","imageName","layerConfigs","blendConfig","_sfc_main$h","LayerProperties","_component_layer_properties","_sfc_main$g","VolumeRendering","VolumePresets","VolumeProperties","LayerList","hasLayers","_component_volume_rendering","MultipleSelectionState","MultipleSelectionState2","useMultipleToolSelection","collection","idToType","newSelection","selectionState","coll","getTools","MeasurementToolDetails","toggled","selectAll","deselectAll","shouldSelectAll","removeAll","allHidden","forEachSelectedTool","toggleGlobalHidden","hidden","useGlobalLayerColorConfig","groupId","sampledConfig","layerUpdateFunctions","setOpacity","updateFn","groupUpdateFunctions","outlineOpacity","rgbaToHexa","rgba","hexaToRGBA","hexa","addNewSegment","selectedSegment","segments_","toggleVisible","allVisible","toggleGlobalVisible","editingSegmentValue","editingSegment","deleteEditingSegment","EXTENSIONS","fileFormat","saveSegmentGroup","UNNAMED_GROUP_NAME","currentSegmentGroups","currentBlend","currentSegmentGroupID","deleteGroup","editingGroupID","editingMetadata","editingNameConflict","createSegmentGroup","copied","segmentGroupConvertibles","createSegmentGroupFromImage","saveId","openSaveDialog","segGroupIds","toggleGlobalVisibility","shouldShow","deleteSelected","_sfc_main$8","_component_v_item_group","_component_v_item","selectedClass","PaintControls","Tabs","MeasurementTools","MeasurementRulerDetails","MeasurementToolTypes","tab","autoFocusTab","ready","sumOp1","sumOp2","doSumLoading","doSum","trivia","triviaLoading","getTrivia","streamProgress","streamLoading","streamProgressText","onStreamData","startStream","medianFilterLoading","medianFilterRadius","doMedianFilter","Modules","DataBrowser","AnnotationsModule","RenderingModule","ServerModule","autoSwitchToAnnotationsTools","_sfc_main$3","selectedModuleIndex","newTool","modules","_component_v_tabs","_component_v_tab","_component_v_window","mod","_component_v_window_item","readAllDirEntries","dirEntry","allEntries","entryToFile","readAllFiles","toProcess","fileEntries","types","bindings","useGlobalErrorHook","onError","errorMessage","captureException","stripTokenFromUrl","populateAuthorizationToken","urlParams","ControlsStrip","LayoutGrid","DragAndDrop","ModulePanel","ControlsModal","WelcomePage","AppBar","hasData","showLoading","defaultImageMetadataName","newMetadata","_component_drag_and_drop","dragHover","_component_v_app","_component_app_bar","_component_module_panel","_component_v_main","_component_controls_strip","_component_welcome_page","ITK_IMAGE_MIME_TYPES","extensionToImageIo","itkReader","convertItkToVtkImage","registerAllReaders","readerMap","CorePiniaProviderPlugin","dependencies","PaintTool","patchExitPointerLock","exitPointerLock","setPipelinesBaseUrl","setPipelineWorkerUrl","imageIoSetPipelinesBaseUrl","pinia","createPinia","createApp","App","initErrorReporting","VueToast","vuetify"],"mappings":"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"}